{
  "response": [
    {
      "text": "实时查询ERP系统维修保养单的数据日志信息",
      "description": "实时查询ERP系统维修保养单的数据日志信息",
      "scriptContent": "String expMsg = \"\";\nMap rsmap = new HashMap();\nif (message.getExceptionPayload() != null)\n{\n    message.setOutboundProperty(\"http.status\", 200);\n    expMsg = message.getExceptionPayload().getRootException().getMessage();\n    if (expMsg.length() > 3500)\n    {\n        expMsg = expMsg.substring(0, 3000);\n    }\n    message.setExceptionPayload(null);\n    rsmap.put(\"code\", \"0003\");\n    rsmap.put(\"msg\", \"同步失败！\");\n}\nelse\n{\n    rsmap.put(\"code\", \"0002\");\n    rsmap.put(\"msg\", \"同步成功！\");\n    rsmap.put(\"data\", payload);\n}\nMap logmap = message.getInboundProperty(\"logmap\");\nObject[] o = new Object[10];\no[0] = \"\";\no[1] = \"\";\no[2] = \"\";\no[3] = \"\";\no[4] = logmap.get(\"begintime\");\no[5] = new java.text.SimpleDateFormat(\"yyyyMMdd HH:mm:ss.SSS\").format(new java.sql.Timestamp(java.lang.System.currentTimeMillis()));\no[6] = \"\";\no[7] = \"\";\no[8] = expMsg;\no[9] = \"ERP_RrpairConfirmation_To_BPM_L\";\ndbop.saveOrUpdate(\"insert into TRINA_SL_INTERFACE_LOG(id,flow,node,billkey,oid,starttime,endtime,request_data,response_data,EXCEPTION,interface_type)values(Trina_SL_Interface_Log_ID_SEQ.Nextval,?,?,?,?,?,?,?,?,?,?)\", o, false);\nreturn rsmap.get(\"code\");",
      "className": "com.bokesoft.exchange.transformer.ScriptWithDSTransformer",
      "smallType": "GroovyScriptWithDS",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "ds": "2c9081d05be7e572015be80fcb64000f",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff9c7b650061"
    }
  ],
  "normal": [
    {
      "text": "接收ERP系统维修保养单的数据集",
      "description": "接收ERP系统维修保养单的数据集",
      "address": "vm://ERP_RrpairConfirmation_To_BPM_L",
      "exchange_pattern": "request-response",
      "className": "",
      "smallType": "VM",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "inbound",
      "simpleMpLog": "false",
      "encoding": "UTF-8",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff906b660057"
    },
    {
      "text": "启动JDBC事务",
      "description": "启动数据库事务",
      "className": "com.bokesoft.dee.transport.transaction.StartTxTransformer",
      "smallType": "StartTxTransformer",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "GGPZTransformer",
      "isRef": "true",
      "id": "8aab8da76204bf1101620502a76e00bc"
    },
    {
      "text": "实时查询维修保养单明细数据",
      "description": "查询维修保养单明细数据",
      "tablePath": "B_RrpairConfirmation",
      "query": "select quantity_ordered as assetnum ,item_description as assetname ,po_line_id as line,pr_number as prnumber  from apps.cux3_po_eflow_acc_interface_v where type = 'P' and (task_id is null or task_id='') and po_number=#[map-payload:po_number]",
      "className": "com.bokesoft.dee.mule.dataimport.FieldValueLookUpWithDsTransformer",
      "smallType": "FieldValueLookUpWithDsTransformer",
      "subField": "B_RrpairConfirmationDtl",
      "firstRecode": "true",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "ds": "8aaae09b5bf03e9f015bf17bc58e061f",
      "isRef": "false",
      "id": "8aab8dab62085249016208573a500080"
    },
    {
      "text": "记录实时查询ERP系统维修保养单的数据开始时间",
      "description": "记录实时查询ERP系统维修保养单的数据开始时间",
      "scriptContent": "String begintime = new java.text.SimpleDateFormat(\"yyyyMMdd HH:mm:ss.SSS\").format(new java.sql.Timestamp(java.lang.System.currentTimeMillis()));\nMap logmap = new HashMap();\nlogmap.put(\"begintime\", begintime);\nmessage.setInboundProperty(\"logmap\", logmap);\ncom.bokesoft.InterfaceOperator.checkTransaction(dbop, \"ERP_RrpairConfirmation_To_BPM_L\");\nreturn payload;",
      "smallType": "GroovyScriptWithDS",
      "className": "com.bokesoft.exchange.transformer.ScriptWithDSTransformer",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "ds": "2c9081d05be7e572015be80fcb64000f",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff9632b7005b"
    },
    {
      "fixFields": "[{\"key\":\"mule.adapter.thing-name\",\"value\":\"B_RrpairConfirmation\"},{\"key\":\"mule.adapter.formKey\",\"value\":\"B_RrpairConfirmation\"},{\"key\":\"mule.adapter.op-plan\",\"value\":\"insert\"},{\"key\":\"mule.adapter.auto-delete-unknown-detail\",\"value\":\"B_RrpairConfirmationDtl\"},{\"key\":\"mule.adapter.start-workflow\",\"value\":\"0\"}]",
      "description": "设置BPM系统维修保养单主表信息",
      "text": "设置BPM系统维修保养单主表信息",
      "tablePath": "B_RrpairConfirmation",
      "smallType": "FixFieldsAddTransformerForYigo2",
      "className": "com.bokesoft.dee.mule.dataimport.FixFieldsAddTransformerForYigo2",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "isRef": "false",
      "rowNumColumn": "norowno",
      "id": "8aab8d9d61fe815c0161ff97b756005c"
    },
    {
      "fixFields": "[{\"key\":\"mule.adapter.thing-name\",\"value\":\"B_RrpairConfirmation\"},{\"key\":\"mule.adapter.op-plan\",\"value\":\"insert\"}]",
      "description": "设置BPM系统维修保养单从表的信息",
      "text": "设置BPM系统维修保养单从表的信息",
      "tablePath": "B_RrpairConfirmation/B_RrpairConfirmationDtl",
      "className": "com.bokesoft.dee.mule.dataimport.FixFieldsAddTransformerForYigo2",
      "smallType": "FixFieldsAddTransformerForYigo2",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "isRef": "false",
      "rowNumColumn": "norowno",
      "id": "8aab8d9d61fe815c0161ff989182005d"
    },
    {
      "text": "查询BPM系统维修保养单字典的信息",
      "description": "查询BPM系统维修保养单字典的信息",
      "tablePath": "B_RrpairConfirmation",
      "smallType": "MutiFieldValueLookUpWithDsTransformer",
      "className": "com.bokesoft.dee.mule.dataimport.MutiFieldValueLookUpWithDsTransformer",
      "firstRecode": "true",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "queries": "[{\"value\":\"select tag2 from OA_WorkflowDesigne_H where WorkflowFormKey='B_RrpairConfirmation' and tag1='OA_WorkflowType'\"},{\"value\":\"select '1' as isAutoGenerate, 'B_RrpairConfirmation'  as billkey,'21360'as applicatisid, '123038' as applicantaccount, '\刘\露 (Liu Lu)' as applicatis ,'21360' as applicantid from dual\"},{\"value\":\"select oid as cc_descriptions from OA_Department_H where name=#[map-payload:cc_description] and status=1\"},{\"value\":\"select oid as grade_leader_a_id , code as requestor, name as grade_leader_a from sys_operator where code=#[map-payload:requestor_number] and status=1\"},{\"value\":\"select code as applicantcode,name as applicantname, deptid as applicantdeptname,position_descr,adaccount from oa_employee_h where code=#[map-payload:agent_number] and (status=0 or status=1)\"},{\"value\":\"select oid as creator, code as creatorcode from sys_operator where code=#[map-payload:agent_number] and (status=0 or status=1)\"},{\"value\":\"select  group_name as creatordeptname from oa_employee_h where code=#[map-payload:agent_number] and (status=0 or status=1)\"}]",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "ds": "2c9081d05be7e572015be80fcb64000f",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff9958bd005e"
    },
    {
      "text": "设置查询的数据集与BPM系统的维修保养单字段进行映射",
      "description": "设置查询的数据集与BPM系统的维修保养单字段进行映射",
      "className": "com.bokesoft.dee.mule.yigo2.transformer.MapKeyMapping",
      "smallType": "MapKeyMapping",
      "fieldExpression": "[{\"one\":\"po_header_id\",\"two\":\"HeadID\",\"three\":\"0\",\"four\":\"1\",\"five\":\"po_header_id\"},{\"one\":\"po_number\",\"two\":\"poNo\",\"three\":\"0\",\"four\":\"1\",\"five\":\"po_number\"},{\"one\":\"vendor_name\",\"two\":\"r_company\",\"three\":\"0\",\"four\":\"1\",\"five\":\"vendor_name\"},{\"one\":\"isautogenerate\",\"two\":\"isAutoGenerate\",\"three\":\"0\",\"four\":\"1\",\"five\":\"isautogenerate\"},{\"one\":\"cc_descriptions\",\"two\":\"dept\",\"three\":\"0\",\"four\":\"1\",\"five\":\"cc_descriptions\"},{\"one\":\"grade_leader_a_id\",\"two\":\"Grade_leader_A_ID\",\"three\":\"0\",\"four\":\"1\",\"five\":\"grade_leader_a_id\"},{\"one\":\"requestor\",\"two\":\"requestor\",\"three\":\"0\",\"four\":\"否\",\"five\":\"requestor\"},{\"one\":\"grade_leader_a\",\"two\":\"Grade_leader_A\",\"three\":\"0\",\"four\":\"1\",\"five\":\"grade_leader_a\"},{\"one\":\"applicatisid\",\"two\":\"applicatisID\",\"three\":\"0\",\"four\":\"1\",\"five\":\"applicatisid\"},{\"one\":\"applicantaccount\",\"two\":\"applicantaccount\",\"three\":\"0\",\"four\":\"否\",\"five\":\"applicantaccount\"},{\"one\":\"applicatis\",\"two\":\"applicatis\",\"three\":\"0\",\"four\":\"否\",\"five\":\"applicatis\"},{\"one\":\"applicantid\",\"two\":\"ApplicantID\",\"three\":\"0\",\"four\":\"1\",\"five\":\"applicantid\"},{\"one\":\"applicantcode\",\"two\":\"ApplicantCode\",\"three\":\"0\",\"four\":\"1\",\"five\":\"applicantcode\"},{\"one\":\"adaccount\",\"two\":\"ADAccount\",\"three\":\"0\",\"four\":\"1\",\"five\":\"adaccount\"},{\"one\":\"applicantname\",\"two\":\"ApplicantName\",\"three\":\"0\",\"four\":\"1\",\"five\":\"applicantname\"},{\"one\":\"position_descr\",\"two\":\"Position_Descr\",\"three\":\"0\",\"four\":\"1\",\"five\":\"position_descr\"},{\"one\":\"applicantdeptname\",\"two\":\"ApplicantDeptName\",\"three\":\"0\",\"four\":\"1\",\"five\":\"applicantdeptname\"},{\"one\":\"creator\",\"two\":\"Creator\",\"three\":\"0\",\"four\":\"1\",\"five\":\"creator\"},{\"one\":\"creatorcode\",\"two\":\"CreatorCode\",\"three\":\"0\",\"four\":\"1\",\"five\":\"creatorcode\"},{\"one\":\"creatordeptname\",\"two\":\"CreatorDeptName\",\"three\":\"0\",\"four\":\"1\",\"five\":\"creatordeptname\"},{\"one\":\"billkey\",\"two\":\"billkey\",\"three\":\"0\",\"four\":\"否\",\"five\":\"billkey\"},{\"one\":\"tag2\",\"two\":\"WorkflowTypeDtlID\",\"three\":\"0\",\"four\":\"1\",\"five\":\"tag2\"},{\"one\":\"b_rrpairconfirmationdtl\",\"two\":\"B_RrpairConfirmationDtl\",\"three\":\"0\",\"four\":\"1\",\"five\":\"b_rrpairconfirmationdtl\"},{\"one\":\"B_RrpairConfirmationDtl.assetnum\",\"two\":\"B_RrpairConfirmationDtl.AssetNum\",\"three\":\"0\",\"four\":\"1\",\"five\":\"assetnum\"},{\"one\":\"B_RrpairConfirmationDtl.line\",\"two\":\"B_RrpairConfirmationDtl.Line\",\"three\":\"0\",\"four\":\"1\",\"five\":\"line\"},{\"one\":\"B_RrpairConfirmationDtl.assetname\",\"two\":\"B_RrpairConfirmationDtl.AssetName\",\"three\":\"0\",\"four\":\"1\",\"five\":\"assetname\"},{\"one\":\"B_RrpairConfirmationDtl.prnumber\",\"two\":\"B_RrpairConfirmationDtl.PRNumber\",\"three\":\"0\",\"four\":\"1\",\"five\":\"prnumber\"}]",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff9aec55005f"
    },
    {
      "isInTransaction": "true",
      "yigoUrl": "BD{YIGO2_URL}",
      "text": "导入数据到BPM系统",
      "description": "导入数据到BPM系统",
      "connectTimeout": 6000,
      "isThrowException": "true",
      "smallType": "YIGO2.0",
      "className": "",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "enable": "true",
      "bigType": "outbound",
      "simpleMpLog": "false",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff9b91830060",
      "readTimeout": 60000
    },
    {
      "text": "提交或者回滚JDBC事务",
      "description": "提交或者回滚数据库事务",
      "smallType": "FinishTxTransformer",
      "className": "com.bokesoft.dee.transport.transaction.FinishTxTransformer",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "GGPZTransformer",
      "isRef": "true",
      "id": "8aab8da76204bf11016205076ff700bd"
    }
  ],
  "exception": [
    {
      "text": "提交或者回滚JDBC事务",
      "description": "提交或者回滚数据库事务",
      "className": "com.bokesoft.dee.transport.transaction.FinishTxTransformer",
      "smallType": "FinishTxTransformer",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "GGPZTransformer",
      "isRef": "true",
      "id": "8aab8da76204bf1101620507e27900be"
    },
    {
      "text": "把异常对象转换为文本",
      "description": "把异常对象转换为文本",
      "smallType": "ExceptionMessageTransformer",
      "className": "com.bokesoft.exchange.transformer.ExceptionMessageTransformer",
      "enable": "true",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "GGPZTransformer",
      "isRef": "true",
      "id": "8aab8d9d61fe815c0161ff74db06004a"
    },
    {
      "path": "${bokedee.logpath.runtimeLog}/ERP_RrpairConfirmation_To_BPM",
      "text": "记录错误日志到文件_ERP_RrpairConfirmation_To_BPM_L",
      "description": "",
      "smallType": "File",
      "className": "",
      "enable": "true",
      "outputPattern": "#[function:datestamp:yyyyMMddHHmmss]-#[message:id].xml",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "outbound",
      "file_subdir": "#[context:serviceName]/#[function:datestamp:yyyyMMdd]",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff74dbce004b"
    },
    {
      "text": "把异常信息替换换行符_ERP_RrpairConfirmation_To_BPM_L",
      "description": "把异常信息替换换行符",
      "scriptContent": "String exceptionContent = message.getPayload();String exception = exceptionContent.replace(\"\\n\", \"<br/>\");message.setPayload(exception);return message;",
      "className": "org.mule.module.scripting.transformer.ScriptTransformer",
      "smallType": "GroovyScriptTransformer",
      "enable": "false",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "transformer_au",
      "simpleMpLog": "false",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff74dc81004c"
    },
    {
      "text": "把异常信息通过邮件发送_ERP_RrpairConfirmation_To_BPM_L",
      "description": "把异常信息通过邮件发送",
      "connector_ref": "bokedee_default_smtp_connector",
      "subject": "ERP_RrpairConfirmation_To_BPM",
      "smallType": "SMTP",
      "className": "",
      "enable": "false",
      "parentId": "8aab8d9d61fe815c0161ff74dac90049",
      "bigType": "outbound",
      "encoding": "UTF-8",
      "isRef": "false",
      "id": "8aab8d9d61fe815c0161ff74dd40004d"
    }
  ]
}