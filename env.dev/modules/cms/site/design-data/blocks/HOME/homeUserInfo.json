{
	"@type":"com.bokesoft.cms2.impl.buildin.modelio.vo.BlockVO",
	"block":{
		"@type":"com.bokesoft.cms2.model.blocks.TmplBlock",
		"formulaText":"cms.PageExp.Local('username',oa.TodoMidExp.queryUserNameByID(cms.Yigo2MidExp.GetLoginOperator()));\ncms.PageExp.Local('EmpID',oa.TodoMidExp.queryEmpIDByID(cms.Yigo2MidExp.GetLoginOperator()));",
		"notes":"",
		"parameters":[],
		"tmplText":"#if($userid>0 && $emp.size()>0)\n<a class=\"\">\n<img id=\"popupUserInfo\" name=\"$code\" src=\"$emp.get(0).PICPATH\" onerror=\"javascript:this.src='${staticRoot}/resources/@buildin/images/default_photo.gif'\"/>\n</a>\n#else\n<img id=\"popupUserInfo\" name=\"$code\" src=\"${staticRoot}/resources/@buildin/images/default_photo.gif\"/>\n#end\n<div class=\"userinfo\">\n<h6 style=\"margin-top: 10px;\">欢迎您！<b> #if($username) $username #else 游客 $userid #end </b></h6>\n<p style=\"display:none;\"><a class=\"updatePWD\" >修改密码</a></p>\n</div>\n<script type=\"text/javascript\">\n\t$(\"#popupUserInfo\").click(function(){\n        openParentForm('OA_Employee',$EmpID); \n    })\n\t$(\".updatePWD\").click(function(){\n\t    cms.Page.popupDialog(480,340, function(dialog){//\"800是弹出层宽，600是弹出层高，function是回调函数\n\t    cms.Page.replaceRegion(\n\t\tdialog.contentSelector, \n\t\t\"/yigo/updatePWD.page\",\n\t\t{},\n\t\tfunction(htmlText){\n\t\t\t// 保存\n\t\t\t$(\"#savePas\").click(function(){\n\t\t\tvar oldPas = $(\"#oldPas\").val();\n\t\t\tvar newPas = $(\"#newPas\").val();\n\t\t\tvar confirmPas = $(\"#confirmPas\").val();\n\t\t\t\n\t\t\tif(newPas!=confirmPas){\n\t\t\t\talert(\"两次密码输入不一样，请重新输入!\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t//var re=/^[\\@A-Za-z0-9\\!\\#\\$\\%\\^\\&\\*\\.\\~]{6,22}$/;\n\t\t\t//只验证密码位数为6~16位 by zr in 2014-8-28\n\t\t\tvar re=/^[\\s]{0,}$|^[\\w\\s]{0,5}$|^[\\w\\s]{17,}$/;\n\t\t\tif(re.test(newPas)){\n\t\t\t\talert(\"密码位数必须为6~16位，请重新输入\");\n\t\t\t\treturn false;\n\t\t\t}\t\n\t\t\t$.ajax({\n\t\t\t\ttype:\"POST\",\n\t\t\t\tasync: true,        //异步\n\t\t\t\tcontentType:\"application/x-www-form-urlencoded; charset=UTF-8\", //发送至服务器的数据类型, 这个是默认值\n\t\t\t\turl:\"/yigo/savePassword.action\",     //要访问的后台地址，如：\"/demo/popup.page\"\n\t\t\t\tdata:{\n                    operatorid:$operatorId,\n\t\t\t\t\tprePwd: oldPas,\n\t\t\t\t\tpwd: newPas\n\t\t\t\t},\n\t\t\t\tdataType:'json',    //服务器返回的数据类型\n\t\t\t\tsuccess:function(htmlText){  \t\t\t\n\t\t\t\t\tif(htmlText.result == \"success\"){\n\t\t\t\t\t\talert(\"密码修改成功！\");\n\t\t\t\t\t\tdialog.close();\n\t\t\t\t\t}else{\n\t\t\t\t\t\talert(htmlText.result);\n\t\t\t\t\t\t$(\"#oldPas\").val(\"\");\n\t\t\t\t\t\t$(\"#newPas\").val(\"\");\n\t\t\t\t\t\t$(\"#confirmPas\").val(\"\");\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\terror:function(error){    \n\t\t\t\t\talert(error); //FIXME: 错误处理太草率\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t// 取消\n\t\t\t$(\"#cancelPas\").click(function(){\n\t\t\t\t$(\"#oldPas\").val(\"\");\n\t\t\t\t$(\"#newPas\").val(\"\");\n\t\t\t\t$(\"#confirmPas\").val(\"\");\n\t\t\t\tdialog.close();\n\t\t\t});\n\t\t});\n\t }); \n\t});\n</script>",
		"type":"TMPL"
	},
	"code":"homeUserInfo",
	"name":"首页用户信息",
	"params":[]
}