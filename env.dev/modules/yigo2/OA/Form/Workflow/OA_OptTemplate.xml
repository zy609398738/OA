<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="OA_OptTemplate" Caption="审批操作模板" FormType="View">
    <DataSource>
        <DataObject Key="OA_OptTemplate" Caption="审批操作模板" PrimaryTableKey="OA_OptTemplate">
            <TableCollection>
                <Table Key="OA_OptTemplate" Caption="审批操作模板" TableMode="Detail" SourceType="Query" Persist="false">
                    <Column Key="OID" Caption="对象标识" DataType="Long"/>
                    <Column Key="SOID" Caption="主对象标识" DataType="Long"/>
                    <Column Key="POID" Caption="父对象标识" DataType="Long"/>
                    <Column Key="VERID" Caption="对象版本" DataType="Integer"/>
                    <Column Key="DVERID" Caption="对象明细版本" DataType="Integer"/>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <OperationCollection>
        <Operation Key="OPTAudit" Caption="审批">
            <Action>
                <![CDATA[if(!ToBool(Para("IsMobile"))){
    if(ContainsKey("WorkflowTypeDtlID")){
        ShowModal("OA_AuditDialog","OptKey:{'OPTAudit'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()},WorkflowTypeDtlID:{WorkflowTypeDtlID}");
    }else{
        ShowModal("OA_AuditDialog","OptKey:{'OPTAudit'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()}");
    }
}else{
    Show("MOA_AuditDialog","newtab","pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()},WorkflowTypeDtlID:{WorkflowTypeDtlID}");
}]]>
            </Action>
        </Operation>
        <Operation Key="OPTEndorse" Caption="加签">
            <Action>
                <![CDATA[ShowModal("OA_EndorseDialog","pWorkitemID:{GetActiveWorkitemID()}");]]>
            </Action>
        </Operation>
        <Operation Key="OPTKillInstance" Caption="终止">
            <Action>
                <![CDATA[SetValue("Status", 2000);
SaveData();
KillInstance(-1);
Confirm("流程终止");]]>
            </Action>
        </Operation>
        <Operation Key="OPTEndInstance" Caption="结束">
            <Action>
                <![CDATA[ShowModal("OA_EndInstanceDialog");]]>
            </Action>
        </Operation>
        <Operation Key="OPTPauseInstance" Caption="暂停">
            <Action>
                <![CDATA[PauseInstance(-1);
Confirm("暂停成功");]]>
            </Action>
        </Operation>
        <Operation Key="OPTRestartInstance" Caption="重置">
            <Action>
                <![CDATA[SetValue("Status", 1100);
SaveData();
RestartInstance(-1);
Confirm("流程已重置");]]>
            </Action>
        </Operation>
        <Operation Key="OPTRollBackToWorkitem" Caption="撤销">
            <Action>
                <![CDATA[RollbackToWorkitem(-1);
Confirm("撤销成功");]]>
            </Action>
        </Operation>
        <Operation Key="OPTTransferTask" Caption="指派">
            <Action>
                <![CDATA[ShowModal("OA_TransferTask","pWorkitemID:{GetActiveWorkitemID()}");]]>
            </Action>
        </Operation>
        <Operation Key="OPTApprove" Caption="通过">
            <Action>
                <![CDATA[if(ContainsKey("WorkflowTypeDtlID")){
    ShowModal("OA_Approve","OptKey:{'OPTApprove'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()},WorkflowTypeDtlID:{WorkflowTypeDtlID}");
}else{
    ShowModal("OA_Approve","OptKey:{'OPTApprove'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()}");
}
]]>
            </Action>
        </Operation>
        <Operation Key="OPTReject" Caption="撤回">
            <Action>
                <![CDATA[if(ContainsKey("WorkflowTypeDtlID")){
    ShowModal("OA_Reject","OptKey:{'OPTReject'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()},WorkflowTypeDtlID:{WorkflowTypeDtlID}");
}else{
    ShowModal("OA_Reject","OptKey:{'OPTReject'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()}");
}
]]>
            </Action>
        </Operation>
        <Operation Key="OPTTransit" Caption="直送">
            <Action>
                <![CDATA[CommitWorkitem(-1, 1,"",{pattern:{Transit}});
Confirm("直送成功");]]>
            </Action>
        </Operation>
        <Operation Key="OPTCirculation" Caption="传阅">
            <Action>
                <![CDATA[if(ContainsKey("WorkflowTypeDtlID")){
    ShowModal("OA_CirculationDialog","OptKey:{'OPTCirculation'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()},WorkflowTypeDtlID:{WorkflowTypeDtlID}");
}else{
    ShowModal("OA_CirculationDialog","OptKey:{'OPTCirculation'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()}");
}
]]>
            </Action>
        </Operation>
        <Operation Key="OPTCommitAudit" Caption="提交">
            <Action>
                <![CDATA[CommitWorkitem(-1, 1, "");
Confirm("提交成功");]]>
            </Action>
        </Operation>
        <Operation Key="OPTRefuse" Caption="拒绝">
            <Action>
                <![CDATA[if(ContainsKey("WorkflowTypeDtlID")){
    ShowModal("OA_Refuse","OptKey:{'OPTRefuse'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()},WorkflowTypeDtlID:{WorkflowTypeDtlID}");
}else{
    ShowModal("OA_Refuse","OptKey:{'OPTRefuse'},pWorkitemID:{GetActiveWorkitemID()},workflowOID:{GetOID()},workflowBillKey:{GetFormKey()}");
}]]>
            </Action>
        </Operation>
        <Operation Key="OPTRejectT" Caption="直接撤回">
            <Action>
                <![CDATA[CommitWorkitem(-1,0,GetValue("AuditOpinion"));
Confirm("撤回成功");]]>
            </Action>
        </Operation>
        <Operation Key="OPTApproveT" Caption="直接通过">
            <Action>
                <![CDATA[OA_AuditBefore(false,-1,GetFormKey(),GetValue("WorkflowTypeDtlID"),GetOID());
CommitWorkitem(-1,1,GetValue("AuditOpinion"));
OA_AuditAfter(false,-1,GetFormKey(),GetValue("WorkflowTypeDtlID"),GetOID());
]]>
            </Action>
        </Operation>
        <Operation Key="OPTMeeting" Caption="会议审批">
            <Action>
                <![CDATA[CommitWorkitem(-1,1,"通过");
var OptID1=InvokeService("OA_GetOperatorIDsByEmp", true, false, Participants,",");
var OptID2=InvokeService("OA_GetOperatorIDsByEmp", true, false, Partake,",");
var OptIDs=OptID1+","+OptID2;
var messages=InvokeService("OA_SendMessage", true, false,true, "OA",ServerDate(),GetOperator(),Topic,NO,OptIDs,MessageSet,BillKey,NO,OID);
if(messages){Confirm("发送成功")}
else{"发送失败"}
]]>
            </Action>
        </Operation>
        <Operation Key="OPTCancelPause" Caption="取消暂停">
            <Action>
                <![CDATA[CanclePause(-1);
Confirm("取消暂停成功");]]>
            </Action>
        </Operation>
        <Operation Key="OPTRefuseT" Caption="直接拒绝">
            <Action>
                <![CDATA[var nodeid = InvokeService("OA_GetNodeIDByNodeKey",false,false,GetFormKey(),"Refuse");
CommitWorkitem(-1,0,GetValue("AuditOpinion"),{pattern:{Return},backSite:{nodeid}});
Confirm("拒绝成功");]]>
            </Action>
        </Operation>
    </OperationCollection>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="root" Caption="根面板">
                <ToolBar Key="ToolBar1" Height="pref" Caption="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <GridLayoutPanel Key="first_head" Padding="5px" Height="pref" Caption="基本信息">
                    <RowDefCollection RowGap="8">
                        <RowDef Height="25px"/>
                        <RowDef Height="25px"/>
                        <RowDef Height="25px"/>
                        <RowDef Height="25px"/>
                    </RowDefCollection>
                    <ColumnDefCollection ColumnGap="8">
                        <ColumnDef Width="5%"/>
                        <ColumnDef Width="15%"/>
                        <ColumnDef Width="61px"/>
                        <ColumnDef Width="15%"/>
                        <ColumnDef Width="5%"/>
                        <ColumnDef Width="15%"/>
                    </ColumnDefCollection>
                </GridLayoutPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
</Form>
