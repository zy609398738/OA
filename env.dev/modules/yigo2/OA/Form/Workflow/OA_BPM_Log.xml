<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Form Key="OA_BPM_Log" Caption="审批记录" FormType="Template">
    <DataSource>
        <DataObject Key="BPM_Log" Caption="审批记录">
            <TableCollection>
                <Table Caption="审批记录" DBTableName="BPM_Log" Key="BPM_Log" SourceType="Query" TableMode="Detail" Persist="false">
                    <Column Caption="工作项标识" DBColumnName="workItemID" DataType="Long" Key="workItemID"/>
                    <Column Caption="父对象标识" DBColumnName="workItemName" DataType="Varchar" Key="workItemName" Length="200"/>
                    <Column Caption="创建时间" DBColumnName="creatTime" DataType="DateTime" Key="creatTime"/>
                    <Column Caption="提交时间" DBColumnName="finishTime" DataType="DateTime" Key="finishTime"/>
                    <Column Caption="人员" DBColumnName="operatorID" DataType="Integer" Key="operatorID"/>
                    <Column Caption="审批意见" DBColumnName="userInfo" DataType="Varchar" Key="userInfo" Length="200"/>
                    <Column Caption="审批结果" DBColumnName="auditResult" DataType="Integer" Key="auditResult"/>
                    <Column Key="E_Signature" Caption="电子签名" DataType="Varchar" DBColumnName="E_Signature"/>
                    <Column Key="Srcoperatorid" Caption="代理人" DataType="Long" DBColumnName="Srcoperatorid"/>
                    <TableFilter>
                        <![CDATA[instanceID=(select instanceID from BPM_Instance where OID=?)]]>
                    </TableFilter>
                    <ParameterCollection>
                        <Parameter Caption="标识" Formula="GetOID();" Key="OID" TargetColumn="workItemID"/>
                    </ParameterCollection>
                    <Statement>
                        <![CDATA[select 
l.workItemID,l.workItemName,l.creatTime,l.finishTime,
case when l.operatorID=-1 then p.operatorid else l.operatorID end operatorID,l.auditResult,
l.userInfo ,case when l.auditResult=-1 then '' else E_Signature end E_Signature,case when w.srcoperatorid=-1 then p.srcoperatorid else w.srcoperatorid end  srcoperatorid from BPM_Log l left join wf_participator p on l.workitemid = p.workitemid join wf_workitem w on w.workitemid = l.workitemid where w.transfertype in (-1,1)]]>
                    </Statement>
                </Table>
            </TableCollection>
        </DataObject>
    </DataSource>
    <Body>
        <Block>
            <FlexFlowLayoutPanel Key="BPM_Log_root" Caption="根面板">
                <ToolBar Key="ToolBar123" Height="pref" Caption="ToolBar1">
                    <ToolBarItemCollection/>
                </ToolBar>
                <FlexFlowLayoutPanel Key="FlexFlowLayoutPanel1233" Caption="FlexFlowLayoutPanel1" Height="230px" OverflowY="Auto">
                    <Grid Key="OA_BPM_Log" Caption="Grid122" NewEmptyRow="false" CanDelete="false" CanInsert="false" Height="230px">
                        <GridColumnCollection>
                            <GridColumn Key="workItemID" Caption="工作项标识" Width="80px" Visible="false"/>
                            <GridColumn Caption="操作名称" Key="workItemName" Width="150px" ColumnType="Detail" ColumnExpand="false"/>
                            <GridColumn Caption="创建时间" Key="creatTime" Width="160px" ColumnType="Detail" Visible="false" ColumnExpand="false"/>
                            <GridColumn Caption="审批时间" Key="finishTime" Width="160px" ColumnType="Detail" ColumnExpand="false"/>
                            <GridColumn Caption="处理人员" Key="operatorID" Width="150px" ColumnType="Detail" ColumnExpand="false"/>
                            <GridColumn Key="Srcoperatorid" Caption="源操作员" Width="150px"/>
                            <GridColumn Caption="审批结果" Key="auditResult" Width="65px" ColumnType="Detail" ColumnExpand="false"/>
                            <GridColumn Caption="审批意见" Key="userInfo" Width="200px" ColumnType="Detail" ColumnExpand="false"/>
                            <GridColumn Key="E_Signature" Caption="电子签名" Width="200px"/>
                            <GridColumn Caption="撤销" ColumnExpand="false" ColumnType="Detail" Enable="true" Key="Rollback" Width="79px" Visible="false"/>
                        </GridColumnCollection>
                        <GridRowCollection>
                            <GridRow GroupKey="Area" Key="R1" TableKey="BPM_Log" RowHeight="60">
                                <GridCell Key="workItemID" Caption="工作项标识">
                                    <DataBinding ColumnKey="workItemID"/>
                                </GridCell>
                                <GridCell Caption="操作名称" Key="workItemName">
                                    <DataBinding ColumnKey="workItemName"/>
                                </GridCell>
                                <GridCell Caption="创建时间" CellType="DatePicker" Key="creatTime">
                                    <DataBinding ColumnKey="creatTime"/>
                                </GridCell>
                                <GridCell Caption="审批时间" CellType="DatePicker" Key="finishTime">
                                    <DataBinding ColumnKey="finishTime"/>
                                </GridCell>
                                <GridCell Caption="处理人员" Key="operatorID" CellType="Dict" ItemKey="Operator">
                                    <DataBinding ColumnKey="operatorID"/>
                                </GridCell>
                                <GridCell Key="Srcoperatorid" Caption="源操作员" CellType="Dict" CellSortType="None" ItemKey="Operator">
                                    <DataBinding ColumnKey="Srcoperatorid"/>
                                </GridCell>
                                <GridCell Caption="审批结果" Key="auditResult" CellType="ComboBox" GroupKey="AuditResult" SourceType="ParaGroup">
                                    <DataBinding ColumnKey="auditResult"/>
                                </GridCell>
                                <GridCell Caption="审批意见" Key="userInfo">
                                    <DataBinding ColumnKey="userInfo"/>
                                </GridCell>
                                <GridCell Key="E_Signature" Caption="电子签名" CellType="Image" Enable="false">
                                    <DataBinding ColumnKey="E_Signature"/>
                                </GridCell>
                                <GridCell Caption="撤销" CellType="Button" Enable="true" Key="Rollback" ShowText="撤销a">
                                    <OnClick>
                                        <![CDATA[RollbackToWorkitem(workItemID);]]>
                                    </OnClick>
                                </GridCell>
                            </GridRow>
                        </GridRowCollection>
                    </Grid>
                </FlexFlowLayoutPanel>
            </FlexFlowLayoutPanel>
        </Block>
    </Body>
</Form>
