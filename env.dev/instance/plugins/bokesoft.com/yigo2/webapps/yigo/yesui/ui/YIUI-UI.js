(function(){YIUI.Yes_Button=function(b){var a={el:$("<div><button></button></div>"),icon:null,type:YIUI.Button_Type.DEFAULT,init:function(){var c=this;$("<span class='txt'></span>").appendTo($("button",this.el));b.icon&&this.setIcon(b.icon);b.type&&this.setType(b.type);},getEl:function(){return this.el;},setEnable:function(d){this.enable=d;var e=this.el,c=this.el;if(this.enable){e.removeAttr("disabled");c.removeClass("ui-readonly");}else{e.attr("disabled","disabled");c.addClass("ui-readonly");}},setIcon:function(e){this.icon=e;var c=$("span.txt",this.el),d=$("span.icon",this.el);if(d.length>0){d.css("background-image","url(Resource/"+e+")");}else{d=$("<span class='icon'></span>").css("background-image","url(Resource/"+e+")");c.before(d);}},setType:function(c){this.type=c;$("input.type",this.el).remove();if(c==YIUI.Button_Type.UPLOAD){$("<input type='file' class='type upload' name='file' data-url='upload'/>").appendTo(this.el);}},getTextButton:function(){return $("span.txt",this.el);},setWidth:function(d){this.el.css("width",d);$("button",this.el).css("width",this.el.width());$(".upload",this.el).css("width",this.el.width());var c=$("span.icon",this.el),e=0;if(c.length>0){e+=c.width();}},setHeight:function(c){this.el.css("height",c);$("button",this.el).css("height",this.el.height());$(".upload",this.el).css("height",this.el.height());}};a=$.extend(a,b);a.init();return a;};})();(function(){YIUI.Yes_HyperLink=function(b){var a={el:$("<a class='ui-hlk'></a>"),targetType:YIUI.Hyperlink_TargetType.NewTab,url:"",init:function(){var c=this;c.enable=b.enable;this.el.mousedown(function(){c.enable&&$(this).addClass("hover");}).mouseup(function(){c.enable&&$(this).removeClass("hover");});},getEl:function(){return this.el;},setText:function(c){this.el.html(c);},getText:function(){return this.el.html();},setEnable:function(c){this.enable=c;},setHeight:function(c){this.el.css({"line-height":c+"px",height:c+"px"});},setWidth:function(c){this.el.css({width:c+"px"});}};a=$.extend(a,b);if(!b.isPortal){a.init();}return a;};})();(function(){YIUI.Yes_Image=function(b){var a={el:$("<div></div>"),sourceType:YIUI.IMAGE_SOURCETYPE.DATA,image:"",stretch:false,imageCut:false,init:function(){this._img=$("<img />").appendTo(this.el);},getEl:function(){return this.el;},setSourceType:function(c){this.sourceType=c;},setImagePath:function(c){this.image="Resource/"+c;this._img.attr("src",this.image.replace(/\\/g,"/"));},setImageCut:function(c){this.imageCut=c;},setStretch:function(c){this.stretch=c;},getImage:function(){return this._img;},setHeight:function(c){var d=this.getImage();if(this.stretch){d.css({height:c});}else{if(c<this.el.width()){d.height("100%");d.width("auto");}else{d.width("100%");d.height("auto");}}},setWidth:function(d){var c=this.getImage();if(this.stretch){c.css("width",this.el.innerWidth());}else{if(d>this.el.height()){c.height("100%");c.width("auto");}else{c.width("100%");c.height("auto");}}},setEnable:function(d){this.enable=d;var e=this.el,c=this.el;if(this.enable){c.removeClass("ui-readonly");}else{c.addClass("ui-readonly");}},setValue:function(c){this.value=c;},uploadImg:function(){},change:function(){},click:function(){},install:function(){var c=this;c.el.on("change",".upbtn",function(h){var f=h.target.files[0],g=f.type.split("/")[1];if(c.imageCut){var e={type:g,callback:function(j){c.uploadImg($(h.target),j);}};$(".upbtn",c.el).photoCut(e);}else{c.uploadImg($(this),{fileName:f.name,imgType:g});}$(".opt,.bar",c.yesCom).hide();});this._img.bind("click",function(f){if(c.enable){c.click();}});var d=function(f){if(f==undefined||f==null){return;}var e={service:"DeleteImage",filePath:f,operatorID:$.cookie("userID"),mode:1};$.ajax({url:Svr.SvrMgr.AttachURL,data:e,type:"post",error:function(h,g,j){alert(j);}});};this.el.mouseenter(function(){if($(".opt",c.el).length==0){var j=(c.sourceType==YIUI.IMAGE_SOURCETYPE.DATA&&c.enable)?"block":"none",k=$("<div class='bar'></div>").appendTo(c.el),g=$("<span class='opt upload' title='"+$.ygrid.cell_imgOpt.open+"'/>").appendTo(c.el),f=$("<span class='opt show' title='"+$.ygrid.cell_imgOpt.show+"'/>").appendTo(c.el),e=$("<span class='opt clear' title='"+$.ygrid.cell_imgOpt.clear+"'/>").appendTo(c.el),h=$("<input type='file' name='file' data-url='upload' class='opt upbtn' accept='image/*' title='"+$.ygrid.cell_imgOpt.open+"'/>").appendTo(c.el);k.css({top:(c.el.height()-25)+"px"});g.css({left:(c.el.width()-22)+"px",top:(c.el.height()-22)+"px",display:j});h.css({left:(c.el.width()-22)+"px",top:(c.el.height()-22)+"px",opacity:0,display:j});f.css({left:(c.el.width()-((j=="none")?22:46))+"px",top:(c.el.height()-22)+"px"});e.css({left:(c.el.width()-68)+"px",top:(c.el.height()-22)+"px",display:j});$(".opt",c.el).mouseover(function(m){var l=$(m.target);if(l.hasClass("upbtn")){g.addClass("sel");}else{l.addClass("sel");}}).mouseout(function(m){var l=$(m.target);if(l.hasClass("upbtn")){g.removeClass("sel");}else{l.removeClass("sel");}});e.click(function(){c.setValue("");c._img.attr("src",YIUI.Image.EmptyImg);c.change();});f.click(function(){var o;if(c.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){if(c.value==undefined||c.value==null||c.value.length==0){return;}var n=c.el.attr("formKey");var m=encodeURIComponent(c.value);o=Svr.SvrMgr.AttachURL+"?path="+m+"&formKey="+n+"&service=DownloadImage&mode=1&r="+Math.random();}else{o=c.image;}var q=$("<div class='ui-img-showDiv'></div>").appendTo(document.body);var l=$("<img class='ui-img-showImg' src='"+o+"'>").appendTo(document.body);l.load(function(){l.css({left:(q.width()-this.width)/2+"px",top:(q.height()-this.height)/2+"px",width:this.width,height:this.height});});q.click(function(){q.remove();l.remove();});l.click(function(){q.remove();l.remove();});});if($.ygrid.msie){h[0].onchange=function(){var n=this;var m=$(this).val().substring($(this).val().lastIndexOf("\\")+1),o=m.split(".")[1];if(c.imageCut){var l={type:o,callback:function(p){c.uploadImg($(n),p);}};$(n).photoCut(l);}else{c.uploadImg($(this),{fileName:m,imgType:o});}$(".opt,.bar",c.yesCom).remove();};}}else{$(".opt,.bar",c.el).show();}}).mouseleave(function(f){$(".opt,.bar",c.el).hide();});}};a=$.extend(a,b);if(!b.isPortal){a.init();}a.install();return a;};})();(function(){YIUI.Yes_TextEditor=function(b){var a={el:$("<span></span>"),_input:"",types:{txt:$("<input type='text'/>"),pwd:$("<input type='password'/>")},inputType:null,maxLength:Number.MAX_VALUE,textCase:YIUI.TEXTEDITOR_CASE.DEFAULT,invalidChars:null,promptText:null,trim:true,focus:true,required:false,selectOnFocus:true,mask:null,icon:null,embedText:null,preIcon:null,init:function(){if(this.inputType=="password"){this._input=this.types.pwd;}else{this._input=this.types.txt;}this._input.appendTo(this.el);if(this.icon){this.setIcon(this.icon);}else{this.setClearable(true);}this.setValue(this.value);this.setTextCase(this.textCase);this.setMaxLength(this.maxLength);this.preIcon&&this.setPreIcon(this.preIcon);this.promptText&&this.setPromptText(this.promptText);this.embedText&&this.setEmbedText(this.embedText);this.setMask(this.mask);},setMask:function(c){this.mask=c;if(this.mask){this._input.mask(this.mask);}},getInput:function(){return this._input;},setInput:function(c){this._input.attr("type",c);},setValue:function(c){this.value=c;if(this.getEl()){this._input.val(c);}},getValue:function(){var c=this._input.val();return c;},setEnable:function(d){this.enable=d;var e=this._input,c=this.getEl();if(this.enable){e.removeAttr("readonly");c.removeClass("ui-readonly");}else{e.attr("readonly","readonly");c.addClass("ui-readonly");}},setRequired:function(c){if(c){this.getEl().addClass("ui-required");}else{this.getEl().removeClass("ui-required");}},setBackColor:function(c){this.backColor=c;this._input.css({"background-image":"none","background-color":c});},setForeColor:function(c){this.foreColor=c;this._input.css("color",c);},setFormatStyle:function(c){this._input.css(c);},setHeight:function(c){this.getEl().css("height",c+"px");this._input.css("height",c+"px");if($.browser.isIE){this._input.css("line-height",(c-2)+"px");}if(this.embedText){$(".embed",this.getEl()).css("height",c+"px");$(".embed",this.getEl()).css("line-height",c+"px");}if(this.preIcon){var d=$(".pre-icon",this.getEl());d.css("top",(this.getEl().height()-d.height())/2+"px");}},setWidth:function(g){var h,e;if(this.preIcon){h=$(".pre-icon",this.getEl());h.css("left","5px");}var f=this.getEl(),d,c;if(this.preIcon){d=h.outerWidth()+8;}else{d=8;}if(this.embedText){e=$(".embed",this.getEl());e.css("padding-left",d+"px");d=e.outerWidth();}this._input.css("padding-left",d+"px");this.getEl().css("width",g+"px");this._input.css("width",g+"px");},getEl:function(){return this.el;},setTextCase:function(d){var c=this._input;this.textCase=d;if(d===YIUI.TEXTEDITOR_CASE.UPPER){c.addClass("uppercase");}else{c.removeClass("uppercase");}if(d===YIUI.TEXTEDITOR_CASE.LOWER){c.addClass("lowercase");}else{c.removeClass("lowercase");}},setInvalidChars:function(c){if($.isString(c)){this.invalidChars=c;}},setMaxLength:function(c){if($.isNumeric(c)&&c>0){this.maxLength=c;}},setIcon:function(c){this.icon=c;$('<span class="icon" />').css("background-image","url(Resource/"+c+")").appendTo(this.getEl());},setPreIcon:function(d){this.preIcon=d;var c=this.getEl();$('<span class="pre-icon" />').css("background-image","url(Resource/"+d+")").appendTo(c);},setEmbedText:function(e){if(e!=""&&e!==null){$(".embed",this.getEl()).remove();this.embedText=e;var g=this._input.outerWidth(),f=this.getEl(),h=$('<span class="embed" />').html(e).prependTo(f),d,c;}},setPromptText:function(c){this.promptText=c;this._input.placeholder(this.promptText);},setClearable:function(c){var e=this.getEl(),d=this._input;if(c){$("<span class='clear'/>").appendTo(e);}else{$(".clear",e).remove();d.css({paddingRight:"2px"});}},setSelOnFoc:function(c){this.selectOnFocus=c;},finishInput:function(){var c=this,d=this._input.val();if(c.trim){d=$.trim(d);}if(d!=c.value){c.setValue(d);c.valueChange(d);if(c.required){var e=(d=="");c.setRequired(e);}}},valueChange:$.noop,install:function(){var d=this;var c=this._input;var e=$("span.clear",this.el);e.mousedown(function(){c.val("").focus();e.hide();}).hide();c.on("click",function(){if(d.needSelectAll){d.focus&&this.select();d.needSelectAll=false;}}).on("focusin",function(){if(d.selectOnFocus){d.needSelectAll=d.selectOnFocus;}}).keyup(function(){if(!$.isDefined($(this).attr("readonly"))){if($(this).val()){e.show();}else{e.hide();}}}).keydown(function(g){var f=g.keyCode||g.which;if(f!=8&&$.InputMask.getCursor(this).start>=d.maxLength){g.preventDefault();return true;}if(g.ctrlKey){if(f==86){window.setTimeout(function(){d.finishInput();},0);}}}).focus(function(){if(!$.isDefined($(this).attr("readonly"))&&$(this).val()){e.show();}}).blur(function(){d.finishInput();e.hide();}).filterInput(this.invalidChars,this.textCase,this.maxLength);}};a=$.extend(a,b);if(!b.isPortal){a.init();}else{a._input=$("input",a.el);a.setMaxLength(a.maxLength);a.promptText&&a.setPromptText(a.promptText);}a.install();return a;};})();(function(){YIUI.Yes_Label=function(b){var a={el:$("<div></div>"),icon:null,init:function(){this.label=$("<label></label>").appendTo(this.el);this.icon&&this.setIcon(this.icon);this.caption&&this.setCaption(this.caption);},setWidth:function(c){this.el.css("width",c);this.label.css("width",c-$("span",this.el).width());},setHeight:function(c){this.el.css("height",c);this.label.css("height",c);this.label.css("line-height",c+"px");if(this.icon){var d=$(".icon",this.el);d.css("top",(c-d.height())/2+"px");}},setCssStyle:function(c){this.label.css(c);},getEl:function(){return this.el;},setCaption:function(c){this.caption=c||"";var d=new RegExp("\n","g");var e=this.caption.replace(d,"<br/>").replace(/\ /g,"&nbsp;");this.label.html(e);},setValue:function(c){this.setCaption(c==null?"":c.toString());},setIcon:function(c){this.icon=c;var d=this.getEl();if($("span.icon",d).length==0){$('<span class="icon" />').css("background-image","url(Resource/"+c+")").prependTo(d);}else{$("span.icon",d).css("background-image","url(Resource/"+c+")");}}};a=$.extend(a,b);if(!b.isPortal){a.init();}return a;};})();(function(){function j(r,q){if(q.aSign){while(r.indexOf(q.aSign)>-1){r=r.replace(q.aSign,"");}}r=r.replace(q.skipFirstAutoStrip,"$1$2");r=r.replace(q.skipLastAutoStrip,"$1");r=r.replace(q.allowedAutoStrip,"");if(q.altDec){r=r.replace(q.altDec,q.aDec);}var p=r.match(q.numRegAutoStrip);r=p?[p[1],p[2],p[3]].join(""):"";return r;}function o(q,p){if(typeof(q[p])==="string"){q[p]*=1;}}function c(t,s){s.oEvent=null;var w=s.vMax.toString().split("."),r=(!s.vMin&&s.vMin!==0)?[]:s.vMin.toString().split(".");o(s,"vMax");o(s,"vMin");o(s,"mDec");s.aNeg=s.vMin<0?"-":"";w[0]=w[0].replace("-","");r[0]=r[0].replace("-","");s.mInt=Math.max(w[0].length,r[0].length,1);if(s.mDec===null){var v=0,q=0;if(w[1]){v=w[1].length;}if(r[1]){q=r[1].length;}s.mDec=Math.max(v,q);}if(s.altDec===null&&s.mDec>0){if(s.aDec==="."&&s.aSep!==","){s.altDec=",";}else{if(s.aDec===","&&s.aSep!=="."){s.altDec=".";}}}var p=s.aNeg?"([-\\"+s.aNeg+"]?)":"(-?)";s.aNegRegAutoStrip=p;s.skipFirstAutoStrip=new RegExp(p+"[^-"+(s.aNeg?"\\"+s.aNeg:"")+"\\"+s.aDec+"\\d]"+".*?(\\d|\\"+s.aDec+"\\d)");s.skipLastAutoStrip=new RegExp("(\\d\\"+s.aDec+"?)[^\\"+s.aDec+"\\d]\\D*$");var u="-"+s.aNum+"\\"+s.aDec;s.allowedAutoStrip=new RegExp("[^"+u+"]","gi");s.numRegAutoStrip=new RegExp(p+"(?:\\"+s.aDec+"?(\\d+\\"+s.aDec+"\\d+)|(\\d*(?:\\"+s.aDec+"\\d*)?))");return s;}function f(r,q,p){if(p&&p!=="-"){r=r.replace("-",p);}if(q&&q!=="."){r=r.replace(".",q);}return r;}function k(q,p){q=j(q,p);q=m(q,p.aDec,p.mDec);q=n(q,p.aDec,p.aNeg);var r=+q;if(r<p.vMin||r>p.vMax){}return r>=p.vMin&&r<=p.vMax;}function m(q,p,t){if(p&&t){var r=q.split(p);if(r[1]&&r[1].length>t){if(t>0){r[1]=r[1].substring(0,t);q=r.join(p);}else{q=r[0];}}}return q;}function n(r,q,p){if(q&&q!=="."){r=r.replace(q,".");}if(p&&p!=="-"){r=r.replace(p,"-");}if(!r.match(/\d/)){r+="0";}return r;}function e(u,t){u=(u==="")?"0":u.toString();var p="",x=0,A="";if(u.charAt(0)==="-"){A="-";u=u.replace("-","");}if(!u.match(/^\d/)){u="0"+u;}if(A==="-"&&+u===0){A="";}var z=u.lastIndexOf("."),w=(z===-1)?u.length-1:z,y=(u.length-1)-w;if(y<=t.mDec){p=u;if(z===-1){p+=".";}var q="0";while(y<t.mDec){p+=q;y+=q.length;}}else{var r=z+t.mDec,s=+u.charAt(r+1),v=u.substring(0,r+1).split("");if((s>4&&t.mRound===YIUI.NUMBEREDITOR_ROUNDINGMODE.HALF_UP)||(s>0&&t.mRound===YIUI.NUMBEREDITOR_ROUNDINGMODE.ROUND_UP)){var x=v.length-1;v[x]=+v[x]+1;}v=v.slice(0,r+1);p=v.join("");}return(+p===0)?p:A+p;}function d(r,w){r=j(r,w);var v=r.replace(",",".");var x=a(r,w,true);if(x!==null){return x;}var p="";if(w.dGroup===2){p=/(\d)((\d)(\d{2}?)+)$/;}else{if(w.dGroup===4){p=/(\d)((\d{4}?)+)$/;}else{p=/(\d)((\d{3}?)+)$/;}}var u=r.split(w.aDec);if(w.altDec&&u.length===1){u=r.split(w.altDec);}var t=u[0];if(w.aSep){while(p.test(t)){t=t.replace(p,"$1"+w.aSep+"$2");}}if(w.mDec!==0&&u.length>1){if(u[1].length>w.mDec){u[1]=u[1].substring(0,w.mDec);}r=t+w.aDec+u[1];}else{r=t;}if(w.aSign){var q=r.indexOf(w.aNeg)!==-1;r=r.replace(w.aNeg,"");r=w.pSign==="p"?w.aSign+r:r+w.aSign;if(q){r=w.aNeg+r;}}return r;}function a(q,r,p){if(q===""||q===r.aNeg){return q;}return null;}function l(r){var q={};if(r.selectionStart===undefined){r.focus();var p=document.selection.createRange();q.length=p.text.length;p.moveStart("character",-r.value.length);q.end=p.text.length;q.start=q.end-q.length;}else{q.start=r.selectionStart;q.end=r.selectionEnd;q.length=q.end-q.start;}return q;}function b(s,t,p){if(s.selectionStart===undefined){s.focus();var q=s.createTextRange();q.collapse(true);q.moveEnd("character",p);q.moveStart("character",t);q.select();}else{s.selectionStart=t;s.selectionEnd=p;}}function h(q,p){this.settings=p;this.that=q;this.$that=$(q);this.formatted=false;this.settingsClone=c(this.$that,this.settings);this.value=q.value;}h.prototype={init:function(p){this.value=this.that.value;this.settingsClone=c(this.$that,this.settings);this.ctrlKey=p.ctrlKey;this.cmdKey=p.metaKey;this.shiftKey=p.shiftKey;this.selection=l(this.that);if(p.type==="keydown"||p.type==="keyup"){this.kdCode=p.keyCode;}this.which=p.which;this.processed=false;this.formatted=false;},setSelection:function(r,p,q){r=Math.max(r,0);p=Math.min(p,this.that.value.length);this.selection={start:r,end:p,length:p-r};if(q===undefined||q){b(this.that,r,p);}},setPosition:function(q,p){this.setSelection(q,q,p);},getBeforeAfter:function(){var q=this.value,r=q.substring(0,this.selection.start),p=q.substring(this.selection.end,q.length);return[r,p];},getBeforeAfterStriped:function(){var p=this.getBeforeAfter();p[0]=j(p[0],this.settingsClone);p[1]=j(p[1],this.settingsClone);return p;},normalizeParts:function(t,s){var q=this.settingsClone;s=j(s,q);t=j(t,q);var r=t+s;if(q.aDec){var p=r.match(new RegExp("^"+q.aNegRegAutoStrip+"\\"+q.aDec));if(p){t=t.replace(p[1],p[1]+"0");r=t+s;}}return[t,s];},processKeypress:function(){var p=this.settingsClone,q=String.fromCharCode(this.which),t=this.getBeforeAfterStriped(),s=t[0],r=t[1];if(q===p.aDec||(p.altDec&&q===p.altDec)||((q==="."||q===",")&&this.kdCode===110)){if(!p.mDec||!p.aDec){return true;}if(p.aNeg&&r.indexOf(p.aNeg)>-1){return true;}if(s.indexOf(p.aDec)>-1){return true;}if(r.indexOf(p.aDec)>0){return true;}if(r.indexOf(p.aDec)===0){r=r.substr(1);}this.setValueParts(s+p.aDec,r);return true;}if(q==="-"||q==="+"){if(!p.aNeg){return true;}if(s===""&&r.indexOf(p.aNeg)>-1){s=p.aNeg;r=r.substring(1,r.length);}if(s.charAt(0)===p.aNeg){s=s.substring(1,s.length);}else{s=(q==="-")?p.aNeg+s:s;}this.setValueParts(s,r);return true;}if(q>="0"&&q<="9"){if(p.aNeg&&s===""&&r.indexOf(p.aNeg)>-1){s=p.aNeg;r=r.substring(1,r.length);}if(p.vMax<=0&&p.vMin<p.vMax&&this.value.indexOf(p.aNeg)===-1&&q!=="0"){s=p.aNeg+s;}this.setValueParts(s+q,r);return true;}return true;},setValueParts:function(u,s){var q=this.settingsClone,t=this.normalizeParts(u,s),r=t.join(""),p=t[0].length;if(k(r,q)){r=m(r,q.aDec,q.mDec);if(p>r.length){p=r.length;}this.value=r;this.setPosition(p,false);return true;}return false;},processAllways:function(){var p;if(this.kdCode===8||this.kdCode===46){if(!this.selection.length){p=this.getBeforeAfterStriped();if(this.kdCode===8){p[0]=p[0].substring(0,p[0].length-1);}else{p[1]=p[1].substring(1,p[1].length);}this.setValueParts(p[0],p[1]);}else{p=this.getBeforeAfterStriped();this.setValueParts(p[0],p[1]);}return true;}return false;},checkPaste:function(){if(this.valuePartsBeforePaste!==undefined){var q=this.getBeforeAfter(),p=this.valuePartsBeforePaste;delete this.valuePartsBeforePaste;q[0]=q[0].substr(0,p[0].length)+j(q[0].substr(p[0].length),this.settingsClone);if(!this.setValueParts(q[0],q[1])){this.value=p.join("");this.setPosition(p[0].length,false);}}},skipAllways:function(s){var t=this.kdCode,r=this.which,q=this.ctrlKey,w=this.cmdKey,u=this.shiftKey;if(((q||w)&&s.type==="keyup"&&this.valuePartsBeforePaste!==undefined)||(u&&t===45)){this.checkPaste();return false;}if((t>=112&&t<=123)||(t>=91&&t<=93)||(t>=9&&t<=31)||(t<8&&(r===0||r===t))||t===144||t===145||t===45){return true;}if((q||w)&&t===65){return true;}if((q||w)&&(t===67||t===86||t===88)){if(t===86||t===45){if(s.type==="keydown"||s.type==="keypress"){if(this.valuePartsBeforePaste===undefined){this.valuePartsBeforePaste=this.getBeforeAfter();}}else{this.checkPaste();}}return s.type==="keydown"||s.type==="keypress"||t===67;}if(q||w){return true;}if(t===37||t===39){var v=this.settingsClone.aSep,p=this.selection.start,x=this.that.value;if(s.type==="keydown"&&v&&!this.shiftKey){if(t===37&&x.charAt(p-2)===v){this.setPosition(p-1);}else{if(t===39&&x.charAt(p+1)===v){this.setPosition(p+1);}}}return true;}if(t>=34&&t<=40){return true;}return false;},formatQuick:function(){var x=this.settingsClone,q=this.getBeforeAfterStriped(),y=this.value;if((x.aSep===""||(x.aSep!==""&&y.indexOf(x.aSep)===-1))&&(x.aSign===""||(x.aSign!==""&&y.indexOf(x.aSign)===-1))){var p=[],z="";p=y.split(x.aDec);if(p[0].indexOf("-")>-1){z="-";p[0]=p[0].replace("-","");q[0]=q[0].replace("-","");}if(p[0].length>x.mInt&&q[0].charAt(0)==="0"){q[0]=q[0].slice(1);}q[0]=z+q[0];}var w=d(this.value,this.settingsClone),s=w.length;if(w){var t=q[0].split(""),r=0;for(r;r<t.length;r+=1){if(!t[r].match("\\d")){t[r]="\\"+t[r];}}var u=new RegExp("^.*?"+t.join(".*?"));var v=w.match(u);if(v){s=v[0].length;if(((s===0&&w.charAt(0)!==x.aNeg)||(s===1&&w.charAt(0)===x.aNeg))&&x.aSign&&x.pSign==="p"){s=this.settingsClone.aSign.length+(w.charAt(0)==="-"?1:0);}}else{if(x.aSign&&x.pSign==="s"){s-=x.aSign.length;}}}this.that.value=w;this.setPosition(s);this.formatted=true;}};function g(p,r,t){var s=p.data("NumberEditor");if(!s){s={};p.data("NumberEditor",s);}var q=s.handler;if((q===undefined&&r)||t){q=new h(p.get(0),r);s.handler=q;}return q;}YIUI.Yes_NumberEditor=function(q){var p={el:$("<span></span>"),selectOnFocus:true,required:false,promptText:null,settings:{aNum:"0123456789",aSep:",",dGroup:"3",aDec:".",aSign:"",pSign:"",vMax:"99999999999999.99",vMin:"-99999999999999.99",mDec:"2",mPre:"16",mRound:YIUI.NUMBEREDITOR_ROUNDINGMODE.HALF_UP,altDec:null},init:function(){$("<input type='text' />").appendTo(this.el);var r=g(this.getInput(),this.settings);this.setValue(this.value);},getValue:function(){var r=null;if(this.value==null){r=0;}else{r=n(this.value,this.settings.aDec,this.settings.aNeg);}return new Decimal(r);},getInput:function(){return $("input",this.el);},getEl:function(){return this.el;},setValue:function(r){if(r==null){r="";}var t=this.getInput();var s=r.toString();if(r instanceof Decimal){s=r.toFixed();}if(!$.isNumeric(+s)){this.value=null;return"";}this.value=s;if(s!==""){s=e(s,this.settings);}s=f(s,this.settings.aDec,this.settings.aNeg);if(!k(s,this.settings)){s=e("",this.settings);}s=d(s,this.settings);if(!(!this.showZero&&s==0)){t.val(s);}},setEnable:function(s){this.enable=s;var t=this.getInput(),r=this.getEl();if(this.enable){t.removeAttr("readonly");r.removeClass("ui-readonly");}else{t.attr("readonly","readonly");r.addClass("ui-readonly");}},setBackColor:function(r){this.backColor=r;this.getInput().css({"background-image":"none","background-color":r});},setForeColor:function(r){this.foreColor=r;this.getInput().css("color",r);},setFormatStyle:function(r){this.getInput().css(r);},setHeight:function(r){this.el.css("height",r+"px");this.getInput().css("height",r+"px");if($.browser.isIE){this.getInput().css("line-height",(r-3)+"px");}},setWidth:function(r){this.el.css("width",r+"px");this.getInput().css("width",r+"px");},setPromptText:function(r){this.promptText=r;this.getInput().placeholder(this.promptText);},autoStrip:function(t,r){return j(t,r);},getHandler:function(r,s,t){return g(r,s,t);},valueChange:$.noop,setRequired:function(r){this.required=r;if(r){this.getEl().addClass("ui-required");}else{this.getEl().removeClass("ui-required");}},finishInput:function(){var s=this,v=this.getInput(),t=s.getHandler(v),r=t.settingsClone;var u=s.autoStrip(v[0].value,r);if(u!=s.value){s.setValue(u);s.valueChange(u);if(s.required){s.setRequired(u=="");}}},install:function(){var s=this.getInput();var r=this;s.on("keydown.numbereditor",function(u){var t=g(s);if(t.settings.aDec===t.settings.aSep){$.error("error");return this;}if(t.that.readOnly){t.processed=true;return true;}t.init(u);t.settings.oEvent="keydown";if(t.skipAllways(u)){t.processed=true;return true;}if(t.processAllways()){t.processed=true;t.formatQuick();u.preventDefault();return false;}t.formatted=false;return true;});s.on("keypress.numbereditor",function(u){var t=g(s);var v=t.processed;t.init(u);t.settings.oEvent="keypress";if(t.skipAllways(u)){return true;}if(v){u.preventDefault();return false;}if(t.processAllways()||t.processKeypress()){t.formatQuick();u.preventDefault();return false;}t.formatted=false;});s.on("keyup.numbereditor",function(v){var t=g(s);t.init(v);t.settings.oEvent="keyup";var u=t.skipAllways(v);t.kdCode=0;delete t.valuePartsBeforePaste;if(s[0].value===t.settings.aSign){if(t.settings.pSign==="s"){b(this,0,0);}else{b(this,t.settings.aSign.length,t.settings.aSign.length);}}if(u){return true;}if(this.value===""){return true;}if(!t.formatted){t.formatQuick();}});s.on("focusin.numbereditor",function(){if(r.selectOnFocus){r.needSelectAll=true;}var u=g(s);u.settingsClone.oEvent="focusin";u.inVal=s.val();var t=a(u.inVal,u.settingsClone,true);if(t!==null){s.val(t);if(u.settings.pSign==="s"){b(this,0,0);}else{b(this,u.settings.aSign.length,u.settings.aSign.length);}}});s.on("focusout.numbereditor",function(){var w=g(s),u=w.settingsClone,x=s.val(),t=x;w.settingsClone.oEvent="focusout";if(x!==""){x=j(x,u);if(a(x,u)===null&&k(x,u,s[0])){x=n(x,u.aDec,u.aNeg);x=e(x,u);x=f(x,u.aDec,u.aNeg);}else{x="";}}var v=a(x,u,false);if(v===null){v=d(x,u);}if(v!==t){s.val(v);}if(v!==w.inVal){s.change();delete w.inVal;}});s.on("click",function(t){if(r.needSelectAll){r.selectOnFocus&&s.select();r.needSelectAll=false;}});s.on("blur",function(t){r.finishInput();});}};p=$.extend(true,p,q);if(!q.isPortal){p.init();}p.install();return p;};})();(function(){var a=0;YIUI.Yes_CheckBox=function(c){a++;var b={id:a,el:$("<div></div>"),checked:false,text:"",getEl:function(){return this.el;},init:function(){$("<input type='checkbox' class='chk'/>").attr("id","chk_"+this.id).appendTo(this.el);$("<label></label>").attr("for","chk_"+this.id).appendTo(this.el);},setChecked:function(e){this.checked=e;var d=$("input",this.el);if(e===true){d.attr("isChecked",true);d.addClass("checked");d[0].checked=true;}else{d.attr("isChecked",false);d.removeClass("checked");d[0].checked=false;}},setText:function(e){var d=$("label",this.el);if(e===undefined||e.length==0){d.css("background-position","center");}d.html(e);},getCheckBox:function(){return $("input",this.el);},getLabel:function(){return $("label",this.el);},getValue:function(){return $("input",this.el).attr("isChecked")==="true"?1:0;},getText:function(){return $("label",this.el).html();},setHeight:function(d){$("label",this.el).css({height:d+"px",lineHeight:d+"px"});var e=$("input",this.el);e.css("margin-top",(d-e.height())/2);},setWidth:function(d){$("label",this.el).css("width",d-$("span",this.el).outerWidth());},setEnable:function(e){this.enable=e;var f=this.getCheckBox(),d=this.el;if(this.enable){f.removeAttr("disabled");d.removeClass("ui-readonly");}else{f.attr("disabled","disabled");d.addClass("ui-readonly");}},install:function(){var d=this;this.getCheckBox().click(function(f){if(!d.enable){return;}});}};b=$.extend(b,c);if(!c.isPortal){b.init();}b.install();return b;};})();(function(){YIUI.Yes_DictTree=function(b){var a={el:$("<div></div>"),independent:true,showCheckBox:false,checkedNodes:{},indeterminatedNodes:null,_pMap:{},rootNode:null,_liwrap:$("<div class = 'liwrap'></div>"),_searchdiv:$("<div class = 'chainsearch'></div>"),_footdiv:$("<div class = 'footdiv'></div>"),_footMean:$("<div class = 'footmean'></div>"),allPageNum:null,startRow:0,pageIndicatorCount:3,fuzzyValue:null,buildTreenode:function(d,e,g,c,f){if(!d){return;}if(!d.length){d=$(d);}this.addNodes(d,e,g,c,f);},addNodes:function(r,f,e,B,t){var p=$("#"+f,this.el);allPageNum=Math.ceil(t/10);this._footdiv.find(".pageinfo").attr("maxnum",allPageNum);if(r.length<=0&&B!=5){p.children("span:first").removeClass("dt-collapse");return;}if(B==5){if(t!=0){this.reset();}var l=$("<span class = 'pageinfo'></span>");if(this.startRow==0){if(this._footdiv.find(".pageinfo").length!=0){this._footdiv.find(".pageinfo").children("span").remove();l=this._footdiv.find(".pageinfo");}l.attr("maxnum",allPageNum);var o=allPageNum>=3?3:allPageNum;for(var u=0;u<o;u++){if(u==0){$("<span class='pagenum nowitem'>"+(u+1)+"</span>").appendTo(l);}else{$("<span class='pagenum'>"+(u+1)+"</span>").appendTo(l);}}this._footMean.find(".prev").after(l);}}var s,n,c,x;this._pMap[f]||(this._pMap[f]=[]);for(var u=0,v=r.length;u<v;u++){s=r[u];n=s.id;c=s.OID;x=s.itemKey;this._pMap[f].push(n);var j=$("<li id='"+n+"' oid = '"+c+"'parentid='"+f+"' itemKey='"+x+"'></li>");if(B!=5){j.attr("level",e).css("padding-left",15);}if(B==5){j.attr("level",e).css("padding-left",2);}var w=p.attr("itemKey");var C=parseInt(p.attr("comp_Level"));if(x!=w){C+=1;}j.attr("comp_Level",C);var y="comp_Level"+C;j.addClass(y);$("<div class='dt-wholerow'/>").appendTo(j);var q=p.children("ul");if(q.length==0){q=$("<ul class='dt-ul'></ul>").appendTo(p);}j.appendTo(q);var k=$("<a class='dt-anchor'></a>");var h,m,d;if(s.NodeType==1){if(s.open){m=$("<span class='icon dt-expand'/>").appendTo(j);_explore=$("<span class='branch b-expand'/>").appendTo(k);}else{m=$("<span class='icon dt-collapse'/>").appendTo(j);_explore=$("<span class='branch b-collapse'/>").appendTo(k);}}else{m=$("<span class='icon'/>").appendTo(j);_explore=$("<span class='branch'/>").appendTo(k);}switch(s.Enable){case YIUI.DictState.Enable:_explore.addClass("enable");break;case YIUI.DictState.Disable:_explore.addClass("disable");break;case YIUI.DictState.Discard:_explore.addClass("discard");break;}if(this.showCheckBox){d=$("<span class='dt-chk' />");m.after(d);}k.appendTo(j);var D=$("<span class='b-txt'>"+s.caption+"</span>").appendTo(k);B==5?p.attr("isLoaded",false):p.attr("isLoaded",true);}if(this.showCheckBox){for(var u=0,v=r.length;u<v;u++){s=r[u];n=s.id;var g=0;if(n in this.checkedNodes){g=1;}if(this.indeterminatedNodes==null){this.indeterminatedNodes=[];}if(!this.independent&&n in this.indeterminatedNodes){g=2;}if(g==0&&!this.independent&&p){var A=p.children(".dt-chk").attr("chkstate")||0;if(A==1){g=1;}}var z=$("#"+n,this.el);z.children(".dt-chk").attr("chkstate",g).addClass("chkstate"+g);}}},checkTreeNode:function(g,c){var h,m,l,j;var n=this;function f(p,u){var s=p.children(".dt-chk");s.removeClass("chkstate"+s.attr("chkstate"));s.attr("chkstate",u).addClass("chkstate"+u);if(u!=2){var q=p.attr("id");n._pMap[q]||(n._pMap[q]=[]);for(var r=0;r<n._pMap[q].length;r++){var o=n._pMap[q][r];var t=$("#"+o,n.el);if(u==0){delete n.checkedNodes[o];}f(t,u);}}}function e(A,o){var v=A.attr("parentid");if(!v){return;}var x=$("#"+v,n.el);var z=x.children(".dt-chk");if(o==2){z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",2).addClass("chkstate"+2);e(x,2);}else{if(o==1){n._pMap[v]||(n._pMap[v]=[]);var p=false;for(var s=0;s<n._pMap[v].length;s++){var w=n._pMap[v][s];var r=$("#"+w,n.el);var q=r.children(".dt-chk").attr("chkstate")||0;if(q!=o){p=true;break;}}if(p){o=2;}z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",o).addClass("chkstate"+o);e(x,o);}else{var t=z.attr("chkstate")||0;var y=A.attr("id");if(t==1){var u=n._pMap[v].length;if(u==1){o=0;}else{for(var s=0;s<n._pMap[v].length;s++){var w=n._pMap[v][s];if(w==y){continue;}var r=$("#"+w,n.el);n.checkedNodes[w]=n.getNodeValue(r);}o=2;}z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",o).addClass("chkstate"+o);}else{if(t==2){var p=true;for(var s=0;s<n._pMap[v].length;s++){var w=n._pMap[v][s];var r=$("#"+w,n.el);var q=r.children(".dt-chk").attr("chkstate")||0;if(q!=o){p=false;break;}}if(p){o=0;z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",o).addClass("chkstate"+o);}}}e(x,o);}}if(o==1){n.checkedNodes[v]=n.getNodeValue(x);}else{delete n.checkedNodes[v];}}var d=g.attr("id");if(c==1){this.checkedNodes[d]=this.getNodeValue(g);}else{delete this.checkedNodes[d];}if(!this.independent){f(g,c);e(g,c);}else{var k=g.children(".dt-chk");k.removeClass("chkstate"+k.attr("chkstate"));k.attr("chkstate",c).addClass("chkstate"+c);}},setCheckedNodes:function(e){if(this.showCheckBox){var d=this;this.clearCheckedNodes();this.checkedNodes=e;this.indeterminatedNodes=null;if(this.rootNode){var c=this.rootNode.attr("id");if(c in this.checkedNodes){this.rootNode.children(".dt-chk").attr("chkstate",1).addClass("chkstate"+1);}else{if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".dt-chk").attr("chkstate",2).addClass("chkstate"+2);}}}}},creatSearchInput:function(c){$("<input type = 'text' class = 'findinput'/>").appendTo(c);$("<span class = 'findspan'>查询</span>").appendTo(c);},creatFootDiv:function(d,c){$("<span class = 'prev disable'>上一页</span>").appendTo(d);$("<span class = 'next'>下一页</span>").appendTo(d);},clearCheckedNodes:function(){this.checkedNodes={};this.indeterminatedNodes=null;$("[chkstate=1],[chkstate=2]").removeClass("chkstate1").removeClass("chkstate2").attr("chkstate",0).addClass("chkstate0");},createRootNode:function(d,m,e,l,c){var f=$("<li id='"+e+"' oid = '"+d.oid+"' itemKey='"+d.itemKey+"'></li>");f.attr("level",-1).attr("comp_Level",1);f.appendTo(this.el);f.addClass("root");if(l!=5){$("<div class='dt-wholerow'/>").appendTo(f);var k=$("<a class='dt-anchor'></a>");$("<span class='icon dt-expand'/>").appendTo(f);if(this.showCheckBox){$("<span class='dt-chk' />").addClass("chkstate0").attr("chkstate",0).appendTo(f);}$("<span class='branch b-expand'/>").appendTo(k);$("<span class='b-txt'>"+m+"</span>").appendTo(k);k.appendTo(f);}var g=this._footdiv.children().length;var h=this._searchdiv.children().length;if(l==5&&g==0&&h==0){this.el.addClass("chain");$("<ul class='dt-ul'></ul>").appendTo(f);this.el.wrap(this._liwrap);var j=$("<div class = 'dt-searchwrap'></div>");this.creatSearchInput(j);j.appendTo(this._searchdiv);this.el.before(this._searchdiv);this.creatFootDiv(this._footMean,c);this._footMean.appendTo(this._footdiv);this.el.after(this._footdiv);}this.rootNode=$("#"+e,this.el);if(this.showCheckBox){if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".dt-chk").attr("chkstate",2).addClass("chkstate"+2);}else{if(e in this.checkedNodes){this.rootNode.children(".dt-chk").attr("chkstate",1).addClass("chkstate"+1);}}}},render:function(c){this.el.appendTo($(c));this.el.addClass("dt");},collapseNode:function(d){d.children("ul").hide();var c=d.children("span:first");c.removeClass("dt-expand").addClass("dt-collapse");c.next(".dt-anchor").find(".branch").removeClass("b-expand").addClass("b-collapse");},expandNode:$.noop,checkboxClick:function(c){if(this.clearChkNodes){this.checkedNodes={};}var e=c.children(".dt-chk").attr("chkstate")==0?1:0;this.checkTreeNode(c,e);this.callback.onChecked(this,c);var d=c.attr("id");if(e==1){this.checkedNodes[d]=this.getNodeValue(c);}else{delete this.checkedNodes[d];}this.clearChkNodes=false;},selectNode:function(c){if(this.selectedNodeId){$("#"+this.selectedNodeId).removeClass("sel");}this.selectedNodeId=c.attr("id");c.addClass("sel");this.callback.onSelected(this,c);},getNodeValue:function(c){},getCheckedValues:function(){if(this.showCheckBox){var f=this;var e=[];var d="";if(f.rootNode){var c=f.rootNode.attr("id");if(c in f.checkedNodes&&!f.independent){e.push(f.getNodeValue(f.rootNode));f._showCaption="";return e;}}$.each(f.checkedNodes,function(l,m){var h=$("#"+l,f.el);if(!f.independent){var k=h.attr("parentid");var g=$("#"+k,f.el);if(g){var j=g.children(".dt-chk").attr("chkstate")||0;if(j==1){}else{e.push(m);}}else{e.push(m);}}else{e.push(m);}});return e;}},formatAsyncData:function(c){return c;},reset:function(){if(this.rootNode){this._pMap={};this.collapseNode(this.rootNode);this.rootNode.children(".dt-ul").children().remove();this.rootNode.removeAttr("isLoaded");this.indeterminatedNodes=null;}}};a.callback=$.extend({beforeExpand:$.noop,onSelected:$.noop,onChecked:$.noop});a.clickEvent={};a.el.bind("click",function(f){var c=$(f.target);var d;if(c.prop("tagName").toLowerCase()=="li"){d=c;}else{d=c.parents("li:first");}if(c.hasClass("dt-collapse")){a.expandNode(d);return;}if(c.hasClass("dt-expand")){a.collapseNode(d);return;}if(c.hasClass("dt-chk")){a.checkboxClick(d);return;}$(".dt-wholerow.sel",this).removeClass("sel");if(d.hasClass("comp_Level1")){$(".dt-wholerow:first",d).addClass("sel");}if(!a.showCheckBox){a.selectNode(d);return;}});a.el.delegate("li","mouseover",function(d){$(".dt-wholerow.hover",a.el).removeClass("hover");var c=$(".dt-wholerow:first",this);if(!c.hasClass("sel")){$(".dt-wholerow:first",this).addClass("hover");}d.stopPropagation();}).delegate("li","mouseleave",function(c){$(".dt-wholerow.hover",a.el).removeClass("hover");c.stopPropagation();});a=$.extend(a,b);return a;};YIUI.Yes_Dict=function(b){var a={_hasShow:false,el:$("<div></div>"),multiSelect:false,rootNode:null,id:"",_dropBtn:$('<div id="'+b.id+'_dropbtn"/>'),_textBtn:$('<input id="'+b.id+'_textbtn" type="text" />'),_dropView:$('<div id="'+b.id+'_dropview"/>'),$suggestView:$('<div class="dt-autovw dt-vw"/>'),checkBoxType:YIUI.Control.DICT_CKBOXTYPE_NORMAL_SELECT,independent:true,itemKey:null,dictTree:null,_resetTree:true,stateMask:YIUI.DictStateMask.Enable,needRebuild:true,enable:true,editable:true,secondaryType:0,init:function(){this._textBtn.addClass("txt").appendTo(this.el);this._dropBtn.addClass("arrow").appendTo(this.el);this._dropView.addClass("dt-vw");$(document.body).append(this._dropView);$(document.body).append(this.$suggestView);},setEditable:function(d){this.editable=d;var e=this._textBtn;if(this.editable){e.removeAttr("readonly");}else{e.attr("readonly","readonly");}},setEnable:function(e){this.enable=e;var f=this._textBtn,d=this.el;if(e){f.removeAttr("readonly");d.removeClass("ui-readonly");}else{f.attr("readonly","readonly");d.addClass("ui-readonly");}},getEl:function(){return this.el;},setMultiSelect:function(d){this.multiSelect=d;},setDictTree:function(d){this.dictTree=d;},getDictTree:function(d){return this.dictTree;},setBackColor:function(d){this.backColor=d;this._textBtn.css({"background-image":"none","background-color":d});},setForeColor:function(d){this.foreColor=d;this._textBtn.css("color",d);},setFormatStyle:function(d){this._textBtn.css(d);},setDropViewTop:function(){var g=this._textBtn;var e=this._textBtn.offset();var d=$(window).height()-e.top-this.el.height();var f=e.top+g.outerHeight();if(d<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");f="auto";d=$(window).height()-e.top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");d="auto";}if(f!="auto"){this._dropView.css("top",f+"px");this._dropView.css("bottom","auto");}if(d!="auto"){this._dropView.css("bottom",d+"px");this._dropView.css("top","auto");}this._dropView.css("width",g.outerWidth()+"px");$(".pageinfo").css("border","0px");},setDropViewLeft:function(){var g=this._textBtn;var e=this._textBtn.offset();var d=$(window).width()-e.left;var f=$(window).width()-this._dropView.outerWidth();if(d<this._dropView.outerWidth()){f="auto";d=$(window).width()-e.left-g.outerWidth();}else{f=e.left;d="auto";}if(f!="auto"){this._dropView.css("left",f+"px");this._dropView.css("right","auto");}if(d!="auto"){this._dropView.css("right",d+"px");this._dropView.css("left","auto");}},setSelValue:function(d){this.value=d;if(this._resetTree&&this.multiSelect){this.dictTree.reset();this.setDictTreeCheckedNodes();}},setDictTreeCheckedNodes:function(){if(this.multiSelect){var d={};if(this.value){$.each(this.value,function(e){var f=this.itemKey+"_"+this.oid;d[f]=this;});}this.dictTree.setCheckedNodes(d);}},getSelValue:function(){if(this.value){return this.value;}else{return null;}},setWidth:function(d){this.el.css("width",d);this._textBtn.css("width",d);this._dropBtn.css("left",this._textBtn.outerWidth()-26+"px");},setHeight:function(d){this.el.css("height",d+"px");this._textBtn.css("height",d+"px");if($.browser.isIE){this._textBtn.css("line-height",(d-3)+"px");}this._dropBtn.css("top",(this._textBtn.outerHeight()-16)/2+"px");},setValue:function(d){this.value=d;},setText:function(d){this._textBtn.val(d);},getText:function(){return this._textBtn.val();},getInput:function(){return this._textBtn;},checkDict:$.noop,hiding:$.noop,getItemKey:$.noop,showing:function(){if(!this.value){return;}if(this.multiSelect){var f=this.value;for(var g=0,d=f.length;g<d;g++){var l=f[g];this.setSelectionValue(this.getItemKey(),l);}}else{if(this.secondaryType!=YIUI.SECONDARYTYPE.CHAINDICT){$(".sel",this._dropView).removeClass("sel");this.setSelectionValue(this.getItemKey(),this.value);var j=this.value.oid;var e=$("[oid='"+j+"']",this.dictTree.el).eq(0);if(e.length>0){var h=e.offset().top-e.parent().height();if(h>0){this.dictTree.el.scrollTop(h);}var k=$(".dt-wholerow:first",e);if(!k.hasClass("sel")&&e.hasClass("comp_Level1")){k.addClass("sel");}}}}},setSelectionValue:function(e,n){var p=YIUI.DictService.getTreePath(e,n);if(p.length>0){var m=p[0];var l=m[0].oid;if(m){for(var k=0,h=m.length;k<h;k++){var o=m[k];var g=o.oid;if(k>0&&g==l){break;}var d=$("[oid='"+g+"']",this.dictTree.el);if(d.length>0){this.dictTree.expandNode(d);}}var f=$("[oid='"+n.oid+"']",this.dictTree.el);if(f.length==0){this.dictTree.clearChkNodes=true;}else{this.dictTree.checkTreeNode(f,1);}}}else{$(".dt-wholerow.sel",this._dropView).removeClass("sel");}},setSecondaryType:function(d){this.secondaryType=d;},destroy:function(){this._dropView.remove();this.$suggestView.remove();},hideDictList:function(){this._dropView.hide();this._hasShow=false;this._resetTree=false;if(this.multiSelect){this.setSelValue(this.dictTree.getCheckedValues());}else{this.setSelValue(this.value);}this._resetTree=true;$(document).off("mousedown");this.hiding();},hideSuggestView:function(){this.$suggestView.hide();this.hiding();$(document).off("mousedown");},getEditor:function(){return this._textBtn;},install:function(){var f=this;var e=f.dictTree;e.startRow=0;e.pageIndicatorCount=3;e.fuzzyValue=null;this._dropBtn.click(function(g){if(!f.enable){return;}if(e.startRow==0){f.dictTree._footMean.find(".prev").addClass("disable");}f._textBtn.focus();if(f._hasShow){f.el.removeClass("focus");f.hideDictList();return;}f.el.addClass("focus");f.checkDict();if(f.secondaryType==YIUI.SECONDARYTYPE.CHAINDICT){f.dictTree.reset();f.dictTree._footdiv.show();f.dictTree._searchdiv.show();}if(f.secondaryType!=YIUI.SECONDARYTYPE.CHAINDICT){f.dictTree._footdiv.hide();f.dictTree._searchdiv.hide();}f.dictTree.expandNode(f.dictTree.rootNode);f.setDropViewTop();f.setDropViewLeft();f.showing();f._dropView.slideDown("fast");$(document).on("mousedown",function(j){var h=$(j.target);if((h.closest(f._dropView).length==0)&&(h.closest(f._dropBtn).length==0)){f.hideDictList();f.el.removeClass("focus");}});f._hasShow=true;g.stopPropagation();});this.dictTree._searchdiv.delegate(".findspan","click",function(){var h=$(this).prev().val();if(h!=null){$(this).parent().parent().parent().find(".next").removeClass("disable");e.fuzzyValue=h;e.startRow=0;f.dictTree.expandNode(f.dictTree.rootNode);var g=f.dictTree._footMean.children(".pageinfo").children().length;if(g==1||g==0){f.dictTree._footMean.find(".next").addClass("disable");f.dictTree._footMean.find(".prev").addClass("disable");}}});this.dictTree._searchdiv.delegate(".findinput","keydown",function(h){var k=h.which;var j=$(this).val();if(j!=null&&k==13){$(this).parent().parent().parent().find(".next").removeClass("disable");e.fuzzyValue=j;e.startRow=0;f.dictTree.expandNode(f.dictTree.rootNode);var g=f.dictTree._footMean.children(".pageinfo").children().length;if(g==1||g==0){f.dictTree._footMean.find(".next").addClass("disable");f.dictTree._footMean.find(".prev").addClass("disable");}}});this.dictTree._footdiv.delegate(".next","click",function(){var p=f.dictTree.el.html();$(this).parent().find(".prev").removeClass("disable");e.startRow=e.startRow+10;f.dictTree.expandNode(f.dictTree.rootNode);var l=f.dictTree.el.html();var h=$(".nowitem",f.dictTree._footdiv);var j=f.dictTree._footdiv.find($(".pageinfo span")).index(f.dictTree._footdiv.find($(".nowitem")));var g=$(".pageinfo",f.dictTree._footdiv).attr("maxnum");var m=$(f.dictTree._footdiv.find(".pagenum"));var k=h.html();if(p==l){e.startRow=e.startRow-10;}if(j==2&&+g>=1){h.html(+h.html()+1);var o=h.prevAll();o.eq(0).html(+o.eq(0).html()+1);o.eq(1).html(+o.eq(1).html()+1);}if(j==2&&+g==1){$(this).addClass("disable");}var n=h.next().length;if(p!=l&&n!=0){h.removeClass("nowitem");h.next().addClass("nowitem");j=+j+1;}if(m.length==2&&j==1){$(this).addClass("disable");}});this.dictTree._footdiv.delegate(".prev","click",function(){e.startRow=e.startRow-10;var g=f.dictTree.el.html();$(this).parent().find(".next").removeClass("disable");f.checkDict();f.dictTree.expandNode(f.dictTree.rootNode);var l=f.dictTree.el.html();var n=$(".nowitem",f.dictTree._footdiv);var k=n.html();var j=f.dictTree._footdiv.find($(".pageinfo span")).index($(".nowitem"));if(k!=1){if(j==0){n.html(+n.html()-1);var h=n.nextAll();h.eq(0).html(+h.eq(0).html()-1);h.eq(1).html(+h.eq(1).html()-1);}var m=n.prev().length;if(m!=0){n.removeClass("nowitem");n.prev().addClass("nowitem");}}if(g==l){e.startRow=e.startRow+10;}if(+k==1){$(this).addClass("disable");}});this.dictTree._footdiv.delegate(".pagenum","click",function(){var l=$(this);var j=l.html();var k=f.dictTree.el.html();e.startRow=(j-1)*10;f.checkDict();f.dictTree.expandNode(f.dictTree.rootNode);var h=f.dictTree.el.html();var m=$(f.dictTree._footdiv.find(".pagenum"));var o=m.index(l);var g=l.parent().attr("maxnum");if(o==0&&l.html()==1){m.removeClass("nowitem");l.addClass("nowitem");l.parent().parent().children().eq(0).removeClass("disable");l.parent().parent().children().eq(1).addClass("disable");}if(o==1&&m.length==3){m.removeClass("nowitem");l.addClass("nowitem");l.parent().parent().find(".next").removeClass("disable");l.parent().parent().find(".prev").removeClass("disable");}if(o==1&&m.length==2){m.removeClass("nowitem");l.addClass("nowitem");l.parent().parent().find(".next").addClass("disable");l.parent().parent().find(".prev").removeClass("disable");}if(l.html()==1){f.dictTree._footMean.children(".prev").addClass("disable");f.dictTree._footMean.children(".next").removeClass("disable");}if(o==2){m.removeClass("nowitem");if(g>1){l.html(+l.html()+1);var p=l.prevAll();$(p[0]).html(+$(p[0]).html()+1);$(p[1]).html(+$(p[1]).html()+1);$(p[0]).addClass("nowitem");m.find(".next").addClass("nowitem");}else{l.addClass("nowitem");l.parent().parent().find(".next").addClass("disable");l.parent().parent().find(".prev").removeClass("disable");}}if(o==0&&l.html()!=1){m.removeClass("nowitem");l.html(+l.html()-1);var n=l.nextAll();$(n).eq(0).html(+$(n[0]).html()-1);$(n).eq(1).html(+$(n[1]).html()-1);m.eq(1).addClass("nowitem");l.parent().parent().children().eq(0).removeClass("disable");l.parent().parent().children().eq(1).removeClass("disable");}});this.$suggestView.delegate("li","click",function(){var h={oid:$(this).attr("oid"),itemKey:$(this).attr("itemkey"),caption:$(this).text()};var g=new YIUI.ItemData(h);f.setSelValue(g);f.hideSuggestView();});var d;this._textBtn.focus(function(){d=$(this).val();}).blur(function(g){var h=$(this).val();if(h!=d){f.doLostFocus(h);}});}};a=$.extend(a,b);a.init();var c=new YIUI.Yes_DictTree({showCheckBox:a.multiSelect,independent:a.independent,formatAsyncData:function(d){$.each(d,function(e,f){var g=f.itemKey+"_"+f.OID;f.id=g;});return d;},getNodeValue:function(e){if(e.length>0){var g="";if(e.attr("oid")>=0){g=e.children("a").text();}var f={};f.oid=e.attr("oid")||0;f.itemKey=e.attr("itemKey");f.caption=g;var d=new YIUI.ItemData(f);return d;}},expandNode:function(e){if(!e){e=this.rootNode;}if(e.attr("isLoaded")=="false"||e.attr("isLoaded")==undefined){this.callback.beforeExpand(this,e);a.getDictChildren(e);}e.children("ul").show();var d=e.children("span:first");if(d.hasClass("dt-collapse")){d.removeClass("dt-collapse").addClass("dt-expand");d.next(".dt-anchor").find(".branch").removeClass("b-collapse").addClass("b-expand");}},callback:{beforeExpand:function(d,f){if(a.multiSelect&&!a.independent&&d.indeterminatedNodes==null){var e=a.getSelValue();a.setDictTreeCheckedNodes();d.indeterminatedNodes=[];if(e&&e.length>0){a.beforeExpand(d,f);}}},onSelected:function(e,d){a.value=e.getNodeValue(d);if(a._hasShow){a.hideDictList();}},onChecked:function(e,d){}}});a.setDictTree(c);a._dropView.hide();a._textBtn.val(this.text);c.render(a._dropView);a.install();return a;};})();(function(){YIUI.Yes_DatePicker=function(b){var a={el:$("<div></div>"),dropView:$("<div class='dp-vw'></div>"),formatStr:"yyyy-MM-dd HH:mm:ss",isNoTimeZone:false,isOnlyDate:false,regional:"zh-CN",calendars:1,enable:true,editable:true,init:function(){this._input=$("<input type='text' class='txt'>").appendTo(this.el);this._btn=$("<span class='arrow'></span>").appendTo(this.el);this.initDatePicker(b.id);},getEl:function(){return this.el;},getInput:function(){return this._input;},getBtn:function(){return this._btn;},getDropView:function(){return this.dropView;},getDetailTime:function(){return this.detailTime;},setFormatStr:function(){if(this.isOnlyDate){this.formatStr="yyyy-MM-dd";}else{this.formatStr="yyyy-MM-dd HH:mm:ss";}},setRegional:function(c){this.regional=c;},setCalendars:function(c){this.calendars=c;},setOnlyDate:function(c){this.isOnlyDate=c;},setIsNoTimeZone:function(c){this.isNoTimeZone=c;},setWidth:function(c){this.el.css("width",c);this.getInput().css("width",c);this.getBtn().css({left:this.el.outerWidth()-26+"px"});this.setDropViewLeft();},setHeight:function(c){this.el.css("height",c);this.getInput().css("height",c);var d=(c-16)/2;this.getBtn().css({top:d});if($.browser.isIE){this.getInput().css("line-height",(c-3)+"px");}},setEditable:function(c){this.editable=c;var d=this.getInput();if(this.editable){d.removeAttr("readonly");}else{d.attr("readonly","readonly");}},setEnable:function(d){this.enable=d;var e=this.getInput(),c=this.el;if(d){e.removeAttr("readonly");c.removeClass("ui-readonly");}else{e.attr("readonly","readonly");c.addClass("ui-readonly");}},setValue:function(d){if(!d){return;}var c;if($.isNumeric(d)){c=new Date(parseFloat(d));}else{var e=d.split(/\W+/);if(this.isOnlyDate){c=new Date(e[0],e[1]-1,e[2]);}else{c=new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5]);}}this.text=c.Format(this.formatStr);this.getInput().val(this.text);},getText:function(){var c=this.getInput().val()||"";if(c!=""&&this.isOnlyDate){c+=" 00:00:00";}return c;},getValue:function(){if(this.getText()!=""){var d=this.getText().split(/\W+/);var c=new Date(d[0],d[1]-1,d[2],d[3]?d[3]:"00",d[4]?d[4]:"00",d[5]?d[5]:"00");if(isNaN(c)){return null;}else{return c.getTime();}}else{return null;}},initDatePicker:function(d){var c=this;this.getInput().attr("id","dateInput_"+d);this.getInput().DateTimeMask({masktype:(this.isOnlyDate?3:1)});this.getBtn().attr("id","dateImg_"+d);this.setFormatStr();this.dropView.attr("id",d+"_datepickerView");this.dropView.html("");this.dropView.DatePicker({flat:true,format:c.formatStr,date:[new Date()],current:c.getInput().val(),calendars:c.calendars,starts:7,regional:c.regional,onChange:function(e){c.getInput().val(e);if(!c.isOnlyDate){c.clearDateTime();}else{c.dropView.hide();c.dropView.blur();}}});this.detailTime=$("<div class='time'></div>");if(!this.isOnlyDate){$("<button class='btn'>今天</button>").click(function(){c.getInput().val((new Date()).Format(c.formatStr));if(!c.isOnlyDate){c.setDetailTime(c.getInput().val());}else{c.dropView.hide();c.dropView.blur();}}).appendTo(this.detailTime);$("<button class='btn'>确认</button>").click(function(){c.dropView.hide();c.dropView.blur();}).appendTo(this.detailTime);$("<input/>").appendTo(this.detailTime).spinit({max:23}).data("index",0);$("<input/>").appendTo(this.detailTime).spinit({max:59}).data("index",1);$("<input/>").appendTo(this.detailTime).spinit({max:59}).data("index",2);this.detailTime.appendTo(this.dropView);}this.install();},setDetailTime:function(d){var c=d.split(" ");if(c.length<2){return;}var f=d.split(" ")[1].split(":");for(var e=0;e<f.length;e++){$("input",this.detailTime).eq(e).val(f[e]);}},clearDateTime:function(){$("input",this.detailTime).each(function(){$(this).val(0);});},setDropViewTop:function(){var f=this.getInput();var d=this.getInput().offset();var c=$(window).height()-d.top-this.el.height();var e=d.top+f.outerHeight();if(c<this.dropView.outerHeight()){this.dropView.addClass("toplst");this.el.addClass("toplst");e=d.top-this.dropView.outerHeight();}else{this.dropView.removeClass("toplst");this.el.removeClass("toplst");}if(e!="auto"){this.dropView.css("top",e+"px");}},setDropViewLeft:function(){var f=this.getInput();var d=this.getInput().offset();var c=$(window).width()-$(this.getInput()).offset().left;var e=$(window).width()-this.dropView.outerWidth();if(c<this.dropView.outerWidth()){e="auto";c=$(window).width()-d.left-f.outerWidth();}else{e=d.left;c="auto";}if(e!="auto"){this.dropView.css("left",e+"px");this.dropView.css("right","auto");}if(c!="auto"){this.dropView.css("right",c+"px");this.dropView.css("left","auto");}},install:function(){var c=this;this.getBtn().click(function(g){if(!c.enable){return;}if($("#"+c.dropView[0].id).length<=0){$(document.body).append(c.dropView);}if(!c.dropView.is(":hidden")){c.dropView.hide();return;}c.el.addClass("focus");var e=c.dropView.find("tr:first").find("table");for(var d=0;d<e.length;d++){if(!e.eq(d).hasClass("datepickerViewDays")){e.eq(d).attr("class","datepickerViewDays");}}if(c.getInput().val()){c.dropView.DatePickerSetDate(c.getInput().val(),true);if(!c.isOnlyDate){c.setDetailTime(c.getInput().val());}}else{c.dropView.DatePickerSetDate((new Date()).Format(c.formatStr));c.clearDateTime();}var f=c.calendars*210+$(".datepickerSpace",c.dropView).children().width()*(c.calendars-1);if(!c.isOnlyDate){f+=160;}c.dropView.css({"min-width":"210px","min-height":"205px",width:f});c.dropView.css("z-index",$.getZindex(c.getInput())+1);$(".datepicker",c.dropView).css({width:c.calendars*210,height:c.dropView.height()});c.setDropViewTop();c.setDropViewLeft();c.dropView.slideDown("fast");$(document).on("mousedown.datePicker",function(j){var h=$(j.target);if((h.closest(c.dropView).length==0)&&(h.closest(c.getInput()).length==0)&&(h.closest(c.getBtn()).length==0)&&!c.dropView.is(":hidden")){c.dropView.hide();c.dropView.blur();c.el.removeClass("focus");$(document).off("mousedown.datePicker");}});g.stopPropagation();});$("input",c.getDetailTime()).bind("blur",function(h){if(c.getInput().val()){var d=c.getInput().val();var f=d.substring(0,d.split(" ")[0].length+1);var g=d.split(" ")[1].split(":");if(h.target.value.length==1){g[$(this).data("index")]="0"+h.target.value;}else{g[$(this).data("index")]=h.target.value;}c.getInput().val(f+g.join(":"));}});}};a=$.extend(a,b);if(!b.isPortal){a.init();}return a;};})();(function(){YIUI.Yes_Combobox=function(b){var a={_hasShow:false,el:$("<div></div>"),_textBtn:$('<input type="text" />'),_dropBtn:$("<div/>"),_dropView:$("<div/>"),$suggestView:$("<div/>"),itemval:0,init:function(){this._textBtn.addClass("txt").appendTo(this.el);this._dropBtn.addClass("arrow").appendTo(this.el);this._dropView.addClass("cmb-vw").appendTo($(document.body));this.$suggestView.addClass("cmb-autovw cmb-vw").appendTo($(document.body));if(this.multiSelect){this._textBtn.attr("readonly","readonly");}},items:null,multiSelect:false,sourceType:YIUI.COMBOBOX_SOURCETYPE.ITEMS,editable:true,enable:true,getEl:function(){return this.el;},setEditable:function(c){this.editable=c;},setEnable:function(d){this.enable=d;var e=this._textBtn,c=this.el;if(d){e.removeAttr("disabled");c.removeClass("ui-readonly");}else{e.attr("disabled","disabled");c.addClass("ui-readonly");}},setFormatStyle:function(c){this._textBtn.css(c);},setDropViewTop:function(){var f=this._textBtn;var d=this._textBtn.offset();var c=$(window).height()-d.top-this.el.height();var e=d.top+f.outerHeight();if(c<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");e="auto";c=$(window).height()-$(this._textBtn).offset().top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");c="auto";}if(e!="auto"){this._dropView.css("top",e+"px");this._dropView.css("bottom","auto");}if(c!="auto"){this._dropView.css("bottom",c+"px");this._dropView.css("top","auto");}},setDropViewLeft:function(){var f=this._textBtn;var d=this._textBtn.offset();var c=$(window).width()-$(this._textBtn).offset().left;var e=$(window).width()-this._dropView.outerWidth();if(c<this._dropView.outerWidth()){e="auto";c=$(window).width()-d.left-f.outerWidth();}else{e=d.left;c="auto";}if(e!="auto"){this._dropView.css("left",e+"px");this._dropView.css("right","auto");}if(c!="auto"){this._dropView.css("right",c+"px");this._dropView.css("left","auto");}this._dropView[0].style.width=f.outerWidth()+"px";},getItemCaption:function(f){if(f==null){return"";}var d=this._textBtn.val();var c=new Array();c[0]=f;if(this.multiSelect){c=f.split(",");}var d=new Array();for(var e in c){for(var g in this.items){if(c[e]==this.items[g].value){d.push(this.items[g].caption);break;}}}return d.join(",");},setWidth:function(c){this.el.css("width",c+"px");this._textBtn.css("width",c+"px");this._dropBtn.css({left:this._textBtn.outerWidth()-26+"px"});},setHeight:function(c){this.el.css("height",c+"px");this._textBtn.css("height",c+"px");if($.browser.isIE){this._textBtn.css("line-height",(c-3)+"px");}this._dropBtn.css({top:(this._textBtn.outerHeight()-16)/2+"px"});},destroy:function(){this._dropView.remove();this.$suggestView.remove();},getItems:function(){return this.items;},hiding:$.noop,hideComboList:function(){this._dropView.hide();this._hasShow=false;$(document).off("mousedown");this.hiding();},setItems:function(e){if(e==null){e=[];}this.items=e;var d=$("<ul/>"),h;this._dropView.html(d);for(var g=0,c=e.length;g<c;g++){var j=e[g].value==undefined?"":e[g].value;if(this.multiSelect){var f=e[g].caption==undefined?"":e[g].caption;h=$('<li><input type="checkbox"  itemValue="'+j+'"/><span>'+f+"</span></li>");}else{h=$('<li itemValue="'+j+'">'+(e[g].caption||"")+"</li>");if(j==""){h.addClass("empty");}if(this.value&&this.value==e[g].value){h.addClass("sel");this._selectedLi=h;}}d.append(h);}},checkItem:function(g){if(this.multiSelect&&g){var c=g.split(",");for(var e in c){var d=this._dropView.find('input[type="checkbox"]');for(var f=0;f<d.length;f++){if(c[e]==$(d[f]).attr("itemValue")){d[f].checked=true;break;}}}}},setSelValue:function(c){this.value=c;},getSelValue:function(){return this.value;},setText:function(c){this.text=c;this._textBtn.val(this.text);},getText:function(){return this._textBtn.val();},install:function(){var d=this;this._dropBtn.click(function(j){if(!d.enable){return;}d._textBtn.focus();if(d._hasShow){d.itemval=0;d.hideComboList();return;}d._dropView.children("ul").css("width","auto");d.getItems();d.checkItem(d.getSelValue());d.setDropViewTop();d.setDropViewLeft();d._dropView.show();var k=d.getText();var f=d._dropView.find("li");if(k==""){f.removeClass("sel");d._dropView.scrollTop(0);}d._dropView.children("ul").css("width",d._dropView[0].scrollWidth);if(d._selectedLi&&(d._selectedLi.attr("itemValue")==d.getSelValue())){var g=d._dropView.outerHeight()-d._dropView[0].clientHeight;var h=d._selectedLi.position().top-d._dropView.height()+d._selectedLi.height()+g;d._dropView.scrollTop(h<0?0:h);}else{var l=$("[itemValue='"+d.getSelValue()+"']");if(l.length>0&&!l.hasClass("empty")){d._selectedLi=l;l.addClass("sel");}}$(document).on("mousedown",function(n){var m=$(n.target);if((m.closest(d._dropView).length==0)&&(m.closest(d._dropBtn).length==0)&&(m.closest(d._textBtn).length==0)){d.itemval=0;d.hideComboList();}});d._hasShow=true;j.stopPropagation();});this._dropView.delegate("li","mouseup",function(g){$(this).parent().find("li").removeClass("sel");if(d.multiSelect){return;}if(d._selectedLi){d._selectedLi.removeClass("sel");}if(!$(this).hasClass("empty")){$(this).addClass("sel");d._selectedLi=$(this);}else{d._selectedLi=null;}var f=$(g.target).attr("itemValue");d.setSelValue(f);d._textBtn.val($(g.target).text());d.hideComboList();});this.$suggestView.delegate("li","mouseup",function(g){var f=$(g.target).attr("itemValue");d.setSelValue(f);d._textBtn.val($(g.target).text());d.$suggestView.hide();d.hiding();d._selectedLi=$("li[itemvalue="+f+"]",d._dropView).addClass("sel");$(document).off("mousedown");});this._textBtn.on("keyup",function(h){var g=$(this);var k=h.which;if(!d._hasShow){h.stopPropagation();return;}var j=g.val();var f=d._dropView.find("li");f.removeClass("sel");if(k!=13){d.itemval=0;if(d._hasShow){e(j,f);h.stopPropagation();}}if(k==13&&j!=""){c(j,f);h.stopPropagation();}});function e(j,g){var h=d.itemval;var f=g.length;if(f!=0){$.each(g,function(k,l){$(l).parent().find("li").removeClass("sel");if($(l).find("span").length==0&&j!=""&&$(l).html().indexOf(j)!=-1){if(h==0){$(this).parent().parent().scrollTop(k*26);$(l).addClass("sel");h=k;d.itemFlag=k;return false;}}if($(l).find("span").length!=0&&$(l).find("span").html().indexOf(j)!=-1){if(h==0){$(this).parent().parent().scrollTop(k*26);$(l).addClass("sel");h=k;d.itemFlag=k;return false;}}});}}function c(l,h){var f=d.itemFlag;for(var j=f+1;j<h.length;j++){var g=$(h[j]);if(g.find("span").length==0){var k=g.html().indexOf(l)!=-1;isUse=k;if(k){g.parent().parent().scrollTop((j)*26);g.parent().find("li").removeClass("sel");g.addClass("sel");d.itemFlag=j;break;}}if(g.find("span").length!=0){var k=g.find("span").html().indexOf(l)!=-1;isUse=k;if(k){g.parent().parent().scrollTop((j)*26);g.parent().find("li").removeClass("sel");g.addClass("sel");d.itemFlag=j;break;}}}}if(this.multiSelect){this._dropView.delegate("input[type='checkbox']","click",function(j){var g=d._dropView.find('input[type="checkbox"]');var f=g.filter(":checked").map(function(){return $(this).next().html();}).get().join(",");var h=g.filter(":checked").map(function(){return $(this).attr("itemValue");}).get().join(",");d._textBtn.val(f);d.setSelValue(h);});}}};a=$.extend(a,b);if(!b.isPortal){a.init();}a.install();return a;};})();(function(){YIUI.Yes_Dialog=function(n){var m={el:$("<div></div>"),msg:"是否关闭",msgType:YIUI.Dialog_MsgType.YES_NO,items:[]};n=$.extend(m,n);var f=n.msgType,k;var c={key:"OK",caption:"确定"};var h={key:"YES",caption:"是"};var g={key:"NO",caption:"否"};var e={key:"Cancel",caption:"取消"};switch(f){case YIUI.Dialog_MsgType.DEFAULT:k=[c];break;case YIUI.Dialog_MsgType.YES_NO:k=[h,g];break;case YIUI.Dialog_MsgType.YES_NO_CANCEL:k=[h,g,e];break;}n.items=k;var l=n.el.attr("id","close_dialog");var d={};var a=function(w,t,o,y){var v=new YIUI.Control.Label({metaObj:{x:1,y:1,colspan:2,topMargin:0,visible:true},caption:n.msg});var x,p;var u=new YIUI.Panel.GridLayoutPanel({metaObj:{rowGap:5,columnGap:2},widths:[5,"50%","50%"],minWidths:["-1","-1","-1"],heights:[5,"pref","100%",25,15]});u.add(v);var s=new YIUI.Panel.FlexFlowLayoutPanel({metaObj:{x:1,y:3,colspan:2,visible:true,cssClass:"dialog_btns"}});for(var q=0,r=k.length;q<r;q++){x=k[q];p=new YIUI.Control.Button({metaObj:{key:x.key,width:60,height:25,left:q*5},caption:x.caption,listeners:null,value:x.caption});d[x.key]=p;s.add(p);}u.add(s);return u;};var j=a();var b={el:l,show:function(){var q={title:n.title,showClose:false,width:"auto",height:"100px"};q.resizeCallback=function(){var t=l.dialogContent();if(j.hasLayout){j.doLayout(t.width(),t.height());}else{j.setWidth(t.width());j.setHeight(t.height());}};l.modalDialog(null,q);j.render(l.dialogContent());var p;for(var o in d){p=d[o];p.el.attr("key",o);p.el.addClass("dlg-btn");p.el.unbind();}var s=($(window).width()/2-l.width()/2)+"px";var r=($(window).height()/2-l.height()/2)+"px";l.css({left:s,top:r});},parseOpt:function(p){var o=-1;if(p==YIUI.Dialog_Btn.STR_YES){o=YIUI.Dialog_Btn.YES_OPTION;}else{if(p==YIUI.Dialog_Btn.STR_NO){o=YIUI.Dialog_Btn.NO_OPTION;}else{if(p==YIUI.Dialog_Btn.STR_CANCEL){o=YIUI.Dialog_Btn.CANCEL_OPTION;}else{if(p==YIUI.Dialog_Btn.STR_OK){o=YIUI.Dialog_Btn.OK_OPTION;}}}}return o;},close:function(){l.close();}};return b;};})();var ConditionParas=ConditionParas||{};(function(){ConditionParas=function(){var a={condParas:[],condFormKey:"",setCondFormKey:function(b){this.condFormKey=b;},getCondFormKey:function(){return this.condFormKey;},add:function(b){this.condParas.push(b);},get:function(b){return this.condParas[b];},size:function(){return this.condParas.length;},getCondParas:function(){return{condParas_items:this.condParas};},clear:function(){this.condParas.length=0;}};return a;};ConditionItem=function(){var a={key:"",type:-1,condSign:-1,group:"",groupHead:false,groupTail:false,targetTableKey:"",tableKey:"",columnKey:"",value:"",setKey:function(b){this.key=b;},getKey:function(){return this.key;},setType:function(b){this.type=b;},getType:function(){return this.type;},setCondSign:function(b){this.condSign=b;},getCondSign:function(){return this.condSign;},setGroup:function(b){this.group=b;},getGroup:function(){return this.group;},setGroupHead:function(b){this.groupHead=b;},isGroupHead:function(){return this.groupHead;},setGroupTail:function(b){this.groupTail=b;},isGroupTail:function(){return this.groupTail;},setTargetTableKey:function(b){this.targetTableKey=b;},getTargetTableKey:function(){return this.targetTableKey;},setTableKey:function(b){this.tableKey=b;},getTableKey:function(){return this.tableKey;},setColumnKey:function(b){this.columnKey=b;},getColumnKey:function(){return this.columnKey;},setValue:function(b){this.value=b;},getValue:function(){return this.value;}};return a;};})();YIUI.Control.Toolbar=YIUI.extend(YIUI.Control,{handler:YIUI.ToolBarHandler,height:36,setEnable:function(a){this.base(true);},renderMenu:function(){var h=this.ul;if(typeof h!="undefined"){h.attr("id",this.id+"_toolbar").addClass("tbr-ul");var f=h.children("li").addClass("tbr-item");var k=f.children("a").addClass("tbr-btn");k.each(function(){if($(this).attr("icon")){$("<span class='icon'></span>").css("background-image","url(Resource/"+$(this).attr("icon")+")").appendTo($(this));}});var c=$("ul",f).addClass("tbr-vw").attr("tabindex","0");$("li",c).addClass("dp-item").attr("tabindex","-1");}for(var e=0,g=this.ul.children().length;e<g;e++){var f=this.ul.children().eq(e);var l=this.items[f[0].index];f[0].item=l;if(l.items){for(var d=0,b=$("ul",f).children().length;d<b;d++){var a=$("ul",f).children().eq(d);a[0].item=l.items[a[0].index];}}}},onSetWidth:function(a){this.base(a);this.ul.width(a-this._dropBtn.width());$("li",this.ul).removeClass("hide");var d=this.ul.children("[style='display: block;']"),c;if(d.length>0&&d.last().position().top>d.first().position().top){this._dropBtn.addClass("show");var f=this.dropView.empty();var e=$("<ul></ul>").appendTo(f);e.addClass("tbr-ul");f.css("top",(this.el.offset().top+this.el.outerHeight())+"px");f.css("z-index",$.getZindex(this._dropBtn)+1);for(var h=0,l=d.length;h<l;h++){c=d.eq(h);if(c.position().top>d.first().position().top){var k=c.clone();c.addClass("hide");e.append(k);k[0].item=c[0].item;var m=c.find("li.dp-item");if(m.length>0){for(var g=0,b=m.length;g<b;g++){k.find("li.dp-item")[g].item=m[g];}}}}}else{this._dropBtn.removeClass("show");this.dropView&&this.dropView.children().remove();}},onSetHeight:$.noop,diff:function(a){this.items=a["items"];this.repaint();},initDefaultValue:function(e){this.base(e);this.ul=e.el.children("ul");var d=this.el.find("li"),b,g,c=[];for(var f=0,a=d.length;f<a;f++){b=d.eq(f);g={key:b.attr("key"),text:b.children("a").text().trim()};c.push(g);}this.items=c;},onRender:function(a){this.base(a);this.el.addClass("ui-tbr");this.ul=this.renderItems(this.el,this.items);this._dropBtn=$("<span class='dp-btn'></span>").appendTo(this.el);this.dropView=$("<div class='tbr-dpvw'></div>").appendTo($(document.body));this.renderMenu();},repaint:function(){this.ul.remove();this.ul=this.renderItems(this.el,this.items);this.renderMenu();},renderItems:function(f,e){var d=f.children("ul");if(d.length==0){d=$("<ul></ul>").appendTo(f);}var j=this;if(e&&e.length>0){var h,g,b;for(var a=0,c=e.length;a<c;a++){h=e[a];g=$("<li></li>").appendTo(d);g.css({display:(h.visible?"block":"none")});g.key=h.key;g[0].index=a;b=$("<a></a>").appendTo(g);if(h.icon){b.attr("icon",h.icon);b.addClass("pri-icon");}$("<span class='txt'/>").html(h.caption).appendTo(b);if(!h.enable||!j.enable){g.addClass("ui-readonly");}if($.isArray(h.items)){if(h.style.toLowerCase()=="splitbutton"){g.addClass("sp-btn");b.addClass("btn-left");$("<a><span class='arrow'></span></a>").addClass("btn-right").appendTo(g);}else{if(h.style.toLowerCase()=="dropdownbutton"){g.addClass("dpd-btn");$("<span class='arrow'></span>").appendTo(b);}}this.renderItems(g,h.items);}}}return d;},setItemVisible:function(e,f){var c=$("li",this.el);for(var d=0,b,a=c.length;d<a;d++){b=c[d];if(b.item.key==e){$(b).css({display:(f?"block":"none")});break;}}},setItemEnable:function(f,d){var c=$("li",this.el);for(var e=0,b,a=c.length;e<a;e++){b=c[e];if(b.item.key==f){d?$(b).removeClass("ui-readonly"):$(b).addClass("ui-readonly");break;}}},beforeDestroy:function(){this.dropView.remove();},needTip:function(){return false;},install:function(){var a=this;a.el.delegate("li","click",function(b){var c=$(this);if(c.hasClass("ui-readonly")){return;}if(c.hasClass("dpd-btn")){c.toggleClass("show");}else{if(c.hasClass("sp-btn")&&($(b.target).hasClass("btn-right")||$(b.target).hasClass("arrow"))){c.toggleClass("show");}else{a.item=this.item;a.handler.doOnClick(a);b.stopPropagation();}}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest($("ul",c)).length==0)&&(d.closest(c).length==0)){c.removeClass("show");}});});a.dropView.delegate("li","click",function(b){var c=$(this);if(c.hasClass("ui-readonly")){return;}if(c.hasClass("dpd-btn")){c.toggleClass("show");}else{if(c.hasClass("sp-btn")&&($(b.target).hasClass("btn-right")||$(b.target).hasClass("arrow"))){c.toggleClass("show");}else{a.dropView.removeClass("show");a.item=this.item;a.handler.doOnClick(a);b.stopPropagation();}}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest($("ul",a.dropView)).length==0)&&(d.closest(a.dropView).length==0)){a.dropView&&a.dropView.removeClass("show");}});});this._dropBtn.click(function(){var b=a.dropView;b.css("right",($(window).width()-a.el.offset().left-a.el.outerWidth())+"px");b.css("top",(a.el.offset().top+a.el.outerHeight())+"px");b.width($(this).outerWidth()+$(this).prev(".btn-left").outerWidth());b.toggleClass("show");$(document).on("mousedown",function(d){var c=$(d.target);if((c.closest($("ul",b)).length==0)&&(c.closest(b).length==0)&&(c.closest(a._dropBtn).length==0)){b&&b.removeClass("show");}});});this.el.find("a.tbr-btn").mouseover(function(){!$(this.parentElement).hasClass("ui-readonly")&&$(this).addClass("hover");});this.el.find("a.tbr-btn").mouseleave(function(){!$(this.parentElement).hasClass("ui-readonly")&&$(this).removeClass("hover");});}});YIUI.reg("toolbar",YIUI.Control.Toolbar);(function(c){var b=1;function a(){return"treemenubar_node_"+b++;}YIUI.Component.TreeMenuBar=YIUI.extend(YIUI.Component,{nodes:null,theme:"Orange",onRender:function(h){this.base(h);this.el.addClass("treemenubar");if(this.nodes){var f=this.nodes,l,e,k;for(var g=0,d=f.length;g<d;g++){l=f[g];l.id=l.id||a();if(!e){e=l;}if(l.pId!=e.id){e=l;var j=c('<ul class="group"><li>'+l.name+"</li><ul></ul></ul>").appendTo(this.el);k=c(j.children()[1]);}else{k.append(c("<li>"+l.name+"</li>"));}}this.el.treemenubar({header:"> ul > li",collapsible:true,heightStyle:"content"});}}});YIUI.reg("treemenubar",YIUI.Component.TreeMenuBar);})(jQuery);YIUI.DataBinding=YIUI.extend({tableKey:"",columnKey:"",init:function(a,b){this.tableKey=a;this.columnKey=b;},setTableKey:function(a){this.tableKey=a;},getTableKey:function(){return this.tableKey;},setColumnKey:function(a){this.columnKey=a;},getColumnKey:function(){return this.columnKey;}});YIUI.Control.Button=YIUI.extend(YIUI.Control,{autoEl:"<div><button></button></div>",handler:YIUI.ButtonHandler,behavior:YIUI.ButtonBehavior,icon:null,type:YIUI.Button_Type.DEFAULT,setType:function(a){this.type=a;this.button.setType(a);},setIcon:function(a){this.icon=a;this.button.setIcon(a);},needClean:function(){return false;},setTip:function(a){var a=this.value;this.base(a);},setValue:function(b,d,a){var c=this.base(b,d,a);this.button.getTextButton().html(b.toString());return c;},getShowText:function(){return this.value;},setEnable:function(a){this.enable=a;this.button.setEnable(a);},setFormatStyle:function(a){this.cssStyle=a;this.button.getTextButton().css(a);},onSetWidth:function(a){this.button.setWidth(a);},onSetHeight:function(a){this.button.setHeight(a);},onRender:function(a){this.base(a);var b=this;this.button=new YIUI.Yes_Button({el:b.el,type:b.getMetaObj().type});this.el.addClass("ui-btn");this.button.getTextButton().html(this.value);this.getMetaObj().icon&&this.setIcon(this.getMetaObj().icon);},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());if(a.clickContent){this.clickContent=a.clickContent;}var b=this;this.button=new YIUI.Yes_Button({el:b.el,isPortal:true});this.install();},install:function(){var a=this;a.el.click(function(b){window.up_target=null;if(!a.enable){b.stopPropagation();return false;}else{if($(b.target).hasClass("upload")){window.up_target=$(b.target);}}a.handler.doOnClick(a);});a.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("button",YIUI.Control.Button);YIUI.Control.RichEditor=YIUI.extend(YIUI.Control,{autoEl:"<textarea></textarea>",editor:null,shadow:null,_input:null,value:null,required:false,handler:YIUI.RichEditorHandler,behavior:YIUI.RichEditorBehavior,checkEnd:function(a){this.value=a;if(this.getEl()){this._input.html(a);}},getValue:function(){var a=this._input.html();return a;},setEnable:function(a){this.base(a);if(a){this.shadow.hide();}else{this.shadow.show();}},setVisible:function(a){this.base(a);if(!a){this.editor.$editorContainer.css("display","none");}else{this.editor.$editorContainer.css("display","block");}},onSetHeight:function(a){this.getOuterEl().css("height",a);var b=this.editor.$btnContainer.height();this.editor.$txtContainer.css("height",a-b-3);this.editor.$txt.css("position","relative");this.editor.$txt.css("min-height",a-b-3);this.shadow.css("height",a);},onSetWidth:function(f){var b=new Array();var c=$(".wangEditor-btn-container-group");for(var e=0;e<c.length;e++){b.push(c[e].offsetWidth);}b.sort(function(k,j){return k-j;});var d=b[b.length-1];if(f<d){var h=parseInt(this.getOuterEl().css("margin-left"))||32;var g=d+h;this.base(g);this.editor.width=g;this.shadow.css("width",g);}else{this.base(f);this.editor.width=f;this.shadow.css("width",f);}var a=this.editor.$btnContainer.height();this.editor.$txtContainer.css("height",this.shadow.height()-a-3);this.shadow.css("margin-top",this.getOuterEl().css("margin-top"));this.shadow.css("margin-left",this.getOuterEl().css("margin-left"));},onRender:function(a){this.base(a);this.editor=this.el.wangEditor();this.el=this.editor.$editorContainer;this.shadow=$("<div class='ui-redt sd'></div>").appendTo(this.container);this.shadow.parent().css("position","relative");this._input=this.editor.$txt;if(this.value){this._input.html(this.value);}this.el.addClass("ui-rich");},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},setError:$.noop,install:function(){this.base();var a=this;this.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108||c===9){a.el.removeAttr("tabIndex");a.el.blur();a.focusManager.requestNextFocus(a);b.preventDefault();}});a._input.bind("blur",function(){a.finishInput();});},finishInput:function(){var a=this,b=this._input.html();if(b!=a.value){a.setValue(b,true,true);a.valueChange(b);if(a.getMetaObj().required){var c=(b=="");a.setRequired(c);}}},valueChange:function(a){this.setValue(a,true,true);},getOuterEl:function(){return this.el;}});YIUI.reg("richeditor",YIUI.Control.RichEditor);YIUI.Control.ButtonGroup=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",items:[],buttonType:"radio",onRender:function(f){this.base(f);var c=this.getEl(),g=this.items,b=this.getId(),k,a,e;for(var d=0;d<g.length;d++){e=g[d];k=b+d;var j=$("<input />").attr("type",this.buttonType).attr("name",b).attr("id",k).val(e.value).appendTo(c);var h=$("<label></label>").attr("for",k).html(e.text).appendTo(c);}c.buttonset({type:this.buttonType});},onSetWidth:function(a){var b=a/this.items.length-$("label",this.el).cssNum("margin-right");this.el.css("width",a+"px");$("label",this.el).css("width",b+"px");},onSetHeight:function(a){var b=$("label span",this.el);b.css("line-height",(a-b.cssNum("padding-top")-b.cssNum("padding-bottom"))+"px");}});YIUI.reg("buttongroup",YIUI.Control.ButtonGroup);YIUI.Control.DropdownButton=YIUI.extend(YIUI.Control,{autoEl:'<div class="ui-dropbtn btn-group"></div>',handler:YIUI.DropdownButtonHandler,icon:"",caption:"",dropdownItems:[],setTip:function(a){var a=this.caption;this.base(a);},onRender:function(f){this.base(f);var c=this.getEl(),d=this.dropdownItems,k=this.caption,g=this.button=$("<a/>").attr("class","btn dp-tgl").attr("data-toggle","dropdown").appendTo(c);this.getMetaObj().icon&&this.setIcon(this.getMetaObj().icon);$("<label>").text(k).appendTo(g);$('<span class="arrow"/>').appendTo(g);if(d.length>0){var b=this._dropView=$('<div class="dpbtn-vw"/>').attr("id",this.id+"_dropdown").appendTo($(document.body));var j=$("<ul/>").appendTo(b);for(var e=0;e<d.length;e++){var h=$("<li></li>").appendTo(j);if(d[e].separator){h.attr("role","separator").addClass("sep");}else{$("<a>"+d[e].text+"</a>").appendTo(h);h.attr("key",d[e].key);}}}},setIcon:function(a){this.icon=a;if($("span.icon",this.el).length==0){$('<span class="icon"/>').css("background-image","url(Resource/"+a+")").appendTo(this.button);}else{$("span.icon",this.el).css("background-image","url(Resource/"+a+")");}},setEditable:function(b){this.editable=b;var c=$(".dp-tgl",this.el),a=this.el;if(this.editable){c.removeAttr("disabled");a.removeClass("ui-readonly");}else{c.attr("disabled","disabled");a.addClass("ui-readonly");}},setBackColor:function(a){this.backColor=a;this.button.css({"background-image":"none","background-color":a});},setForeColor:function(a){this.foreColor=a;this.button.css("color",a);},setFormatStyle:function(a){$("label",this.button).css(a);},onSetWidth:function(a){this.button.css("width",a);$("label",this.button).css("width",a-$("span.icon",this.el).width()-12);},onSetHeight:function(a){this.button.css({"height":a,"line-height":a+"px"});$("span.arrow",this.el).css("margin-top",(a-4)/2+"px");var b=$("span.icon",this.el);b.css("top",(a-b.height()-2)/2);},setDisabled:function(b){this.base(b);var a=this.getEl().children();$.each(a,function(){if(b){$(this).attr("disabled","disabled");}else{$(this).removeAttr("disabled");}});},hideDropdownList:function(){this._dropView&&this._dropView.hide();this._hasShow=false;this.el.removeClass("focus");},setDropViewTop:function(){var d=this.el;var b=this.el.offset();var a=$(window).height()-b.top-d.outerHeight();var c=b.top+d.outerHeight();if(a<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");c="auto";a=$(window).height()-b.top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");a="auto";}if(c!="auto"){this._dropView.css("top",c+"px");this._dropView.css("bottom","auto");}if(a!="auto"){this._dropView.css("bottom",a+"px");this._dropView.css("top","auto");}this._dropView.css("width",d.outerWidth()+"px");},setDropViewLeft:function(){var d=this.el;var b=this.el.offset();var a=$(window).width()-b.left;var c=$(window).width()-this._dropView.outerWidth();if(a<this._dropView.outerWidth()){c="auto";a=$(window).width()-b.left-d.outerWidth();}else{c=b.left;a="auto";}if(c!="auto"){this._dropView.css("left",c+"px");this._dropView.css("right","auto");}if(a!="auto"){this._dropView.css("right",a+"px");this._dropView.css("left","auto");}},initDefaultValue:function(a){this.base(a);this._dropView=$(".dp-vw",this.el).attr("id",this.el[0].id+"_dropdown");$("span.arrow",this.el).css({"position":"absolute","margin-top":(this.el.outerHeight()-4)/2+"px","float":"right","right":"10px"});this.button.css({"line-height":this.el.outerHeight()+"px","height":this.el.outerHeight()+"px"});$("label",this.el).css({"width":this.el.width()-22,"height":this.el.height(),"float":"left"});},beforeDestroy:function(){this._dropView&&this._dropView.remove();},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){var b=this;this.el.keydown(function(c){var d=c.keyCode||c.charCode;if(d===9||d===13||d===108){b.el.removeAttr("tabIndex");b.el.blur();b.focusManager.requestNextFocus(b);c.preventDefault();}});b.el.click(function(c){if(!b.enable){return;}b.el.addClass("focus");if(b._hasShow){b.hideDropdownList();b._hasShow=false;return;}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest(b._dropView).length==0)&&(d.closest(b.button).length==0)){b.hideDropdownList();$(document).off("mousedown");}});if(!b._dropView){return;}b.setDropViewTop();b.setDropViewLeft();b._dropView.slideDown("fast");if(b._dropView[0].scrollWidth>b._dropView[0].clientWidth){b._dropView.children("ul").width(b._dropView[0].scrollWidth);}b._dropView.css({width:b.el.width()});b._hasShow=true;c.stopPropagation();});$("a",this.el).blur(function(){b.hideDropdownList();});if(!this.disabled){var a=$("#"+this.id+"_dropdown");$("li",a).bind("click",function(){b.handler.doOnClick(b,$(this).attr("key"));b.hideDropdownList();});}}});YIUI.reg("dropdownbutton",YIUI.Control.DropdownButton);YIUI.Control.SplitButton=YIUI.extend(YIUI.Control,{autoEl:'<div class="ui-splbtn btn-group"></div>',handler:YIUI.SplitButtonHandler,behavior:YIUI.SplitButtonBehavior,_hasShow:false,icon:"",caption:"",dropdownItems:[],setTip:function(a){var a=this.caption;this.base(a);},onRender:function(g){this.base(g);var b=this.getEl(),d=this.dropdownItems,l=this.caption,c=this.buttonLeft=$("<button/>").attr("class","btn btn-left").appendTo(b),f=this.buttonRight=$("<button/>").attr("class","btn dp-tgl").attr("data-toggle","dropdown").appendTo(b),h=$('<span class="arrow"/>').appendTo(f);this.getMetaObj().icon&&this.setIcon(this.getMetaObj().icon);$("<label/>").text(l).appendTo(c);if(d.length>0){var a=this._dropView=$('<div class="sp-vw"/>').attr("id",this.id+"_dropdown").appendTo($(document.body));var k=$("<ul/>").appendTo(a);for(var e=0;e<d.length;e++){var j=$("<li></li>").appendTo(k);if(d[e].separator){j.attr("role","separator").addClass("sep");}else{$("<a>"+d[e].text+"</a>").appendTo(j);j.attr("key",d[e].key);}}}},setIcon:function(a){this.icon=a;if($("span.icon",this.el).length==0){$('<span class="icon"/>').css("background-image","url(Resource/"+a+")").appendTo(this.buttonLeft);}else{$("span.icon",this.el).css("background-image","url(Resource/"+a+")");}},setEnable:function(b){this.enable=b;var c=this.buttonLeft,a=this.el;if(this.enable){c.prev().removeAttr("disabled");a.removeClass("ui-readonly");}else{c.prev().attr("disabled","disabled");a.addClass("ui-readonly");}},setFormatStyle:function(a){$("label",this.buttonLeft).css(a);},onSetWidth:function(a){this.el.css("width",a);var b=a-this.buttonRight.outerWidth();this.buttonLeft.css("width",b);$("label",this.buttonLeft).css("width",b-$("span.icon",this.el).outerWidth()-12);},onSetHeight:function(a){this.el.css("height",a);this.buttonLeft.css("height",a);this.buttonRight.css("height",a);var b=$("span.icon",this.el);b.css("top",(a-b.height()-2)/2);},setDisabled:function(b){this.base(b);var a=this.getEl().children();$.each(a,function(){if(b){$(this).attr("disabled","disabled");}else{$(this).removeAttr("disabled");}});},hideDropdownList:function(){this._dropView&&this._dropView.hide();this._hasShow=false;this.el.removeClass("focus");},setDropViewTop:function(){var d=this.el;var b=this.el.offset();var a=$(window).height()-b.top-d.outerHeight();var c=b.top+d.outerHeight();if(a<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");c="auto";a=$(window).height()-b.top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");a="auto";}if(c!="auto"){this._dropView.css("top",c+"px");this._dropView.css("bottom","auto");}if(a!="auto"){this._dropView.css("bottom",a+"px");this._dropView.css("top","auto");}},setDropViewLeft:function(){var d=this.el;var b=this.el.offset();var a=$(window).width()-b.left;var c=$(window).width()-this._dropView.outerWidth();if(a<this._dropView.outerWidth()){c="auto";a=$(window).width()-b.left-d.outerWidth();}else{c=b.left;a="auto";}if(c!="auto"){this._dropView.css("left",c+"px");this._dropView.css("right","auto");}if(a!="auto"){this._dropView.css("right",a+"px");this._dropView.css("left","auto");}},afterRender:function(){this.base();if(this.format){if(this.format.foreColor){this.buttonLeft.css("color",this.format.foreColor);this.buttonRight.css("color",this.format.foreColor);}if(this.format.backColor){this.el.css("background-color","rgba(0, 0, 0, 0)");this.buttonLeft.css("background-color",this.format.backColor);this.buttonRight.css("background-color",this.format.backColor);}}},initDefaultValue:function(a){this.base(a);this.dropdownItems=a.dropdownitems;this._dropView=$(".sp-vw",this.el).attr("id",this.el[0].id+"_dropdown");$("a",this.el).css("line-height",$("a",this.el).height()+"px");this.buttonLeft=$(".btn-left",this.el);this.buttonRight=$(".btn-right",this.el);this.buttonLeft.css({"width":(this.el.outerWidth()-this.buttonRight.outerWidth()),"padding":0,"height":this.el.outerHeight()});this.buttonRight.css("height",this.el.outerHeight());$("label",this.buttonLeft).css("width",this.buttonLeft.width());},beforeDestroy:function(){this._dropView&&this._dropView.remove();},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){var b=this;this.el.keydown(function(c){var d=c.keyCode||c.charCode;if(d===9||d===13||d===108){b.el.removeAttr("tabIndex");b.el.blur();b.focusManager.requestNextFocus(b);c.preventDefault();}});b.buttonRight.click(function(c){if(!b.enable){return;}b.el.addClass("focus");if(b._hasShow){b.hideDropdownList();b._hasShow=false;return;}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest(b._dropView).length==0)&&(d.closest(b.buttonLeft).length==0)&&(d.closest(b.buttonRight).length==0)){b.hideDropdownList();$(document).off("mousedown");}});if(!b._dropView){return;}b.setDropViewTop();b.setDropViewLeft();b._dropView.css("z-index",$.getZindex(b.el)+1);b._dropView.slideDown("fast");b._dropView.width(b.el.width()-3);if(b._dropView[0].scrollWidth>b._dropView[0].clientWidth){b._dropView.children("ul").width(b._dropView[0].scrollWidth);}b._hasShow=true;c.stopPropagation();});if(!this.disabled){var b=this;this.buttonLeft.bind("click",function(){b.handler.doOnClick(b);if(!b.enable){return;}b.el.addClass("focus");});this.buttonLeft.bind("blur",function(){b.el.removeClass("focus");});var a=$("#"+this.id+"_dropdown");$("li",a).bind("click",function(){b.handler.doOnClick(b,$(this).attr("key"));b.hideDropdownList();});}}});YIUI.reg("splitbutton",YIUI.Control.SplitButton);YIUI.Control.Calendar=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",events:new Array(),slotMinutes:30,setValue:function(b,d,a){var c=this.base(b,d,a);this.events=b;return c;},setHeight:function(a){this.base(a);this.el.fullCalendar("option","height",a);this.el.fullCalendar("render");},onRender:function(b){this.base(b);var a=this;this.el.fullCalendar({theme:true,defaultView:"month",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},titleFormat:{month:"yyyy年MM月",week:"yyyy年MM月dd-{dd}日",day:"yyyy年MM月dd日-dddd"},timeFormat:{agendaDay:"HH:mm-{HH:mm}",agendaWeek:"HH:mm-\n{HH:mm}",month:"HH:mm"},weekMode:"liquid",weekends:true,weekNumbers:false,weekNumberTitle:"周",buttonText:{month:"月",agendaWeek:"周",agendaDay:"日",today:"今天"},monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["周日","周一","周二","周三","周四","周五","周六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],editable:true,slotMinutes:this.slotMinutes,allDayText:"全天",axisFormat:"HH"+"点",minTime:0,maxTime:24,slotEventOverlap:false,events:this.events,eventClick:function(f,e,d){var c=f.allDay?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";a.modifyEventDialog(f).dialog("open");},eventMouseover:function(e,d,c){},eventMouseout:function(e,d,c){},selectable:true,selectHelper:true,select:function(d,h,g,f,e){var c=g?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";a.editEventDialog("add",$.fullCalendar.formatDate(d,c),$.fullCalendar.formatDate(h,c),g).dialog("open");}});},editEventDialog:function(h,e,l,b,q,d){var n=this;e=(typeof e=="undefined")?"":e;l=(typeof l=="undefined")?"":l;b=(typeof b=="undefined")?true:b;var k=$("<div id='editEventDialog' style='display: none'></div>");$.datepicker.setDefaults($.datepicker.regional["zh-CN"]);$('<p style="margin: 0;padding:0">日程内容：</p>').appendTo(k).append($('<label id="contentCheck" style="color: red;display: none"></label>'));var g=$('<textarea id="event" style="width:100%;height: 50%" placeholder="记录你将要做的一件事...">'+"</textarea>").appendTo(k);g.focus(function(){$("#contentCheck").hide();});if(typeof q!="undefined"){g.val(q);}var c=$("<input type='text'>").appendTo(k);c.wrap("<p style='margin: 0;padding: 0'>开始时间：</p>");var r=$("<input type='text'>").appendTo(k);r.wrap("<p id='endDate' style='margin: 0;padding: 0;display: none'>结束时间：</p>");r.datetimepicker({showSecond:false,stepMinute:n.slotMinutes,closeText:"选择",currentText:"当前"});var o=$('<input type="checkbox" value="1" id="isallday"> ').appendTo(k);var f=function(){r[0].parentElement.style.display=b?"none":"block";if(!b){o.removeAttr("checked");c.val("");r.val("");c.datepicker("destroy");c.datetimepicker({showSecond:false,stepMinute:n.slotMinutes,closeText:"选择",currentText:"当前"});}else{o.attr("checked","checked");c.val("");r.val("");c.datetimepicker("destroy");c.datepicker();}};f();c.val(e);r.val(l);o.click(function(){b=!b;f();});o.wrap("<label></label>").after("全天");var p=function(){if(g.val()==""){$("#contentCheck").html("内容不允许为空!");$("#contentCheck").show();return false;}if(c.val()==""){$("#contentCheck").html("开始时间不允许为空!");$("#contentCheck").show();return false;}return true;};k.dialog({title:(h=="add")?"新建事件":"编辑事件",autoOpen:false,height:"auto",width:"auto",modal:true,buttons:{"新建":function(){if(!p()){return;}var t={title:g.val(),start:c.val(),end:b?"":r.val(),allDay:b};n.events.push(t);k.dialog("close");},"修改":function(){if(!p()){return;}var t=n.getEventByID(d);t.title=g.val();t.start=c.val();t.end=b?"":r.val();t.allDay=b;k.dialog("close");},"取消":function(){k.dialog("close");}},close:function(){k.remove();n.el.fullCalendar("refetchEvents");}});var m=k[0].nextElementSibling;var s=m.firstElementChild;if(h=="add"){$(s.childNodes[1]).hide();}else{var a=$("<button>刪除</button>").button().click(function(){var t=$("<div></div>").dialog({title:"确定删除？",height:"auto",width:"auto",modal:true,buttons:{"确定":function(){var u=n.getEventByID(d);var v=n.events.indexOf(u);n.events.splice(v,1);k.dialog("close");t.dialog("close");},"取消":function(){t.dialog("close");}},close:function(){t.remove();n.el.fullCalendar("refetchEvents");}});});var j=$("<div style='float: left;width: auto;height: auto'></div>").append(a);m.insertBefore(j[0],s);$(s.childNodes[0]).hide();}return k;},modifyEventDialog:function(b){var a=b.allDay?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";return this.editEventDialog("modify",$.fullCalendar.formatDate(b.start,a),$.fullCalendar.formatDate(b.end,a),b.allDay,b.title,b._id);},getEventByID:function(c){for(var a=0;a<this.events.length;a++){var b=this.events[a];if(b._id==c){return b;}}return null;}});YIUI.reg("calendar",YIUI.Control.Calendar);YIUI.Control.CheckBox=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.CheckBoxHandler,behavior:YIUI.CheckBoxBehavior,checked:false,text:"",setText:function(a){this.text=a;this.checkbox.setText(a);},getText:function(){return this.text;},getShowText:function(){return this.getText();},onSetHeight:function(a){this.base(a);this.checkbox.setHeight(a);},onSetWidth:function(a){this.base(a);this.checkbox.setWidth(a);},setEnable:function(a){this.enable=a;this.checkbox.setEnable(a);},setFormatStyle:function(a){this.cssStyle=a;this.checkbox.getLabel().css(a);$("input",this.el).css(a);},checkEnd:function(a){this.value=a;this.checkbox.setChecked(YIUI.TypeConvertor.toBoolean(this.value));},isNull:function(){return !YIUI.TypeConvertor.toBoolean(this.value);},onRender:function(b){this.base(b);var c=this;this.checkbox=new YIUI.Yes_CheckBox({el:c.el});this.el.addClass("ui-chk");this.checkbox.setChecked(this.getMetaObj().checked);var a=this.text.replace(/ /g,"&nbsp;");this.checkbox.setText(a);},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());if(a.clickContent){this.clickContent=a.clickContent;}var b=this;this.checkbox=new YIUI.Yes_CheckBox({el:b.el,isPortal:true});this.install();},focus:function(){this.checkbox&&this.checkbox.getCheckBox().focus();},install:function(){this.base();var a=this;this.checkbox.getCheckBox().change(function(c){var b=this.checked;a.setValue(b,true,true);});this.checkbox.getCheckBox().keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108){a.checkbox.getCheckBox().click();b.preventDefault();}else{if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}}});}});YIUI.reg("checkbox",YIUI.Control.CheckBox);YIUI.Control.ComboBox=YIUI.extend(YIUI.Control,{needRebuild:true,items:null,multiSelect:false,hasText:false,sourceType:YIUI.COMBOBOX_SOURCETYPE.ITEMS,editable:true,handler:YIUI.ComboBoxHandler,behavior:YIUI.ComboBoxBehavior,init:function(a){this.base(a);this.multiSelect=(a.type==YIUI.CONTROLTYPE.CHECKLISTBOX);},setTip:function(a){var a=this.text;this.base(a);},setEditable:function(a){if(this.multiSelect){this.editable=false;}else{this.editable=a;}this.yesCombobox.setEditable(this.editable);},setEnable:function(a){this.enable=a;this.yesCombobox.setEnable(a);},getCheckedValue:function(){},dependedValueChange:function(a){this.needRebuild=true;this.setText("");this.setValue(null,true,true,false,true);},checkEnd:function(a){var b="";if(a){switch(this.getMetaObj().sourceType){case YIUI.COMBOBOX_SOURCETYPE.FORMULA:this.handler.getComboboxItems(this);b=this.getCaption(a);break;case YIUI.COMBOBOX_SOURCETYPE.QUERY:b=a;break;default:b=this.getCaption(a);break;}if(!b&&this.getMetaObj().editable){b=a;}}this.setText(b);this.value=a;this.yesCombobox.setSelValue(a);this.checkItem(a);},getItems:function(){this.handler.getComboboxItems(this);},setFormatStyle:function(a){this.cssStyle=a;this.yesCombobox.setFormatStyle(a);},setBackColor:function(a){this.backColor=a;$("input",this.getEl()).css({"background-image":"none","background-color":a});},setForeColor:function(a){this.foreColor=a;$("input",this.getEl()).css("color",a);},onSetWidth:function(a){this.yesCombobox.setWidth(a);},onSetHeight:function(a){this.yesCombobox.setHeight(a);},setText:function(a){this.text=a;this.yesCombobox.setText(a);},getText:function(){return this.text;},getShowText:function(){return this.getText();},setItems:function(a){this.items=a;this.yesCombobox.setItems(a);},checkItem:function(a){this.yesCombobox.checkItem(a);},beforeDestroy:function(){this.yesCombobox.destroy();},getValue:function(){var a=this.value;if(this.getMetaObj().integerValue){a=YIUI.TypeConvertor.toInt(a);}return a;},getCaption:function(e){var c="";if(this.multiSelect){var b=e.split(",");for(var d=0,a=b.length;d<a;d++){if(d>0){c+=",";}c+=this.getItemCaption(b[d]);}}else{c=this.getItemCaption(e);}return c;},getItemCaption:function(e){var b="";for(var c=0,a=this.items.length,d;c<a;c++){d=this.items[c];if(d.value==e){b=d.caption;break;}}return b;},focus:function(){$("input",this.el).focus();},install:function(){this.base();var b=this;var c=-1;var a=false;var d=function(){b.$combView&&b.$combView.hide();b.selLi=null;$(".selected",b.$combView).removeClass("selected");var k=b.yesCombobox._textBtn.val();var e=b.items;var j=false;for(var h=0;h<e.length;h++){if(e[h].caption==k){k=e[h].value;j=true;}}k=k==""?null:k;var f=b.getMetaObj().integerValue;var g=b.metaObj.editable;if(f||g==false){if(j==false){k=null;}}b.setValue(k,true,true);c=-1;};$("input",b.el).bind("keyup",$.debounce(200,function(h){if(b.yesCombobox._hasShow){h.stopPropagation();return;}if(b.multiSelect){return;}var f=$(this).val();var g=h.keyCode;if(g==27){d();return;}$(document).on("mousedown",function(m){var l=$(m.target);if(b.selLi&&b.selLi.length>0){b.selLi.mouseup();}else{if(l.closest(b.yesCombobox.$suggestView).length==0&&l.closest(b.yesCombobox._textBtn).length==0){d();var j=b.getMetaObj().integerValue;var k=b.metaObj.editable;var n=b.yesCombobox._textBtn.val();if(k==true&&j==false){b.setText(n);}$(document).off("mousedown");}}b.selLi=null;});if(g==38||g==40||g==9){return;}if(g==13){if(b.selLi){c=-1;b.selLi.mouseup();}return;}b.handler.doSuggest(b,f);}));$("input",b.el).bind("keydown",function(j){if(b.yesCombobox._hasShow){j.stopPropagation();return;}if(!a&&b.sourceType==YIUI.COMBOBOX_SOURCETYPE.QUERY){a=true;b.handler.getComboboxItems(b);}var n=j.keyCode;var p=b.yesCombobox.$suggestView,f,l=false;if(!p.is(":hidden")||(b.yesCombobox._dropView.is(":hidden")&&(n!=40))){f=p;l=true;}else{f=b.yesCombobox._dropView;}b.$combView=f;var h=$("li",f).length;if(n==38){if(!l&&b.yesCombobox._dropView.is(":hidden")){return;}c--;if(c==-1){c=h-1;}}else{if(n==40){if(!l&&b.yesCombobox._dropView.is(":hidden")){b.yesCombobox._dropBtn.click();var k=$("li.sel",b.yesCombobox._dropView).removeClass("sel");c=k.index();}c++;if(c==h){c=0;}}else{if(n==9||n===13||n===108){b.focusManager.requestNextFocus(b);if(n==9&&!b.yesCombobox._dropView.is(":hidden")){$(document).mousedown();}j.preventDefault();}else{return;}}}if(c==-1){return;}b.selLi&&b.selLi.removeClass("selected").removeClass("sel");var m=f.find("li:eq("+c+")");m.addClass("selected");b.selLi=m;var o=b.yesCombobox._dropView.outerHeight()-b.yesCombobox._dropView[0].clientHeight;var g=m.position().top-b.yesCombobox._dropView.height()+m.height()+o;b.yesCombobox._dropView.scrollTop(g<0?0:g);if(!l){b.yesCombobox._textBtn.val(m.text());}});$("input",b.el).blur(function(){a=false;var o=$(this);var f=b.getMetaObj().integerValue;var h=b.metaObj.editable;var e=false;var g=b.yesCombobox._textBtn.val();var q=b.items;if(b.multiSelect){var u=g.split(",");var p=false;for(var m=0,n=u.length;m<n;m++){var r=u[m];var k=false;for(var l=0;l<q.length;l++){var t=q[l].caption;if(t==r){k=true;continue;}}if(k){p=true;k=false;}else{p=false;break;}}e=p;}else{for(var m=0;m<q.length;m++){var s=b.items[m].caption;if(s!=""&&s==g){e=true;break;}}}if(f||h==false){if(e==false){b.yesCombobox._textBtn.val("");b.setValue(null,true,true);}}else{if(h){b.setValue(b.yesCombobox._textBtn.val(),true,true);}}});},initDefaultValue:function(b){this.base(b);if(b.multiSelect){this.multiSelect=b.multiSelect;}if(b.columnKey){this.columnKey=b.columnKey;}if(b.tableKey){this.tableKey=b.tableKey;}if(b.sourceType){this.sourceType=b.sourceType;}if(b.evalItems){this.evalItems=b.evalItems;}var a=this;this.yesCombobox=new YIUI.Yes_Combobox({el:a.el,isPortal:true,multiSelect:a.multiSelect,items:a.items,value:a.value,isPortal:true,getItems:function(){a.handler.getComboboxItems(a);},hiding:function(){var c=this.getSelValue();a.setValue(c,true,true);}});this._dropView=$(".cmb_vw",this.el).appendTo($(document.body));$(".cmb_vw",this.el).remove();this._textBtn=$("input",this.el);this._dropBtn=$(".arrow",this.el);a._firstClick=false;this._textBtn.css({"width":this.el.outerWidth(),"height":this.el.outerHeight()});this._dropBtn.css({left:this._textBtn.outerWidth()-26,top:(this._textBtn.outerHeight()-16)/2,height:"16px",width:"16px"});if($.browser.isIE){this._textBtn.css("line-height",(this.el.outerHeight()-3));}this.install();},setSourceType:function(a){this.sourceType=a;},onRender:function(b){this.base(b);var a=this;this.yesCombobox=new YIUI.Yes_Combobox({el:a.el,multiSelect:a.multiSelect,required:a.required,items:a.items,value:a.value,intergerValue:this.getMetaObj().integerValue,getItems:function(){a.handler.getComboboxItems(a);},hiding:function(){var d=this.getSelValue();a.setValue(d,true,true,false,true);}});this.el.addClass("ui-cmb");this.setValue(this.value);this.setText(this.text);if(this.getMetaObj().sourceType){this.setSourceType(this.getMetaObj().sourceType);}this.setItems(this.items);var c=this.getValue();this.checkItem(c);}});YIUI.reg("combobox",YIUI.Control.ComboBox);YIUI.reg("checklistbox",YIUI.Control.ComboBox);YIUI.Control.DatePicker=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.DatePickerHandler,behavior:YIUI.DatePickerBehavior,isOnlyDate:false,formatStr:"yyyy-MM-dd HH:mm:ss",isNoTimeZone:false,regional:"zh-CN",mask:null,calendars:1,setTip:function(a){var a=this.text;this.base(a);},setFormatStr:function(){if(this.getMetaObj().isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}},setEditable:function(a){this.editable=a;this.datePicker.setEditable(a);},setEnable:function(a){this.enable=a;this.datePicker.setEnable(a);},setBackColor:function(a){this.backColor=a;this.datePicker.getInput().css({"background-image":"none","background-color":a});},setForeColor:function(a){this.foreColor=a;this.datePicker.getInput().css("color",a);},setFormatStyle:function(a){this.cssStyle=a;this.datePicker.getInput().css(a);},setText:function(b){if(b&&b.length>0){b=b.replace(/-/g,"/");var a=new Date(b);this.text=a.Format(this.formatStr);this.datePicker.getInput().val(this.text);}else{this.text=b;this.datePicker.getInput().val(this.text);}},getText:function(){var a=this.text||"";if(a!=""&&this.getMetaObj().isOnlyDate){a+=" 00:00:00";}return a;},getShowText:function(){return this.getText();},changeToVal:function(){var a=this.getText();if(this.getText()!=""){a=a.replace(/-/g,"/");return new Date(a);}else{return null;}},onRender:function(a){this.base(a);var c=this;c.formatStr&&this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:c.id,el:c.el,formatStr:c.formatStr,isOnlyDate:c.getMetaObj().isOnlyDate,isNoTimeZone:c.getMetaObj().isNoTimeZone,regional:c.getMetaObj().regional,calendars:c.calendars});this.el.addClass("ui-dp");if(this.text){this.setText(this.text);}if(this.value){var b=new Date(parseInt(this.value));this.setValue(b,false,false);}},afterRender:function(){this.base();if(this.mask){}},onSetWidth:function(a){this.datePicker.setWidth(a);},onSetHeight:function(a){this.datePicker.setHeight(a);},initDefaultValue:function(c){this.base(c);this.formatStr=c.formatstr;this.isOnlyDate=c.isonlydate;this.isNoTimeZone=c.isnotimezone;this.calendars=1;if(this.isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}var d=this;this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:d.id,el:d.el,isPortal:true,formatStr:d.formatStr,isOnlyDate:d.isOnlyDate,isNoTimeZone:d.isNoTimeZone,regional:d.regional,calendars:d.calendars});this.datePicker.setIsNoTimeZone(this.isNoTimeZone);this.datePicker.setOnlyDate(this.isOnlyDate);this.datePicker.setRegional(this.regional);this.datePicker.setCalendars(this.calendars);this.datePicker.initDatePicker(this.id);var a=this.datePicker.getInput(),b=this.datePicker.getBtn();b.css({left:this._dateInput.outerWidth()-26+"px",top:(this._dateInput.outerHeight()-16)/2+"px",height:"16px",width:"16px"});if($.browser.isIE){a.css("line-height",(this.el.outerHeight()-3)+"px");}if(this.value){if(this.isOnlyDate){this.value=this.value.substring(0,this.value.indexOf(" "));}this.setValue(this.value);}if(this.text){this.setText(this.text);}},beforeDestroy:function(){this.datePicker.getDropView().remove();},focus:function(){this.datePicker&&this.datePicker.getInput().focus();},checkEnd:function(a){this.value=a;this.caption=a;var b="";if(this.value){b=this.value.Format(this.formatStr);}this.setText(b);},install:function(){this.base();var a=this;this.datePicker.getInput().bind("click",function(b){this.select();}).on("blur",function(b){var c=b.target.value;if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getDropView().blur(function(b){var c=a.datePicker.getInput().val();if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getInput().keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("datepicker",YIUI.Control.DatePicker);YIUI.Control.DICT_CKBOXTYPE_NORMAL_SELECT=YIUI.TREEPANEL_CKBOXTYPE_NORMAL_SELECT;YIUI.Control.DICT_CKBOXTYPE_SINGLE_SELECT=YIUI.TREEPANEL_CKBOXTYPE_SINGLE_SELECT;YIUI.Control.Dict=YIUI.extend(YIUI.Control,{value:null,handler:YIUI.DictHandler,behavior:YIUI.DictBehavior,stateMask:YIUI.DictStateMask.Enable,needRebuild:true,init:function(a){this.base(a);},setEditable:function(a){this.editable=a;this.yesDict.setEditable(this.editable);},setEnable:function(a){this.enable=a;this.yesDict.setEnable(a);},setBackColor:function(a){this.yesDict.setBackColor(a);},setForeColor:function(a){this.yesDict.setForeColor(a);},setFormatStyle:function(a){this.yesDict.setFormatStyle(a);},setMultiSelect:function(a){this.multiSelect=a;this.yesDict.setMultiSelect(a);},beforeDestroy:function(){this.yesDict.destroy();},isNull:function(){var c=this.value;if($.isEmptyObject(c)){return true;}if(c instanceof YIUI.ItemData){return c.oid==0;}else{if($.isArray(c)){for(var b=0,a=c.length;b<a;b++){if(c[b].oid>0){return false;}}return true;}}return false;},getCheckOpts:function(a){var c=this.base(a);var b=YIUI.FormStack.getForm(this.ofFormID);var a={dictCaption:b.dictCaption,itemKey:this.itemKey};c=$.extend(c,a);return c;},setTip:function(a){var a=this.text;this.base(a);},checkEnd:function(c){this.value=c;this.yesDict.setValue(c);var e="";if(c!=null){if(this.multiSelect){for(var b=0,a=c.length;b<a;b++){var d=c[b];if(b>0){e+=",";}e+=d.caption;}}else{e=c.caption;if(c.oid==0){this.value=null;}}}this.setText(e);},getValue:function(){return this.value;},onSetWidth:function(a){this.yesDict.setWidth(a);},onSetHeight:function(a){this.yesDict.setHeight(a);},getDictTree:function(){return this.yesDict.dictTree;},isChanged:function(d){this.value;var e=false;if(!this.value&&d){e=true;}else{if(this.value){if(this.multiSelect){if(this.value.length!=d.length){e=true;}else{for(var c=0,a=d.length;c<a;c++){var b=this.value.indexOf(d[c]);if(b<0){e=true;break;}}}}else{e=!(this.value.oid==d.oid);}}}return e;},onRender:function(f){this.base(f);var h=this;var d=h.ofFormID;var b=YIUI.FormStack.getForm(d);this.yesDict=new YIUI.Yes_Dict({id:h.id,el:h.el,secondaryType:h.secondaryType,dataSource:h.dataSource,independent:h.getMetaObj().independent,multiSelect:h.getMetaObj().multiSelect,getItemKey:function(){return h.itemKey;},hiding:function(){var l=this.getSelValue();var m=h.isChanged(l);if(m){h.setValue(l,true,true,false,true);}},getDictChildren:function(l){var m=function(o){if(o){var s=l.attr("id");var t=h.getDictTree().formatAsyncData(o);var r=o.totalRowCount;o=h.secondaryType==5?o.data:o;for(var p=0,n=o.length;p<n;p++){if(h.type==YIUI.CONTROLTYPE.COMPDICT||h.secondaryType==5){var q=s+"_"+o[p].OID;o[p].id=q;}}t=h.secondaryType==5?o:t;h.getDictTree().buildTreenode(t,s,parseInt(l.attr("level"))+1,h.secondaryType,r);h.secondaryType==5?l.attr("isLoaded",false):l.attr("isLoaded",true);}};if(h.secondaryType!=5){YIUI.DictService.getDictChildren(h.itemKey,h.getDictTree().getNodeValue(l),h.getDictTree().dictFilter,h.stateMask,m);}else{YIUI.DictService.getQueryData(h.itemKey,h.yesDict.dictTree.startRow,pageMaxNum,h.yesDict.dictTree.pageIndicatorCount,h.yesDict.dictTree.fuzzyValue,h.stateMask,h.getDictTree().dictFilter,h.getDictTree().getNodeValue(l),m);}},checkDict:function(){h.checkDict(h);this.setSelValue(h.value);},doLostFocus:function(m,l){if(h.autoSel){h.$dictView.hide();h.isDictView=false;return;}if(!h.multiSelect&&(!$.isEmptyObject(m)||l)){if((h.hasSuggest&&!h.isSuggest)||h.hasSuggest==false){h.$dictView.hide();}h.handler.autoComplete(h,m);}else{h.setValue(null,true,true,false,true);h.setText("");}},valueChange:function(l){h.handler.doLostFocus(h,l);},beforeExpand:function(l,m){var n=function(o){if(o){$.each(o,function(p){var q=this.itemKey+"_"+this.oid;l.indeterminatedNodes[q]=this;});}};YIUI.DictService.getAllParentID(h.itemKey,h.getValue(),n);}});this.el.addClass("ui-dict");if(this.value){if(this.getMetaObj().multiSelect){var j=[];for(var e=0,g=this.value.length;e<g;e++){var c=this.value[e];var k=new YIUI.ItemData(c);j.push(k);}this.value=j;}else{var a=this.value;a.caption=this.text;var k=new YIUI.ItemData(a);this.value=k;}}this.setValue(this.value);this.setMultiSelect(this.getMetaObj().multiSelect);this.setDynamic(this.getMetaObj().isDynamic);this.setStateMask(this.getMetaObj().stateMask);this.setText(this.text);},setStateMask:function(a){this.stateMask=a;},setDynamic:function(a){this.isDynamic=a;},focus:function(){$("input",this.el).focus();},install:function(){this.base();var a=this;var b=-1;var c=function(){a.$dictView&&a.$dictView.hide();a.selLi=null;$(".selected",a.$dictView).removeClass("selected");a.setText(a.text);b=-1;};$("input",a.el).bind("keyup",function(g){if(a.multiselect){return;}var f=g.keyCode;if(f==13){if(a.selLi){$(".b-txt",a.selLi).click();}else{$(this).blur();}return;}var d=$(this).val();$(document).on("mousedown",function(j){var h=$(j.target);if(h.closest(a.yesDict.$suggestView).length==0){if(a.selLi&&a.selLi.length>0){a.selLi.click();}a.isSuggest=false;$(document).off("mousedown");a.yesDict.$suggestView.hide();}else{a.isSuggest=true;}a.selLi=null;b=-1;});if(f==38||f==40||f==9){return;}if(f==13&&a.selLi){b=-1;a.selLi.click();return;}a.yesDict._dropView.hide();a.handler.doSuggest(a,d);});$("input",a.el).bind("keydown",function(h){var n=h.keyCode;var p=a.yesDict.$suggestView,m,k=false;if(!p.is(":hidden")||(a.yesDict._dropView.is(":hidden")&&(n!=40))){m=p;k=true;}else{m=a.yesDict._dropView;}a.$dictView=m;var f=$("li[level != '-1']",m).length;if(n==38){if(!k&&a.yesDict._dropView.is(":hidden")){return;}b--;if(b==-1){b=f-1;}}else{if(n==40){if(!k&&a.yesDict._dropView.is(":hidden")){a.isDictView=true;a.yesDict._dropBtn.click();var g=$("li .dt-wholerow.sel",a.yesDict._dropView);g.removeClass("sel");var j=g.parents("li").eq(0);b=j.index();}b++;if(b==f){b=0;}}else{if(n==9||n===13||n===108){a.focusManager.requestNextFocus(a);if(n==9&&!a.yesDict._dropView.is(":hidden")){$(document).mousedown();}h.preventDefault();}else{return;}}}if(b==-1){return;}if(a.selLi){a.selLi.removeClass("selected").removeClass("sel");$(".dt-wholerow",a.selLi).removeClass("sel");}var l=m.find("li[level != '-1']:eq("+b+")");l.addClass("selected");a.selLi=l;a.autoSel=true;$(".dt-wholerow",l).eq(0).addClass("sel");var o=a.yesDict._dropView.outerHeight()-a.yesDict._dropView[0].clientHeight;var d=l.position().top-a.yesDict._dropView.height()+l.height()+o;a.yesDict._dropView.scrollTop(d<0?0:d);if(!k){a.yesDict._textBtn.val($(".b-txt",l).eq(0).text());}});$("input",a.el).bind("blur",function(d){b=-1;});},setText:function(a){this.text=a;this.yesDict.setText(a);},getText:function(){return this.yesDict.getText();},getShowText:function(){return this.getText();},dependedValueChange:function(b){if(this.getMetaObj().isDynamic){if(this.refKey&&this.refKey==b){this.needRebuild=true;}}if(!this.needRebuild){if(this.root&&this.root.length>0){if(this.root==b){this.needRebuild=true;}}}if(!this.needRebuild){var a=this.getDictTree().dictFilter;if(a){if(a.dependency&&a.dependency.toLowerCase().indexOf(b.toLowerCase())>=0){this.needRebuild=true;}}else{var d=this.ofFormID;var c=YIUI.FormStack.getForm(d);a=this.handler.getFilter(c,this.key,this.itemFilters,this.itemKey);if(a){this.needRebuild=true;}}}if(this.needRebuild){this.setText("");this.setValue(null,true,true,false,true);}},setSecondaryType:function(a){this.yesDict.setSecondaryType(a);},checkDict:function(){this.handler.setContext(null);this.handler.checkDict(this);}});YIUI.reg("dict",YIUI.Control.Dict);YIUI.reg("compdict",YIUI.Control.Dict);YIUI.reg("dynamicdict",YIUI.Control.Dict);var pageMaxNum=10;(function(){YIUI.ItemData=function(a){this.oid=a.oid||0;this.itemKey=a.itemKey||"";this.caption=a.caption||"";};Lang.impl(YIUI.ItemData,{getOID:function(){return this.oid;},getItemKey:function(){return this.itemKey;},getCaption:function(){return this.caption;},equals:function(a){if(a==null){return false;}return this.toString()==a.toString();},toString:function(){return this.itemKey+"_"+this.oid;},toJSON:function(){var a={oid:this.oid,itemKey:this.itemKey,caption:this.caption};return a;},fromJSON:function(a){if(a.oid){this.oid=a.oid;}if(a.itemKey){this.itemKey=a.itemKey;}if(a.caption){this.caption=a.caption;}}});})();YIUI.DictTree=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",independent:true,showCheckBox:false,checkedNodes:{},indeterminatedNodes:null,_pMap:{},url:null,params:{},rootNode:null,init:function(b){this.base(b);var a=this;a.results=[];a.callback=$.extend({beforeExpand:$.noop,onSelected:$.noop,onChecked:$.noop},b.callback);a.clickEvent={};this.rootNode=null;this.indeterminatedNodes=null;},buildTreenode:function(a,b,c){if(!a){return;}if(!a.length){a=$(a);}this.addNodes(a,b,c);},addNodes:function(n,d,c){var l=$("#"+d,this.el);if(n.length<=0){l.children("span:first").removeClass("tree-collapse");return;}var o,k,a,r;this._pMap[d]||(this._pMap[d]=[]);for(var p=0,q=n.length;p<q;p++){o=n[p];k=o.id;a=o.oid;r=o.itemKey;this._pMap[d].push(k);var f=$("<li id='"+k+"' class='dictTree tree-node' oid = '"+a+"'parentid='"+d+"' itemKey='"+r+"'></li>");f.attr("level",c).css("padding-left",15);var m=l.children("ul");if(m.length==0){m=$("<ul class='tree-ul'></ul>").appendTo(l);}f.appendTo(m);var h=$("<a class='tree-anchor'></a>");var g,j,b;if(o.isParent){if(o.open){f.addClass("selected");j=$("<span class='dictTree-icon tree-expand'/>").appendTo(f);_explore=$("<span class='tree-explore tree-explore-expand'/>").appendTo(h);}else{j=$("<span class='dictTree-icon tree-collapse'/>").appendTo(f);_explore=$("<span class='tree-explore tree-explore-collapse'/>").appendTo(h);}}else{j=$("<span class='dictTree-icon'/>").appendTo(f);_explore=$("<span class='tree-explore'/>").appendTo(h);}switch(o.stateMask){case YIUI.DictStateMask.Enable:j.addClass("enable");break;case YIUI.DictStateMask.Disable:j.addClass("disable");break;case YIUI.DictStateMask.Discard:j.addClass("discard");break;}if(this.showCheckBox){b=$("<span class='tree-checkbox' />");j.after(b);}h.appendTo(f);var u=$("<span class='treenode-name'>"+o.name+"</span>").appendTo(h);l.attr("isLoaded",true);}if(this.showCheckBox){for(var p=0,q=n.length;p<q;p++){o=n[p];k=o.id;var e=0;if(k in this.checkedNodes){e=1;}else{if(!this.independent&&k in this.indeterminatedNodes){e=2;}}if(e==0&&!this.independent&&l){var t=l.children(".tree-checkbox").attr("checkstate")||0;if(t==1){e=1;}}var s=$("#"+k,this.el);s.children(".tree-checkbox").attr("checkstate",e).addClass("checkstate"+e);}}},checkTreeNode:function(d,a){var e,g,f,h;var j=this;function c(l,q){var p=l.children(".tree-checkbox");p.removeClass("checkstate"+p.attr("checkstate"));p.attr("checkstate",q).addClass("checkstate"+q);if(q!=2){var m=l.attr("id");j._pMap[m]||(j._pMap[m]=[]);for(var n=0;n<j._pMap[m].length;n++){var k=j._pMap[m][n];var o=$("#"+k,j.el);c(o,q);}}}function b(t,k){var q=t.attr("parentid");if(!q){return;}var s=$("#"+q,j.el);var p=s.children(".tree-checkbox");p.removeClass("checkstate"+p.attr("checkstate"));if(k==2){p.attr("checkstate",2).addClass("checkstate"+2);b(s,2);}else{j._pMap[q]||(j._pMap[q]=[]);var l=false;for(var o=0;o<j._pMap[q].length;o++){var r=j._pMap[q][o];var n=$("#"+r,j.el);var m=n.children(".tree-checkbox").attr("checkstate")||0;if(m!=k){l=true;break;}}if(l){k=2;}p.attr("checkstate",k).addClass("checkstate"+k);b(s,k);}if(k==1){j.checkedNodes[q]=j.getNodeValue(s);}else{delete j.checkedNodes[q];}}if(!this.independent){c(d,a);b(d,a);}else{d.children(".tree-checkbox").attr("checkstate",a).addClass("checkstate"+a);}},setCheckedNodes:function(c){if(this.showCheckBox){var b=this;this.clearCheckedNodes();this.checkedNodes=c;this.indeterminatedNodes=null;if(this.rootNode){var a=this.rootNode.attr("id");if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".tree-checkbox").attr("checkstate",2).addClass("checkstate"+2);}else{if(a in this.checkedNodes){this.rootNode.children(".tree-checkbox").attr("checkstate",1).addClass("checkstate"+1);}}}}},clearCheckedNodes:function(){this.checkedNodes={};this.indeterminatedNodes=null;$("[checkstate=1],[checkstate=2]").removeClass("checkstate1").removeClass("checkstate2").attr("checkstate",0).addClass("checkstate0");},createRootNode:function(d,a){var c=$("<li id='"+a+"'class='dictTree tree-node' oid = '"+d.oid+"' itemKey='"+d.itemKey+"'></li>");c.attr("level",-1);c.appendTo(this.el);var b=$("<a class='tree-anchor'></a>");c.addClass("selected");b.addClass("curSelectedNode");$("<span class='dictTree-icon tree-expand'/>").appendTo(c);if(this.showCheckBox){$("<span class='tree-checkbox' />").addClass("checkstate0").appendTo(c);}$("<span class='tree-explore tree-explore-expand'/>").appendTo(b);$("<span class='treenode-name'>"+d.name+"</span>").appendTo(b);b.appendTo(c);$("<ul class='tree-ul'></ul>").appendTo(c);this.rootNode=$("#"+a,this.el);if(this.showCheckBox){if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".tree-checkbox").attr("checkstate",2).addClass("checkstate"+2);}else{if(a in this.checkedNodes){this.rootNode.children(".tree-checkbox").attr("checkstate",1).addClass("checkstate"+1);}}}},onRender:function(a){this.base(a);this.el.addClass("dictTree dictTree-content");var b=this.el.attr("id");this.buildTreenode(this.dataSource,null,0);},collapseNode:function(b){b.children("ul").hide();var a=b.children("span:first");a.removeClass("tree-expand").addClass("tree-collapse");a.next(".tree-explore").removeClass("tree-explore-expand").addClass("tree-explore-collapse");b.children("a").removeClass("curSelectedNode");b.removeClass("selected");},expandNode:function(c){if(!c){c=this.rootNode;}var a=this;if(!c.attr("isLoaded")){this.callback.beforeExpand(this,c);YIUI.Service.getDictChildren(this,c);}c.children("ul").show();var b=c.children("span:first");if(b.hasClass("tree-collapse")){b.removeClass("tree-collapse").addClass("tree-expand");b.next(".tree-explore").removeClass("tree-explore-collapse").addClass("tree-explore-expand");c.children("a").addClass("curSelectedNode");c.addClass("selected");}},checkboxClick:function(a){var c=a.children(".tree-checkbox").attr("checkstate")==0?1:0;this.checkTreeNode(a,c);this.callback.onChecked(this,a);var b=a.attr("id");if(c==1){this.checkedNodes[b]=this.getNodeValue(a);}else{delete this.checkedNodes[b];}},selectNode:function(a){if(this.selectedNodeId){$("#"+this.selectedNodeId).removeClass("clicked");}this.selectedNodeId=a.attr("id");a.addClass("clicked");this.callback.onSelected(this,a);},getNodeValue:function(a){},install:function(){var a=this;if(!this.showCheckBox){a.el.bind("click",function(d){var b=$(d.target);var c=b.parents("li:first");if(b.hasClass("tree-collapse")){a.expandNode(c);return;}if(b.hasClass("tree-expand")){a.collapseNode(c);return;}if(b.hasClass("tree-checkbox")){a.checkboxClick(c);return;}if(b.hasClass("treenode-name")){a.selectNode(c);return;}});}},getCheckedValues:function(){if(this.showCheckBox){var b=this;var a=[];$.each(b.checkedNodes,function(g,h){var d=$("#"+g,b.el);if(!this.independent){var f=d.attr("parentid");var c=$("#"+f,b.el);if(c){var e=c.children(".tree-checkbox").attr("checkstate")||0;if(e==1){}else{a.push(h);}}else{a.push(h);}}else{a.push(h);}});return a;}},formatAsyncData:function(a){return a;},afterRender:function(){this.base();},reset:function(){if(this.rootNode){this._pMap={};this.collapseNode(this.rootNode);this.rootNode.children(".tree-ul").children().remove();this.rootNode.removeAttr("isLoaded");this.indeterminatedNodes=null;}}});YIUI.reg("dicttree",YIUI.DictTree);(function(){var b=0;function a(){return"n-"+(++b);}YIUI.Control.DictView=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",selectId:null,dataUrl:null,data:null,_datas:{},root:null,colModel:null,enableColumnResize:true,defaultWidth:100,_$table:null,selectionModel:1,pageSize:this.pageRowCount,pageIndicatorCount:3,handler:YIUI.DictViewHandler,init:function(d){this.base(d);this.dataUrl="";var c=this;c.pageSize=c.pageRowCount;c.loadedNodes={};this.option={theme:"default",expandLevel:2,expandable:true,levelMinus:true,beforeExpand:function(e){var f=$(e).attr("id");if(!c.loadedNodes[f]){c.handler.doExpand(c,$(e));c.loadedNodes[f]=true;if(!$(e).is(":hidden")){$(e).click();if(!c._selectItem){return;}var f=c._selectItem.itemKey+"_"+c._selectItem.oid;if(f==e.attr("id")){c._selectItem.isExpandNode=true;}}}},onSelect:function(e,f){if(f){$("#"+c.selectId,e).removeClass("sel-row");f.addClass("sel-row");var h=f.index();var g=f.attr("id");if(g){if(c.hasClick){c.selectId=g;c.handler.doOnRowClick(c,f);}else{if(c.hasRowChanged){if(c.selectId!=g){c.selectId=g;c.handler.doOnFocusRowChange(c,f);}}}}}},doubleClick:c.hasDblClick?function(e,f){c.handler.doOnDblClick(c,f);}:null};this.data=d.data.addedNodes;if(this.data==undefined){this.data={};}},setEnable:function(c){this.base(c);this._$table.setEnable(c);},onSetHeight:function(c){this.el.css("height",c);var e=$(".paginationjs-pages",this.el).is(":hidden")?0:$(".paginationjs-pages",this.el).height();var d=c-e-this.$fuzzybar.height();this._pagination.content.css("height",d);$(".ui-resizer",this.el).css({"top":this.$fuzzybar.height(),"height":this._$table.height()});},onSetWidth:function(e){this.el.css("width",e);this._$fuzzyText.css("width",e-this._$fuzzyBtn.outerWidth());var c=$("th",this.el),d;this._pagination.content.css("width",e);this.el.hide();this._$table.css("width",this._pagination.content.width());this.el.show();},onRender:function(f){this.base(f);this.el.addClass("ui-dv");if($.browser.isIE){this.el.attr("onselectstart","return false");}var h=this.$fuzzybar=$('<div id="'+this.id+'-fuzzy" class="fuzzy"/>');this._$fuzzyText=$('<input id="'+this.id+'_textbtn" type="text" style="height: 30px;"/>').addClass("txt").appendTo(h);this._$fuzzyBtn=$('<button id="'+this.id+'_dropbtn" style="height: 30px; width: 30px;"></button>').appendTo(h);if(!this.isHiddenFuzzyBar){h.appendTo(this.el);}var n=this;n._pagination=n.el.pagination({pageSize:n.pageSize,totalNumber:n.totalRowCount,showPages:true,showPageDetail:false,showFirstButton:false,showLastButton:false,pageIndicatorCount:this.pageIndicatorCount});this._$table=$('<table cellpadding="0" cellspacing="0" unselectable="on"></table>').appendTo(n._pagination.content);var j=$("<tr ></tr>").appendTo(this._$table),l=this.colModel,d,e,g,c,m;for(e=0,g=l.length;e<l.length;e++){d=l[e];c=Math.round(100/g);m=$('<th ><span class="title">'+d.caption+"</span></th>").css("width",c+"%").appendTo(j);if(e<g-1){$("<span class='dv-handler'></span>").appendTo($("span",m));}}j.appendTo(this._$table);if(this.root){var k=this.createRow(this.root);k.addClass("comp_Level1").attr("comp_Level",1);n.loadedNodes[k.attr("id")]=true;k.addClass("root");this._$table.append(k);k.hide();}this._$table=this._$table.treetable(this.option);if(this.totalRowCount<=this.pageSize){this._pagination.hidePagination();}this.addNodes(this.data);},install:function(){this.enableColumnResize&&this.addColumnResize();var c=this;c._pagination.pageChanges=function(e){c.handler.doGoToPage(c,e);};this._$fuzzyBtn.click(function(f){var g=c._$fuzzyText.val();c.handler.doDictViewSearch(c,g);});var d=this;$(".dv-handler",this.el).bind("mousedown",function(l){if(!d.enable){return false;}var p=$(".ui-resizer",d.el);var g=$(this).position().left+$(this).width();p.css("left",g);p.addClass("clicked");var m,n,k;l.preventDefault();var h=l.clientX;m=$(this).parents("th");n=m.width();var f,o,j;$(document).on("mousemove.rc",function(q){f=q.clientX-h;p.css("left",g+f);});return $(document).one("mouseup",function(){$(document).off("mousemove.rc");d.el.hide();o=n+f;m.width(o);m.next().css("width","100%");p.removeClass("clicked");d.el.show();});});},createRow:function(o){delete this.loadedNodes[o.id];var f=$('<tr id="'+o.id+'"></tr>'),h=this.colModel;if(o.OID!=undefined){f.attr("oid",o.OID);}if(o.pid!=undefined){f.attr("pid",o.pid);}if(o.itemKey!=undefined){f.attr("itemKey",o.itemKey);}if(this.dictType==YIUI.SECONDARYTYPE.COMPDICT){var p=o.path;if(!p){p=o.id;}f.attr("path",p);var m=$("[id="+o.pid+"]",this.el);var n=parseInt(m.attr("comp_Level"));var g=m.attr("itemKey");var c=o.itemKey;if(c!=g){n+=1;}f.attr("comp_Level",n);var l="comp_Level"+n;f.addClass(l);}if(!this.isChainDict()){if(o.NodeType==1){f.attr("haschild",true);}}if(o.previd!=undefined){f.attr("previd",o.previd);}if(o.Enable!=undefined){f.attr("enable",o.Enable);switch(o.Enable){case -1:f.addClass("invalid");break;case 0:f.addClass("disabled");break;case 1:break;}}var k;if(this.dictType==YIUI.SECONDARYTYPE.COMPDICT){k=o["Code"]+" "+o["Name"];$("<td>"+k+"</td>").appendTo(f);}else{for(var d=0,e=h.length;d<e;d++){k=o[h[d].key];if(!k){k="";}$("<td>"+k+"</td>").appendTo(f);}}return f;},createRowsHtml:function(f){var e="";for(var d=0,c=f.length;d<c;d++){e+=this.createRow(f[d])[0].outerHTML;}return e;},initDefaultValue:function(c){this.base(c);this._$table=$("table",this.el);},setTotalRowCount:function(c){this.totalRowCount=c==undefined?this.totalRowCount:c;this._pagination.setTotalRowCount(this.totalRowCount,this.isResetPageNum);this.isResetPageNum=false;},diff:function(c){var d=this;d.setTotalRowCount(c.totalRowCount);this.base(c,function(g,j){if(g=="data"){if(j.deletedNodes){this.deleteNodes(j.deletedNodes);for(var h=0,f=j.deletedNodes.length;h<f;h++){this.loadedNodes[j.deletedNodes[h]]=false;}}if(j.addedNodes){this.addNodes(j.addedNodes);}if(j.updatedNodes){for(var h=0,f=j.updatedNodes.length;h<f;h++){this.refreshNode(j.updatedNodes[h]);}}}});if(c.focusedNode){var e=$("#"+c.focusedNode,this._$table);if(e){if(this.selectId){$("#"+this.selectId,this._$table).removeClass("sel-row");}e.addClass("sel-row");this.selectId=c.focusedNode;}}},focusNode:function(d){var c=$("#"+d,this._$table);if(c){if(this.selectId){$("#"+this.selectId,this._$table).removeClass("sel-row");}c.addClass("sel-row");if(!c.hasClass("selected")){c.addClass("selected");}this.selectId=d;if(this.hasClick){this.handler.doOnRowClick(this,c);}else{if(this.hasRowChanged){this.handler.doOnFocusRowChange(this,c);}}}},deleteNodes:function(c){if(c==undefined){return;}this._$table.removeNodes(c);},addNodes:function(c){if(c==undefined){return;}var d=this.createRowsHtml(c);this._$table.addChilds(d);},syncHandleWidths:function(){var d=this;var c=$(".resizer-ctnr",this.el);c.width(d._$table.width());c.find(".resizer").each(function(e,f){return $(f).css({left:$(f).data("th").outerWidth()+($(f).data("th").offset().left-c.offset().left),height:d._$table.height()});});},addColumnResize:function(){var e=this.colModel,h=this.el.find("tr:first-child"),d=h.children(),g=0;var c=$('<div class="resizer-ctnr">');var j=this;var f=$("<div class='ui-resizer' />");this._$table.before(f);},find:function(d){var c=$("#"+d,this._$table);return c.length>0;},getNode:function(d){var c=$("#"+d,this._$table);return c;},expandNode:function(e,d){var c=$("#"+e,this._$table);if(d){this._$table.removeChildren(e);delete this.loadedNodes[e];}this._$table.expand(c);},getSelectedValue:function(c){var d=null;if(this._selectItem){c=c.charAt(0).toLowerCase()+c.slice(1);if(c=="nodeType"){d=this._selectItem.isExpandNode?1:0;}else{if(c.toLowerCase()=="oid"){d=this._selectItem["oid"];}else{d=this._selectItem[c];}}}return d;},getNodeValue:function(d){if(d.length>0){var h=d.attr("id");var e=h.lastIndexOf("_");var g=d.attr("itemkey");var f=d.attr("oid");var c={};c.oid=f||0;c.itemKey=g||this.itemKey;return c;}},removeNode:function(c){this._$table.removeNode(c,true);delete this.loadedNodes[c];},isChainDict:function(){return !this.isHiddenFuzzyBar;},addNodeByItem:function(c,e){if(e==undefined){return;}var d=this.createRowByItem(c,e);this._$table.addChilds(d);},createRowByItem:function(d,f){var k=f.itemKey+"_"+f.oid;delete this.loadedNodes[k];var h=$('<tr id="'+k+'"></tr>');if(d){h.attr("pid",d.attr("id"));}else{h.attr("pid",this.root.id);}if(!this.isChainDict()){if(f.nodeType==1){h.attr("haschild",true);}}if(f.oid!=undefined){h.attr("oid",f.oid);}if(f.itemKey!=undefined){h.attr("itemKey",f.itemKey);}if(f.enable!=undefined){h.attr("enable",f.enable);switch(f.enable){case -1:h.addClass("invalid");break;case 0:h.addClass("disabled");break;case 1:break;}}var g;for(var e=0,c=this.colModel.length;e<c;e++){g=f.getValue(this.colModel[e].key);if(!g){g="";}$("<td>"+g+"</td>").appendTo(h);}return h;},refreshNode:function(c){this.handler.refreshNode(this,c);},getQueryValue:function(){return this._$fuzzyText.val();},clearSelection:function(){if(this.selectId){$("#"+this.selectId,this._$table).removeClass("sel-row");this.selectId=null;}},dependedValueChange:function(f){var e=this.handler.getDictFilter(this);var c=function(h,g){if(g==null){return false;}if(h.itemKey!=g.itemKey){return false;}if(h.formKey!=g.formKey){return false;}if(h.fieldKey!=g.fieldKey){return false;}if(h.filterIndex!=g.filterIndex){return false;}if(h.values.toString()!=g.values.toString()){return false;}if(h.dependency!=g.dependency){return false;}return true;};var d=false;if(e!=null&&!c(e,this.dictFilter)){this.dictFilter=e;d=true;}else{if(e!=null){if(this.dictFilter.dependency&&this.dictFilter.dependency.toLowerCase().indexOf(f.toLowerCase())>=0){d=true;}}else{if(this.dictFilter!=null){this.dictFilter=null;d=true;}}}if(!d){return;}if(this.isChainDict()){this.handler.doGoToPage(this,0,true);}else{this.expandNode(this.root.id,true);}}});YIUI.reg("dictview",YIUI.Control.DictView);})();(function(){YIUI.DictQuery=function(c){c=$.extend(true,{startRow:0,maxRows:5,pageIndicatorCount:3,fuzzyValue:"",columns:[{key:"Name",caption:"名称",visible:true,enable:true},{key:"Code",caption:"代码",visible:true,enable:true}]},c);var e=$("<div></div>").attr("id","dict_dialog").addClass("dtquery");var b=YIUI.DictService.getQueryData(c.itemKey,0,c.maxRows,c.pageIndicatorCount,c.fuzzyValue,c.stateMask,c.dictFilter,c.rootValue);var d=new YIUI.Control.TextEditor({metaObj:{x:0,y:0,top:"5px",visible:true},listeners:{change:$.noop},install:$.noop,value:c.fuzzyValue});var f=new YIUI.Control.Button({metaObj:{x:1,y:0,top:"5px",visible:true},listeners:{click:$.noop},value:"查询"});var a=new YIUI.Control.ListView({metaObj:{x:0,y:1,colspan:2,pageRowCount:c.maxRows,visible:true},data:b.data,showPageDetail:false,showFirstButton:false,showLastButton:false,totalRowCount:b.totalRowCount,pageIndicatorCount:c.pageIndicatorCount,columnInfo:c.columns});if(c.displayCols){a.columnInfo=c.displayCols;}a.addDataRow=function(n){var j=$(".tbl-body tbody",a.$table);var l=$("tr.first",j).length==0?false:true;if(a.$table&&n!==undefined){var j=$(".lv-tb .lv-body tbody",this.el);$("tr.space",j).remove();if($("tr.data",j).length==0||$("label.empty",j).length==0){$("label.empty",j).remove();}var k,m,o;$.each(n,function(q,r){k=$("<tr></tr>").addClass("data");if(!l&&q==0){k.addClass("first");}var p=j.children().length+1;if(p%2==0){k.addClass("even");}$.each(a.columnInfo,function(s,u){o=$("<td></td>");if(s==0){var t=$("<span/>").addClass("dict_icon").appendTo(o);if(r.NodeType==0){t.addClass("p_node");}}m=r[u.key];o.append(m);if(u.visible){k.append(o);}});k.data("caption",r["caption"]);k.data("itemKey",r["itemKey"]);k.data("oid",r["oid"]);j.append(k);});}};a.addEmptyRow=function(){var n=$(".lv-tb .lv-body",this.el);var j=$(".tbl-body",n);$("tr.space",j).remove();if($("tr.data",j).first().length==0){var v=$("tbody label.empty",j);if(v.length==0){v=$("<label class='empty'>表中无内容</label>");$("tbody",j).append(v);}var l=$("tr.first",j).width();var w=(n.height()-v.height())/2;v.width(l).css("top",w+"px");return;}var x=$("tr.data",j).first().outerHeight();var k=$(".tbl-body",n).outerHeight();if(!k){var u=$("tr.data",j).length;k=0;for(var o=0;o<u;o++){k+=$("tr.data",j).eq(o).outerHeight();}}var r=((n[0].clientHeight||n.height())-k);var t=Math.ceil(r/x);var m=r-(t-1)*x;if(t<=0){return;}for(var o=0;o<t;o++){var q=$("<tr></tr>").addClass("space").appendTo(j);var s=q.index()+1;if(s%2==0){q.addClass("even");}$.each(this.columnInfo,function(y,z){var A=$("<td></td>");if(z.visible){q.append(A);}});if(o==t-1){q.addClass("last");$("td",q).height(m);var p=n.height()-j.height();if(p>0&&p<x){$("td",q).height(m+p);}}else{q.outerHeight(x);}}};a.createColumnHead=function(){var m=$(".tbl-head thead",this.$table);var k=$(".tbl-body tbody",this.$table);if(this.columnInfo&&this.columnInfo.length>0){var o=$("<tr></tr>"),n;var q=$('<tr class="first"></tr>'),p;for(var l=0,j=this.columnInfo.length;l<j;l++){this.columnInfo[l].width=Math.round((1/j)*100)+"%";n=$("<th><label>"+this.columnInfo[l].caption+"</label></th>").attr("colIndex",l);n.css("width",$.getReal(this.columnInfo[l].width,this.calcRealValues(this.columnInfo,this.$table.width())));$("label",n).css("width",n.width()).css("overflow","hidden").css("text-overflow","ellipsis").css("display","block");p=$("<td></td>").attr("colIndex",l);p.css("width",$.getReal(this.columnInfo[l].width,this.calcRealValues(this.columnInfo,this.$table.width())));p.css("height","0px");if(this.columnInfo[l].visible!=false){o.append(n);q.append(p);}}}m.append(o);k.append(q);};a.onSetWidth=function(l){this.el.css("width",l);this._pagination.content.css("width",l);var p=$("th",this.$table),j=$("tr.first td",this.$table),s,k,m,r;var q=0;for(var n=0,o=this.columnInfo.length;n<o;n++){s=$("[colindex="+n+"]",this.$table);k=j.eq(s.index());if(!this.columnInfo[n].visible){continue;}m=$.getReal(this.columnInfo[n].width,this.calcRealValues(this.columnInfo,this.$table.width()));s.css("width",m);k.css("width",s.width());k.outerWidth(s.outerWidth());$("label",s).css("width",m);q+=m;}this.syncHandleWidths();};var h=new YIUI.Panel.GridLayoutPanel({metaObj:{rowGap:5,columnGap:5,leftPadding:5,topPadding:5,bottomPadding:5},widths:["99%",80],minWidths:[-1,-1],heights:[30,"100%"],items:[d,f,a]});e.modalDialog(null,{title:c.caption||" ",showClose:false,isResize:false,width:"500px",height:"345px"});h.render(e.dialogContent());$(".dialog-close",e).click(function(){c.callback();c.textInput.focus();});f.el.unbind();$("input",d.el).unbind();f.el.click(function(j){g(d.getValue(),0,true);});d.el.keypress(function(j){if(j.keyCode==13){f.el.click();$("input",d.el).blur();}});a.el.addClass("ui-dictquery");a._pagination.pageChanges=function(j){g(d.getValue(),j*c.maxRows);};var g=function(m,j,l){var k=YIUI.DictService.getQueryData(c.itemKey,j,c.maxRows,c.pageIndicatorCount,m,c.stateMask,c.dictFilter,c.rootValue);if(j==0&&k.totalRowCount<c.maxRows){a._pagination.hidePagination();}else{if(k.totalRowCount){a._pagination.setTotalRowCount(k.totalRowCount+j,l||false);}}a.data=k.data;a.clearDataRow();a.addDataRow(a.data);a.addEmptyRow();};a.$table.undelegate();a.$table.delegate(".tbl-body tr","dblclick",this.doubleClick==null?function(o){if(!a.enable||$(this).attr("enable")=="false"){return;}var m=$(o.target).index();var q=$(o.target).parent().index();var k=$(this).data("caption"),p=$(this).data("itemKey"),n=$(this).data("oid"),l={};l.oid=n||0;l.itemKey=p;l.caption=k;var j=new YIUI.ItemData(l);c.callback(j);e.close();c.textInput.focus();o.stopPropagation();}:this.doubleClick);};})();YIUI.Control.Hyperlink=YIUI.extend(YIUI.Control,{autoEl:'<a class="ui-hlk"></a>',handler:YIUI.HyperLinkHandler,behavior:YIUI.HyperLinkBehavior,target:"_self",targetType:YIUI.Hyperlink_TargetType.NewTab,setText:function(a){this.hyperlink.setText(a);},getShowText:function(){return this.hyperlink.getText();},needClean:function(){return false;},onRender:function(b){this.base(b);var c=this;var a=this.getMetaObj();this.hyperlink=new YIUI.Yes_HyperLink({el:c.el,url:a.url,targetType:a.targetType});this.setValue(this.value);this.setTarget(a.targetType);this.setURL(a.url);if(this.text){this.hyperlink.setText(this.text);}else{this.hyperlink.setText(this.caption);}},setTip:function(a){var a=this.text||this.caption;this.base(a);},setURL:function(a){if(!a){return;}this.url=a;var b=YIUI.Hyperlink_TargetType.Str_NewTab;switch(this.targetType){case YIUI.Hyperlink_TargetType.Current:b=YIUI.Hyperlink_TargetType.Str_Current;case YIUI.Hyperlink_TargetType.NewTab:this.el.attr("href",this.url);this.el.attr("target",YIUI.Hyperlink_target[b]);break;}},setTarget:function(a){this.targetType=a;},onSetHeight:function(a){this.base(a);this.hyperlink.setHeight(a);},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){var a=this;if(this.hyperlink.getText()!=""){this.el.click(function(){if(!a.enable){return;}if(a.url&&a.targetType==YIUI.Hyperlink_TargetType.New){window.open(a.url,YIUI.Hyperlink_target.New,"alwaysRaised=yes");}else{if(!a.url){a.handler.doOnClick(a);}}});}this.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.el.removeAttr("tabIndex");a.el.blur();a.focusManager.requestNextFocus(a);b.preventDefault();}});},initDefaultValue:function(a){this.base(a);var b=this;this.hyperlink=new YIUI.Yes_HyperLink({el:b.el,isPortal:true});this.install();},setEnable:function(a){this.base(a);this.hyperlink.setEnable(a);},checkEnd:function(a){this.text=a;this.hyperlink.setText(this.text);}});YIUI.reg("hyperlink",YIUI.Control.Hyperlink);YIUI.Control.ImageList=YIUI.extend(YIUI.Control,{autoEl:"<img>",items:null,defaultValue:null,setValue:function(a){this.base(a);if(this.items){this.el.attr("src",this.items[a]);}},onRender:function(a){this.base(a);if(this.items){if(this.defaultValue){this.el.attr("src",this.items[this.defaultValue]);}else{this.el.attr("src",this.items[0]);}}}});YIUI.reg("imagelist",YIUI.Control.ImageList);YIUI.Control.Label=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",icon:null,onSetWidth:function(a){this.yesLabel.setWidth(a);},onSetHeight:function(a){this.yesLabel.setHeight(a);},setFormatStyle:function(a){this.yesLabel.setCssStyle(a);},setIcon:function(a){this.yesLabel.setIcon(a);},needClean:function(){return false;},setTip:function(a){var a=this.value;this.base(a);},setValue:function(b,d,a){var c=this.base(b,d,a);this.yesLabel.setValue(this.value);return c;},onRender:function(a){this.base(a);var b=this;b.value=b.value||b.caption;this.yesLabel=new YIUI.Yes_Label({el:b.el,icon:b.getMetaObj().icon,caption:b.value});if(this.buddy){this.el.addClass("ui-innerlbl");}else{this.el.addClass("ui-lbl");}}});YIUI.reg("label",YIUI.Control.Label);YIUI.ListViewWithLayout=function(d){var f={};$.each(d.columnInfo,function(h,j){f[j.key]=j;});var c=d.layoutView;var e=c["items"];var g=0,b=0,a=50;return{_drawLayoutPanel:function(h){$("tr[row!='0'] td",h.el).addClass("lv-cell-sp");},_getRowLayoutWidth:function(){return b-a;},createFirstDataLayoutView:function(){var h=$.extend(true,{},c);$.each(h.items,function(k,l){l.type=YIUI.CONTROLTYPE.LABEL;l.tagName="label";});var j=$("<td class='lv-layout'></td>");j.css("width",b);j.css("height","0px");return j;},createDataLayoutView:function(j){var k=$.extend(true,{},c);var l=$("<td class='lv-layout'></td>");l.css("width",b);l.css("height",g);$.each(k.items,function(n,p){p.ofFormID=d.ofFormID;p.tagName="label";p.type=YIUI.CONTROLTYPE.LABEL;var q;if(j){var m=j[p.key];q=(m&&m.value!=="")?m.caption:"";}else{return;}p.caption=q;var o=f[p.key];switch(o.columnType){case YIUI.CONTROLTYPE.CHECKBOX:delete p.caption;delete p.text;case YIUI.CONTROLTYPE.BUTTON:case YIUI.CONTROLTYPE.HYPERLINK:p.type=o.columnType;$.extend(p,o);break;case YIUI.CONTROLTYPE.DATEPICKER:if(o.isOnlyDate){p.caption=q.split(" ")[0];}}});var h=new YIUI.Panel(k);h.render(l);h.doLayout(this._getRowLayoutWidth(),g);$(".chk",l).unbind();this._drawLayoutPanel(h);return l;},createHeadLayoutView:function(){var j=$.extend(true,{},c);$.each(j.items,function(l,n){var m=f[n.key];n.type=YIUI.CONTROLTYPE.LABEL;n.tagName="label";n.caption=m.caption;});var h=new YIUI.Panel(j);var k=$("<th class='lv-layout'></th>");k.css("width",this._getRowLayoutWidth());k.css("height",g);h.render(k);h.doLayout(this._getRowLayoutWidth(),g);this._drawLayoutPanel(h);return k;},createColumnHead:function(){b=d.el.width();var j=$(".tbl-head thead",d.$table);var h=$(".tbl-body tbody",d.$table);if(d.columnInfo&&d.columnInfo.length>0){var l=$("<tr></tr>"),k;var n=$('<tr class="first"></tr>'),m;k=$("<th><label>序</label></th>").addClass("seq");$("label",k).css("width","100%").css("overflow","hidden").css("text-overflow","ellipsis").css("display","block");l.append(k);m=$("<td></td>").addClass("seq");m.css("height","0px");n.append(m);k=this.createHeadLayoutView();l.append(k);m=this.createFirstDataLayoutView();n.append(m);$("<th class='space'></th>").appendTo(l);$("<td class='space'></td>").css("height","0px").appendTo(n);}j.append(l);h.append(n);},onSetWidth:function(l){d.el.css("width",l);d._pagination.content.css("width",l);var j=$("th",d.$table),k,p,m,o;$("th.space",d.$table).css("width","100%");var h=c.widths;var n=0;$.each(h,function(r,q){m=$.getReal(q,d.calcRealValues(h,d.el.width()));n+=m;$(".lv-tb .lv-layout tr td[col='"+r+"']").each(function(t,s){$(s).css("width",m);$("div",s).children().eq(0).width(m);});});b=Math.max(l,n+a);$(".lv-layout",d.el).css("width",this._getRowLayoutWidth());$("div.ui-pnl",d.el).css("width",this._getRowLayoutWidth());$("table.lv-tb",d.el).css("width",b);d.syncHandleWidths();},addEmptyRow:function(){var p=$(".lv-tb .lv-body",d.el);var j=$(".tbl-body",p);$("tr.space",j).remove();if($("tr.data",j).first().length==0){var x=$("tbody label.empty",j);if(x.length==0){x=$("<label class='empty'>表中无内容</label>");$("tbody",j).append(x);}var m=$("tr.first",j).width();var y=(p.height()-x.height())/2;x.width(m).css("top",y+"px");return;}var z=$("tr.data",j).first().outerHeight();var k=$(".tbl-body",p).outerHeight();if(!k){var w=$("tr.data",j).length;k=0;for(var q=0;q<w;q++){k+=$("tr.data",j).eq(q).outerHeight();}}var n=(p[0].clientHeight||p.height());var t=(n-k);var v=Math.ceil(t/z);var o=t-(v-1)*z;if(v<=0){return;}for(var q=0;q<v;q++){var s=$("<tr></tr>").addClass("space").appendTo(j);var u=s.index()+1;if(u%2==0){s.addClass("even");}$("<td></td>").addClass("seq").appendTo(s);var l=this.createDataLayoutView();s.append(l);$("<td class='space'></td>").appendTo(s);if(q==v-1){s.addClass("last");$("td",s).height(o);var r=n-j.height();if(r>0&&r<z){$("td",s).height(o+r);}}else{s.outerHeight(z);}}this.onSetWidth(b);},addDataRow:function(m){if(m&&d.$table){var h=$(".tbl-body>tbody",d.$table);$("tr.space",h).remove();if($("tr.data",h).length==0){$("label.empty",h).remove();}var k,l,n;var o=this;var j=$("tr.first",h).length==0?false:true;$.each(m,function(q,r){k=$("<tr></tr>").addClass("data");n=$("<td></td>").addClass("seq");if(!j&&q==0){k.addClass("first");}var p=h.children().length+1;if(p%2==0){k.addClass("even");}k.append(n.html(h.children().length));n=o.createDataLayoutView(r);k.append(n);$("<td class='space'></td>").appendTo(k);h.append(k);});}},install:function(){var h=this;d.$table.delegate(".chk","click",function(l){if(!d.enable||$(this).attr("enable")=="false"){return;}if($(this).attr("isChecked")&&$(this).attr("isChecked")=="true"){$(this).attr("isChecked","false");$(this).removeClass("checked");}else{$(this).attr("isChecked","true");$(this).addClass("checked");}var k=$(l.target).parents("div.ui-chk").attr("id");k=h._getCompKey(k);var j=$.inArray(f[k],d.columnInfo);var n=$(l.target).parents("tr.data").index()-1;var m=$(this).attr("isChecked")=="true"?true:false;d.handler.doCellValueChanged(d,n,j,m);l.stopPropagation();});d.$table.delegate(".ui-btn","click",function(k){if(!d.enable||$(this).attr("enable")=="false"){return;}var j=$(this).attr("id");j=h._getCompKey(j);var l=$(k.target).parents("tr.data").index()-1;d.handler.doOnCellClick(d,l,j);k.stopPropagation();});d.$table.delegate(".ui-hlk","click",function(k){if(!d.enable||$(this).attr("enable")=="false"){return;}var l=$(k.target).parents("tr.data").index()-1;var j=$(this).attr("id");j=h._getCompKey(j);d.handler.doOnCellClick(d,l,j);k.stopPropagation();});},_getCompKey:function(h){if(!h){return h;}if(!d.ofFormID){return h;}var j=d.ofFormID+"_";if(h.length>j.length&&h.substring(0,j.length)==j){return h.substring(j.length);}return h;},_createHandles:function(){var h=d;h.$handleContainer=$("<div class='rc-handle-cntr'/>");h.$table.before(h.$handleContainer);h.$table.find("th .ui-pnl tr td").each(function(j,k){var l;l=$("<div class='rc-handle' />");l.data("th",$(k));l.bind("mousedown",h,function(s){var m,u,v;s.preventDefault();m=$(s.currentTarget);u=m.data("th");v=u.width();var t=$(s.target);t.addClass("clicked");t.data("startPos",t.position().left);var p=s.clientX;var n,w,q,x;var y=u.parents("table.lv-tb").eq(0);var r=u.parents("table.lv-tb .lv-head .lv-layout");var o=$(".lv-tb .lv-body",h.el);var z=(o[0].clientHeight||o.height());$(document).on("mousemove.rc",function(A){n=A.clientX-p;t.css("left",t.data("startPos")+n);w=v+n;q=y.width()+n;x=r.width()+n;if(w<10){w=10;q+=10-w;}});return $(document).one("mouseup",function(C){$(document).off("mousemove.rc");var B=u.attr("col");$(".lv-layout tr td[col='"+B+"']",y).each(function(E,D){$(D).css("width",w);$("div",D).width(w);$("div",D).children().eq(0).width(w);$(D).parents(".lv-layout").css("width",x);});t.removeClass("clicked");var A=(o[0].clientHeight||o.height());if(z!=A){h.addEmptyRow();}return h.syncHandleWidths();});});return l.appendTo(h.$handleContainer);});}};};YIUI.Control.ListView=YIUI.extend(YIUI.Control,{handler:YIUI.ListViewHandler,behavior:YIUI.ListViewBehavior,$table:null,height:"100%",$handleContainer:null,getFieldArray:function(b,a){var e=this.columnInfo;var j="";for(var h=0,k=e.length;h<k;h++){var f=e[h];if(f.columnKey==a){j=f.key;break;}}var l=b.getDocument(),d=new Array(),c;c=l.getByKey(this.getMetaObj().tableKey);var g=this.data,m=this.columnInfo;for(var h=0,k=g.length;h<k;h++){if(!this.isActiveRowSelect(h)){continue;}d.push(this.getValByKey(h,j));}return d;},isActiveRowSelect:function(b){if(this.hasSelectField){var a=this.selectFieldIndex;return this.getValue(b,a);}return true;},onRender:function(e){this.base(e);if(this.layoutView){this.layoutViewInvoker=new YIUI.ListViewWithLayout(this);this.el.addClass("ui-lv ui-lv-withlayout");}else{this.el.addClass("ui-lv");}if($.browser.isIE){this.el.attr("onselectstart","return false");}var p=this;var k=p.getMetaObj().pageRowCount;var h=p.getMetaObj().loadType;p._pagination=p.el.pagination({pageSize:k,totalNumber:p.totalRowCount,showPages:true,showPageDetail:p.showPageDetail||false,showFirstButton:p.showFirstButton,showLastButton:p.showLastButton,pageNumber:p.pageNumber||1,pageIndicatorCount:p.pageIndicatorCount||5});var g=$("<tbody></tbody>");var n=$("<thead></thead>");var j=$('<div class="lv-div"></div>').appendTo(p._pagination.content);this.$table=$('<table class="lv-tb"></table>').appendTo(j);var m=$('<tr class="head"></tr>').appendTo(this.$table);var l=$("<td></td>").attr("colspan",this.columnInfo.length+1).appendTo(m);var o=$('<div class="lv-head"></div>').appendTo(l);var f=$('<table class="tbl-head"></table>').append(n).appendTo(o);var b=$('<tr class="body"></tr>').appendTo(this.$table);var a=$("<td></td>").attr("colspan",this.columnInfo.length+1).appendTo(b);var c=$('<div class="lv-body"></div>').appendTo(a);var d=$('<table class="tbl-body"></table>').append(g).appendTo(c);this.createColumnHead();if(this.totalRowCount<=this.getMetaObj().pageRowCount){this._pagination.hidePagination();this._pagination.content.css("height","100%");}this._createHandles();this.syncHandleWidths();this.addDataRow(this.data);},setColStyle:function(a,f){var g={};f.backColor&&(g["background-color"]=f.backColor);f.foreColor&&(g["color"]=f.foreColor);if(f.vAlign>-1){g["vertical-align"]=YIUI.VAlignment.parse(f.vAlign);g["line-height"]="normal";}if(f.hAlign>-1){var c=YIUI.HAlignment.parse(f.hAlign);g["text-align"]=c;var d=a.index();var e=$(".lv-head .tbl-head th",this.$table).eq(d);if(e.css("text-align")!=c){e.css("text-align",c);}}var b=f.font;if(b){b.name&&(g["font-family"]=b.name);b.size&&(g["font-size"]=b.size);b.bold&&(g["font-weight"]="bold");b.italic&&(g["font-style"]="italic");}a.css(g);},addEmptyRow:function(){if(this.layoutViewInvoker){this.layoutViewInvoker.addEmptyRow();return;}var f=$(".lv-tb .lv-body",this.el);var a=$(".tbl-body",f);$("tr.space",a).remove();if($("tr.data",a).first().length==0){var q=$("tbody label.empty",a);if(q.length==0){q=$("<label class='empty'>表中无内容</label>");$("tbody",a).append(q);}var c=$("tr.first",a).width();var r=(f.height()-q.height())/2;q.width(c).css("top",r+"px");return;}var s=$("tr.data",a).first().outerHeight();var b=$(".tbl-body",f).outerHeight();if(!b){var o=$("tr.data",a).length;b=0;for(var g=0;g<o;g++){b+=$("tr.data",a).eq(g).outerHeight();}}var d=(f[0].clientHeight||f.height());var l=(d-b);var n=Math.ceil(l/s);var e=l-(n-1)*s;if(n<=0){return;}for(var g=0;g<n;g++){var k=$("<tr></tr>").addClass("space").appendTo(a);var m=k.index()+1;if(m%2==0){k.addClass("even");}$("<td></td>").addClass("seq").appendTo(k);var p=this;$.each(this.columnInfo,function(h,t){var u=$("<td></td>");if(t.visible){k.append(u);}if(t.format){p.setColStyle(u,t.format);}});$("<td class='space'></td>").appendTo(k);if(g==n-1){k.addClass("last");$("td",k).height(e);var j=d-a.height();if(j>0&&j<s){$("td",k).height(e+j);}}else{k.outerHeight(s);}}},onSetHeight:function(b){this.el.css("height",b);var e=$(".paginationjs-pages",this.el).is(":hidden")?0:$(".paginationjs-pages",this.el).outerHeight();var d=b-e;this._pagination.content.css("height",d);var g=$(".lv-tb .head",this.el).outerHeight();var c=d-g;var a=$(".lv-tb .lv-head",this.el);var f=$(".lv-tb .lv-body",this.el);f.outerHeight(c-2);$(".lv-div",this.el).outerHeight(d);$(".space",a).css("width","100%");this.addEmptyRow();this.syncHandleWidths();},onSetWidth:function(c){if(this.layoutViewInvoker){this.layoutViewInvoker.onSetWidth(c);return;}this.el.css("width",c);this._pagination.content.css("width",c);var g=$("th",this.$table),a=$("tr.first td",this.$table),k,b,d,j;$("th.space",this.$table).css("width","100%");var h=0;for(var e=0,f=this.columnInfo.length;e<f;e++){k=$("[colindex="+e+"]",this.$table);b=a.eq(k.index());if(!this.columnInfo[e].visible){continue;}d=$.getReal(this.columnInfo[e].width,this.calcRealValues(this.columnInfo,this.el.width()));k.css("width",d);b.css("width",k.width());b.outerWidth(k.outerWidth());$("label",k).css("width",k.width());h+=d;}this.syncHandleWidths();},createColumnHead:function(){if(this.layoutViewInvoker){this.layoutViewInvoker.createColumnHead();return;}var c=$(".tbl-head thead",this.$table);var a=$(".tbl-body tbody",this.$table);if(this.columnInfo&&this.columnInfo.length>0){var f=$("<tr></tr>"),e;var h=$('<tr class="first"></tr>'),g;for(var b=0;b<this.columnInfo.length;b++){var d=this.columnInfo[b];if(b==0){e=$("<th><label>序号</label></th>").addClass("seq");$("label",e).css("width","100%").css("overflow","hidden").css("text-overflow","ellipsis").css("display","block");f.append(e);g=$("<td></td>").addClass("seq");g.css("height","0px");h.append(g);}e=$("<th><label>"+d.caption+"</label></th>").attr("colIndex",b);e.css("width",$.getReal(d.width,this.calcRealValues(this.columnInfo,this.el.width())));$("label",e).css("width",e.width()).css("overflow","hidden").css("text-overflow","ellipsis").css("display","block");g=$("<td></td>").attr("colIndex",b);g.css("width",$.getReal(d.width,this.calcRealValues(this.columnInfo,this.el.width())));g.css("height","0px");switch(d.columnType){case YIUI.CONTROLTYPE.TEXTEDITOR:e.addClass("lv-h-txt");break;case YIUI.CONTROLTYPE.CHECKBOX:e.addClass("lv-h-chk");break;case YIUI.CONTROLTYPE.BUTTON:e.addClass("lv-h-btn");break;case YIUI.CONTROLTYPE.HYPERLINK:e.addClass("lv-h-hlk");break;case YIUI.CONTROLTYPE.DATEPICKER:e.addClass("lv-h-dp");break;}if(d.visible){f.append(e);h.append(g);}}$("<th class='space'></th>").appendTo(f);$("<td class='space'></td>").css("height","0px").appendTo(h);}c.append(f);a.append(h);},setColumnCaption:function(d,b){var c=this.findIndex(d);var a=$("thead th[colIndex='"+c+"'] label",this.$table);a.text(b);},setColumnEnable:function(b,e){var h=this.findIndex(b);var j=$("thead th[colIndex='"+h+"']",this.$table);var d=j.index();if(d>-1){for(var c=0,g=this.data.length;c<g;c++){var f=$(".tbl-body tr",this.$table).eq(c);var a=$("td",f).eq(d);var k=a.children();this.setEnableByEl(k,e);}}},setEnableByEl:function(b,a){if(a){$(b,this.el).removeAttr("disabled");$(b,this.el).removeClass("disabled");}else{$(b,this.el).attr("disabled","disabled");$(b,this.el).addClass("disabled");}},setColumnVisible:function(b,c){var h=this.findIndex(b);var j=$("thead th[colIndex='"+h+"']",this.$table);c?j.show():j.hide();var e=j.index();if(e>-1){for(var d=0,g=this.data.length;d<g;d++){var f=$(".tbl-body tr",this.$table).eq(d);var a=$("td",f).eq(e);c?a.show():a.hide();}}},calcRealValues:function(f,d){var g=0,e,c;for(var b=0,a=f.length;b<a;b++){e=$.isNumeric(f[b])?f[b]:f[b].width;if($.isNumeric(e)&&e>0){g+=parseInt(e);}}c=d-g;return c<0?10:c;},addDataRow:function(f){if(this.layoutViewInvoker){this.layoutViewInvoker.addDataRow(f);return;}if(f&&this.$table){var a=$(".tbl-body tbody",this.$table);$("tr.space",a).remove();if($("tr.data",a).length==0){$("label.empty",a).remove();}var e,c,g;var b=this;var d=$("tr.first",a).length==0?false:true;$.each(f,function(j,k){e=$("<tr></tr>").addClass("data");g=$("<td></td>").addClass("seq");if(!d&&j==0){e.addClass("first");}var h=a.children().length+1;if(h%2==0){e.addClass("even");}e.append(g.html(a.children().length));$.each(b.columnInfo,function(q,o){g=$("<td></td>");g.css("width",$.getReal(o.width,b.calcRealValues(b.columnInfo,b.el.width())));var u=k[o.key];if(u){if(u.value==""){c="";}else{c=u.caption;}}switch(o.columnType){case YIUI.CONTROLTYPE.TEXTEDITOR:c=YIUI.TextFormat.format(c,this);g.text(c).addClass("lv-txt");break;case YIUI.CONTROLTYPE.CHECKBOX:var r=$('<span class="chk"/>');r.attr("isChecked",c=="1"?"true":"false");r.addClass(c=="1"?"checked":"");r.attr("enable",o.enable);r.data("key",o.key);g.append(r).addClass("lv-chk");b.setEnableByEl(r,o.enable);o.el=r;break;case YIUI.CONTROLTYPE.BUTTON:var t=$("<button></button>");t.addClass("btn");var p=$("<span class='imginfo' style='display: inline-block;height: 16px;width: 16px;vertical-align: middle;'></span>");var n=$("<span style='width:165px;font-weight: normal;overflow: hidden;max-width: 100%;text-overflow: ellipsis;vertical-align: middle;'>"+c+"</span>");p.css("background","url('Resource/"+this.icon+"')");t.attr("enable",o.enable);t.data("key",o.key);t.append(p);n.appendTo(t);g.append(t).addClass("lv-btn");b.setEnableByEl(t,o.enable);o.el=t;break;case YIUI.CONTROLTYPE.HYPERLINK:var m=$("<a>"+c+"</a>");m.addClass("hlk");var s=YIUI.Hyperlink_TargetType.Str_NewTab;switch(o.targetType){case YIUI.Hyperlink_TargetType.Current:s=YIUI.Hyperlink_TargetType.Str_Current;case YIUI.Hyperlink_TargetType.NewTab:m.attr("href",o.url);m.attr("target",YIUI.Hyperlink_target[s]);break;default:m.data("url",o.url);m.data("target",YIUI.Hyperlink_TargetType.New);break;}m.attr("enable",o.enable);m.data("key",o.key);g.append(m).addClass("lv-hlk");b.setEnableByEl(m,o.enable);o.el=m;break;case YIUI.CONTROLTYPE.DATEPICKER:var l=o.isOnlyDate;if(l){c=c.split(" ")[0];}g.text(c).addClass("lv-dp");break;default:g.html(c);break;}if(o.visible){e.append(g);}if(o.format){b.setColStyle(g,o.format);}});$("<td class='space'></td>").appendTo(e);a.append(e);});}},clearDataRow:function(){if(this.$table){var a=$(".tbl-body tbody",this.$table);$("tr",a).not(".first").remove();}},clearAllRows:function(){this.data=[];this.clearDataRow();},diff:function(b){var a=this;a.totalRowCount=b.totalRowCount||a.totalRowCount;if(b.totalRowCount==undefined){a.totalRowCount=a.totalRowCount;}else{a.totalRowCount=b.totalRowCount;}var e=b.columnInfo;if(a.totalRowCount<a.getMetaObj().pageRowCount){if(!$(".paginationjs-pages",this.el).is(":hidden")){a._pagination.hidePagination();}}else{if(a.totalRowCount){a._pagination.setTotalRowCount(a.totalRowCount,true);}}var d=$(".lv-tb .lv-body",this.el);var f=d.outerHeight();var c=$(".lv-div",this.el).height();c-=$(".lv-tb .head").outerHeight();d.css("height",c+"px");if(b.data){a.data=b.data;a.clearDataRow();a.addDataRow(a.data);}else{if(e){$("thead",a.$table).empty();a.clearDataRow();a.columnInfo=e;a.createColumnHead();a._createHandles();a.syncHandleWidths();a.addDataRow(a.data);}}this.addEmptyRow();},initDefaultValue:function(k){this.$table=$("table",this.el);this._createHandles();this.syncHandleWidths();this.totalRowCount=k.totalrowcount;this.pageRowCount=k.pagerowcount;if(k.columnkey){this.columnKey=k.columnkey;}if(k.tablekey){this.tableKey=k.tablekey;}this._pagination=this.el.pagination({pageSize:this.pageRowCount,totalNumber:this.totalRowCount,showPages:true,pageIndicatorCount:5});this.$table.appendTo(this._pagination.content);this._pagination.content.css("width",this.el.width());var g=$("th",this.$table),j,a,h,c=[],b;for(var d=0,e=g.length;d<e;d++){j=g.eq(d);b={};b.key=j.attr("key");b.enable=j.attr("enable");b.visible=j.attr("visible");b.columnType=j.attr("columnType");c.push(b);}this.columnInfo=c;var f=this.el.height()-$(".paginationjs-pages",this.el).height();this._pagination.content.css("height",f);},reload:function(){var a=YIUI.FormStack.getForm(this.ofFormID);var b=YIUI.ShowListView(a,this);b.load(this);},repaint:function(){this.clearDataRow();this.addDataRow(this.data);this.addEmptyRow();},needTip:function(){return false;},install:function(){var b=this;b._pagination.pageChanges=function(d){b.handler.doGoToPage(b,d);b.addEmptyRow();};if(this.hasDblClick){b.$table.delegate(".tbl-body tr.data","dblclick",function(d){if(!b.enable||$(this).attr("enable")=="false"){return;}var e=$(d.target).parents("tr.data").index()-1;b.handler.doOnRowDblClick(b,e);});}b.$table.delegate(".tbl-body>tbody>tr","click",function(e){if(!$(this).hasClass("data")){if(b._selectedRow){b._selectedRow.removeClass("clicked");b._selectedRow=null;}return;}var d=true;var g=$(e.target).parents("tr.data").index()-1;var f;if(b._selectedRow){f=b._selectedRow.index()-1;d=(f!=g);b._selectedRow.removeClass("clicked");}$(this).addClass("clicked");b._selectedRow=$(this);if(b.hasClick){b.handler.doOnRowClick(b,g);}if(d&&b.hasRowChanged){b.handler.doOnFocusRowChange(b,f,g);}});if(this.layoutViewInvoker){this.layoutViewInvoker.install();}else{b.$table.delegate(".chk","click",function(f){if(!b.enable||$(this).attr("enable")=="false"){return;}if($(this).attr("isChecked")&&$(this).attr("isChecked")=="true"){$(this).attr("isChecked","false");$(this).removeClass("checked");}else{$(this).attr("isChecked","true");$(this).addClass("checked");}var e=$(f.target).parent("td").index();var d=$("thead th",b.$table).eq(e).attr("colIndex");var h=$(f.target).parents("tr").index()-1;var g=$(this).attr("isChecked")=="true"?true:false;b.handler.doCellValueChanged(b,h,d,g);f.stopPropagation();});b.$table.delegate(".btn","click",function(e){if(!b.enable||$(this).attr("enable")=="false"){return;}var d=$(this).data("key");var f=$(e.target).parents("tr").index()-1;b.handler.doOnCellClick(b,f,d);e.stopPropagation();});b.$table.delegate(".hlk","click",function(g){if(!b.enable||$(this).attr("enable")=="false"){return;}var f=$(this).data("url");var d=$(this).data("target");if(f&&d==YIUI.Hyperlink_TargetType.New){window.open(f,YIUI.Hyperlink_target.New,"alwaysRaised=yes");}else{if(!f){var h=$(g.target).parents("tr").index()-1;var e=$(this).data("key");b.handler.doOnCellClick(b,h,e);g.stopPropagation();}}});}var c=$(".lv-tb .lv-body",this.el);var a=$(".lv-tb .lv-head",this.el);c.scroll(function(){var e=c.scrollLeft();a.scrollLeft(e);if(c[0].clientWidth!=c[0].scrollWidth){var d=c.width()-c[0].clientWidth;$(".space",a).outerWidth(d);}b.syncHandleWidths();});},_createHandles:function(){if(this.layoutViewInvoker){this.layoutViewInvoker._createHandles();return;}var a=this;this.$handleContainer=$("<div class='rc-handle-cntr'/>");this.$table.before(this.$handleContainer);this.$table.find("tr th").each(function(b,c){var d;d=$("<div class='rc-handle' />");d.data("th",$(c));d.bind("mousedown",a,function(m){var f,o,p,l=m.data;m.preventDefault();f=$(m.currentTarget);o=f.data("th");p=o.width();var n=$(m.target);n.addClass("clicked");n.data("startPos",n.position().left);var j=m.clientX;var g,q,k;var r=o.parents("table").eq(0);var h=$(".lv-tb .lv-body",l.el);var s=(h[0].clientHeight||h.height());$(document).on("mousemove.rc",function(t){g=t.clientX-j;n.css("left",n.data("startPos")+g);q=p+g;k=r.width()+g;if(q<10){q=10;k+=10-q;}});return $(document).one("mouseup",function(v){$(document).off("mousemove.rc");o.outerWidth(q);$("label",o).width(o.width());var u=o.index();var w=$(".lv-tb .lv-body tr.first td",l.el).eq(u);w.css("width",q);n.removeClass("clicked");var t=(h[0].clientHeight||h.height());if(s!=t){l.addEmptyRow();}return l.syncHandleWidths();});});return d.appendTo(a.$handleContainer);});},syncHandleWidths:function(){var a=this;this.$handleContainer.width(this.$table.width());this.$handleContainer.find(".rc-handle").each(function(b,c){return $(c).css({left:$(c).data("th").outerWidth()+($(c).data("th").offset().left-a.$handleContainer.offset().left),height:a.$table.height()});});},getFocusRowIndex:function(){var a=-1;if(this._selectedRow){a=this._selectedRow.index()-1;}return a;},findIndex:function(c){var e=this.columnInfo,b=-1;for(var d=0,a=e.length;d<a;d++){if(e[d].key==c){b=d;break;}}return b;},setValByKey:function(f,b,d,e,c){var a=this.findIndex(b);this.setValByIndex(f,a,d,e,c);},setValByIndex:function(rowIndex,colIndex,value,commit,fireEvent){var $tdIndex=$(".tbl-head thead th[colIndex='"+colIndex+"']",this.$table).index();if($tdIndex>-1){var $td=$(".tbl-body tbody tr.data",this.$table).eq(rowIndex).children("td").eq($tdIndex);var column=this.columnInfo[colIndex];switch(column.columnType){case YIUI.CONTROLTYPE.CHECKBOX:var $chk=$td.children();var isChecked=$chk.attr("isChecked")=="true"?true:false;var chkVal=value==true?true:false;if(chkVal==isChecked){break;}if(value){$chk.attr("isChecked","false");$chk.removeClass("checked");}else{$chk.attr("isChecked","true");$chk.addClass("checked");}break;case YIUI.CONTROLTYPE.BUTTON:$td.children("button").html(value);break;case YIUI.CONTROLTYPE.HYPERLINK:$td.children("a").html(value);break;default:$td.html(value);}if(column.valueChanged){var form=YIUI.FormStack.getForm(this.ofFormID);form.eval(column.valueChanged,{form:form},null);}}},getValue:function(c,a){var b=this.columnInfo[a].key;return this.getValByKey(c,b);},getValByKey:function(b,a){return this.data[b][a].value;},getRowCount:function(){return this.data.length;},deleteRow:function(g){this.data.splice(g,1);var b=$(".tbl-body tbody",this.$table);$("tr.data",b).eq(g).remove();var a=this.data.length;for(var d=g;d<a+1;d++){var e=$("tr.data",b).eq(d);var c=d+1;var f=$(".seq",e).html(c);if(c%2==0){e.addClass("even");}else{e.removeClass("even");}}$("tr.space",b).remove();this.addEmptyRow();},addNewRow:function(b){this.data.push(b);var a=[];a.push(b);this.addDataRow(a);this.addEmptyRow();}});YIUI.reg("listview",YIUI.Control.ListView);(function(a){YIUI.Control.NumberEditor=YIUI.extend(YIUI.Control,{handler:YIUI.NumberEditorHandler,behavior:YIUI.NumberEditorBehavior,decPrecision:16,showZero:false,init:function(c){this.base(c);var b="";for(var d=0;d<this.getMetaObj().decPrecision-this.getMetaObj().decScale;d++){b+="9";}if(this.getMetaObj().decScale>0){b+=".";for(var d=0;d<this.getMetaObj().decScale;d++){b+="9";}}this.settings={aNum:"0123456789",aSep:this.getMetaObj().sep,dGroup:this.getMetaObj().groupingSize,aDec:this.getMetaObj().decSep,aSign:"",pSign:"s",vMax:b,vMin:"-"+b,mDec:this.getMetaObj().decScale,mRound:this.getMetaObj().roundingMode,altDec:null};},isNull:function(){var b=this.value.toString();if(b){b=parseFloat(b);return b==0?true:false;}else{return true;}},getValue:function(){return this.yesNumEd.getValue();},getCheckOpts:function(b){var c=this.base(b);var b={decScale:this.getMetaObj().decScale,roundingMode:this.roundingMode};c=a.extend(c,b);return c;},checkEnd:function(b){this.value=b;this.caption=b;this.yesNumEd.setValue(b);},setEnable:function(b){this.enable=b;this.yesNumEd.setEnable(b);},setBackColor:function(b){this.yesNumEd.setBackColor(b);},setForeColor:function(b){this.yesNumEd.setForeColor(b);},setFormatStyle:function(b){this.yesNumEd.setFormatStyle(b);},onSetHeight:function(b){this.yesNumEd.setHeight(b);},onSetWidth:function(b){this.yesNumEd.setWidth(b);},setPromptText:function(b){this.yesNumEd.setPromptText(b);},getText:function(){var b=this.base();return b.toString();},getShowText:function(){return a("input",this.el).val();},setTip:function(b){var b=this.text;this.base(b);},onRender:function(c){this.base(c);this.el.addClass("ui-numed");var d=this;var b=this.getMetaObj();this.yesNumEd=new YIUI.Yes_NumberEditor({el:d.el,value:d.value,settings:d.settings,required:d.required,showZero:b.showZero,selectOnFocus:b.selectOnFocus,valueChange:function(e){d.setValue(e,true,true);}});this.setValue(this.value,false,false);b.promptText&&this.setPromptText(b.promptText);b.showZero&&this.setShowZero(b.showZero);},setShowZero:function(b){this.showZero=b;},isShowZero:function(){return this.showZero;},initDefaultValue:function(c){this.base(c);this._input=a("input",c.el);if(!c.selectOnFocus){this.selectOnFocus=c.selectOnFocus;}if(c.error){this.setError(c.error);}if(c.decPrecision!=undefined&&c.decPrecision!=16){this.decPrecision=c.decPrecision;}if(c.decScale!=undefined&&c.decScale!=2){this.decScale=c.decScale;}if(c.groupingSize!=undefined&&c.groupingSize!=3){this.groupingSize=c.groupingSize;}if(!c.useSep){this.useSep=c.useSep;}if(c.sep){this.sep=c.sep;}if(c.decSep){this.decSep=c.decSep;}if(c.roundingMode!=undefined&&c.roundingMode!=0){this.roundingMode=c.roundingMode;}if(c.columnKey){this.columnKey=c.columnKey;}if(c.tableKey){this.tableKey=c.tableKey;}var b="";for(var d=0;d<this.decPrecision-this.decScale;d++){b+="9";}if(this.decScale>0){b+=".";for(var d=0;d<this.decScale;d++){b+="9";}}this.settings={aNum:"0123456789",aSep:this.useSep?this.sep:"",dGroup:this.groupingSize,aDec:this.decSep,aSign:"",pSign:"s",vMax:b,vMin:"-"+b,mDec:this.decScale,mRound:this.roundingMode};a.extend(this,c);var e=this;this.yesNumEd=new YIUI.Yes_NumberEditor({el:e.el,isPortal:true,settings:e.settings,required:e.required,selectOnFocus:this.selectOnFocus,valueChange:function(f){e.setValue(f,true,true);}});this.install();},focus:function(){this.yesNumEd&&this.yesNumEd.getInput().focus();},install:function(){var b=this;this.yesNumEd.getInput().keydown(function(c){var d=c.keyCode||c.charCode;if(d===13||d===108||d===9){b.focusManager.requestNextFocus(b);c.preventDefault();}});}});YIUI.reg("numbereditor",YIUI.Control.NumberEditor);}(jQuery));YIUI.Control.Image=YIUI.extend(YIUI.Control,{sourceType:YIUI.IMAGE_SOURCETYPE.DATA,image:"",maxSize:-1,imageCut:false,stretch:false,handler:YIUI.ImageHandler,behavior:YIUI.ImageBehavior,setValue:function(e,h,c){var b=this.getMetaObj().sourceType;if(!this.isNull()&&b==YIUI.IMAGE_SOURCETYPE.RESOURCE){return false;}this._image.setValue(e);this.base(e,h,c);if(!e){this._image.getImage().attr("src",YIUI.Image.EmptyImg);}else{if(this.getMetaObj().sourceType==YIUI.IMAGE_SOURCETYPE.DATA){var d=YIUI.FormStack.getForm(this.ofFormID);var g=d.formKey;var f=encodeURIComponent(e);var a=Svr.SvrMgr.AttachURL+"?path="+f+"&formKey="+g+"&service=DownloadImage&mode=1&r="+Math.random();this._image.getImage().attr("src",a);this.el.attr("formKey",g);}else{if(b==YIUI.IMAGE_SOURCETYPE.RESOURCE){this.setImage(e);}}}},getValue:function(){return this._image.value;},setSourceType:function(a){this.sourceType=a;this._image.setSourceType(a);},onSetHeight:function(a){this.base(a);this._image.setHeight(a);},onSetWidth:function(a){this.base(a);this._image.setWidth(a);},setImage:function(a){this._image.setImagePath(a);},setImageCut:function(a){this._image.setImageCut(a);},setEnable:function(a){this.enable=a;this._image.setEnable(a);},onRender:function(a){this.base(a);var c=this;var b=new Array("gif","jpg","jpeg","png","bmp");this._image=new YIUI.Yes_Image({el:c.el,sourceType:c.getMetaObj().sourceType,stretch:c.getMetaObj().stretch,maxSize:c.getMetaObj().maxSize,imageCut:c.getMetaObj().imageCut,uploadImg:function(h,e){var d=c;var f=YIUI.FormStack.getForm(d.ofFormID);var g=function(j){var k=$.checkFile(j,c.getMetaObj().maxSize,b);if(!k||f.OID==null||f.OID==-1){return;}e=$.extend({service:"UploadImage",controlKey:d.key,formKey:f.formKey,operatorID:$.cookie("userID"),fileID:-1,oid:f.OID,mode:1},e);$.ajaxFileUpload({url:Svr.SvrMgr.AttachURL,secureuri:false,fileElement:j,data:e,type:"post",success:function(m,l,n){n.attr("accept","image/*");m=JSON.parse(m);d.setValue(m.data.replace(/\\/g,"/"),true,true);},error:function(m,l,n){alert(n);}});};g(h);},change:function(){c.setValue("",true,true);}});this.el.addClass("ui-img");this._image.getImage().attr("alt",this.caption);if(this.value){this.setValue(this.value,true,true);}if(this.image){this.setImage(this.image);this.value=this.image;}if(!this.value){this._image.getImage().attr("src",YIUI.Image.EmptyImg);}},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());this._image.getImage().css("height",this.el.innerHeight());},downPicture:function(){alert(123);},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){$(this.el).unbind("click");var a=this;$("img",a.el).click(function(b){if(a._image.enable){if(a.isNull()&&!a.image){return;}a.handler.doOnClick(a);}});this.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.el.removeAttr("tabIndex");a.el.blur();a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("image",YIUI.Control.Image);YIUI.Control.RadioButton=YIUI.extend(YIUI.Control,{autoEl:'<div class="ui-rdo">',handler:YIUI.RadioButtonHandler,behavior:YIUI.RadioButtonBehavior,checked:false,groupKey:"",metaValue:"",listeners:{change:function(){var a=this;if(!this.getMetaObj().isGroupHead){var b=YIUI.FormStack.getForm(this.ofFormID);a=b.getComponent(this.groupHeadKey);}var c=a.getValue();if(typeof c=="object"&&c!=null){c=$.toJSON(c);}this.handler.doValueChanged(a,c,true,true);}},checkEnd:function(d){this.value=d;if($.isDefined(d)&&d){var e=$("[name="+this.ofFormID+"_"+this.getMetaObj().groupKey+"]");for(var c=0,a=e.length;c<a;c++){var b=e.eq(c);if(b.val()==d){b.prop("checked",true);$(this._groKey).data(this._groKey,d);}}}},getValue:function(){var a=$(this._groKey).data(this._groKey);return a;},setText:function(a){$("label",this.el).html(a);},getText:function(){return $("label",this.el).html();},setEnable:function(b){this.enable=b;var c=$("input",this.el),a=this.el;if(this.enable){c.removeAttr("disabled");a.removeClass("ui-readonly");}else{c.attr("disabled","disabled");a.addClass("ui-readonly");}},onSetHeight:function(a){this.base(a);$("label",this.el).css({height:a+"px",lineHeight:a+"px"});var b=$("input",this.el);b.css("margin-top",(a-b.height())/2);},onSetWidth:function(a){this.base(a);$("label",this.el).css("width",a-$("input",this.el).outerWidth());},setFormatStyle:function(a){$("label",this.el).css(a);$("input",this.el).css(a);},onRender:function(c){this.base(c);var b=$('<input id="radio_'+this.id+'" type="radio" value="'+this.getMetaObj().metaValue+'" name="'+this.ofFormID+"_"+this.getMetaObj().groupKey+'">').appendTo(this.el);b.prop("checked",(this.checked||false));this._groKey="ui_"+this.getMetaObj().groupKey+"_"+this.ofFormID;var a=this.text.replace(/ /g,"&nbsp;");$('<label id=label_"'+this.id+' for="radio_'+this.id+'">'+a+"</label>").appendTo(this.el);if(this.getMetaObj().isGroupHead){var d=this._groKey;$("<"+d+"/>").appendTo(this.el);}$(this._groKey).data(this._groKey,this.value);},focus:function(){$("input",this.el).focus();$("label",this.el).addClass("checked");},install:function(){this.base();var a=this;this.el.children("label").click(function(c){a.changeStyle();var b=$(a._groKey).data(a._groKey);$(a._groKey).data(a._groKey,this.value);if(b!=this.value){a.fireEvent("change",c);}});$("input",this.el).keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108||c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}});},changeStyle:function(){var a=this.ofFormID+"_"+this.getMetaObj().groupKey;$("input[name="+a+"] + label").removeClass("select");$("label",this.el).addClass("select");}});YIUI.reg("radiobutton",YIUI.Control.RadioButton);YIUI.Control.TextEditor=YIUI.extend(YIUI.Control,{autoEl:"<span></span>",handler:YIUI.TextEditorHandler,behavior:YIUI.TextEditorBehavior,maxLength:Number.MAX_VALUE,textCase:YIUI.TEXTEDITOR_CASE.DEFAULT,invalidChars:null,promptText:null,trim:true,selectOnFocus:true,mask:null,icon:null,embedText:null,preIcon:null,holdFocus:false,getCheckOpts:function(a){var b=this.base(a);var a={trim:this.getMetaObj().trim,textCase:this.getMetaObj().textCase,maxLength:this.getMetaObj().maxLength,invalidChars:this.getMetaObj().invalidChars};b=$.extend(b,a);return b;},checkEnd:function(a){this.value=a;this.yesText.setValue(a);this.caption=a;$("input",this.yesText.el).val(a);},getShowText:function(){return this.value;},getValue:function(){return this.yesText.getValue();},setEnable:function(a){this.enable=a;this.yesText.setEnable(a);},setBackColor:function(a){this.yesText.setBackColor(a);},setForeColor:function(a){this.yesText.setForeColor(a);},setFormatStyle:function(a){this.yesText.setFormatStyle(a);},onSetHeight:function(a){this.yesText.setHeight(a);},onSetWidth:function(a){this.yesText.setWidth(a);},getOuterEl:function(){return this.el;},diff:function(a){this.base(a);},setTip:function(a){var a=this.value;this.base(a);},onRender:function(b){this.base(b);var c=this;var a=this.getMetaObj();this.yesText=new YIUI.Yes_TextEditor({el:c.el,value:c.value,required:a.required,textCase:a.textCase,inputType:c.inputType,trim:a.trim,maxLength:a.maxLength,promptText:a.promptText,selectOnFocus:a.selectOnFocus,invalidChars:a.invalidChars,embedText:a.embedText,icon:a.icon,preIcon:a.preIcon,valueChange:function(d){c.setValue(d,true,true);}});this.el.addClass("ui-txted");a.holdFocus&&this.setHoldFocus(a.holdFocus);},setHoldFocus:function(a){this.holdFocus=a;},afterRender:function(){this.base();},initDefaultValue:function(options){this.base(options);this._input=$("input",options.el);$.extend(this,options);this.invalidChars=options.invalidChars.toString();var $this=this;this.yesText=new YIUI.Yes_TextEditor({el:$this.el,isPortal:true,value:$this.value,required:$this.required,textCase:$this.textCase,inputType:$this.inputType,maxLength:$this.maxLength,promptText:$this.promptText,selectOnFocus:$this.selectOnFocus,invalidChars:$this.invalidChars,embedText:$this.embedText,icon:$this.icon,preIcon:$this.preIcon,valueChange:function(newValue){$this.setValue(newValue,true,true);}});var height=this.el.height();$(".input-embed",this.el).css("height",height+"px");$(".input-embed",this.el).css("line-height",height+"px");if($.browser.isIE){this._input.css("line-height",(height-2)+"px");}$(".input-preIcon",this.el).css("top",(this.el.height()-16)/2+"px");$(".input-preIcon",this.el).css("left","10px");this._input.attr("value")&&this.setValue(eval(this._input.attr("value")))&&this.fireEvent("change",null);},focus:function(){this.yesText&&this.yesText.getInput().focus();},install:function(){this.base();var a=this;this.yesText.getInput().keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108){a.handler.doEnterPress&&a.handler.doEnterPress(a);if(a.holdFocus){a.yesText.getInput().focus();}else{a.focusManager.requestNextFocus(a);b.preventDefault();}}else{if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}}});}});YIUI.reg("texteditor",YIUI.Control.TextEditor);YIUI.reg("maskeditor",YIUI.Control.TextEditor);YIUI.Control.TextArea=YIUI.extend(YIUI.Control,{autoEl:"<span/>",handler:YIUI.TextAreaHandler,behavior:YIUI.TextAreaBehavior,_input:"",maxLength:Number.MAX_VALUE,checkEnd:function(a){this.value=a;if(this.el){this._input.val(a);}},getShowText:function(){return this.value;},setTip:function(a){var a=this._input.val();this.base(a);},getValue:function(){return this._input.val();},setEnable:function(b){this.enable=b;var c=this._input,a=this.getOuterEl();if(this.enable){c.removeAttr("readonly");a.removeClass("ui-readonly");}else{c.attr("readonly","readonly");a.addClass("ui-readonly");}},onSetHeight:function(a){this.el.css("height",a+"px");this._input.css("height",a+"px");},onSetWidth:function(a){this.el.css("width",a+"px");this._input.css("width",a+"px");},getOuterEl:function(){return this.el;},diff:function(a){this.base(a);},setMaxLength:function(a){if($.isNumeric(a)&&a>0){this.maxLength=a;if(a!=Number.MAX_VALUE){this._input.attr("maxLength",a);}}},setFormatStyle:function(a){this._input.css(a);},setForeColor:function(a){this.foreColor=a;this._input.css("color",a);},onRender:function(b){this.base(b);var a=this.el;a.addClass("ui-txta");this._input=$("<textarea/>").val(this.value).appendTo(a);this.setMaxLength(this.getMetaObj().maxLength);this.setValue(this.value);},afterRender:function(){this.base();if(this.mask){this._input.mask(this.mask);}},initDefaultValue:function(b){this.base(b);this._input=$("input",b.el);if(!b.selectonfocus){this.selectOnFocus=b.selectonfocus;}if(b.error){this.setError(b.error);}var a=this.el.height();if($.browser.isIE){this._input.css("line-height",(a-2)+"px");}},focus:function(){this._input.focus();},install:function(){this.base();var a=this;a._input.on("click",function(b){if(a.needSelectAll){a.selectOnFocus&&this.select();a.needSelectAll=false;}}).on("focusin",function(b){if(a.selectOnFocus){a.needSelectAll=true;}}).on("blur",function(b){var c=b.target.value;if(c!=a.value){a.setValue(c,true,true);}}).on("keypress",function(b){if($(this).val().length>=a.maxLength){b.preventDefault();return true;}}).keydown(function(b){var c=b.keyCode||b.charCode;if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}});if($.browser.isIE){a._input.on("propertychange",function(b){if(this.value.length>a.maxLength){this.value=this.value.substring(0,a.maxLength);}});}}});YIUI.reg("textarea",YIUI.Control.TextArea);YIUI.Control.TextButton=YIUI.extend(YIUI.Control.TextEditor,{onRender:function(a){this.base(a);this.el.addClass("ui-txtbtn");this._btn=$("<button class='btn'>...</button>").css("width","30px").appendTo(this.el);this._btn.css({verticalAlign:"top",padding:"0"});},onSetHeight:function(a){this.base(a);this._btn.css({height:a+"px"});},onSetWidth:function(d){this.base(d);var a=this._btn.outerWidth();$("input",this.el).css({width:(d-a)+"px"});var b=$("span.clear",this.el),c=b[0].style.right;b.css({right:(c+a)+"px"});},setEnable:function(a){this.base(a);this.enable=a;this.install();},setTip:function(a){var a=$("input",this.el).val();this.base(a);},install:function(){this.base();var a=this;this._btn.mousedown(function(b){a.enable&&$(this).addClass("hover");}).mouseup(function(b){a.enable&&$(this).removeClass("hover");});$(this._btn).unbind("click");if(this.enable){this.bind(this._btn,"click");}}});YIUI.reg("textbutton",YIUI.Control.TextButton);YIUI.Control.StatusBar=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",onRender:function(a){this.base(a);}});YIUI.reg("statusbar",YIUI.Control.StatusBar);(function(){var b=0;function a(){return"n-"+(++b);}YIUI.Control.TreeView=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",selectId:null,dataUrl:null,data:null,root:null,colModel:null,enableColumnResize:true,defaultWidth:100,_$table:null,selectionModel:1,init:function(c){this.base(c);this.dataUrl="";var d=this;d.loadedNodes={};this.option={theme:"default",expandLevel:2,beforeExpand:function(e,f){if(!d.loadedNodes[f]){YIUI.EventHandler.doExpand(d,f||0);d.loadedNodes[f]=true;}},onSelect:function(e,h){$("#"+d.selectId,e).removeClass("trchekedstyle");var f=$("#"+h,e);f.addClass("trchekedstyle");var g=f.index();YIUI.EventHandler.doOnClick(d,h||0);d.selectId=h;}};this.data=c.data.addedNodes;if(this.data==undefined){this.data={};}},onRender:function(h){this.base(h);this.el.addClass("treeview");this._$table=$('<table cellpadding="0" cellspacing="0"></table>').appendTo(this.el);var k=$("<tr ></tr>").appendTo(this._$table),l=this.colModel,d,f,j,c;for(f=0,j=l.length;f<l.length;f++){d=l[f];c=d.width||this.defaultWidth;$("<col></col>").attr("width",c).prependTo(this._$table);$("<th>"+d.caption+"</th>").appendTo(k);}if(this.root){var e=this.createRow(this.root);e.attr("isLastOne",true);this._$table.append(e);}this._$table.treeTable(this.option);var g=this.createRowsHtml(this.data);this._$table.addChilds(g);},createRow:function(h){var g=$('<tr id="'+h.id+'"></tr>'),e=this.colModel;if(h.pid!=undefined){g.attr("pId",h.pid);}if(h.expand!=undefined&&h.expand){g.attr("hasChild",true);}if(h.previd!=undefined){g.attr("prevId",h.previd);}if(h.islast!=undefined&&h.islast){g.attr("isLastOne",true);}var f;for(var d=0,c=e.length;d<c;d++){f=h[e[d].key];if(!f){f="";}$("<td>"+f+"</td>").appendTo(g);}return g;},createRowsHtml:function(f){var e="";for(var d=0,c=f.length;d<c;d++){e+=this.createRow(f[d])[0].outerHTML;}return e;},initDefaultValue:function(c){this.base(c);this._$table=$("table",this.el);},install:function(){this.base();this.enableColumnResize&&this.addColumnResize();},diff:function(c){var d=this;this.base(c,function(e,f){if(e=="data"){if(f.deletedNodes){this.deleteNodes(f.deletedNodes);}if(f.addedNodes){this.addNodes(f.addedNodes);}if(f.focusedNode){d.focusNode(f.focusedNode);}}});},focusNode:function(d){var c=$("#"+d,this._$table);if(c){$("#"+this.selectId,this._$table).removeClass("trchekedstyle");c.addClass("trchekedstyle");this.selectId=d;}},deleteNodes:function(c){if(c==undefined){return;}this._$table.deleteChilds(c);},addNodes:function(c){if(c==undefined){return;}var d=this.createRowsHtml(c);this._$table.addChilds(d);},addColumnResize:function(){var e=this.colModel,h=this.el.find("tr:first-child"),d=h.children(),g=0;var c=$('<div class="treeview-resizer-container">');this._$table.before(c);var j=this;function f(k){c.width(j._$table.width());c.find(".treeview-resizer").each(function(l,m){return $(m).css({left:$(m).data("th").outerWidth()+($(m).data("th").offset().left-c.offset().left),height:j._$table.height()});});}this._$table.find("tr th").each(function(k,l){var m;m=$("<div class='treeview-resizer' />");m.data("th",$(l));m.bind("mousedown",function(r){var q,o,s,n;r.preventDefault();var p=r.pageX;q=$(r.currentTarget);o=q.data("th");s=o.width();n=j._$table.width();$(document).on("mousemove.rc",function(u){var v,t;v=u.pageX-p;t=s+v;o.width(t);j._$table.width(n+v);return f(t);});return $(document).one("mouseup",function(){$(document).off("mousemove.rc");});});return m.appendTo(c);});f();}});YIUI.reg("treeview",YIUI.Control.TreeView);})();YIUI.Control.PasswordEditor=YIUI.extend(YIUI.Control.TextEditor,{inputType:"password",handler:YIUI.PasswordEditorHandler,initDefaultValue:function(a){this.el=a.el;this._input=$("input",a.el);if(a.preicon){this.setPreIcon(a.preicon);}if(a.embedtext){this.setEmbedText(a.embedtext);}if(!a.selectonfocus){this.selectOnFocus=a.selectonfocus;}if(a.error){this.setError(a.error);}}});YIUI.reg("passwordeditor",YIUI.Control.PasswordEditor);YIUI.Tree=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",menuType:YIUI.TREEMENU_TYPE.GROUPTREE,_data:[],rootEntry:[],rootNode:null,independent:true,selectedNodeId:null,isAsyncNodes:true,_isOpen:false,_openedItem:null,container:null,handler:YIUI.TreeHandler,initDataSource:function(d){if(d){this.isAsyncNodes=false;if(!d.length){d=$(d);}var c;for(var b=0,a=d.length;b<a;b++){c=d[b];if(!c.id){c.id=c.key+b;}if(c.children){c.isParent=true;this.initDataSource(c.children);}}}},init:function(b){this.base(b);var a=this;this.menuType=this.rootEntry.style||YIUI.TREEMENU_TYPE.GROUPTREE;a.initDataSource(this.rootEntry);a._data=[];a.callback=$.extend({beforeExpand:$.noop,onSelect:function(e,d,c){if(c.children){if(a.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$("#"+c.id+" span.treemenu-icon").click();}else{if(a.menuType==YIUI.TREEMENU_TYPE.TREE){if($("#"+c.id).attr("open")){a.clickEvent.collapse(e,a,null);$("#"+c.id).attr("open",false);$(this).removeClass("curSelectedNode");$(this).parent().removeClass("selected");}else{a.clickEvent.expandNode(e,a,null);$("#"+c.id).attr("open",true);$(this).addClass("curSelectedNode");$(this).parent().addClass("selected");}}}}else{a.handler.doTreeClick(c,container);}}},b.callback);a.clickEvent={expandNode:function(g,d,f){var h=g.attr("id");var e=d.getTreeNode(h);d.callback.beforeExpand(e);var c=e.id+"-"+d.el.attr("id");if(!e.isLoaded){e.isLoaded=true;}if(g.parent().hasClass("top-level")){if(d._openedItem&&g.attr("id")!=d._openedItem.attr("id")){d._openedItem.removeClass("open").addClass("close");d._openedItem.next().hide();d._openedItem.removeClass("curSelectedNode");d._openedItem.parent().removeClass("selected");if(d.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$(".tree-expand",d._openedItem).removeClass("tree-expand").addClass("tree-collapse");$(".tree-explore",d._openedItem).removeClass("tree-explore-expand").addClass("tree-explore-collapse");}else{$(".tree.expand",d._openedItem).removeClass("expand").addClass("collapse");}}d._openedItem=g;}g.next().show();g.removeClass("close").addClass("open");g.addClass("curSelectedNode");g.parent().addClass("selected");if(d.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$(".tree-collapse",g).removeClass("tree-collapse").addClass("tree-expand");$(".tree-explore",g).removeClass("tree-explore-collapse").addClass("tree-explore-expand");}else{$(".tree.collapse",g).removeClass("collapse").addClass("expand");}},collapse:function(e,c,d){e.removeClass("open").addClass("close");e.next().hide();e.removeClass("curSelectedNode");e.parent().removeClass("selected");if(c.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$(".tree-expand",e).removeClass("tree-expand").addClass("tree-collapse");$(".tree-explore",e).removeClass("tree-explore-expand").addClass("tree-explore-collapse");}else{$(".tree.expand",e).removeClass("expand").addClass("collapse");}},selectNode:function(f,c,e){var g=f.attr("id");var d=c.el.attr("id");if(c.selectedNodeId){$("#"+c.selectedNodeId).removeClass("clicked");$("#"+c.selectedNodeId).prev().removeClass("tree-wholerow-clicked");$("#"+c.selectedNodeId).parent().removeClass("clicked");}c.selectedNodeId=g;$("#"+g).addClass("clicked");$("#"+g).prev().addClass("tree-wholerow-clicked");$("#"+g).parent().addClass("clicked");c.callback.onSelect(f,$("#"+d),c.getTreeNode(g));}};},dataSourceCopy:function(a){if(a){if(!a.length){a=$(a);}for(var h=0,k=a.length;h<k;h++){var f=a[h];var m=f.parent;var l=new Object();l.name=f.name;l.id=f.id;l.itemKey=f.itemKey;l.layerItemKey=f.layerItemKey;if(f.isLoaded){l.isLoaded=f.isLoaded;}else{l.isLoaded=false;}if(f.children&&f.children.length>0){l.open=f.open;var e=[];for(var g=0,c=f.children.length;g<c;g++){var b=f.children[g];e.push(b.id);this.dataSourceCopy($(b));}l.children=e;}else{l.key=f.key;l.formKey=f.formKey;}if(f.parent){l.parentId=f.parent.id;}this._data.push(l);}}},changeDataType:function(e){var d=[];var b=$.grep(e,function(g,f){return typeof(g.parentId)=="undefined"?g:null;});for(var a=0;a<b.length;a++){var c=$.extend(true,{},b[a]);d.push(c);this.changeData(c);}this.rootEntry=d;},changeData:function(d){if(d.children){for(var b=0,a=d.children.length;b<a;b++){var c=$.extend(true,{},this.getTreeNode(d.children[b]));d.children.splice(b,1,c);if(c.children){this.changeData(d.children[b]);}}}},buildTreenode:function(a,b){if(!a){return;}if(!a.length){if(!b){a=a.children;}}this.addChilds(a,b,0);},addChilds:function(c,h,b){if(c.length<=0){if(h){$("#"+h,this.el).next().remove();$("#"+h,this.el).children().first().removeClass("tree-collapse");}return;}var e,a;if(h){var j=this.getTreeNode(h);j.children=[];}for(var f=0,m=c.length;f<m;f++){e=c[f];a=e.id;e.parentId=h;var k=$("<li class='treemenu tree-node' level='"+b+"'></li>");if(!e.parentId){k.addClass("top-level");}if(h){j.children.push(a);k.appendTo($("#"+h,this.el).next());var g=$("#"+h,this.el).next().children().length;}else{k.appendTo(this.el);}var n=$("<a id='"+a+"' class='tree-anchor'></a>").appendTo(k),d,l,o;if(e.isParent){k.addClass("isParent");o=$("<span class='tree'></span>");d=$("<ul class='tree-ul'></ul>");l=$("<span class='treemenu-icon'/>");if(e.open&&!this._isOpen&&!e.parentId){k.addClass("selected");n.addClass("curSelectedNode open").attr("open",true);l.addClass("tree-expand");this._isOpen=true;this._openedItem=n;o.addClass("expand");}else{n.attr("open",false).addClass("close");d.css("display","none");l.addClass("tree-collapse");o.addClass("collapse");}d.appendTo(k);_explore=$("<span class='tree-explore'/>");if(this.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){l.appendTo(n);_explore.appendTo(n);if(e.icon){_explore.css("background-image","url(Resource/"+e.icon+")");}}else{o.appendTo(n);}}$("<span class='treenode-name'>"+e.name+"</span>").appendTo(n);if(this.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){if(b>0){n.css("padding-left",(b-1)*20+50);}}else{n.css("padding-left",b*20);}if(e.children){this.addChilds(e.children,e.id,b+1);}else{n.addClass("noExpand");}}},removeChilds:function(a){$("#"+a).parent().remove();this.removeNode(a);},removeNode:function(f){for(var c=0,a=this._data.length;c<a;c++){var g=this._data[c];if(g.id==f){if(g.parentId){var d=this.getTreeNode(g.parentId);d.children=$.map(d.children,function(j,h){return j!=g.id?j:null;});}else{if(g.children){this._data.splice(c,1);for(var b=0,e=g.children.length;b<e;b++){this.removeNode(g.children[b]);}break;}else{this._data.splice(c,1);break;}}}}},onRender:function(a){this.base(a);this.el.addClass("treemenu treemenu-content");var b=this.el.attr("id");this.dataSourceCopy(this.rootEntry);this.buildTreenode(this.rootEntry,null);switch(this.menuType){case YIUI.TREEMENU_TYPE.TREE:break;case YIUI.TREEMENU_TYPE.GROUPTREE:this.el.addClass("treemenu-grouptree");break;}},install:function(){var a=this;$("a",a.el).bind("click",function(b){if($(this).hasClass("open")){a.clickEvent.collapse($(this),a,null);return;}if($(this).hasClass("close")){a.clickEvent.expandNode($(this),a,null);return;}if($(this).hasClass("noExpand")){a.clickEvent.selectNode($(this),a,null);return;}});},getTreeNode:function(c){for(var b=0,a=this._data.length;b<a;b++){if(this._data[b].id==c){return this._data[b];}}},setRootNode:function(a){this.rootNode=a;},getRootNode:function(){return this.rootNode;}});YIUI.reg("tree",YIUI.Tree);YIUI.Control.Attachment=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.AttachmentHandler,_operatorID:null,maxSize:1024,width:1500,onRender:function(e){this.base(e);this._operatorID=$.cookie("userID");this.el.addClass("ui-att");var k=$("<thead></thead>");var f=$("<tbody></tbody>");this.$att_tbl=$('<table class="att-tbl"></table>').appendTo(this.el);var j=$('<tr class="tr-head"></tr>').appendTo(this.$att_tbl);var h=$('<td class="out"></td>').appendTo(j);var n=$('<div class="head"></div>').appendTo(h);var g=$('<table class="tbl-head"></table>').append(k).appendTo(n);var c=$('<tr class="tr-body"></tr>').appendTo(this.$att_tbl);var b=$('<td class="out"></td>').appendTo(c);var d=$("<div class='body'></div>").appendTo(b);this.$table=$('<table border="1" class="tbl-body"></table>').append(f).appendTo(d);$("<span class='space'></span>").appendTo(d);var m=$('<tr class="tr-foot"></tr>').appendTo(this.$att_tbl);var l=$('<td class="out"></td>').appendTo(m);var a=$('<div class="foot"></div>').appendTo(l);$('<table border="1" class="tbl-foot"></table>').appendTo(a);this.createColumns();this.loadAttachment();},onSetHeight:function(a){this.base(a);var b=a-$(".tbl-head",this.el).outerHeight()-$(".tbl-foot",this.el).outerHeight();$(".body",this.el).height(b);this.addEmptyRow();$(".ui-resizer",this.el).height($(".tbl-head",this.el).outerHeight()+$(".body",this.el)[0].clientHeight);},onSetWidth:function(b){this.base(b);var a=b-this.getPlaceholderWidth();var c=this.placeW=$.getReal("100%",a);if(c>0){$(".tbl-head td.empty",this.el).outerWidth("100%");$(".body tr.first td.empty",this.el).outerWidth("100%");}this.fileBtn.css("left",b/2);},getPlaceholderWidth:function(){var d=$(".tbl-head td",this.el),e,c=0;for(var b=0,a=d.length;b<a-1;b++){e=d.eq(b);c+=e.outerWidth();}return c;},setEnable:function(b){this.enable=b;var c=this.getEl(),a=this.getOuterEl();var d=$(".btn:not([class~='view']):not([class~='download'])",c);if(this.enable){a.removeClass("ui-readonly");d.removeAttr("disabled");$(".fup",c).removeAttr("disabled");}else{a.addClass("ui-readonly");d.attr("disabled","disabled");$(".fup",c).attr("disabled","disabled");}},createColumns:function(){var b=$("<div class='ui-resizer' />").prependTo(this.el);var e=$(".tbl-head",this.el).children("thead");var d=$("<tr></tr>"),h;$('<td><label>附件名称</label><span class="att-handler"></span></td>').appendTo(d);$('<td><label>上传时间</label><span class="att-handler"></span></td>').appendTo(d);$('<td><label>上传人</label><span class="att-handler"></span></td>').appendTo(d);$('<td><label>附件路径</label><span class="att-handler"></span></td>').appendTo(d);$("<td><label></label></td>").appendTo(d);if(this.getMetaObj().preview){d.addClass("hasView");$('<td class="opt_left"><label>操</label></td>').appendTo(d);$('<td class="opt_right"><label>作</label></td>').appendTo(d);}else{$("<td><label>操作</label></td>").appendTo(d);}$("<td><label></label></td>").appendTo(d);$('<td class="empty"><span/></td>').appendTo(d);e.append(d);var f=$(".tbl-foot",this.el);var a=$("<input class='btn fileBtn' type='button' value='上传'>");var j=this.fileBtn=$("<input type='file' name='file' data-url='upload' class='fup'>").data("fileID",-1);$('<td colspan="7"></td>').append(a).append(j).appendTo($("<tr></tr>")).appendTo(f);var c=this.$table.children("tbody");var g=$('<tr class="first"></tr>');$('<td class="name"></td>').appendTo(g);$('<td class="time"></td>').appendTo(g);$('<td class="operator"></td>').appendTo(g);$('<td class="path"></td>').appendTo(g);$('<td class="download"></td>').appendTo(g);$('<td class="delete"></td>').appendTo(g);$('<td class="upload"></td>').appendTo(g);if(this.getMetaObj().preview){g.addClass("hasView");$('<td class="view"></td>').appendTo(g);}$('<td class="empty"></td>').appendTo(g);c.append(g);},loadAttachment:function(){this.$table.children("tbody tr").not(".first").remove();var a=YIUI.FormStack.getForm(this.ofFormID);var b;var c=function(d){b=d;};Svr.Request.getSyncData(Svr.SvrMgr.AttachURL,{service:"LoadAllAttachment",oid:a.OID,formKey:a.formKey},c);this.addAttachment(b);},addAttachment:function(g){var f=this.$table.children("tbody");var k,b,n=this;if(g&&g.size()>0){var h=$("tr.first",f);for(var j=0,l=g.size();j<l;j++){g.setPos(j);var e=g.getByKey(YIUI.Attachment_Data.UPLOAD_TIME);var d=new Date(parseInt(e));d=YIUI.DateFormat.format(d);var m=g.getByKey(YIUI.Attachment_Data.UPLOAD_NAME);var o=g.getByKey(YIUI.Attachment_Data.PATH);var a=g.getByKey(YIUI.Attachment_Data.NAME);var c=g.getByKey(YIUI.Attachment_Data.OID);k=$("<tr></tr>");$("<td>"+a+"</td>").appendTo(k);$("<td>"+d+"</td>").appendTo(k);$("<td>"+m+"</td>").appendTo(k);$("<td>"+o+"</td>").appendTo(k);$("<td></td>").appendTo(k).append($("<input class='btn download' type='button' value='下载'>").data("fileID",c).data("path",o));$("<td></td>").appendTo(k).append($("<input class='btn del' type='button' value='删除'>").data("fileID",c));$("<td></td>").appendTo(k).append($("<input class='btn upd' type='button' value='上传'>")).append($("<input type='file' name='file' data-url='upload' class='btn upd fup'>").data("fileID",c));if(this.getMetaObj().preview){k.addClass("hasView");$("<td></td>").appendTo(k).append($("<input class='btn view' type='button' value='预览'>").data("fileID",c));}$("<td></td>").addClass("empty").appendTo(k);f.append(k);}}},addEmptyRow:function(){var g=$(".body",this.el);var a=$(".head",this.el);var b=g.children("span");if(!this.items||this.items.length==0){var f=$("label.empty",b).remove();if($("tr",g).not(".first").length==0){f=$("<label class='empty'>表中无内容</label>");b.append(f);var e=$(".head tr",this.el).width();var h=(g.height()-f.height())/2;f.width(e).css({"top":h+"px","padding-left":b.width()/2+"px"});}}var c=$(".body span.space",this.el);c.outerHeight(g[0].clientHeight-g.outerHeight());if(g[0].clientWidth!=g[0].scrollWidth){var d=g.width()-g[0].clientWidth;if($("td.empty",a).width()<d){$("td.empty",a).outerWidth(d);$("tr.first td.empty",g).outerWidth(0);}}else{$("td.empty",a).outerWidth("100%");$("tr.first td.empty",g).outerWidth("100%");}},uploadFile:function(e,a){var b=this;var c=YIUI.FormStack.getForm(b.ofFormID);var d=function(f){var g=$.checkFile(f,b.getMetaObj().maxSize);if(!g){return;}var h=f.parents("tr").eq(0).index()-1;$.ajaxFileUpload({url:Svr.SvrMgr.AttachURL,secureuri:false,fileElement:f,data:{service:"UploadAttachment",formKey:c.formKey,operatorID:b._operatorID,fileID:a,oid:c.OID,mode:1},type:"post",success:function(o,m,p){p.data("fileID",a);o=JSON.parse(o);var n=YIUI.DataUtil.fromJSONDataTable(o);if(a!=-1){var q=p.parents("tr").eq(0).children();var k=n.getByKey(YIUI.Attachment_Data.UPLOAD_TIME);var l=new Date(parseInt(k));l=YIUI.DateFormat.format(l);var r=n.getByKey(YIUI.Attachment_Data.UPLOAD_NAME);var s=n.getByKey(YIUI.Attachment_Data.PATH);var j=n.getByKey(YIUI.Attachment_Data.NAME);q.eq(0).text(j);q.eq(1).text(l);q.eq(2).text(r);q.eq(3).text(s);}else{b.addAttachment(n);b.addEmptyRow();}},error:function(k,j,l){alert(l);}});};if(c.OID){d(e);}else{alert("新增状态无法进行上传操作！");}},focus:function(){$(".btn.fileBtn",this.el).focus();},install:function(){var b=this;b.$table.delegate(".download","click",function(f){var h=$(f.target);var d=h.data("fileID");var g=h.data("path");var e=YIUI.FormStack.getForm(b.ofFormID);location.href=Svr.SvrMgr.AttachURL+"?fileID="+d+"&path="+g+"&formKey="+e.formKey+"&mode=1&service=DownloadAttachment";});b.el.delegate(".tbl-body .upd, .tbl-foot .fileBtn","click",function(d){var e=$(d.target);e.next().click();});b.$table.delegate(".del","click",function(f){var g=$(f.target);var d=g.data("fileID");var e=YIUI.FormStack.getForm(b.ofFormID);b.handler.doDeleteAttachement(b,d,e.formKey);var h=g.parents("tr").eq(0).index()-1;$(this).parents("tr").eq(0).remove();b.addEmptyRow();});b.el.delegate(".fup","change",function(d){b.uploadFile($(this),$(this).data("fileID"));});b.el.delegate(".btn.fileBtn","keydown",function(d){var e=d.keyCode||d.charCode;if(e===13||e===108){$(".fup",b.el).click();d.preventDefault();}else{if(e===9){b.focusManager.requestNextFocus(b);d.preventDefault();}}});b.el.delegate(".view","click",function(f){var e=$(this).parents("tr:eq(0)");var d=$("td:eq(0)",e).text();var g=$("td:eq(3)",e).text();b.handler.preview(g,d,b);});var c=$(".body",this.el);var a=$(".head",this.el);c.scroll(function(){var e=c.scrollLeft();a.scrollLeft(e);if(c[0].clientWidth!=c[0].scrollWidth){var d=c.width()-c[0].clientWidth;$("td.empty",a).outerWidth(d);}});$(".att-handler",this.el).bind("mousedown",function(k){if(!b.enable){return false;}var o=$(".ui-resizer",b.el);var f=$(this).parent().position().left+$(this).parent().outerWidth();o.css("left",f);o.addClass("clicked");var l,m,j;k.preventDefault();var g=k.clientX;l=$(this).parents("td").eq(0);m=l.width();var d,n,h;$(document).on("mousemove.rc",function(p){d=p.clientX-g;o.css("left",f+d);});return $(document).one("mouseup",function(){$(document).off("mousemove.rc");n=m+d;if(n<10){n=10;}l.width(n);$("label",l).width(n);var e=$(".tbl-body tr.first td",c).eq(l.index());e.width(n);o.removeClass("clicked");b.addEmptyRow();});});}});YIUI.reg("attachment",YIUI.Control.Attachment);YIUI.Control.Separator=YIUI.extend(YIUI.Control,{autoEl:'<hr size="1"></hr>',onSetHeight:function(a){},onRender:function(a){this.base(a);this.el.addClass("ui-sep");this.el.attr("color","#dadada");}});YIUI.reg("separator",YIUI.Control.Separator);YIUI.Control.Chart=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",title:null,grouped:true,barWidth:0.5,yMin:0,xMin:null,fillColor:"#FFFFFF",series:null,categories:null,height:500,width:500,fistStraw:true,yScale:[],xScale:[],setDataModel:function(m){var a=[];if(m){this.series=m.series;this.categories=m.categories;}switch(this.getMetaObj().chartType){case 1:this.horizontal=false;this.bars=true;this.stacked=true;this.grouped=false;this.track=false;break;case 2:this.horizontal=true;this.bars=true;this.track=true;break;case 3:this.horizontal=true;this.bars=true;this.stacked=true;this.grouped=false;this.track=false;break;case 4:this.fill=true;this.showPoint=true;this.showLine=true;break;case 5:this.fill=false;this.showPoint=true;this.showLine=true;break;case 6:this.showPoint=true;break;case 7:this.pie=true;break;case 0:default:this.horizontal=false;this.bars=true;this.track=true;break;}if($.isNumeric(this.categories[0])){for(var h=0,l=this.series.length;h<l;h++){var g=[];var b=[];for(var d=0,c=this.categories.length;d<c;d++){if(this.horizontal){g.push([this.series[h].data[d],parseInt(this.categories[d])]);b.push(this.series[h].data[d]);}else{g.push([parseInt(this.categories[d]),this.series[h].data[d]]);b.push(this.series[h].data[d]);}}g.sort(function(o,j){return o[0]-j[0];});var k={data:g,label:this.series[h].name,lines:{fill:this.fill,show:this.showLine},points:{show:this.showPoint,fillColor:this.fillColor}};a.push(k);}if(this.horizontal){for(var h=0,l=a[0].data.length;h<l;h++){this.yScale.push(parseInt(a[0].data[h][1]));}this.xScale=null;}else{for(var h=0,l=a[0].data.length;h<l;h++){this.xScale.push(parseInt(a[0].data[h][0]));}this.yScale=null;}}else{for(var h=0,l=this.series.length;h<l;h++){var g=[];for(var d=0,c=this.series[h].data.length;d<c;d++){if(this.horizontal){g.push([this.series[h].data[d],d+1]);}else{g.push([d+1,this.series[h].data[d]]);}}var k={data:g,label:this.series[h].name,lines:{fill:this.fill,show:this.showLine},points:{show:this.showPoint,fillColor:this.fillColor}};a.push(k);}if(this.horizontal){for(var h=0;h<this.categories.length;h++){this.yScale.push([h+1,this.categories[h]]);}this.xScale=null;}else{for(var h=0;h<this.categories.length;h++){this.xScale.push([h+1,this.categories[h]]);}this.yScale=null;}}this.xyData=a;this.maxData=b;this.yMax=Math.max.apply(null,this.maxData)+50;if(this.pie){var n=[];for(var d=0,c=this.categories.length;d<c;d++){var f=this.series[0].data[d];var e={data:[[0,f]],label:this.categories[d]};n.push(e);}this.pieData=n;}if(this.isDraw){this.setDraw();}else{this.isDraw=true;}},onRender:function(a){this.base(a);this.el.addClass("ui-chart");this.dataModel&&this.setDataModel(this.dataModel);},onSetWidth:function(a){if(a>20){this.el.css("width",a-20);this.el.css("margin-right",20);this._hasSetWidth=true;this.reSetDraw(this._hasSetWidth,this._hasSetHeight);}},onSetHeight:function(a){if(a>30){this.el.css("height",a-30);this._hasSetHeight=true;this.reSetDraw(this._hasSetWidth,this._hasSetHeight);}},reSetDraw:function(a,b){if(a&&b){this.setDraw();}},setDraw:function(){if(this.horizontal){this.yMin=null;this.xMin=0;}if(this.pie){Flotr.draw(this.el[0],this.pieData,{HtmlText:false,grid:{outlineWidth:0,verticalLines:false,horizontalLines:false},xaxis:{title:this.categoryAxisTitle,showLabels:false},yaxis:{title:this.seriesAxisTitle,showLabels:false},pie:{show:true,fillOpacity:1,explode:5},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.bars){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,min:this.xMin,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,min:this.yMin,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},bars:{show:this.bars,stacked:this.stacked,horizontal:this.horizontal,barWidth:this.barWidth,grouped:this.grouped,fillOpacity:1},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.fill){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.points){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,min:this.xMin,max:this.xMax,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,min:this.yMin,min:this.yMax,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.showPoint){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}}}}}if(this.fistStraw){this.height=-1;this.width=-1;this.fistStraw=false;}this.xScale=[];this.yScale=[];},setSeriesAxisTitle:function(a){this.seriesAxisTitle=a;},setCategoryAxisTitle:function(a){this.categoryAxisTitle=a;},setTitle:function(a){this.title=a;},afterRender:function(b){this.base(b);var a=this.getMetaObj();a.seriesAxisTitle&&this.setSeriesAxisTitle();a.categoryAxisTitle&&this.setCategoryAxisTitle();a.title&&this.setTitle();this.setDraw();}});YIUI.reg("chart",YIUI.Control.Chart);YIUI.Control.BPMGraph=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",paper:null,nodes:null,mX:null,mY:null,transitions:null,swims:null,elements:{},nodeElements:{},circle_R:20,isSourceTop:false,isSourceLeft:false,transPath:null,init:function(a){this.base(a);},isTransPathLine:function(e){if(this.transPath){var c,d=this.nodeElements[e.source],a=this.nodeElements[e.target];for(var b=0;b<this.transPath["steps"].length;b++){c=this.transPath["steps"][b];if(c.source==d.id&&c.target==a.id){return true;}}}return false;},isLastNodeInPath:function(b){if(this.transPath){var a=this.transPath["steps"][this.transPath["steps"].length-1];if(a&&b.id==a.target){return true;}}return false;},isIE:function(){return $.browser.isIE;},textFormat:function(a){a.attr("font-style","normal");a.attr("font-weight","normal");a.attr("font-size","12px");},onSetHeight:function(a){this.base(a);if(this.hasWidth&&this.paper==null){this.createGraph();}this.hasHeight=true;},onSetWidth:function(a){this.base(a);this.el.css("overflow","auto");if(this.hasHeight&&this.paper==null){this.createGraph();}this.hasWidth=true;},onRender:function(a){this.base(a);},createGraph:function(){if(!this.paper){this.paper=Raphael(this.id);}if(this.nodes&&this.transitions){var h=this.nodes[0];var g=h.x,b=h.x,d=h.y,a=h.y;for(var j=1,k=this.nodes.length;j<k;j++){var e=this.nodes[j];if(e.x<g){g=e.x;}if(e.x+e.width>b){b=e.x+e.width;}if(e.y<d){d=e.y;}if(e.y+e.height>a){a=e.y+e.height;}}this.mX=(b-g)/2-this.el.width()/2+50;this.mY=d-20;this.paper.setSize(b+Math.abs(this.mX)+40,a+40);for(var j in this.nodes){var e=this.nodes[j];var c=this.createNode(e);this.elements[e.key]=c;this.nodeElements[e.key]=e;}for(var j in this.transitions){var m=this.transitions[j];var f=this.nodes[m.source];this.createLine(m);}}if(this.swims){for(var j in this.swims){var l=this.swims[j];this.createSwim(l);}}this.hasWidth=false;this.hasHeight=false;},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length);},createSwim:function(c){var d=c.direction;if(d!=undefined){if(d=="Vertical"){var b=this.paper.rect(c.x,c.y,c.width,c.height,0);b.toBack();b.attr("stroke","gray");var a=this.paper.path("M"+c.x+" "+(c.y+2*this.circle_R)+"L"+(c.x+c.width)+" "+(c.y+2*this.circle_R));a.toBack();a.attr("stroke","gray");var e=this.paper.text(c.x+c.width/2,c.y+this.circle_R,c.caption);if(this.isIE()){this.textFormat(e);}e.attr("font-size","25px");if(this.isIE()){this.textFormat(e);}}else{var b=this.paper.rect(c.x,c.y,c.height,c.width,0);b.toBack();b.attr("stroke","gray");var a=this.paper.path("M"+(c.x+2*this.circle_R)+" "+c.y+"L"+(c.x+2*this.circle_R)+" "+(c.y+c.width));a.toBack();a.attr("stroke","gray");var e=this.paper.text(c.x+this.circle_R,(c.y+c.width/2),c.caption);e.attr("font-size","20px");if(this.isIE()){this.textFormat(e);}}}},createLine:function(b){var a=b.lineStyle;switch(a){case BPMLineType.STEAIGHT_LINE:return this.createSteaightLine(b);case BPMLineType.CHAMFER_CURVE_H_ONE:return this.chamferCurveHOne(b);case BPMLineType.CHAMFER_CURVE_V_ONE:return this.chamferCurveVOne(b);case BPMLineType.CHAMFER_CURVE_H_TWO:return this.chamferCurveHTwo(b);case BPMLineType.CHAMFER_CURVE_V_TWO:return this.chamferCurveVTwo(b);case BPMLineType.FILLET_CURVE_H_ONE:return this.filletCurveHOne(b);case BPMLineType.FILLET_CURVE_V_ONE:return this.filletCurveVOne(b);case BPMLineType.FILLET_CURVE_H_TWO:return this.filletCurveHTwo(b);case BPMLineType.FILLET_CURVE_V_TWO:return this.filletCurveVTwo(b);case BPMLineType.OBKIQUE_CURVE_H_TWO:return this.obkiqueCurveHTwo(b);case BPMLineType.OBKIQUE_CURVE_V_TWO:return this.obkiqueCurveVTwo(b);default:return null;}},obkiqueCurveVTwoBase:function(g,c,e,d,f){var b=this.paper.path("M"+(g.x-this.mX)+" "+(g.y-this.mY)+"L"+(g.x-this.mX)+" "+(e-this.mY));b.attr({"stroke-width":"2"});var k=this.paper.path("M"+(g.x-this.mX)+" "+(e-this.mY)+"L"+(c.x-this.mX)+" "+(d-this.mY));k.attr({"stroke-width":"2"});var j=this.paper.path("M"+(c.x-this.mX)+" "+(d-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));j.attr({"stroke-width":"2"});j.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(f)){b.attr({"stroke":"red"});j.attr({"stroke":"red"});k.attr({"stroke":"red"});}switch(f.tagName){case"association":b.attr({"stroke-dasharray":"- "});k.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});break;case"exception-flow":var h=b.getPointAtLength(8.5);var a=this.paper.image("Resource/bpmgraph/ExceptionFlow-icon.png",(h.x-8.5-this.mX),(h.y-8.5-this.mY),17,17);break;}},obkiqueCurveVTwo:function(e){var a=this.stNode(e);this.brokenLine(a.sourceNode,a.targetNode);var c=this.isSourceTop?this.getBottom(a.sourceNode):this.getTop(a.sourceNode);var f=this.isSourceTop?this.getTop(a.targetNode):this.getBottom(a.targetNode);if(c!=null&&f!=null){var d=c.y+(f.y-c.y)/3;var b=c.y+(f.y-c.y)/3*2;this.obkiqueCurveVTwoBase(c,f,d,b,e);}},obkiqueCurveHTwoBase:function(f,c,g,e,d){var b=this.paper.path("M"+(f.x-this.mX)+" "+(f.y-this.mY)+"L"+(g-this.mX)+" "+(f.y-this.mY));b.attr({"stroke-width":"2"});var k=this.paper.path("M"+(g-this.mX)+" "+(f.y-this.mY)+"L"+(e-this.mX)+" "+(c.y-this.mY));k.attr({"stroke-width":"2"});var j=this.paper.path("M"+(e-this.mX)+" "+(c.y-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));j.attr({"stroke-width":"2"});j.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(d)){b.attr({"stroke":"red"});j.attr({"stroke":"red"});k.attr({"stroke":"red"});}switch(d.tagName){case"association":b.attr({"stroke-dasharray":"- "});k.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});break;case"exception-flow":var h=b.getPointAtLength(8.5);var a=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(h.x-8.5-this.mX),(h.y-8.5-this.mY),17,17);break;}},obkiqueCurveHTwo:function(e){var a=this.stNode(e);this.brokenLine(a.sourceNode,a.targetNode);var d=this.isSourceLeft?this.getRight(a.sourceNode):this.getLeft(a.sourceNode);var f=this.isSourceLeft?this.getLeft(a.targetNode):this.getRight(a.targetNode);if(d!=null&&f!=null){var c=d.x+(f.x-d.x)/3;var b=d.x+(f.x-d.x)/3*2;this.obkiqueCurveHTwoBase(d,f,c,b,e);}},filletCurveVTwoBase:function(e,c,f,d){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(e.x-this.mX)+" "+(f-this.mY));b.attr({"stroke-width":"2"});var j=this.paper.path("M"+(e.x-this.mX)+" "+(f-this.mY)+"L"+(c.x-this.mX)+" "+(f-this.mY));j.attr({"stroke-width":"2"});var h=this.paper.path("M"+(c.x-this.mX)+" "+(f-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));h.attr({"stroke-width":"2"});h.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(d)){b.attr({"stroke":"red"});h.attr({"stroke":"red"});j.attr({"stroke":"red"});}switch(d.tagName){case"association":b.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});h.attr({"stroke-dasharray":"- "});break;case"exception-flow":var g=b.getPointAtLength(8.5);var a=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(g.x-8.5-this.mX),(g.y-8.5-this.mY),17,17);break;}},filletCurveVTwo:function(d){var a=this.stNode(d);this.brokenLine(a.sourceNode,a.targetNode);var c=this.isSourceTop?this.getBottom(a.sourceNode):this.getTop(a.sourceNode);var e=this.isSourceTop?this.getTop(a.targetNode):this.getBottom(a.targetNode);if(c!=null&&e!=null){var b=(c.y+e.y)/2;this.filletCurveVTwoBase(c,e,b,d);}},filletCurveHTwoBase:function(e,c,f,d){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(f-this.mX)+" "+(e.y-this.mY));b.attr({"stroke-width":"2"});var j=this.paper.path("M"+(f-this.mX)+" "+(e.y-this.mY)+"L"+(f-this.mX)+" "+(c.y-this.mY));j.attr({"stroke-width":"2"});var h=this.paper.path("M"+(f-this.mX)+" "+(c.y-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));h.attr({"stroke-width":"2"});h.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(d)){b.attr({"stroke":"red"});h.attr({"stroke":"red"});j.attr({"stroke":"red"});}switch(d.tagName){case"association":b.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});h.attr({"stroke-dasharray":"- "});break;case"exception-flow":var g=b.getPointAtLength(8.5);var a=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(g.x-8.5-this.mX),(g.y-8.5-this.mY),17,17);break;}},filletCurveHTwo:function(d){var a=this.stNode(d);this.brokenLine(a.sourceNode,a.targetNode);var b=this.isSourceLeft?this.getRight(a.sourceNode):this.getLeft(a.sourceNode);var e=this.isSourceLeft?this.getLeft(a.targetNode):this.getRight(a.targetNode);if(b!=null&&e!=null){var c=(b.x+e.x)/2;this.filletCurveHTwoBase(b,e,c,d);}},filletCurveVOneBase:function(e,g,f){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(g.x-this.mX)+" "+(e.y-this.mY));b.attr({"stroke-width":"2"});var c=this.paper.path("M"+(g.x-this.mX)+" "+(e.y-this.mY)+"L"+(g.x-this.mX)+" "+(g.y-this.mY));c.attr({"arrow-end":"classic-wide-long"});c.attr({"stroke-width":"2"});if(this.isTransPathLine(f)){b.attr({"stroke":"red"});c.attr({"stroke":"red"});}switch(f.tagName){case"association":b.attr({"stroke-dasharray":"- "});c.attr({"stroke-dasharray":"- "});break;case"exception-flow":var a=b.getPointAtLength(8.5);var d=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(a.x-8.5-this.mX),(a.y-8.5-this.mY),17,17);break;}},filletCurveVOne:function(c){var a=this.stNode(c);this.brokenLine(a.sourceNode,a.targetNode);var b=this.isSourceLeft?this.getRight(a.sourceNode):this.getLeft(a.sourceNode);var d=this.isSourceTop?this.getTop(a.targetNode):this.getBottom(a.targetNode);if(b!=null&&d!=null){this.filletCurveVOneBase(b,d,c);}},filletCurveHOneBase:function(e,g,f){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(e.x-this.mX)+" "+(g.y-this.mY));b.attr({"stroke-width":"2"});var c=this.paper.path("M"+(e.x-this.mX)+" "+(g.y-this.mY)+"L"+(g.x-this.mX)+" "+(g.y-this.mY));c.attr({"arrow-end":"classic-wide-long"});c.attr({"stroke-width":"2"});if(this.isTransPathLine(f)){b.attr({"stroke":"red"});c.attr({"stroke":"red"});}switch(f.tagName){case"association":b.attr({"stroke-dasharray":"- "});c.attr({"stroke-dasharray":"- "});break;case"exception-flow":var a=b.getPointAtLength(8.5);var d=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(a.x-8.5-this.mX),(a.y-8.5-this.mY),17,17);break;}},filletCurveHOne:function(c){var a=this.stNode(c);this.brokenLine(a.sourceNode,a.targetNode);var b=this.isSourceTop?this.getBottom(a.sourceNode):this.getTop(a.sourceNode);var d=this.isSourceLeft?this.getLeft(a.targetNode):this.getRight(a.targetNode);if(b!=null&&d!=null){this.filletCurveHOneBase(b,d,c);}},chamferCurveVTwoBase:function(l,g,e,c,j,h,m,k){var d=this.paper.path("M"+(l.x-this.mX)+" "+(l.y-this.mY)+"L"+(l.x-this.mX)+" "+(m+(c<0?h:-h)-this.mY));d.attr({"stroke-width":"2"});var q=0;if(c*e<0){q=1;}var a=d.paper.path("M"+(l.x-this.mX)+" "+(m+(c<0?h:-h)-this.mY)+"A"+j+" "+h+" 0 0"+" "+q+" "+(l.x+(e<0?-j:+j)-this.mX)+" "+(m-this.mY));a.attr({"stroke-width":"2"});var r=this.paper.path("M"+(l.x+(e<0?-j:+j)-this.mX)+" "+(m-this.mY)+"L"+(g.x+(e<0?j:-j)-this.mX)+" "+(m-this.mY));r.attr({"stroke-width":"2"});var f=0;if(c*e>0){f=1;}var o=d.paper.path("M"+(g.x+(e<0?j:-j)-this.mX)+" "+(m-this.mY)+"A"+j+" "+h+" 0 0"+" "+f+" "+(g.x-this.mX)+" "+(m+(c<0?-h:h)-this.mY));o.attr({"stroke-width":"2"});var p=this.paper.path("M"+(g.x-this.mX)+" "+(m+(c<0?-h:h)-this.mY)+"L"+(g.x-this.mX)+" "+(g.y-this.mY));p.attr({"arrow-end":"classic-wide-long"});p.attr({"stroke-width":"2"});if(this.isTransPathLine(k)){d.attr({"stroke":"red"});a.attr({"stroke":"red"});r.attr({"stroke":"red"});o.attr({"stroke":"red"});p.attr({"stroke":"red"});}switch(k.tagName){case"association":d.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});r.attr({"stroke-dasharray":"- "});o.attr({"stroke-dasharray":"- "});p.attr({"stroke-dasharray":"- "});break;case"exception-flow":var n=d.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(n.x-8.5-this.mX),(n.y-8.5-this.mY),17,17);break;}},chamferCurveVTwo:function(f){var g=this.stNode(f);this.brokenLine(g.sourceNode,g.targetNode);var j=this.isSourceTop?this.getBottom(g.sourceNode):this.getTop(g.sourceNode);var c=this.isSourceTop?this.getTop(g.targetNode):this.getBottom(g.targetNode);if(j!=null&&c!=null){var a=c.y-j.y;var d=Math.min(Math.abs(a),20);var b=c.x-j.x;var e=Math.min(Math.abs(b),20);var h=(j.y+c.y)/2;this.chamferCurveVTwoBase(j,c,b,a,e,d,h,f);}},chamferCurveHTwoBase:function(l,g,e,c,j,h,o,k){var d=this.paper.path("M"+(l.x-this.mX)+" "+(l.y-this.mY)+"L"+(o+(e<0?j:-j)-this.mX)+" "+(l.y-this.mY));d.attr({"stroke-width":"2"});var q=0;if(c*e>0){q=1;}var a=d.paper.path("M"+(o+(e<0?j:-j)-this.mX)+" "+(l.y-this.mY)+"A"+j+" "+h+" 0 0"+" "+q+" "+(o-this.mX)+" "+(l.y+(c<0?-h:h)-this.mY));a.attr({"stroke-width":"2"});var r=this.paper.path("M"+(o-this.mX)+" "+(l.y+(c<0?-h:h)-this.mY)+"L"+(o-this.mX)+" "+(g.y+(c<0?h:-h)-this.mY));r.attr({"stroke-width":"2"});var f=0;if(c*e<0){f=1;}var n=d.paper.path("M"+(o-this.mX)+" "+(g.y+(c<0?h:-h)-this.mY)+"A"+j+" "+h+" 0 0"+" "+f+" "+(o+(e<0?-j:+j)-this.mX)+" "+(g.y-this.mY));n.attr({"stroke-width":"2"});var p=this.paper.path("M"+(o+(e<0?-j:+j)-this.mX)+" "+(g.y-this.mY)+"L"+g.x+" "+(g.y-this.mY));p.attr({"arrow-end":"classic-wide-long"});p.attr({"stroke-width":"2"});if(this.isTransPathLine(k)){d.attr({"stroke":"red"});a.attr({"stroke":"red"});r.attr({"stroke":"red"});n.attr({"stroke":"red"});p.attr({"stroke":"red"});}switch(k.tagName){case"association":d.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});r.attr({"stroke-dasharray":"- "});n.attr({"stroke-dasharray":"- "});p.attr({"stroke-dasharray":"- "});break;case"exception-flow":var m=d.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(m.x-8.5-this.mX),(m.y-8.5-this.mY),17,17);break;}},chamferCurveHTwo:function(f){var g=this.stNode(f);this.brokenLine(g.sourceNode,g.targetNode);var h=this.isSourceLeft?this.getRight(g.sourceNode):this.getLeft(g.sourceNode);var c=this.isSourceLeft?this.getLeft(g.targetNode):this.getRight(g.targetNode);if(h!=null&&c!=null){var a=c.y-h.y;var d=Math.min(Math.abs(a),20);var b=c.x-h.x;var e=Math.min(Math.abs(b),20);var j=(h.x+c.x)/2;this.chamferCurveHTwoBase(h,c,b,a,e,d,j,f);}},chamferCurveVOneBase:function(k,f,d,c,h,g,j){var e=this.paper.path("M"+(k.x-this.mX)+" "+(k.y-this.mY)+"L"+(f.x-this.mX+(d<0?h:-h))+" "+(k.y-this.mY));e.attr({"stroke-width":"2"});var m=0;if(c*d>0){m=1;}var a=e.paper.path("M"+(f.x+(d<0?h:-h)-this.mX)+" "+(k.y-this.mY)+"A"+h+" "+g+" 0 0"+" "+m+" "+(f.x-this.mX)+" "+(k.y+(c<0?-g:g)-this.mY));a.attr({"stroke-width":"2"});if(m==0){var n=a.paper.path("M"+(f.x-this.mX)+" "+(k.y+(c<0?-g:g)-this.mY)+"L"+(f.x-this.mX)+" "+(f.y-this.mY));n.attr({"arrow-end":"classic-wide-long"});n.attr({"stroke-width":"2"});}else{var n=a.paper.path("M"+(f.x-this.mX)+" "+(k.y+(c<0?-g:g)-this.mY)+"L"+(f.x-this.mX)+" "+(f.y-this.mY));n.attr({"arrow-end":"classic-wide-long"});n.attr({"stroke-width":"2"});}if(this.isTransPathLine(j)){e.attr({"stroke":"red"});a.attr({"stroke":"red"});n.attr({"stroke":"red"});}switch(j.tagName){case"association":e.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});n.attr({"stroke-dasharray":"- "});break;case"exception-flow":var l=e.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(l.x-8.5-this.mX),(l.y-8.5-this.mY),17,17);break;}},chamferCurveVOne:function(g){var c=this.stNode(g);this.brokenLine(c.sourceNode,c.targetNode);var f=this.isSourceLeft?this.getRight(c.sourceNode):this.getLeft(c.sourceNode);var h=this.isSourceTop?this.getTop(c.targetNode):this.getBottom(c.targetNode);if(f!=null&&h!=null){var a=h.y-f.y;var d=Math.min(Math.abs(a),20);var b=h.x-f.x;var e=Math.min(Math.abs(b),20);this.chamferCurveVOneBase(f,h,b,a,e,d,g);}},chamferCurveHOneBase:function(k,f,d,c,h,g,j){var e=this.paper.path("M"+(k.x-this.mX)+" "+(k.y-this.mY)+"L"+(k.x-this.mX)+" "+(f.y+(c<0?g:-g)-this.mY));e.attr({"stroke-width":"2"});var m=0;if(c*d<0){m=1;}var a=e.paper.path("M"+(k.x-this.mX)+" "+(f.y+(c<0?g:-g)-this.mY)+"A"+h+" "+g+" 0 0"+" "+m+" "+(k.x-this.mX+(d<0?-h:h))+" "+(f.y-this.mY));a.attr({"stroke-width":"2"});var n=a.paper.path("M"+(k.x+h-this.mX)+" "+(f.y-this.mY)+"L"+(f.x-this.mX)+" "+f.y-this.mY);n.attr({"arrow-end":"classic-wide-long"});n.attr({"stroke-width":"2"});if(this.isTransPathLine(j)){e.attr({"stroke":"red"});a.attr({"stroke":"red"});n.attr({"stroke":"red"});}switch(j.tagName){case"association":e.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});n.attr({"stroke-dasharray":"- "});break;case"exception-flow":var l=e.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(l.x-8.5-this.mX),(l.y-8.5-this.mY),17,17);break;}},chamferCurveHOne:function(g){var c=this.stNode(g);this.brokenLine(c.sourceNode,c.targetNode);var f=this.isSourceTop?this.getBottom(c.sourceNode):this.getTop(c.sourceNode);var h=this.isSourceLeft?this.getLeft(c.targetNode):this.getRight(c.targetNode);if(f!=null&&h!=null){var a=h.y-f.y;var d=Math.min(Math.abs(a),20);var b=h.x-f.x;var e=Math.min(Math.abs(b),20);this.chamferCurveHOneBase(f,h,b,a,e,d,g);}},steaightLineBase:function(d,f,e){var b=this.paper.path("M"+(d.x-this.mX)+" "+(d.y-this.mY)+"L"+(f.x-this.mX)+" "+(f.y-this.mY));b.attr({"arrow-end":"classic-wide-long"});b.attr({"stroke-width":"2"});if(this.isTransPathLine(e)){b.attr({"stroke":"red"});}switch(e.tagName){case"association":b.attr({"stroke-dasharray":"- "});break;case"exception-flow":var a=b.getPointAtLength(8.5);var c=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(a.x-8.5),(a.y-8.5),17,17);break;}},createSteaightLine:function(e){var a=this.stNode(e);var b=this.elements[a.sourceNodeKey];var c=this.elements[a.targetNodeKey];var d=this.getSourcePoint(b,a.targetNode,a.sourceNode);var f=this.getTargrtPoint(c,a.targetNode,a.sourceNode);if(d!=null&&f!=null){this.steaightLineBase(d,f,e);}},getCenter:function(c){var b=this.elements[c.key].type;var a={};if(b=="circle"){a.x=c.x+this.circle_R;a.y=c.y+this.circle_R;}if(b=="rect"){a.x=c.x+c.width/2;a.y=c.y+c.height/2;}if(b=="set"){a.x=c.x+25;a.y=c.y+25;}return a;},getTop:function(b){var a=this.elements[b.key].type;var c={};if(a=="circle"){c.x=b.x+this.circle_R;c.y=b.y;}if(a=="rect"){c.x=b.x+b.width/2;c.y=b.y;}if(a=="set"){c.x=b.x+25;c.y=b.y;}return c;},getBottom:function(c){var b=this.elements[c.key].type;var a={};if(b=="circle"){a.x=c.x+this.circle_R;a.y=c.y+2*this.circle_R;}if(b=="rect"){a.x=c.x+c.width/2;a.y=c.y+c.height;}if(b=="set"){a.x=c.x+25;a.y=c.y+50;}return a;},getLeft:function(b){var a=this.elements[b.key].type;var c={};if(a=="circle"){c.x=b.x;c.y=b.y+this.circle_R;}if(a=="rect"){c.x=b.x;c.y=b.y+b.height/2;}if(a=="set"){c.x=b.x;c.y=b.y+25;}return c;},getRight:function(c){var b=this.elements[c.key].type;var a={};if(b=="circle"){a.x=c.x+2*this.circle_R;a.y=c.y+this.circle_R;}if(b=="rect"){a.x=c.x+c.width;a.y=c.y+c.height/2;}if(b=="set"){a.x=c.x+50;a.y=c.y+25;}return a;},getSourcePoint:function(a,d,b){if(a.type=="circle"){var c=this.getCircleLineIntersectPoint(b,d);return c;}if(a.type=="rect"){var c=this.getRectLineIntersectPoint(b,d);return c;}if(a.type=="set"){var c=this.getDiamondLineIntersectPoint(b,d);return c;}return null;},getTargrtPoint:function(b,c,a){if(b.type=="circle"){var d=this.getCircleLineIntersectPoint(c,a);return d;}if(b.type=="rect"){var d=this.getRectLineIntersectPoint(c,a);return d;}if(b.type=="set"){var d=this.getDiamondLineIntersectPoint(c,a);return d;}return null;},getCircleLineIntersectPoint:function(b,c){var e=this.getCenter(c).x-b.x-this.circle_R;var d=this.getCenter(c).y-b.y-this.circle_R;var j=(b.x+this.circle_R)-this.getCenter(c).x;var h=(b.y+this.circle_R)-this.getCenter(c).y;var a=Math.pow((j*j+h*h),0.5);if(a<this.circle_R){return;}var g=b.x+this.circle_R+e*this.circle_R/a;var f=b.y+this.circle_R+d*this.circle_R/a;return{x:g,y:f};},getRectLineIntersectPoint:function(f,h){var e={};var n=f.x;e.x=f.x+f.width/2;e.y=f.y+f.height/2;var m={},l={},k={},j={};m.x=f.x;m.y=f.y;l.x=f.x+f.width;l.y=f.y;k.x=f.x+f.width;k.y=f.y+f.height;j.x=f.x;j.y=f.y+f.height;var g=this.getRectIntersectPoint(e,this.getCenter(h),m,l);if(g==null){g=this.getRectIntersectPoint(e,this.getCenter(h),l,k);}if(g==null){g=this.getRectIntersectPoint(e,this.getCenter(h),k,j);}if(g==null){g=this.getRectIntersectPoint(e,this.getCenter(h),j,m);}return g;},getDiamondLineIntersectPoint:function(g,h){var m={};m.x=g.x+25;m.y=g.y+25;var f={},e={},l={},k={};f.x=g.x;f.y=g.y+25;e.x=g.x+25;e.y=g.y+50;l.x=g.x+50;l.y=g.y+25;k.x=g.x+25;k.y=g.y;var j=this.getRectIntersectPoint(m,this.getCenter(h),f,e);if(j==null){j=this.getRectIntersectPoint(m,this.getCenter(h),e,l);}if(j==null){j=this.getRectIntersectPoint(m,this.getCenter(h),l,k);}if(j==null){j=this.getRectIntersectPoint(m,this.getCenter(h),k,f);}return j;},getRectIntersectPoint:function(m,k,g,f){var j=k.x-m.x;var d=k.y-m.y;var h=f.x-g.x;var c=f.y-g.y;var a=j*c-d*h;if(a==0){return null;}var b=((f.x-m.x)*d+(m.y-f.y)*j)/a;if(b>0||b<-1){return null;}var e={};e.x=f.x+h*b;e.y=f.y+c*b;if((e.x-m.x)*(e.x-k.x)>0){return null;}if((e.y-m.y)*(e.y-k.y)>0){return null;}return e;},createNode:function(c){var a=c.nodeType;switch(a){case BPMNodeType.BEGIN:case BPMNodeType.END:case BPMNodeType.JOIN:case BPMNodeType.DECISION:case BPMNodeType.FORK:case BPMNodeType.EXCLUSIVE_FORK:case BPMNodeType.COMPLEX_JOIN:case BPMNodeType.STATE:break;default:var b=this.getShowCaption(c.width,c.caption);if(b.length>0){c.caption=b;}break;}switch(a){case BPMNodeType.BEGIN:return this.createBeginNode(c);case BPMNodeType.END:return this.createEndNode(c);case BPMNodeType.BRANCH_END:return this.createBranchEndNode(c);case BPMNodeType.STATE:return this.createStateNode(c);case BPMNodeType.USER_TASK:return this.createUserTaskNode(c);case BPMNodeType.SERVICE_TASK:return this.createServiceTaskNode(c);case BPMNodeType.MANUAL_TASK:return this.createManualTaskNode(c);case BPMNodeType.AUDIT:return this.createAuditNode(c);case BPMNodeType.FORK:return this.createForkNode(c);case BPMNodeType.JOIN:return this.createJoinNode(c);case BPMNodeType.EXCLUSIVE_FORK:return this.createExclusiveForkNode(c);case BPMNodeType.COMPLEX_JOIN:return this.createComplexJoinNode(c);case BPMNodeType.DECISION:return this.createDecisionNode(c);case BPMNodeType.SUB_PROCESS:return this.createSubProcessNode(c);case BPMNodeType.INLINE:return this.createInlineNode(c);case BPMNodeType.DATAMAP:return this.createDataMapNode(c);case BPMNodeType.COUNTERSIGN:return this.createCounterSignNode(c);case BPMNodeType.STATE_ACTION:return this.createStateActionNode(c);default:return null;}},createBeginNode:function(c){var b=this.paper.circle((c.x-this.mX)+this.circle_R,c.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(c)){b.attr("stroke","red");}b.attr({"stroke-width":"2","fill":"white"});var d=b.paper.text((c.x-this.mX)+this.circle_R,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+d.node.clientHeight/2-this.mY;d.attr({"y":""+a});b.hover(function(f){b.attr({"cursor":"pointer"});},function(){});return b;},createEndNode:function(b){var c=this.paper.circle((b.x-this.mX)+this.circle_R,b.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(b)){c.attr("stroke","red");}c.attr({"stroke-width":"2"});c.attr({"fill":"white"});var e=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R-10);e.attr({"stroke-width":"0"});e.attr({"stroke":null});e.attr({"fill":"black"});var d=c.paper.text(b.x+this.circle_R-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+d.node.clientHeight/2-this.mY;d.attr({"y":""+a});c.hover(function(f){c.attr({"cursor":"pointer"});e.attr({"cursor":"pointer"});},function(){});return c;},createBranchEndNode:function(b){var a=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"5"});a.attr({"fill":"white"});var c=a.paper.text(b.x+this.circle_R-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(c);}a.hover(function(d){a.attr({"cursor":"pointer"});},function(){});return a;},createStateNode:function(b){var c=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(b)){c.attr("stroke","red");}c.attr({"stroke-width":"1"});c.attr({"fill":"white"});var e=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R-5);e.attr({"stroke-width":"2"});e.attr({"stroke":"black"});e.attr({"fill":"white"});var d=c.paper.text(b.x+this.circle_R-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+d.node.clientHeight/2-this.mY;d.attr({"y":""+a});c.hover(function(f){c.attr({"cursor":"pointer"});e.attr({"cursor":"pointer"});},function(){});return c;},createUserTaskNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/UserTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}$(a[0]).attr("key",b.key);$(c[0]).attr("key",b.key);$(d[0]).attr("key",b.key);a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createServiceTaskNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ServiceTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createManualTaskNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ManualTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createAuditNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/Audit-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}$(a[0]).attr("key",b.key);$(c[0]).attr("key",b.key);$(d[0]).attr("key",b.key);a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createDiamond:function(c){var b=this.paper.path("M"+(c.x-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25-this.mX)+" "+(c.y+2*25-this.mY));var a=this.paper.path("M"+(c.x+25-this.mX)+" "+(c.y+2*25-this.mY)+"L"+(c.x+2*25-this.mX)+" "+(c.y+25-this.mY));var f=this.paper.path("M"+(c.x+2*25-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25-this.mX)+" "+(c.y-this.mY));var d=this.paper.path("M"+(c.x+25-this.mX)+" "+(c.y-this.mY)+"L"+(c.x-this.mX)+" "+(c.y+25-this.mY));var e=this.paper.set();e.push(b,a,f,d);if(this.isLastNodeInPath(c)){b.attr("stroke","red");a.attr("stroke","red");f.attr("stroke","red");d.attr("stroke","red");e.attr("stroke","red");}e.attr({"stroke-width":"2"});e.attr({"type":"diamond"});e.attr({"fill":"white"});e.data({"diamond":"diamond"});return e;},createForkNode:function(c){var d=this.createDiamond(c);var b=this.paper.rect(c.x+7.5-this.mX,c.y+7.5-this.mY,35.4,35.4,0).transform("r45");b.attr({"fill":"white"});if(this.isLastNodeInPath(c)){b.attr("stroke","red");}d.paper.path("M"+(c.x+25-15-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25+15-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25+5-this.mX)+" "+(c.y+25+10-this.mY)+"L"+(c.x+25-6-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25+5-this.mX)+" "+(c.y+25-10-this.mY)+"L"+(c.x+25-6-this.mX)+" "+(c.y+25-this.mY));var e=d.paper.text(c.x+25-this.mX,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(e);}var a=e.attr().y+15-this.mY;e.attr({"y":""+a});b.hover(function(){b.attr({"cursor":"pointer"});},function(){});return d;},createJoinNode:function(c){var d=this.createDiamond(c);var b=this.paper.rect(c.x+7.5-this.mX,c.y+7.5-this.mY,35.4,35.4,0).transform("r45");if(this.isLastNodeInPath(c)){b.attr("stroke","red");}b.attr({"fill":"white"});d.paper.path("M"+(c.x+25-15-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25+15-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25+10-this.mY)+"L"+(c.x+25+6-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25-10-this.mY)+"L"+(c.x+25+6-this.mX)+" "+(c.y+25-this.mY));var e=d.paper.text(c.x+25-this.mX,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(e);}var a=e.attr().y+15-this.mY;e.attr({"y":""+a});b.hover(function(){b.attr({"cursor":"pointer"});},function(){});return d;},createExclusiveForkNode:function(b){var d=this.createDiamond(b);var e=this.paper.rect(b.x+7.5-this.mX,b.y+7.5-this.mY,35.4,35.4,0).transform("r45");if(this.isLastNodeInPath(b)){e.attr("stroke","red");}e.attr({"fill":"white"});d.paper.path("M"+(b.x+25-5-this.mX)+" "+(b.y+25-5-this.mY)+"L"+(b.x+25+5-this.mX)+" "+(b.y+25+5-this.mY));d.paper.path("M"+(b.x+25-5-this.mX)+" "+(b.y+25+5-this.mY)+"L"+(b.x+25+5-this.mX)+" "+(b.y+25-5-this.mY));var c=d.paper.text(b.x+25-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(c);}var a=c.attr().y+15-this.mY;c.attr({"y":""+a});e.hover(function(){e.attr({"cursor":"pointer"});},function(){});return d;},createComplexJoinNode:function(c){var b=this.createDiamond(c);var e=this.paper.rect(c.x+7.5-this.mX,c.y+7.5-this.mY,35.4,35.4,0).transform("r45");e.attr({"fill":"white"});if(this.isLastNodeInPath(c)){e.attr("stroke","red");}b.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25-5-this.mY)+"L"+(c.x+25+5-this.mX)+" "+(c.y+25+5-this.mY));b.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25+5-this.mY)+"L"+(c.x+25+5-this.mX)+" "+(c.y+25-5-this.mY));b.paper.path("M"+(c.x+25-7-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25+7-this.mX)+" "+(c.y+25-this.mY));b.paper.path("M"+(c.x+25-this.mX)+" "+(c.y+25-7-this.mY)+"L"+(c.x+25-this.mX)+" "+(c.y+25+7-this.mY));var d=b.paper.text(c.x+25-this.mX,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+15-this.mY;d.attr({"y":""+a});e.hover(function(){e.attr({"cursor":"pointer"});},function(){});return b;},createDecisionNode:function(d){var c=this.createDiamond(d);var b=this.paper.rect(d.x+7.5-this.mX,d.y+7.5-this.mY,35.4,35.4,0).transform("r45");b.attr({"fill":"white"});if(this.isLastNodeInPath(d)){b.attr("stroke","red");}var e=c.paper.text(d.x+25-this.mX,d.y+25-this.mY,"?");e.attr("font-size","25px");if(this.isIE()){this.textFormat(e);}var f=c.paper.text(d.x+25-this.mX,d.y+d.height,d.caption);if(this.isIE()){this.textFormat(f);}var a=f.attr().y+15-this.mY;f.attr({"y":""+a});b.hover(function(){b.attr({"cursor":"pointer"});e.attr({"cursor":"pointer"});},function(){});return c;},createSubProcessNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/SubProcess-icon.png",b.x+b.width/2-10-this.mX,b.y+b.height-18-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createInlineNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/Inline-icon.png",b.x+b.width/2-10-this.mX,b.y+b.height-18-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createDataMapNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/DataMap-icon.png",b.x+b.width/2-10-this.mX,b.y+b.height-18-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}$(a[0]).attr("key",b.key);$(c[0]).attr("key",b.key);$(d[0]).attr("key",b.key);a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createCounterSignNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/UserTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createStateActionNode:function(a){var c=this.paper.rect(a.x-this.mX,a.y-this.mY,a.width,a.height,10);if(this.isLastNodeInPath(a)){c.attr("stroke","red");}c.attr({"stroke-width":"2"});c.attr({"fill":"white"});var b=c.paper.text(a.x-this.mX+a.width/2,a.y+a.height/2-this.mY,a.caption);if(this.isIE()){this.textFormat(b);}c.hover(function(d){c.attr({"cursor":"pointer"});b.attr({"cursor":"pointer"});},function(){});return c;},getShowCaption:function(e,b){var f=12,h=$.ygrid.getTextWidth(b,f),d="",g="";if(h>e){for(var c=0;c<b.length;c++){g=g+b.substr(c,1);var a=$.ygrid.getTextWidth(g,f);if(a>=e){g=g.substring(0,g.length-1);g+="\n";d+=g;g="";c--;}}d+=g;}return d;},brokenLine:function(b,d){var c=this.getCenter(b);var a=this.getCenter(d);this.isSourceLeft=c.x<=a.x;this.isSourceTop=c.y<=a.y;},stNode:function(b){var a={sourceNodeKey:b.source,targetNodeKey:b.target,sourceNode:this.nodeElements[b.source],targetNode:this.nodeElements[b.target]};return a;}});YIUI.reg("bpmgraph",YIUI.Control.BPMGraph);var BPMNodeType=(function(){var a={BEGIN:0,END:1,USER_TASK:2,AUDIT:3,COUNTERSIGN:4,DECISION:5,SUB_PROCESS:6,FORK:7,JOIN:8,EVENT:9,STATE:10,TIMER:11,INLINE:12,DATAMAP:13,COMPLEX_JOIN:14,MANUAL_TASK:15,EXCLUSIVE_FORK:16,SERVICE_TASK:17,BRANCH_END:18,STATE_ACTION:19};return a;})();var BPMLineType=(function(){var a={STEAIGHT_LINE:0,FILLET_CURVE_H_ONE:1,FILLET_CURVE_V_ONE:2,FILLET_CURVE_H_TWO:3,FILLET_CURVE_V_TWO:4,CHAMFER_CURVE_H_ONE:5,CHAMFER_CURVE_V_ONE:6,CHAMFER_CURVE_H_TWO:7,CHAMFER_CURVE_V_TWO:8,OBKIQUE_CURVE_H_TWO:9,OBKIQUE_CURVE_V_TWO:10};return a;})();YIUI.Control.Custom=YIUI.extend(YIUI.Control,{autoEl:"<div/>",height:"100%",onSetHeight:function(a){this.el.css("height",a);this.custom.setHeight(a);},onSetWidth:function(a){this.el.css("width",a);this.custom.setWidth(a);},afterRender:function(b){this.base(b);var c;switch(this.tag){case YIUI.Custom_tag.UserInfoPane:c=YIUI.CUSTOMVIEW.USERINFOPANE;break;case YIUI.Custom_tag.RoleRights:case YIUI.Custom_tag.OperatorRights:var a={el:this.el,container:this.container,tag:this.tag,width:this.el.width(),height:this.el.height(),key:this.key,objType:YIUI.Rights_objType[this.tag],formKey:YIUI.FormStack.getForm(this.ofFormID).formKey};c=YIUI.CUSTOM_ROLERIGHTS(a);break;default:c="";}this.custom=c;this.el.append(c.el);}});YIUI.reg("custom",YIUI.Control.Custom);YIUI.CUSTOMVIEW={};(function(c){var e=function(){self._dropdownItems.slideDown("fast");self._dropdownItems.slideDown("fast");self._dropdownItems.css({width:self.el.width()+"px",height:self.el.height()+"px"});c(document).on("mousedown",function(g){var f=c(g.target);if((f.closest(self._dropdownItems).length==0)&&(f.closest(self.buttonLeft).length==0)&&(f.closest(self.buttonRight).length==0)){self.hideDropdownList();c(document).off("mousedown");}self.el.removeClass("datepicker_btnClick");});self._hasShow=true;event.stopPropagation();};var a=function(){c.cookie("JSESSIONID",null);c.cookie("usercode",null);location.href="http://localhost:8089/yes";};var b=function(){c("#form").remove();c.cookie("JSESSIONID",null);c.cookie("usercode",null);};var d="<div class='btn-group'> "+"<button data-toggle='dropdown' class='btn btn-default dropdown-toggle' onclick='dropdown()'>系统管理员<span class='caret'></span></button>"+"<ul class='dropdown-menu'>"+"<li><a class='logout' onclick='logout()'>注销</a></li>"+"<li><a class='exit' onclick='exit()'>退出</a></li>"+"</ul>"+"</div>";YIUI.CUSTOMVIEW.USERINFOPANE=d;}(jQuery));(function(a){YIUI.CUSTOM_ROLERIGHTS=function(ac){var ag={height:"100%",width:"100%",maxRows:50,pageIndicatorCount:3};ac=a.extend(ag,ac);var l=function(aL,aK){var aH=aL.length;if(aH>0){for(var aJ=0,aH=aL.length;aJ<aH;aJ++){if(aK){aL[aJ].pid=aK;}aL[aJ].previd=aL[aJ].previd;aL[aJ].id=aL[aJ].OID||aL[aJ].oid||aL[aJ].key.trim();var aI=aL[aJ].id;if(a.isString(aI)){aI=aI.replace(/\//g,"_");aL[aJ].id=aI;}if(aL[aJ].items&&aL[aJ].items.length>0){aL[aJ].hasChild=true;l(aL[aJ].items,aL[aJ].id);}else{if(aL[aJ].nodeType==1){aL[aJ].hasChild=true;}}}}};var j=function(aH,aK,aI){var aJ=aK.rows,aL=aK.cols;l(aJ,aI);return P(aJ,aL,aH);};var P=function(aQ,aN,aP){var aJ="";var aK=aQ.length;if(aK>0){aP.next("label.empty").remove();for(var aI=0;aI<aK;aI++){var aM=z(aP,aQ[aI],aN);aJ+=aM[0].outerHTML;var aL=aQ[aI].items;var aH="";if(aL&&aL.length>0){aJ+=P(aL,aN,aP);}}}else{var aO=a("<label class='empty'>表中无内容</label>");aP.after(aO);}return aJ;};var z=function(aO,aP,aM){var aL=a('<tr id="'+aP.id+'"></tr>').attr("oid",aP.OID).attr("key",aP.key);if(ac.type==YIUI.Rights_type.TYPE_DICT){if(aP.hasRights&&!aP.changed){ac.dictRts.push(aP.id);var aQ=aP.hasRights==0?false:true;aL.attr("hasRts",aQ);}}else{if(ac.isFFData){if(!aP.visible){ac.visibleRts.push(aP.key);}if(!aP.enable){ac.enableRts.push(aP.key);}}else{if(ac.isFOData){if(aP.hasRights){ac.optRts.push(aP.key);}}}}if(aP.pid!=undefined){aL.attr("pId",aP.pid);}if(aP.previd!=undefined){aL.attr("previd",aP.previd);}if(aP.hasChild){aL.attr("hasChild",true);}if(aP.secondaryType){aL.attr("secondaryType",aP.secondaryType);}var aN,aJ=false;for(var aI=0,aK=aM.length;aI<aK;aI++){aN=aP[aM[aI].key];if(aM[aI].type=="checkbox"){var aH;if(aM[aI].isEntry){aH=a("<span class='checkbox state0' chkstate='0'/>");}else{aH=a("<input type='checkbox' value="+aN+" class='checkbox' />").attr("disabled","disabled");if(aN){aH.attr("checked",true);}else{if(aN==undefined){aH.addClass("ignore");}}}if(aM[aI].key=="enable"&&aP.disable){aH.attr("enable","false");}if(aM[aI].index){aH.attr("index",aM[aI].index);}a("<td></td>").append(aH).appendTo(aL);if(aM[aI].showText){aH.after(aN);}}else{a("<td><span>"+aN+"</span></td>").appendTo(aL);}}return aL;};var aj=function(aJ,aO,aX){if(aX.length==0){return null;}aJ.empty();var aV=aX.cols;var aW=a('<table cellpadding="0" cellspacing="0"></table>').appendTo(aJ);aW.attr("enable",true);var aS=a("<thead></thead>").appendTo(aW);a("<tbody></tbody>").appendTo(aW);var aU=a("<tr ></tr>").appendTo(aS),aK,aM,aQ,aH;aU.addClass("title");for(aM=0,aQ=aV.length;aM<aV.length;aM++){aK=aV[aM];if(aK.type=="checkbox"&&!aK.hide){var aL=a("<input type='checkbox' class='checkbox all' disabled='disabled'/>");if(aV[aM].index){aL.attr("index",aK.index);}a("<th>"+aK.caption+"</th>").prepend(aL).appendTo(aU);}else{a("<th>"+aK.caption+"</th>").appendTo(aU);}}var aN=j(aW,aX);a("tbody",aW).append(a(aN));aO=a.extend({expandable:true},aO);aW=aW.treetable(aO);var aP=a("thead tr.title .checkbox",aW),aR;var aI=a("tr:not([class~='title'])",aW);for(var aM=0,aQ=aP.length;aM<aQ;aM++){var aT=ac.type;switch(aT){case YIUI.Rights_type.TYPE_DICT:if(aX.hasAllRights){aP.eq(aM).prop("checked",true);}break;case YIUI.Rights_type.TYPE_FORM:if((aX.allOptRights)||(aM==0&&aX.allVisibleRights)||(aM==1&&aX.allEnableRights)){aP.eq(aM).prop("checked",true);}break;}}return aW;};var af=function(aI){var aJ={};aJ.service="SetRightsService";aJ=a.extend(aJ,aI);var aH=null;var aK=function(aL){if(aL){if(aL.length>0){aH={rows:aL,cols:[{key:"Code",caption:"代码"},{key:"Name",caption:"名称"}]};}else{aH=aL;}}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,aJ,aK);return aH;};var e=ac.el||a("<div/>");var A=e.addClass("roleRights");A.css({height:"100%",width:"100%"});var an=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var S=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var aa=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var Y=new YIUI.Panel.GridLayoutPanel({widths:["99%",50],minWidths:["-1","-1"],heights:[25],height:30,metaObj:{columnGap:3},items:[an,S]});var V=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[Y,aa]});var X=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%"});var v=new YIUI.Panel.SplitPanel({height:ac.height||"100%",width:ac.width||"100%",metaObj:{orientation:"horizontal"},splitSizes:[{size:"25%"},{size:"75%"}],items:[V,X]});v.el=A;v.render();var W=function(aK,aI){var aH=false;if(aK.hasClass("title")){aH=true;}var aJ=a("tr.sel",aI);if(aJ.length>0){if(aJ.attr("id")==aK.attr("id")){aH=true;}aJ.removeClass("sel");aK.addClass("sel");}else{aK.addClass("sel");}return aH;};var ao=function(aN,aH,aO){var aP=aO.treeNode.tree;var aI=aP[aN];var aM=aI.parentId;if(aM){var aL=0;for(var aJ=0,aK=aH.length;aJ<aK;aJ++){if(aH[aJ]==aM){aL=aJ;}}if(aL>0){aH.splice(aL,0,aN);}else{aH.push(aN);}}else{aH.push(aN);}};var aq={theme:"default",expandLevel:1,onSelect:function(aQ,aZ){if(aQ.attr("enable")=="true"){var aV=W(aZ,aQ);if(aV){return;}w.setEnable(true);p.setEnable(true);ac.id=aZ.attr("id");d&&d.removeAll();ad&&ad.removeAll();aC&&aC.removeAll();var aL={cmd:"LoadEntryRightsData",operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var a0=af(aL);a(".checkbox").removeClass("state0").removeClass("state1").removeClass("state2").addClass("state0");a(".checkbox").attr("chkstate",0);aQ.allRights=a0.allRights;if(a0.allRights){a(".checkbox",aG).removeClass("state0").addClass("state1");a(".title .checkbox",aG).prop("checked",true);var aR=a("tbody tr",aG);if(!aG.entryKeys){aG.entryKeys=[];}for(var aW=0,aX=aR.length;aW<aX;aW++){var a1=aR.eq(aW).attr("key");aG.entryKeys.push(a1);}}else{a(".title .checkbox",aG).prop("checked",false);var aY=a0.entryKeys,aU;aG.entryKeys=aY;var aP=[];for(var aW=0,aX=aY.length;aW<aX;aW++){aU=aY[aW];var aS=aU.replace(/\//g,"_");var aH=a("[id='"+aS+"']",aG);var aN=a(".checkbox",aH);var aM=1;aN.removeClass("state0");if(aH.attr("hasChild")=="true"){ao(aS,aP,aG);}else{aN.addClass("state1");aN.attr("chkstate",1);}}for(var aW=0,aX=aP.length;aW<aX;aW++){var aT=aP[aW];var aO=a("[id='"+aP[aW]+"']",aG);var aK=a("[pId='"+aT+"'] .checkbox",aG).hasClass("state0");var aJ=a("[pId='"+aT+"'] .checkbox",aG).hasClass("state1");var aI=a("[pId='"+aT+"'] .checkbox",aG).hasClass("state2");if(aK&&!aJ&&!aI){continue;}else{if(aJ&&!aK&&!aI){a(".checkbox",aO).addClass("state1");a(".checkbox",aO).attr("chkstate",1);}else{a(".checkbox",aO).addClass("state2");a(".checkbox",aO).attr("chkstate",2);}}}}if(ac.clickTr&&(ac.clickTr.parents(".ui-pnl:eq(0)").attr("id")!=aZ.parents(".ui-pnl:eq(0)").attr("id"))){ac.clickTr.removeClass("sel");ac.clickTr.click();}else{ac.clickTr=aZ;}}}};var ak;var J=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%"});var w=new YIUI.Control.Button({value:"修改",metaObj:{x:0,y:0},listeners:null});var D=new YIUI.Control.Button({value:"保存",metaObj:{enable:false,x:1,y:0},listeners:null});var aE=new YIUI.Control.Button({value:"取消",metaObj:{enable:false,x:2,y:0},listeners:null});var N=new YIUI.Panel.GridLayoutPanel({widths:[50,50,50,"100%"],minWidths:["-1","-1","-1","-1"],heights:[25,5],metaObj:{columnGap:3},height:30,items:[w,D,aE]});var T=new YIUI.Panel.FlexFlowLayoutPanel({metaObj:{overflowX:"auto",overflowY:"auto"},height:"100%",width:"100%"});var B=new YIUI.Panel({height:"100%",metaObj:{title:"入口权限设置"},items:[T]});var aA=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var k=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var x=new YIUI.Panel.GridLayoutPanel({widths:["100%",50],minWidths:["-1","-1"],heights:[25,5],height:30,metaObj:{columnGap:3},items:[aA,k]});var H=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var ar=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var g=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var ae=new YIUI.Panel.GridLayoutPanel({key:"test",widths:["100%",50],minWidths:["-1","-1"],heights:[25,5],height:30,metaObj:{columnGap:3,visible:false},items:[ar,g]});var al=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var q=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[x,H]});var o=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[ae,al]});var C=new YIUI.Panel.SplitPanel({height:"100%",metaObj:{orientation:"horizontal"},splitSizes:[{size:"30%"},{size:"70%"}],items:[q,o]});var R=new YIUI.Panel({height:"100%",metaObj:{title:"字典权限设置"},items:[C]});var n=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var am=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var Z=new YIUI.Panel.GridLayoutPanel({widths:["100%",50],minWidths:["-1","-1"],heights:[25],metaObj:{columnGap:3},height:30,items:[n,am]});var ai=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var U=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[Z,ai]});var t=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var L=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var y=new YIUI.Panel.GridLayoutPanel({widths:["100%",50],minWidths:["-1","-1"],heights:[25],height:30,metaObj:{columnGap:3},items:[t,L]});var I=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var Q=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var aB=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{visible:false},items:[Q]});var au=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var at=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{visible:false},items:[au]});var m=new YIUI.Panel.SplitPanel({metaObj:{orientation:"horizontal"},splitSizes:[{size:"40%"},{size:"60%"}],items:[at,aB]});var az=new YIUI.Panel.SplitPanel({height:"100%",metaObj:{orientation:"horizontal"},splitSizes:[{size:"30%"},{size:"70%"}],items:[U,m]});var h=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{title:"表单权限设置"},items:[az]});var p=new YIUI.Panel.TabPanel({height:"100%",items:[B,R,h]});J.add(N);J.add(p);X.add(J);X.doRenderChildren(false,true);var r={theme:"default",expandLevel:1,onSelect:function(aQ,aM){if(aQ.attr("enable")=="true"){ac.type=YIUI.Rights_type.TYPE_ENTRY;if(aM.hasClass("title")){var aL=a(".checkbox",aM).is(":checked");aQ.allRights=aL;if(aL){a(".checkbox",aQ).removeClass("state2").removeClass("state0").addClass("state1");var aN=a("tbody tr",aQ);if(!aQ.entryKeys){aQ.entryKeys=[];}for(var aK=0,aO=aN.length;aK<aO;aK++){var aP=aN.eq(aK).attr("key");aQ.entryKeys.push(aP);}}else{a(".checkbox",aQ).removeClass("state1").addClass("state0");aG.entryKeys=[];}return;}if(!a(aQ.target).hasClass("checkbox")){return;}var aJ=aM.attr("id");var aH=a(".checkbox",aM).is(":checked");var aI=a(".checkbox",aM).attr("chkstate")==0?1:0;a(".checkbox",aM).attr("chkstate",aI);if(aI>0){a(".checkbox",aM).removeClass("state0").removeClass("state2").addClass("state1");}else{a(".checkbox",aM).removeClass("state1").removeClass("state2").addClass("state0");}aD(aJ,aI,aQ);f(aQ,aJ,aI);ah(aQ,aJ,aI);}}};var ab=function(aO,aM,aI){var aL=ac.type,aI;aI=aG;if((aM==0)&&aI.allRights){aI.allRights=false;}if(!aI.entryKeys){aI.entryKeys=[];}var aN=aI.entryKeys;if(aM>0){var aK=a("#"+aO,aI).attr("key");aN.push(aK);}else{a(".title .checkbox",aI).prop("checked",false);if(a("[id='"+aO+"'] .checkbox",aI).attr("chkstate")==2){return;}for(var aJ=0,aH=aN.length;aJ<aH;aJ++){if(aN[aJ].replace(/\//g,"_")==aO){aN.splice(aJ,1);break;}}}};var aw=function(aI,aH,aP){var aK=aP.treeNode.tree[aI];var aR=aK.row.attr("hasRts")==undefined?false:true;if(aH!=aR&&!aK.changed){aK.changed=true;}var aQ=ac.clickTr.attr("secondaryType")==5;if(!aQ){return;}var aM=ac.dict.addRts;var aJ=ac.dict.delRts;var aS=aP.dictRts;var aO=true;for(var aL=0,aN=aS.length;aL<aN;aL++){if(aS[aL]==aI){aO=false;break;}}if(aH){if(aO){aM.push(aI);}else{for(var aL=0,aN=aJ.length;aL<aN;aL++){if(aJ[aL]==aI){aJ.splice(aL,1);break;}}}}else{if(aO){for(var aL=0,aN=aM.length;aL<aN;aL++){if(aM[aL]==aI){aM.splice(aL,1);break;}}}else{aJ.push(aI);}}};var O=function(aI,aH,aQ,aJ){if(aJ){var aN=aJ.enable;var aL=aJ.visible;var aK=false;var aR=false;for(var aM=0,aO=aQ.enableRts.length;aM<aO;aM++){if(aQ.enableRts[aM]==aJ.id){aK=true;if(aN){aQ.enableRts.splice(aM,1);}break;}}if(!aK&&!aN){aQ.enableRts.push(aJ.id);aQ.hasAllEnableRights=false;}for(var aM=0,aO=aQ.visibleRts.length;aM<aO;aM++){if(aQ.visibleRts[aM]==aJ.id){aR=true;if(aL){aQ.visibleRts.splice(aM,1);}break;}}if(!aR&&!aL){aQ.visibleRts.push(aJ.id);aQ.hasAllVisibleRights=false;}}else{var aP=false;for(var aM=0,aO=aQ.optRts.length;aM<aO;aM++){if(aQ.optRts[aM]==aI){aP=true;if(!aH){aQ.optRts.splice(aM,1);}}}if(!aP&&aH){aQ.optRts.push(aI);aQ.hasAllOptRights=false;}}};var aD=function(aL,aI,aH,aK){var aJ=ac.type,aH;switch(aJ){case YIUI.Rights_type.TYPE_ENTRY:ab(aL,aI,aH);break;case YIUI.Rights_type.TYPE_DICT:aw(aL,aI,aH,aK);break;case YIUI.Rights_type.TYPE_FORM:O(aL,aI,aH,aK);break;}};var f=function(aU,aJ,aH,aQ){if(!aJ){return;}var aM=aU.treeNode.tree[aJ],aT,aN,aR;var aL=aM.children,aK;if(!aL||aL.length==0){return;}for(var aO=0,aP=aL.length;aO<aP;aO++){aK=aL[aO];var aS=a("[id='"+aK.id+"']",aU);aN=a(".checkbox:not([index])",aS);if(ac.isField){if(aQ>0){aN=a(".checkbox[index='"+aQ+"']",aS);}aR=aN.parents("tr").eq(0);var aI={id:aR.attr("id")};if(aQ==0){if(!aH){a(".checkbox",aR).eq(1).prop("checked",false);aI.enable=false;}aI.visible=aH;}if(aQ==1){if(aH){a(".checkbox",aR).eq(0).prop("checked",true);aI.visible=true;}aI.enable=aH;}if(aQ==0){aI.visible=aH;}else{if(aQ==1){aI.enable=aH;}}aD(aR.attr("id"),aH,aU,aI);}else{if(aN.attr("chkstate")>-1){if(aN.attr("chkstate")!=aH){aN.removeClass("state0").removeClass("state1").removeClass("state2").addClass("state"+aH).attr("chkstate",aH);}}aD(aK.id,aH,aU);}if(!aN.attr("chkstate")){aN.prop("checked",aH);}f(aU,aK.id,aH);}};var ah=function(aS,aJ,aH,aM){var aK=aS.treeNode.tree[aJ],aL;if(aK){var aO=aK.parentId;if(!aO){return;}var aQ=aS.treeNode.tree[aO];var aR=a("[id='"+aO+"']",aS);aL=a(".checkbox:not([index])",aR);if(aL.attr("chkstate")!=aH){var aN=a("[pid='"+aO+"']",A);if(a(".checkbox",aN).hasClass("state0")||a(".checkbox",aN).hasClass("state2")){if(!a(".checkbox",aN).hasClass("state1")&&!a(".checkbox",aN).hasClass("state2")){aL.removeClass("state1").removeClass("state2").addClass("state0").attr("chkstate",0);}else{aL.removeClass("state0").removeClass("state1").addClass("state2").attr("chkstate",2);}}else{if(!a(".checkbox",aN).hasClass("state2")){aL.removeClass("state2").addClass("state1").attr("chkstate",1);}}}if(ac.isField){if(aM>0){aL=a(".checkbox[index='"+aM+"']",aR);}var aP=aL.parents("tr").eq(0);var aI={id:aP.attr("id")};if(aM==0){if(!aH){}}if(aM==1){if(aH){a(".checkbox",aP).eq(0).prop("checked",true);aI.visible=true;}}if(aH){a(".checkbox",aP).eq(aM).prop("checked",true);}aI.enable=a(".checkbox",aP).eq(1).prop("checked");aI.visible=a(".checkbox",aP).eq(0).prop("checked");aD(aP.attr("id"),aH,aS,aI);}else{if(a.isNumeric(aH)&&aL.attr("chkstate")!=aH){aD(aO,aH,aS);}else{if(aH&&aL.prop("checked")!=aH){aL.prop("checked",true);aD(aO,aH,aS);}}}ah(aS,aO,aH);}};var aG=null;var K={theme:"default",expandLevel:1,onSelect:function(aQ,aK){if(aQ.attr("enable")=="true"){if(!ac.id){return;}var aO=W(aK,aQ);if(aO){return;}ac.clickTr=aK;d&&d.removeAll();ac.type=YIUI.Rights_type.TYPE_DICT;ac.itemKey=aK.attr("id");ac.dict={addRts:[],delRts:[],saveType:0,allRights:false};var aH=aK.attr("id");var aI=aH;var aU={cmd:"LoadDictRightsData",itemKey:aI,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aT=al.el;var aR=aK.attr("secondaryType")==5;if(aR){ae.setVisible(true);aU.cmd="LoadChainDictRightsData";aU.startRow=0;aU.maxRows=ac.maxRows;aU.pageIndicatorCount=ac.pageIndicatorCount;aU.value=a("input",ar.el).val();aT.empty();}else{ae.setVisible(false);}var aS=af(aU);if(!aS){return;}if(!o.visisble){o.setVisible(true);}if(aR){var aL=aS.totalRowCount;var aN=al.el.pagination({pageSize:50,totalNumber:aL,showPages:true,showPageDetail:false,showFirstButton:false,showLastButton:false,pageIndicatorCount:3});aT=aN.content;var aP=a(".paginationjs-pages",al.el).is(":hidden")?0:a(".paginationjs-pages",al.el).outerHeight();var aM=al.el.height()-aP;aN.content.css("height",aM);aN.pageChanges=function(aW){var aV=ay(aI,aW);d.removeAll();ac.dictRts=[];d=aj(aT,F,aV);d.dictRts=ac.dictRts;aN.setTotalRowCount(aW*50+aV.totalRowCount);if(!w.enable){a(".checkbox",d).removeAttr("disabled");}};ac.setTotalRowCount=function(aW,aV){aN.setTotalRowCount(aV);};}ac.dictRts=[];var aJ={rows:aS.data,cols:[{key:"code",caption:"编码"},{key:"name",caption:"名称"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],hasAllRights:aS.hasAllRights};ac.dict.allRights=aS.hasAllRights;d=aj(aT,F,aJ);d.dictRts=ac.dictRts;d.isChain=aR;}}};var s=null;var ay=function(aK,aJ){var aI={cmd:"LoadChainDictRightsData",itemKey:aK,startRow:aJ*ac.maxRows,maxRows:ac.maxRows,pageIndicatorCount:ac.pageIndicatorCount,value:a("input",ar.el).val(),operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aH=af(aI);var aI={rows:aH.data,cols:[{key:"code",caption:"编码"},{key:"name",caption:"名称"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],hasAllRights:aH.hasAllRights,totalRowCount:aH.totalRowCount};return aI;};var F={theme:"default",expandLevel:1,beforeExpand:function(aI){var aH=aI.attr("id");var aO=aI.attr("expanded");if(aO){return;}var aL={cmd:"LoadDictRightsData",itemKey:ac.itemKey,parentID:aH,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aV=af(aL);var aU=aV.data;var aT=d.treeNode.tree[aH];var aK=aT.changed;var aQ=false;var aL={rows:aU,cols:[{key:"code",caption:"编码"},{key:"name",caption:"名称"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],hasAllRights:aV.hasAllRights};var aM=j(d,aL,aH);d.addChilds(aM);aI.attr("expanded","expanded");if(!w.enable){a(".checkbox",d).removeAttr("disabled");}if(aK){aQ=a(".checkbox",aI).is(":checked");if(aU.length>0){for(var aJ=0,aN=aU.length;aJ<aN;aJ++){var aS=aU[aJ].oid;var aP=d.treeNode.tree[aS];var aR=aU[aJ].hasRights==0?false:true;if(aR!=aQ){aP.changed=true;if(aQ){a(".checkbox",aP.row).prop("checked",true);ac.dict.addRts.push(aS);}else{a(".checkbox",aP.row).prop("checked",false);ac.dict.delRts.push(aS);}}}}}},onSelect:function(aH,aJ){if(!aH.target.hasClass("checkbox")){return;}av(aH);var aI=a(".checkbox",aJ).is(":checked");if(!aI&&ac.dict.allRights){ac.dict.allRights=false;ac.dict.saveType=1;}}};var d=null;var aF={theme:"default",expandLevel:1,onSelect:function(aP,aK){if(aP.attr("enable")=="true"){if(!ac.id){return;}var aM=W(aK,aP);if(aM){return;}ac.clickTr=aK;if(!aB.visible){aB.setVisible(true);}if(!at.visible){at.setVisible(true);}ad&&ad.removeAll();aC&&aC.removeAll();ac.type=YIUI.Rights_type.TYPE_FORM;ac.formKey=aK.attr("id");var aH=aK.attr("id");var aO=aH;var aI={cmd:"LoadFormRightsData",formKey:aO,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aL=af(aI);if(aL.fieldData){var aN={rows:aL.fieldData,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"标识"},{key:"visible",caption:"是否可见",type:"checkbox",index:0},{key:"enable",caption:"是否可编辑",type:"checkbox",index:1}],allEnableRights:aL.hasAllEnableRights,allVisibleRights:aL.hasAllVisibleRights};ac.isFFData=true;ac.visibleRts=[];ac.enableRts=[];ad=aj(Q.el,ax,aN);ad.hasAllEnableRights=aL.hasAllEnableRights;ad.hasAllVisibleRights=aL.hasAllVisibleRights;ad.enableRts=ac.enableRts;ad.visibleRts=ac.visibleRts;ac.isFFData=false;}if(aL.optData){var aJ={rows:aL.optData,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"标识"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],allOptRights:aL.hasAllOptRights};ac.isFOData=true;ac.optRts=[];aC=aj(au.el,u,aJ);aC.optRts=ac.optRts;aC.hasAllOptRights=aL.hasAllOptRights;ac.isFOData=false;}}}};var ap=null;var ax={theme:"default",expandLevel:1,onSelect:function(aI,aJ){if(aI.attr("enable")=="true"){if(!aI.target.hasClass("checkbox")){return;}ac.isField=true;var aK=aI.target;var aH=aK.attr("index")||0;E(aI,aH);ac.isField=false;}}};var ad=null;var u={theme:"default",expandLevel:1,onSelect:function(aH,aI){if(aH.attr("enable")=="true"){if(!aH.target.hasClass("checkbox")){return;}av(aH);}}};var aC=null;var av=function(aT){var aO=aT.target;var aU=a("tr.title .checkbox",aT),aJ,aK;var aS=aO.is(":checked");var aH=a("tr:not([class~='title'])",aT);if(aO.parents("tr").hasClass("title")){for(var aL=0,aN=aH.length;aL<aN;aL++){aJ=a(".checkbox",aH.eq(aL));if(aJ.attr("enable")=="false"){continue;}aJ.prop("checked",aS);var aQ=aJ.parents("tr").eq(0);aD(aQ.attr("id"),aS,aT);}var aP=ac.type;switch(aP){case YIUI.Rights_type.TYPE_DICT:if(aS){ac.dict.allRights=true;ac.dict.saveType=1;}else{ac.dict.allRights=false;ac.dict.saveType=-1;}break;case YIUI.Rights_type.TYPE_FORM:if(aS){aT.allOptRights=true;}else{aT.allOptRights=false;}break;}}else{var aQ=aO.parents("tr").eq(0);var aM=aQ.attr("pid");aD(aQ.attr("id"),aS,aT);f(aT,aQ.attr("id"),aS);ah(aT,aQ.attr("id"),aS);var aR=true;var aI=a(".checkbox:not([enable='false'])",aH);for(var aL=0,aN=aI.length;aL<aN;aL++){var aV=aI.eq(aL).is(":checked");if(!aV){aR=false;}}if(!aR){a(".checkbox",a("tr[class~='title']",aT)).prop("checked",false);if(aT.allOptRights){aT.allOptRights=false;}}}};var E=function(aS,aP){var aZ=aS.target;var aJ=a("tr.title .checkbox",aS),aO,aX;var aQ=aZ.is(":checked");if(!aP){aP=0;aS.hasAllVisibleRights=aQ;if(!aQ){a(".checkbox",aZ.parents("tr")).eq(1).prop("checked",false);aS.hasAllEnableRights=false;}}else{aS.hasAllEnableRights=aQ;if(aQ){a(".checkbox",aZ.parents("tr")).eq(0).prop("checked",true);aS.hasAllEnableRights=true;}}var aY=a("tr:not([class~='title'])",aS);if(aZ.parents("tr").hasClass("title")){for(var aV=0,aW=aY.length;aV<aW;aV++){var a0=aY.eq(aV);aO=a(".checkbox:not([class~='ignore'])",a0).eq(aP);if(aO.length==0||aO.attr("enable")=="false"){continue;}aO.prop("checked",aQ);var aH=aO.parents("tr").eq(0);var aI={id:aH.attr("id")};if(aP==0){if(!aQ){a(".checkbox",aH).eq(1).prop("checked",false);}aI.enable=a(".checkbox",aH).eq(1).prop("checked");aI.visible=aQ;}if(aP==1){if(aQ){a(".checkbox",aH).eq(0).prop("checked",true);}aI.visible=a(".checkbox",aH).eq(0).prop("checked");aI.enable=aQ;}aD(aH.attr("id"),aQ,aS,aI);}}else{var aH=aZ.parents("tr").eq(0);var aI={id:aH.attr("id")};if(aP==0){if(!aQ){a(".checkbox",aH).eq(1).prop("checked",false);}aI.enable=a(".checkbox",aH).eq(1).prop("checked");aI.visible=aQ;}if(aP==1){if(aQ){a(".checkbox",aH).eq(0).prop("checked",true);}aI.visible=a(".checkbox",aH).eq(0).prop("checked");aI.enable=aQ;}var aT=aH.attr("pid");aD(aH.attr("id"),aQ,aS,aI);f(aS,aH.attr("id"),aQ,aP);ah(aS,aH.attr("id"),aQ,aP);var aN=a("thead tr.title .checkbox",aS),aM;var aY=a("tr:not([class~='title'])",aS);for(var aV=0,aW=aN.length;aV<aW;aV++){var aR=true;if(aV!=0){aM=a(".checkbox[index='"+aV+"'].checkbox:not([enable='false']):not([class ~='ignore'])",aY);}else{aM=a(".checkbox:not([index]):not([enable='false']):not([class ~='ignore'])",aY);}var aL=aM.length;if(aL==0){aN.eq(aV).attr("enable","false");break;}for(var aU=0;aU<aL;aU++){var aK=aM.eq(aU).is(":checked");if(!aK){aR=false;}}if(!aR){aN.eq(aV).prop("checked",false);if(aV==0){aS.hasAllEnableRights=aR;}else{aS.hasAllVisibleRights=aR;}}}}};var G=function(aH){for(var aI=0;aI<aH.data.length;aI++){if(aH.data[aI].OID==21||aH.data[aI].OID==11||aH.data[aI].OID==a.cookie("userID")){aH.data.splice(aI,1);aI--;}}var aJ={rows:aH.data,cols:[{key:"Code",caption:"代码"},{key:"Name",caption:"名称"}],totalRowCount:aH.totalRowCount};return aJ;};var c=function(aL,aN){var aM=ac.maxRows;var aJ=ac.pageIndicatorCount;var aK=a("input",an.el).val();var aO=true;var aH="Role";if(ac.tag==YIUI.Custom_tag.OperatorRights){aH="Operator";}var aQ={service:"DictService",cmd:"GetQueryData",itemKey:aH,startRow:aL*aM,maxRows:aM,pageIndicatorCount:aJ,value:aK};var aP=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,aQ,aN);if(!aN){var aI=G(aP);return aI;}};var M=function(aI,aJ){var aH=c(aI);ak.removeAll();ac.dictRts=[];ak=aj(ac.userPage.content,aq,aH);ac.userPage.setTotalRowCount(aI*ac.maxRows+aH.totalRowCount,aJ);if(!w.enable){a(".checkbox",ak).removeAttr("disabled");}};var b={el:A,setHeight:function(aH){v.setHeight(aH);v.doLayout(this.el.width(),aH);var aJ=a(".paginationjs-pages",al.el).is(":hidden")?0:a(".paginationjs-pages",al.el).outerHeight();var aI=al.el.height()-aJ;a(".paginationjs-content",al.el).css("height",aI);var aJ=a(".paginationjs-pages",aa.el).is(":hidden")?0:a(".paginationjs-pages",aa.el).outerHeight();var aI=aa.el.height()-aJ;a(".paginationjs-content",aa.el).css("height",aI);},setWidth:function(aH){v.setWidth(aH);v.doLayout(aH,this.el.height());},init:function(){var aM=function(aT){var aR=aT.totalRowCount;var aS=G(aT);var aQ=ac.userPage=aa.el.pagination({pageSize:ac.maxRows,totalNumber:aR,showPages:true,showPageDetail:false,showFirstButton:false,showLastButton:false,pageIndicatorCount:ac.pageIndicatorCount});ak=aj(aQ.content,aq,aS);aQ.pageChanges=function(aU){M(aU,false);};};c(0,aM);var aP={cmd:"LoadSetRightsList",operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aI=af(aP);if(!aI){return;}var aJ=aI.entry;var aN={rows:aJ,cols:[{key:"caption",caption:"全选",type:"checkbox",showText:true,isEntry:true}]};aG=aj(T.el,r,aN);T.el.addClass("entryRts");var aO=aI.dict;var aH={rows:aO,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"代码"}]};s=aj(H.el,K,aH);var aK=aI.form;var aL={rows:aK,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"标志"}]};ap=aj(ai.el,aF,aL);aG.attr("enable",false);w.setEnable(false);p.setEnable(false);},install:function(){var aL=p;aL.el.children("ul").unbind();aL.el.children("ul").click(function(aN){var aO=a(aN.target);if(aO.hasClass("ui-anchor-label")||aO.hasClass("ui-tans-anchor")){if(aL.selectedTab&&aL.selectedTab.attr("aria-controls")!=aO.closest("li").attr("aria-controls")){if(!aL.enable){return false;}aO.closest("li").toggleClass("aria-selected");}var aM=aO.closest("li").attr("aria-controls");if(aL.selectedTab.attr("aria-controls")==aO.closest("li").attr("aria-controls")){aN.stopPropagation();return false;}else{aL.selectedTab.toggleClass("aria-selected");a("#"+aL.selectedTab.attr("aria-controls")).toggleClass("aria-show");}a("#"+aM).toggleClass("aria-show");aL.setActiveTab(aM);a("#"+aM).show();aL.layout.layout(aL.getWidth(),aL.getHeight());aL.selectedTab=aO.closest("li");}a(".tab-body .ui-corner-bottom",aL.el).css("display","none");a(".tab-body .ui-corner-bottom.aria-show ",aL.el).css("display","block");aN.stopPropagation();return false;});a("input[type='text']",A).unbind();a("button",A).unbind();w.el.click(function(aM){aG.attr("enable",true);ak.attr("enable",false);s.attr("enable",false);ap.attr("enable",false);w.setEnable(false);D.setEnable(true);aE.setEnable(true);V.setEnable(false);X.setEnable(true);p.setEnable(false);a(".checkbox:not([class~='ignore'])",A).removeAttr("disabled");});var aK=function(aN){var aP=a("[pId='"+aN.id+"'] .checkbox:checked",d).size();var aQ=false;var aR=aN.children;if(aP==aR.length){for(var aO=0,aM=aR.length;aO<aM;aO++){var aS=aR[aO];if(aS.children&&aS.children.length>0){aQ=aK(aS);}}}else{aQ=true;}return aQ;};var aJ=function(aV,aS,aN,aM){if(aV.length>0){for(var aP=0,aQ=aV.length;aP<aQ;aP++){var aT=aV[aP];var aW=aT.row;var aR=a(".checkbox",aW);var aU=aR.is(":checked");if(aT.changed){if(aT.children&&aT.children.length>0){var aO=aK(aT);if(!aO){aS.push(aT.id);}else{if(aU){aN.push(aT.id);}else{aM.push(aT.id);}aJ(aT.children,aS,aN,aM);}}else{if(aU){aS.push(aT.id);}else{aM.push(aT.id);}}}else{if(aT.children&&aT.children.length>0){aJ(aT.children,aS,aN,aM);}}}}};D.el.click(function(aP){var aU={key:ac.key,id:ac.id,type:ac.type,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aR=ac.type;switch(aR){case YIUI.Rights_type.TYPE_ENTRY:aU.rights=a.toJSON(aG.entryKeys);aU.allRights=aG.allRights;aU.cmd="SaveEntryRights";break;case YIUI.Rights_type.TYPE_DICT:aU.allRights=ac.dict.allRights;var aT=ac.clickTr.attr("secondaryType")==5;if(!aT){var aQ=[],aN=[],aM=[];var aS=d.treeNode.roots;aJ(aS,aQ,aN,aM);aU.halfCheckRights=a.toJSON(aN);aU.delRights=a.toJSON(aM);aU.addRights=a.toJSON(aQ);}else{aU.addRights=a.toJSON(ac.dict.addRts);aU.delRights=a.toJSON(ac.dict.delRts);}aU.saveType=ac.dict.saveType;aU.itemKey=ac.itemKey;aU.cmd="SaveDictRights";break;case YIUI.Rights_type.TYPE_FORM:aU.allOptRights=aC.allOptRights;aU.optRights=a.toJSON(aC.optRts);aU.allEnableRights=ad.hasAllEnableRights;aU.enableRights=a.toJSON(ad.enableRts);aU.allVisibleRights=ad.hasAllVisibleRights;aU.visibleRights=a.toJSON(ad.visibleRts);aU.formKey=ac.formKey;aU.cmd="SaveFormRights";break;}aH(aU);a(".checkbox[type='checkbox']",A).attr("disabled","disabled");aG.attr("enable",false);ak.attr("enable",true);s.attr("enable",true);ap.attr("enable",true);D.setEnable(false);w.setEnable(true);aE.setEnable(false);V.setEnable(true);X.setEnable(false);p.setEnable(true);if(ac.dict){ac.dict.saveType=0;}var aO=a(".checkbox:checked",A).parents("tr");});aE.el.click(function(aM){aG.attr("enable",false);ak.attr("enable",true);s.attr("enable",true);ap.attr("enable",true);aE.setEnable(false);D.setEnable(false);w.setEnable(true);V.setEnable(true);X.setEnable(false);p.setEnable(true);if(ac.dict){ac.dict.saveType=0;}a(".checkbox[type='checkbox']",A).attr("disabled","disabled");if(ac.clickTr){ac.clickTr.removeClass("sel");ac.clickTr.click();}});S.el.click(function(aM){M(0,true);});var aH=function(aN){var aO={};aO.service="SetRightsService";aO=a.extend(aO,aN);var aM=null;var aP=function(){};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,aO,aP);return aM;};var aI=function(a1,a2){if(a2.searchValue==a1){a2.searches++;}else{a2.searches=1;a2.searchValue=a1;}var aS=a("tr:gt(0)",a2),aX,aM,aQ,aW,aZ,a0=0,aU=true,aP,aO=false;var aN=a2.parent();for(var aV=0,aY=aS.length;aV<aY;aV++){aX=aS.eq(aV);aM=a("td",aX);aZ=false;for(var aT=0,aR=aM.length;aT<aR;aT++){aQ=aM.eq(aT);aW=aQ.text().toLowerCase();if(aW.indexOf(a1)>-1){if(aU){aP=aX;aU=false;}aZ=true;a0++;continue;}}if(aZ){if(a2.searches==a0){aN.scrollTop(0);aN.scrollTop(aX.position().top);aX.click();aO=true;break;}}}if(!aO&&aP){aN.scrollTop(0);aN.scrollTop(aP.position().top);aP.click();a2.searches=1;}};k.el.click(function(aN){var aM=a("input",aA.el).val().toLowerCase();aI(aM,s);});am.el.click(function(aN){var aM=a("input",n.el).val().toLowerCase();aI(aM,ap);});g.el.click(function(aQ){var aP=a("input",ar.el).val().toLowerCase();var aN=ac.clickTr.attr("secondaryType")==5;var aM=al.el;if(aN){aM=a(".paginationjs-content",al.el);var aO=ay(ac.itemKey,0);d.removeAll();ac.dictRts=[];d=aj(aM,F,aO);d.dictRts=ac.dictRts;ac.setTotalRowCount(0,aO.totalRowCount);}else{aI(aP,d);}});}};b.init();b.install();return b;};}(jQuery));YIUI.Control.Dialog=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.DialogHandler,msgType:YIUI.Dialog_MsgType.YES_NO_OPTION,eventList:{},onRender:function(a){this.base(a);this.dialog=new YIUI.Yes_Dialog({el:this.el,title:this.title,msg:this.msg,msgType:this.msgType});this.el.addClass("ui-dlg");this.dialog.show();},regEvent:function(a,b){this.eventList[a]=b;},getEvent:function(a){return this.eventList[a];},regExcp:function(a){this.excp=a;},setOwner:function(a){this.form=a;},getOwner:function(){return this.form;},install:function(){var a=this;$(".dlg-btn",a.el).click(function(c){var b=$(this).attr("key");a.handler.doOnClick(a,b);});$(".dialog-close",a.el).click(function(b){a.handler.doOnClick(a,YIUI.Dialog_Btn.STR_NO);});}});YIUI.reg("dialog",YIUI.Control.Button);YIUI.Control.FileChooser=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",useType:"open",allowMulti:false,extFilter:null,handler:YIUI.FileChooserHandler,onSetWidth:function(a){this.base(a);this.$input.width(a-this.$btn.width());this.$fileBtn.css("left",this.$btn.position().left);},onSetHeight:function(a){this.base(a);this.$input.height(a);this.$btn.height(a);},getValue:function(){return this.value;},onRender:function(a){this.base(a);this.el.addClass("ui-fc");this.$input=$("<input class='txt' />").appendTo(this.el);this.$btn=$("<button class='btn'>...</button>").appendTo(this.el);this.$fileBtn=$("<input type='file' name='file' data-url='upload' class='fup'>").appendTo(this.el);},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());if(a.clickcontent){this.clickContent=a.clickcontent;}},install:function(){var a=this;this.el.delegate(".fup","change",function(b){a.$input.val(this.value);a.value=this.value;});}});YIUI.reg("filechooser",YIUI.Control.FileChooser);YIUI.Control.MapDraw=YIUI.extend(YIUI.Control,{handler:YIUI.MapDrawHandler,zoom:11,marker:false,lng:0,lat:0,polyEdit:false,height:500,width:500,setValue:function(b,d,a){var c=this.base(b,d,a);return c;},setZoom:function(a){this.zoom=a;},setMarker:function(a){this.marker=a;},setLng:function(a){this.lng=a;},setLat:function(a){this.lat=a;},clear:function(){this.cWin.clearMap();},setDriveRoute:function(d,a,c,b){this.cWin.setDriveRoute(d,a,c,b);},drawMarker:function(a){this.cWin.drawMarker(a);},drawPolyline:function(a){this.cWin.drawPolyline(a);},drawPolygon:function(a){this.cWin.drawPolygon(a);},getMapInfo:function(){return this.cWin.getMapInfo();},showMapInfo:function(a){this.cWin.showMapInfo&&this.cWin.showMapInfo(a);},setEnable:function(a){this.enable=a;this.cWin.setEnable&&this.cWin.setEnable(a);},onSetWidth:function(a){this.base(a);this.iFrame.css("width","100%");},onSetHeight:function(a){this.base(a);this.iFrame.css("height","100%");this.setURL("http://localhost:8089/yigo/bdmap.jsp?ak=55Nw4ZvSVHMbPG2LHOwHMhSZ2ZA0FfF9");},setURL:function(b){this.url=b;if(b.indexOf("?")>0){b+="&formID="+this.ofFormID;}else{b+="?formID="+this.ofFormID;}b+="&ctlKey="+this.getMetaObj().key;var a=this.paras;if(a){for(var c in a){b+="&"+c+"="+a[c];}}this.iFrame.attr("src",b);},onRender:function(b){this.base(b);this.el.addClass("ui-map");this.iFrame=$("<iFrame/>").appendTo(this.el);this.cWin=this.iFrame[0].contentWindow;this.marker&&this.setMarker(this.marker);this.zoom&&this.setZoom(this.zoom);this.lng&&this.setLng(this.lng);this.lat&&this.setLat(this.lat);var a=this.getMetaObj();a.url&&this.setURL(a.url);},beforeDestroy:function(){this.cWin=null;},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());},install:function(){var a=this;}});YIUI.reg("map",YIUI.Control.MapDraw);YIUI.Control.UTCDatePicker=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.DatePickerHandler,behavior:YIUI.UTCDatePickerBehavior,_hasShow:false,_firstClick:true,isOnlyDate:false,formatStr:"yyyy-MM-dd HH:mm:ss",isNoTimeZone:false,regional:"zh-CN",mask:null,calendars:1,setTip:function(a){var a=this.text;this.base(a);},setFormatStr:function(){if(this.getMetaObj().isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}},setEditable:function(a){this.editable=a;this.datePicker.setEditable(a);},setEnable:function(a){this.enable=a;this.datePicker.setEnable(a);},setBackColor:function(a){this.backColor=a;this.datePicker.getInput().css({"background-image":"none","background-color":a});},test:function(){return this.getValue();},setForeColor:function(a){this.foreColor=a;this.datePicker.getInput().css("color",a);},setFormatStyle:function(a){this.cssStyle=a;this.datePicker.getInput().css(a);},setText:function(b){if(b&&b.length>0){b=b.replace(/-/g,"/");var a=new Date(b);this.text=a.Format(this.formatStr);this.datePicker.getInput().val(this.text);}else{this.text=b;this.datePicker.getInput().val(this.text);}},getText:function(){var a=this.text||"";return a;},changeToVal:function(){var a=this.getText();if(this.getText()!=""){a=a.replace(/(\W+)/g,"");return a;}else{return null;}},checkEnd:function(a){this.value=a;this.caption=a;if(!a){return;}var b=YIUI.UTCDateFormat.formatCaption(a,this.getMetaObj().isOnlyDate,this.check);this.setText(b);},setValue:function(e,g,d,c,b){var a=false;if($.isNumeric(e)){a=true;}this.check=a;var f=this.base(e,g,d,c,b);return f;},onRender:function(a){this.base(a);var b=this;b.formatStr&&this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:b.id,el:b.el,formatStr:b.formatStr,isOnlyDate:b.getMetaObj().isOnlyDate,isNoTimeZone:b.getMetaObj().isNoTimeZone,regional:b.getMetaObj().regional,calendars:b.calendars});this.el.addClass("ui-dp ui-utc");if(this.value>0&&this.text){this.setText(this.text);}},afterRender:function(){this.base();if(this.mask){}},onSetWidth:function(a){this.datePicker.setWidth(a);},onSetHeight:function(a){this.datePicker.setHeight(a);},initDefaultValue:function(c){this.base(c);this.formatStr=c.formatstr;this.isOnlyDate=c.isonlydate;this.isNoTimeZone=c.isnotimezone;this.calendars=1;if(this.isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}var d=this;this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:d.id,el:d.el,isPortal:true,formatStr:d.formatStr,isOnlyDate:d.isOnlyDate,isNoTimeZone:d.isNoTimeZone,regional:d.regional,calendars:d.calendars});this.datePicker.setIsNoTimeZone(this.isNoTimeZone);this.datePicker.setOnlyDate(this.isOnlyDate);this.datePicker.setRegional(this.regional);this.datePicker.setCalendars(this.calendars);this.datePicker.initDatePicker(this.id);var a=this.datePicker.getInput(),b=this.datePicker.getBtn();b.css({left:this._dateInput.outerWidth()-26+"px",top:(this._dateInput.outerHeight()-16)/2+"px",height:"16px",width:"16px"});if($.browser.isIE){a.css("line-height",(this.el.outerHeight()-3)+"px");}if(this.value){if(this.isOnlyDate){this.value=this.value.substring(0,this.value.indexOf(" "));}this.setValue(this.value);}if(this.text){this.setText(this.text);}},beforeDestroy:function(){this.datePicker.getDropView().remove();},focus:function(){this.datePicker&&this.datePicker.getInput().focus();},install:function(){this.base();var a=this;this.datePicker.getInput().bind("click",function(b){this.select();}).on("blur",function(b){var c=b.target.value;if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getDropView().blur(function(b){var c=a.datePicker.getInput().val();if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getInput().keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("utcdatepicker",YIUI.Control.UTCDatePicker);YIUI.Control.SearchBox=YIUI.extend(YIUI.Control,{handler:YIUI.SearchBoxHandler,behavior:YIUI.SearchBoxBehavior,providerKey:null,providerFormulaKey:null,providerDependency:null,onRender:function(a){this.base(a);this.el.addClass("ui-srch");this.txt=$("<input type='text' class='txt'/>").appendTo(this.el);this.btn=$("<button class='btn'>...</button>").appendTo(this.el);},onSetHeight:function(a){this.base(a);},onSetWidth:function(a){this.base(a);this.txt.css("width",a-this.btn.outerWidth());},setEnable:function(a){this.base(a);},getControlValue:function(){return this.txt.val();},checkEnd:function(a){this.value=a;this.txt.val(this.value);},dependedValueChange:function(a){var b=this.getMetaObj();if(!b.providerKey){if(b.providerDependency==a){this.setValue(null,false,true);this.handler.setNeedRefresh(true);}}},install:function(){this.base();var a=this;a.btn.click(function(c){var b=a.getControlValue();a.handler.doOnClick(a);});a.txt.blur(function(c){var b=a.getControlValue();a.handler.autoComplete(a,b);});}});YIUI.reg("searchbox",YIUI.Control.SearchBox);YIUI.GridSumUtil=(function(){var Return={evalAffectSum:function(form,grid,rowIndex,colIndex){var rd=grid.dataModel.data[rowIndex],curGlevel=rd.rowGroupLevel,len=grid.dataModel.data.length,clen=grid.dataModel.colModel.columns.length,preRd,nextRd,column;for(var i=rowIndex-1;i>=0;i--){preRd=grid.dataModel.data[i];if(preRd.rowType=="Group"&&preRd.rowGroupLevel<=curGlevel){curGlevel=preRd.rowGroupLevel;this.evalSumFieldValue(form,grid,i,colIndex);}if(preRd.rowGroupLevel==0){break;}}curGlevel=rd.rowGroupLevel;for(var j=rowIndex+1;j<len;j++){nextRd=grid.dataModel.data[j];if(nextRd.isDetail&&nextRd.bookmark==null){continue;}if(nextRd.rowType=="Group"&&nextRd.rowGroupLevel<=curGlevel){curGlevel=nextRd.rowGroupLevel;this.evalSumFieldValue(form,grid,j,colIndex);}if(nextRd.rowGroupLevel==0){break;}}for(var k=0;k<clen;k++){column=grid.dataModel.colModel.columns[k];if(column.columnType!=null&&column.columnType!=="Detail"){this.evalSumFieldValue(form,grid,rowIndex,k);}}for(var m=0;m<len;m++){rd=grid.dataModel.data[m];if(rd.rowType=="Total"){for(var n=0;n<clen;n++){this.evalSumFieldValue(form,grid,m,n);}}}},evalSumFieldValue:function(form,grid,rowIndex,colIndex){var rowData=grid.dataModel.data[rowIndex],metaRow=grid.metaRowInfo.rows[rowData.metaRowIndex],metaCell=metaRow.cells[colIndex],defaultFormulaValue=metaCell.defaultFormulaValue;if(defaultFormulaValue!==undefined&&defaultFormulaValue.length>0&&defaultFormulaValue.indexOf("Sum")==0){var value=form.eval(defaultFormulaValue,{form:form,target:metaCell.key,rowIndex:rowIndex,colIndex:colIndex},null);grid.setValueAt(rowIndex,colIndex,value,true,false);}},evalSum:function(form,grid){var length=grid.dataModel.data.length,cLength=grid.dataModel.colModel.columns.length,row;for(var i=0;i<length;i++){row=grid.dataModel.data[i];if(row.rowType=="Group"||row.rowType=="Total"){for(var j=0;j<cLength;j++){this.evalSumFieldValue(form,grid,i,j);}}}}};return Return;})();YIUI.Control.Grid=YIUI.extend(YIUI.Control,{autoEl:"<table></table>",dataModel:{data:[],colModel:[]},groupHeaders:[],pageInfo:null,errorInfoes:{rows:[],cells:[]},hasRowClick:false,hasRowChange:false,hasRowDblClick:false,gridHandler:YIUI.GridHandler,rowHeight:32,selectFieldIndex:-1,init:function(a){this.base(a);if(this.dataModel.data.isFirstShow){this.rowIDMap=this.dataModel.data.rowIDMap;this.dataModel.data=this.dataModel.data.addRowArray;this.initRowDatas();}},initRowDatas:function(){var a=this.dataModel.data.length,c;for(var b=0;b<a;b++){c=this.dataModel.data[b];this.initOneRow(c);}},initOneRow:function(a){if(a.rowID==undefined){a.rowID=this.randID();}if(a.rowType==undefined){a.rowType="Detail";if(a.metaRowIndex==undefined||a.metaRowIndex==-1){a.metaRowIndex=this.metaRowInfo.dtlRowIndex;}}a.isDetail=(a.rowType=="Detail");a.isEditable=(a.rowType=="Fix"||a.rowType=="Detail");a.cellKeys=this.metaRowInfo.rows[a.metaRowIndex].cellKeys;a.rowHeight=this.metaRowInfo.rows[a.metaRowIndex].rowHeight;if(this.hasColExpand&&a.isDetail&&a.cellBkmks==undefined){a.cellBkmks=[];}},setID:function(){console.log(this);},setVAlign:function(a){},setHAlign:function(a){},onSetWidth:function(a){this.el.setGridWidth(a);},setHeight:function(b){this.base(b);if(!this.isHeightSet){var d=this.el[0].grid.bDiv.scrollTop,e=this.el[0].grid.bDiv.scrollLeft;var c=this.getFocusRowIndex(),f=this.getFocusColIndex();this.refreshGrid({populate:true,rowNum:this.dataModel.data.length});this.el[0].grid.bDiv.scrollTop=d;this.el[0].grid.bDiv.scrollLeft=e;var a=this.el.getGridCellAt(c+1,f+1);if(a){a.notOnSelectRow=true;$(a).click();}}},onSetHeight:function(b){this.el.setGridHeight(b);var d=this.el[0].grid.bDiv.scrollTop,e=this.el[0].grid.bDiv.scrollLeft;var c=this.getFocusRowIndex(),f=this.getFocusColIndex();this.refreshGrid({populate:true,rowNum:parseInt((this.el[0].grid.bDiv.clientHeight/this.rowHeight),10)+2});this.el[0].grid.bDiv.scrollTop=d;this.el[0].grid.bDiv.scrollLeft=e;var a=this.el.getGridCellAt(c+1,f+1);if(a){a.notOnSelectRow=true;$(a).click();}this.isHeightSet=true;},getOuterEl:function(){return $("#gbox_"+this.id);},diff:function(J){var f=false,w=false;if(typeof J.editable!="undefined"&&J.editable!=this.isEnable()){this.setEnable(J.editable);this.el.setGridParam({enable:this.isEnable()});this.el[0].updatePager();}var e=false;if(J.pageInfo){if(J.pageInfo.currentPage){this.pageInfo.currentPage=J.pageInfo.currentPage;e=true;}if(J.pageInfo.totalRowCount){this.pageInfo.totalRowCount=J.pageInfo.totalRowCount;}if(J.pageInfo.totalPage){this.pageInfo.totalPage=J.pageInfo.totalPage;}}if(J.errorInfoes){this.errorInfoes.cells=J.errorInfoes.cells;this.errorInfoes.rows=J.errorInfoes.rows;}if(J.dataModel){if(J.dataModel.cellEnables){for(var A=0,r=J.dataModel.cellEnables.length;A<r;A++){var t=J.dataModel.cellEnables[A],d=t.rowID,v=this.getRowDataByID(d),b=this.getRowIndexByID(d);if(v==null||t.cells==undefined){continue;}for(var n in t.cells){this.setCellEnable(b,n,t.cells[n]);}}}if(J.dataModel.colModel){if(J.dataModel.colModel.columns){this.dataModel.colModel.columns=J.dataModel.colModel.columns;}if(J.dataModel.colModel.cells){this.dataModel.colModel.cells=J.dataModel.colModel.cells;}if(this.dataModel.colModel.columns.length!=this.el[0].p.colModel.length){w=true;this.groupHeaders=J.groupHeaders;}this.el[0].p.colModel.isChange=false;for(var h=0,g=this.dataModel.colModel.columns.length;h<g;h++){var l=this.dataModel.colModel.columns[h];var z=null;for(var k=0,C=this.el[0].p.colModel.length;k<C;k++){z=this.el[0].p.colModel[k];if(z.name==l.name){break;}}z.editable=l.editable;if(z.hidden!==l.hidden){this.el[0].p.colModel.isChange=true;f=true;}z.hidden=l.hidden;}}if(J.dataModel.data){var m=J.dataModel.data.isFirstShow;if(m){this.dataModel.data=J.dataModel.data.addRowArray;if(!this.dataModel.data){this.dataModel.data=new Array();}this.initRowDatas();if(this.treeType!==-1){this.rowIDMap=J.dataModel.data.rowIDMap;this.treeOldData=this.dataModel.data;this.dataModel.data=new Array();var I,D,r;if(this.treeExpand){for(I=0,r=this.treeOldData.length;I<r;I++){D=this.treeOldData[I];if(D.childRows.length>0){D.isExpand=true;}this.dataModel.data.push(D);}}else{for(I=0,r=this.treeOldData.length;I<r;I++){D=this.treeOldData[I];if(D.parentRow===undefined){this.dataModel.data.push(D);}}}}else{if(this.rowExpandIndex!=-1){for(var H=0,x=this.dataModel.data.length;H<x;H++){var G=this.dataModel.data[H];G.data[this.rowExpandIndex][2]=false;}}}f=true;}else{var y=J.dataModel.data.addRowArray;var B=J.dataModel.data.modifyRowArray;var K=J.dataModel.data.deleteRowArray;this.deleteRows(K);this.addNewRows(y);this.modifyRows(B);f=false;}}if(w){var E=$("#gbox_"+this.id),o=$(E[0].parentElement),a=E.width(),c=E.height();E.remove();this.el=null;this.onRender(o);this.onSetWidth(a);this.setHeight(c);}else{var L=this.el[0].grid.bDiv.scrollTop,u=this.el[0].grid.bDiv.scrollLeft;var s={enable:this.isEnable()};this.el.setGridParam(s);if(f){this.refreshGrid(s);}this.initPageOpts(e);this.initGridErrors();this.el[0].grid.bDiv.scrollTop=L;this.el[0].grid.bDiv.scrollLeft=u;var F=false,p=this.el[0].p.editCells;for(var I=0,q=p.length;I<q;I++){if(p[I].cell.editor!==undefined){F=true;break;}}if(F){this.el[0].p.editCells=p;}}}},deleteRows:function(e){if(e){for(var b=this.dataModel.data.length-1;b>=0;b--){var d=this.dataModel.data[b];for(var c=e.length-1;c>=0;c--){var a=e[c]["rowID"];if(d.rowID==a){this.dataModel.data.splice(b,1);this.el[0].deleteGridRow(b);e.splice(c,1);break;}}}}},addNewRows:function(d){if(d){while(d.length!=0){for(var c=d.length-1;c>=0;c--){var a=d[c];if(a.data!==null&&a.data!==undefined){this.initOneRow(a);}var e=a["insertRowID"];if(e==-1){this.dataModel.data.splice(0,0,a);this.el[0].insertGridRow(0,a);d.splice(c,1);}else{for(var b=0,g=this.dataModel.data.length;b<g;b++){var h=this.dataModel.data[b];var f=h["rowID"];if(f==e){this.dataModel.data.splice(b+1,0,a);this.el[0].insertGridRow(b+1,a);d.splice(c,1);break;}}}}}}},modifyRows:function(f){if(f){for(var g=0,n=f.length;g<n;g++){var e=f[g];var o=e["rowID"],l,a,q,m=this.showRowHead?1:0;for(var d=0,h=this.dataModel.data.length;d<h;d++){var r=this.dataModel.data[d];var b=r["rowID"];if(b==o){a=this.dataModel.data[d];for(var c=0,p=e.cells.length;c<p;c++){q=e.cells[c];a.data[q.colIndex]=q.value;this.el[0].modifyGridCell(d,q.colIndex+m,a);}if(this.treeType!==-1){e.isExpand=r.isExpand;e.treeLevel=r.treeLevel;l=this.rowIDMap[o];this.treeOldData.splice(l,1,a);}this.dataModel.data.splice(d,1,a);break;}}}}},createCellEditor:function(cell,edittype,iRow,iCol,opt){if(edittype==="label"){return;}var editor,$t=this,self=$t.getControlGrid(),form=YIUI.FormStack.getForm(self.ofFormID),rowIndex=parseInt($.ygrid.stripPref($.ygrid.uidPref,$t.rows[iRow].id),10),rowData=$t.p.data[rowIndex],rowID=rowData.rowID,colIndex=$t.p.rowSequences?iCol-1:iCol,cellV=rowData.data[colIndex],oldV=cellV[0],oldCaption=cellV[1];if(oldV===null||oldV===undefined||oldV==="&nbsp;"||oldV==="&#160;"||($.isString(oldV)&&oldV.length===1&&oldV.charCodeAt(0)===160)){oldV="";}cell.html("").attr("tabIndex","0");var scrollTop=$t.grid.bDiv.scrollTop,scrollLeft=$t.grid.bDiv.scrollLeft;var setFocusAndSelect=function(editor){var moveStart=function(element){var pos=element.value.length;if(element.setSelectionRange){element.setSelectionRange(pos,pos);}else{if(element.createTextRange){var r=element.createTextRange();r.moveStart("character",pos);r.collapse(true);r.select();}}};window.setTimeout(function(){$(editor.getInput()).focus(function(){if(!$.ygrid.msie){moveStart(this);}});editor.getInput().focus();if(!cell[0].inKeyEvent){editor.getInput().select();}else{if($.ygrid.msie){moveStart(editor.getInput()[0]);}cell[0].inKeyEvent=false;}},0);};var hideDropView=function(){var th=self.el,p=th[0].p,value;if(p.editCells.length===0){var dV=p.data[iRow-1].data[iCol-(p.rowSequences?1:0)];p.editCells.push({ir:iRow,ic:iCol,name:p.colModel[iCol].name,v:dV,cell:cell});}th.yGrid("saveCell",iRow,iCol);th[0].selecting=false;var hCell=$("td.ui-state-highlight",th[0].grid.bDiv);if(hCell[0]&&(hCell[0].parentElement.id!==p.selectRow||hCell[0].cellIndex!==p.selectCell)){hCell.click();}window.setTimeout(function(){$("#"+self.el[0].p.knv).focus();self.el[0].grid.bDiv.scrollTop=scrollTop;self.el[0].grid.bDiv.scrollLeft=scrollLeft;},0);};var clickDropBtn=function(editor){var event=opt.event||window.event;if(event.type==="click"){var srcE=event.target||event.srcElement,x=event.offsetX||(event.clientX-srcE.getBoundingClientRect().left),y=event.offsetY||(event.clientY-srcE.getBoundingClientRect().top),btn=editor.getDropBtn()[0],top=btn.offsetTop,left=btn.offsetLeft,height=btn.offsetHeight,width=btn.offsetWidth;if(top<=y&&y<=(top+height)&&left<=x&&x<=(cell[0].offsetLeft+cell[0].offsetWidth)){editor.getDropBtn().click();}}};if(edittype=="dynamic"){var typeFormula=opt.typeFormula;var typeDefKey=form.eval(typeFormula,{form:form,rowIndex:rowIndex,colIndex:colIndex});var cellTypeDef=DynamicCell.getCellTypeTable()[form.formKey][typeDefKey];if(cellTypeDef!=null){if(cellTypeDef.options.isAlwaysShow){return;}cell[0].cellTypeDef=cellTypeDef;edittype=cellTypeDef.options.edittype;opt=$.extend(opt,cellTypeDef.options,{typeDefKey:typeDefKey});}}switch(edittype){case"textEditor":opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};editor=new YIUI.CellEditor.CellTextEditor(opt);editor.getInput().addClass("celled");editor.render(cell);editor.setValue(oldV);setFocusAndSelect(editor);break;case"numberEditor":opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};editor=new YIUI.CellEditor.CellNumberEditor(opt);editor.getInput().addClass("celled");editor.render(cell);editor.setValue(oldV);setFocusAndSelect(editor);break;case"dict":self.gridHandler.doGridCellSelect(self,rowID,colIndex);var stopClickCell=function(){self.el[0].grid.clearSelectCells();self.el[0].selecting=false;};opt=$.extend(true,opt,{ofFormID:self.ofFormID,hiding:hideDropView,rowIndex:self.getRowIndexByID(rowID),colIndex:colIndex,stopClickCell:stopClickCell});opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};editor=new YIUI.CellEditor.CellDict(opt,cell);editor.render(cell);if(oldV!=null&&!opt.multiSelect){oldV=new YIUI.ItemData(oldV);}editor.setValue(oldV);editor.setText(oldCaption);clickDropBtn(editor);break;case"comboBox":self.gridHandler.doGridCellSelect(self,rowID,colIndex);opt=$.extend(true,opt,{ofFormID:self.ofFormID,hiding:hideDropView,cxt:{form:form,rowIndex:self.getRowIndexByID(rowID),colIndex:colIndex}});editor=new YIUI.CellEditor.CellComboBox(opt);editor.render(cell);editor.setValue(oldV);editor.setText(oldCaption);editor.yesCom.setItems(editor.yesCom.items);editor.getDropBtn().click();break;case"datePicker":case"utcDatePicker":editor=new YIUI.CellEditor.CellDatePicker(opt);editor.render(cell);if(edittype=="utcDatePicker"&&oldV!=null&&oldV!=""){oldV=YIUI.UTCDateFormat.formatCaption(oldV,opt.isOnlyDate,true);}editor.setValue(oldV);editor.getDropView().blur(function(){self.el.yGrid("saveCell",iRow,iCol);});clickDropBtn(editor);break;case"textButton":opt.rowID=rowID;opt.colIndex=colIndex;opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};opt.click=function(){self.gridHandler.doOnCellClick(self,this.rowID,this.colIndex);window.setTimeout(function(){$("#"+$t.p.knv).focus();},0);};editor=new YIUI.CellEditor.CellTextButton(opt);editor.getInput().addClass("celled");editor.setValue(oldV);editor.render(cell);setFocusAndSelect(editor);break;}editor.getInput().keydown(function(event){var keyCode=event.charCode||event.keyCode||0;if(keyCode===13||keyCode===108||keyCode===9){editor.getInput().blur();if(editor.yesCom.isShowQuery){event.stopPropagation();}$("#"+self.el[0].p.knv).trigger("keydown",event);}});cell[0].editor=editor;},endCellEditor:function(m,k,e,l){var j=this.p.colModel[l],a=this.rows[e].id,f=$.ygrid.stripPref($.ygrid.uidPref,a),o=this.p.data[f],b=this.getCellEditOpt(o,l),d=o.data[j.index][2],h,n="";if(m[0].editor==null&&k!="label"){return[null,"",d];}if(k=="dynamic"&&m[0].cellTypeDef!=null){k=m[0].cellTypeDef.options.edittype;}switch(k){case"dict":m[0].editor.beforeDestroy();h=m[0].editor.getValue();if(h!==null){if(h.length&&h.length>=1){for(var c=0,g=h.length;c<g;c++){n+=h[c].caption+",";}n=n.substring(0,n.length-1);}else{n=h.caption==undefined?"":h.caption;}}if(b.multiSelect){h=[h];}h=[h,n,d];return h;case"numberEditor":case"textEditor":case"textButton":m[0].editor.finishInput();case"comboBox":m[0].editor.beforeDestroy();h=m[0].editor.getValue();h=[h,m[0].editor.getText(),d];return h;case"datePicker":case"utcDatePicker":m[0].editor.finishInput();m[0].editor.beforeDestroy();h=m[0].editor.getValue();if(h==null){h=[null,"",d];}else{n=new Date(h).Format(b.editOptions.formatStr).toLocaleString();if(k=="utcDatePicker"){h=YIUI.UTCDateFormat.format(new Date(h),b.editOptions);}h=[h,n,d];}return h;case"label":return o.data[j.index];}return[null,"",d];},afterEndCellEditor:function(l,j,n,f,k){var c=this,a=c.getControlGrid();if(j=="dynamic"&&l[0].cellTypeDef!=null){j=l[0].cellTypeDef.options.edittype;}if(j!==undefined&&j!=="label"&&l[0].editor!=null){var h=l[0].editor.getValue(),b=c.rows[f].id,g=$.ygrid.stripPref($.ygrid.uidPref,b),o=this.p.data[g],e=o.rowID,d=c.getCellEditOpt(o,k);if(j=="utcDatePicker"){h=YIUI.UTCDateFormat.format(new Date(h),d.editOptions);}if(j=="textEditor"||j=="textButton"){a.afterTextEditing=true;}if(n){a.gridHandler.doCellValueChanged(a,e,c.p.rowSequences?k-1:k,h);}if(j=="numberEditor"&&c.rows[f]!=null){var m=c.rows[f].cells[k];if(h.isNegative()){$(m).css({color:d.editOptions.negtiveForeColor});}else{$(m).css({color:""});}}}},alwaysShowCellEditor:function(c,j,g,n,v,b,f){var h,u=this.p,k=this,l=u.data[b.ri],d=l.rowID,a=this.getControlGrid(),q=v[2]||(v[2]==null&&a.isEnable()),e=k.getCellEditOpt(l,g),t=(u.rowSequences?g-1:g);c.html("");if(l.rowType=="Group"||l.rowType=="Total"){return;}b.rowID=d;b.colIndex=t;b.click=function(){var p=k.grid.bDiv.scrollTop,A=k.grid.bDiv.scrollLeft;a.setFocusRowIndex(a.getRowIndexByID(d));if(e.formatter==="checkbox"){var B=$("input",h)[0].checked;a.gridHandler.doOnCellClick(a,this.rowID,this.colIndex,B);}else{a.gridHandler.doOnCellClick(a,this.rowID,this.colIndex);}if(k.p.selectFieldIndex==e.colIndex){a.checkHeadSelect(e.colIndex);}c.click();window.setTimeout(function(){if(k.grid){$("#"+u.knv).focus();k.grid.bDiv.scrollTop=p;k.grid.bDiv.scrollLeft=A;}},0);};c[0].style.height=f+"px";switch(e.formatter){case"button":var x="";if(b.icon){x="<span class='icon button' style='background-image: url(Resource/"+b.icon+")'></span>";}h=$("<div class='ui-btn button cellEditor'>"+"<button>"+x+"<span class='txt button'>"+(v[0]==null?"":v[0])+"</span></button></div>");if(b.type==YIUI.Button_Type.UPLOAD){var y=$("<input type='file' class='type upload' name='file' data-url='upload'/>");y.appendTo(h);y[0].enable=q;}$("button",h)[0].enable=q;h.appendTo(c);h.mousedown(function(p){p.delegateTarget.enable&&$(this).addClass("hover");}).mouseup(function(p){p.delegateTarget.enable&&$(this).removeClass("hover");});h.click(function(p){window.up_target=null;if(!p.target.enable){p.stopPropagation();return false;}else{if($(p.target).hasClass("upload")){window.up_target=$(p.target);}}b.click();});$("button",h).click(function(p){if(!this.enable){p.stopPropagation();return false;}else{if($(p.target).hasClass("upload")){window.up_target=$(p.target);}}b.click();});h.attr("title",v[0]);c.attr("title",v[0]);break;case"hyperlink":var r=(v[0]==null?"":v[0]);h=$("<a class='ui-hlk cellEditor' style='width: 100%;height: 100%;line-height: "+f+"px'>"+r+"</a>");h[0].enable=q;var w=YIUI.Hyperlink_TargetType.Str_NewTab;switch(b.targetType){case YIUI.Hyperlink_TargetType.Current:w=YIUI.Hyperlink_TargetType.Str_Current;case YIUI.Hyperlink_TargetType.NewTab:if(b.url!=null&&b.url.length>0){h.attr("href",b.url);}h.attr("target",YIUI.Hyperlink_target[w]);break;}h.mousedown(function(p){p.delegateTarget.enable&&$(this).addClass("hover");}).mouseup(function(p){p.delegateTarget.enable&&$(this).removeClass("hover");});h.click(function(p){if(!p.target.enable){return;}if(b.url&&b.targetType==YIUI.Hyperlink_TargetType.New){window.open(b.url,YIUI.Hyperlink_target.New,"alwaysRaised=yes");}else{if(!b.url){b.click();}}});h.appendTo(c);h.attr("title",v[0]);c.attr("title",v[0]);break;case"checkbox":var m="",o,s;var z=this.id+"_"+j+"_"+g;if(v[0]==="1"||v[0]===1||v[0]==="true"||v[0]===true){m="checked";}s=(f-16)/2;h=$("<div class='ui-chk cellEditor' style='width: 100%;height: 100%';>"+"<input id="+z+" type='checkbox' class='chk' "+m+"/>"+"<label for="+z+" style='height:16px;width:16px;top:"+s+"px;position: relative' ></label>"+"</div>");h[0].enable=q;o=$("input",h);label=$("label",h);!q&&o.attr("disabled","disabled");h.click(function(p){a.setCellFocus(j-1,a.showRowHead?g-1:g);p.delegateTarget.enable&&b.click();});h.appendTo(c);h.attr("title",v[0]);c.attr("title",v[0]);if(o.is(":checked")){o.addClass("checked");}label.click(function(){if(o.is(":checked")){o.removeClass("checked");}else{o.addClass("checked");}});break;case"image":b.ofFormID=a.ofFormID;b.enable=q;b.value=v[0];b.gridKey=a.key;b.rowIndex=a.getRowIndexByID(b.rowID);b.change=function(p){u.data[j-1].data[n.index]=[p,p];u.editCells.push({ir:j,ic:g,name:n.name,v:u.data[j-1].data[n.index],cell:c});if(u.afterEndCellEditor&&$.isFunction(u.afterEndCellEditor)){u.afterEndCellEditor.call(k,c,e.edittype,true,j,g);}u.selectRow=null;u.selectCell=null;u.editCells=[];k.grid.clearSelectCells();};h=new YIUI.CellEditor.CellImage(b);h.render(c);h.getEl().attr("title",h.pathV);c.attr("title",h.pathV);c[0].editor=h;break;}},doPageEvent:function(d,c,b){c=parseInt(c,10);if(d){this.dataModel.data=[];var a={optType:b};if(!isNaN(c)&&c>=0){a["pageIndex"]=c;}this.gridHandler.doGoToPage(this,JSON.stringify(a));}},initPageOpts:function(f){if(!this.pageInfo.isUsePaging){return;}if(f){this.pageInfo.totalPage+=this.pageInfo.currentPage-1;}var c=this,l=this.id+"_pager",p=$("#first_"+l).removeClass("ui-state-disabled").unbind("click"),s=$("#prev_"+l).removeClass("ui-state-disabled").unbind("click"),j=$("#next_"+l).removeClass("ui-state-disabled").unbind("click"),g=$("#last_"+l).removeClass("ui-state-disabled").unbind("click"),n=$("#pagination_"+l),m=$("#"+l+"_center .ui-pg-input").val(this.pageInfo.currentPage).unbind("keypress");$("#sp_1_"+l).html(this.pageInfo.totalPage);var a=this.pageInfo.currentPage*this.pageInfo.pageRowCount;var o=(this.pageInfo.currentPage-1)*this.pageInfo.pageRowCount+1;if(a==0){o=0;}var q="第"+o+" - "+a+"条";$("#"+l+"_right .ui-paging-info").html(q);p.bind("click",function(){c.doPageEvent(!p.hasClass("ui-state-disabled"),-1,"firstPage");});s.bind("click",function(){c.doPageEvent(!s.hasClass("ui-state-disabled"),-1,"prevPage");});j.bind("click",function(){c.doPageEvent(!j.hasClass("ui-state-disabled"),-1,"nextPage");});g.bind("click",function(){c.doPageEvent(!g.hasClass("ui-state-disabled"),-1,"lastPage");});if(this.pageInfo.totalPage==1){m.attr("readOnly","readOnly");}m.keypress(function(u){var t=u.charCode||u.keyCode||0;if(t===13){if(m.val()>c.pageInfo.totalPage){m.val(c.pageInfo.totalPage);}c.doPageEvent(!m.hasClass("ui-state-disabled"),m.val(),"turnToPage");}else{if(t>=48&&t<=57){return this;}}return false;});var b=function(x,u,y){$("ul",n).html();var t=[],w,z;for(var v=x;v<=u;v++){var w;if(v==u){w="border:0";}z=(v==y)?"ui-state-highlight":"";t.push(["<li class='pagination_btn ",z,"' style='",w,"' data-num=",v,">",v,"</li>"].join(""));}$("ul",n).html(t.join(""));};if(this.pageInfo.totalPage<=5){b(1,this.pageInfo.totalPage,this.pageInfo.currentPage);}else{var h=this.pageInfo.currentPage,e=this.pageInfo.totalPage,r=(h-2)>=1?(h-2):1,d=r+4;if(d>e){var k=d-e;r-=k;d-=k;}b(r,d,this.pageInfo.currentPage);}$("li",n).click(function(){var t=$(this).attr("data-num");c.doPageEvent(!$(this).hasClass("ui-state-disabled"),t,"turnToPage");});if(this.pageInfo.currentPage==1){p.addClass("ui-state-disabled");s.addClass("ui-state-disabled");}else{p.removeClass("ui-state-disabled");s.removeClass("ui-state-disabled");}if(this.pageInfo.currentPage==this.pageInfo.totalPage){j.addClass("ui-state-disabled");g.addClass("ui-state-disabled");}else{j.removeClass("ui-state-disabled");g.removeClass("ui-state-disabled");}},rowOptFunc:function(e){if(this.p.selectRow){var c=$.ygrid.stripPref($.ygrid.uidPref,this.p.selectRow),d=this.p.data[c].rowID,b=this.getControlGrid(),f=this.getControlGrid().getRowIndexByID(d);if(e==="add"){var a=this.p.selectCell;this.getControlGrid().gridHandler.doInsertGridRow(b,d);$($("#"+$.ygrid.uidPref+c)[0].cells[a]).click();}else{if(e==="del"){this.getControlGrid().gridHandler.doDeleteGridRow(b,d);}else{if(e=="upRow"||e=="downRow"){this.getControlGrid().gridHandler.doShiftRow(b,f,e=="upRow");}}}}},extKeyDownEvent:function(a){var e=this.p.selectRow,k=this.p.selectCell,h=a.charCode||a.keyCode||0,j=this.rows[e];if(e===undefined||e==null||k===undefined||k==null||j==undefined){return;}var d=$.ygrid.stripPref($.ygrid.uidPref,j.id),b=this.p.data[d],g=j.cells[k],c=this.getCellEditOpt(b,k);if(c.edittype=="textEditor"||c.edittype=="numberEditor"||c.edittype=="textButton"||c.edittype=="dict"||c.edittype=="datePicker"){var f;if(h>=48&&h<=57){f=String.fromCharCode(h);}else{if(h>=96&&h<=105){f=String.fromCharCode(h-48);}else{if(h>=65&&h<=90){if(c.edittype=="numberEditor"||c.edittype=="datePicker"){return;}f=String.fromCharCode(h).toLowerCase();if(a.shiftKey||document.isCapeLook){f=f.toUpperCase();}}else{if(h==107||h==109||h==187||h==189){f=String.fromCharCode(0);}}}}if(f==undefined){return;}g.inKeyEvent=true;g.click();if($(g).find("input")[0]!==undefined&&$(g).find("input")[0]!==document.activeElement){window.setTimeout(function(){$(g).find("input").focus();if(c.edittype=="textEditor"){var o,p="",m=g.editor.yesCom;if(m.invalidChars&&m.invalidChars.length>0&&f&&f.length>0){for(var n=0,l=f.length;n<l;n++){o=f.charAt(n);if(m.invalidChars.indexOf(o)<0){p+=o;}}}else{p=f;}if(m.textCase){if(m.textCase==YIUI.TEXTEDITOR_CASE.UPPER){p=p.toUpperCase();}else{if(m.textCase=YIUI.TEXTEDITOR_CASE.LOWER){p=p.toLowerCase();}}}f=p;}$(g).find("input").val(f);},0);}}},onSortClick:function(a,b){if(!this.getControlGrid().hasGroupRow){a=this.p.rowSequences?a-1:a;this.getControlGrid().gridHandler.doOnSortClick(this.getControlGrid(),a,b);}else{alert($.ygrid.error.isSortError);}},onSelectRow:function(h,d){var c=this.getControlGrid(),a=-1;if(this.p.selectRow!==undefined){var g=c.el.getGridRowById(this.p.selectRow);if(g){a=g.rowIndex;}if(!a){a=-1;}}if(c.hasRowClick){var e=this.p.data[h-1].rowID;c.gridHandler.doOnRowClick(c,e);}if(c.hasRowChange&&h!=a&&h>=0){c.el[0].p.selectRow=d;var f=this.p.data[h-1].rowID,b=(a===-1?-1:this.p.data[a-1].rowID);c.gridHandler.doGridCellSelect(c,f,this.p.selectCell?this.p.selectCell:-1);c.gridHandler.doOnFocusRowChange(c,b,f);}},getFocusRowIndex:function(){if(this.el[0].p.selectRow==undefined||this.el[0].p.selectRow==null){return -1;}var a=this.el.getGridRowById(this.el[0].p.selectRow);return parseInt($.ygrid.stripPref($.ygrid.uidPref,a.id));},getFocusColIndex:function(){var a=this.el[0].p.selectCell;if(a){a=this.el[0].p.rowSequences?a-1:a;}else{a=-1;}return a;},ondblClickRow:function(c){var a=this.getControlGrid();if(a.hasRowDblClick){var b=this.p.data[c-1].rowID;a.gridHandler.doOnRowDblClick(a,b);}},afterPaste:function(g){var a=this.p.selectRow,e=this.p.selectCell,d=this.getControlGrid();if(a==undefined||a==null){return;}var b=$.ygrid.stripPref($.ygrid.uidPref,a),f=this.p.rowSequences?e-1:e;if(this.p.selectionMode==YIUI.SelectionMode.ROW){f=0;}var c=this.p.data[b].data[f][2];c=(c==null?this.p.enable:c);if(c&&a!==undefined&&e!==undefined&&g!==undefined&&g.length>0){d.gridHandler.doCellPast(d,this.p.data[b].rowID,f,g);}},getControlGrid:function(){return this;},treeIconClick:function(m,j){var f=m.childRows,h,k,a,b=this.getControlGrid();if(b.treeExpand){return;}var l=function(v,p,o){var q,s=0,t,u,n;if(v.isExpand){for(var q=0,r=v.childRows.length;q<r;q++){t=v.childRows[q];u=p[t];n=o[u];s+=l(n,p,o);s++;}v.isExpand=false;}return s;};if(!m.isExpand){var g=f.length;for(i=g-1;i>=0;i--){h=f[i];k=b.rowIDMap[h];a=b.treeOldData[k];a.treeLevel=m.treeLevel+1;if(b.treeColIndex!=null&&b.treeColIndex>=0){a.data[b.treeColIndex][2]=false;}if(j>=b.dataModel.data.length){b.dataModel.data.push(a);}else{b.dataModel.data.splice(j,0,a);}}b.dataModel.data[j-1].isExpand=true;}else{var e=l(m,b.rowIDMap,b.treeOldData);b.dataModel.data.splice(j,e);b.dataModel.data[j-1].isExpand=false;}var c=this.grid.bDiv.scrollTop,d=this.grid.bDiv.scrollLeft;b.refreshGrid();this.grid.bDiv.scrollTop=c;this.grid.bDiv.scrollLeft=d;},initOptions:function(){this.options={populate:false,selectionMode:this.selectionMode,treeType:this.treeType,hasRowExpand:this.hasRowExpand,rowSequences:this.showRowHead,enable:this.getMetaObj().editable,colModel:this.dataModel.colModel.columns,cellLookup:this.dataModel.colModel.cells,data:this.dataModel.data,navButtons:{add:this.canInsert,addIcon:"ui-icon-plus",addFunc:this.rowOptFunc,del:this.canDelete,delIcon:"ui-icon-trash",delFunc:this.rowOptFunc,upRow:this.canShift,upRowIcon:"ui-icon-up",upRowFunc:this.rowOptFunc,downRow:this.canShift,downRowIcon:"ui-icon-down",downRowFunc:this.rowOptFunc},createCellEditor:this.createCellEditor,endCellEditor:this.endCellEditor,alwaysShowCellEditor:this.alwaysShowCellEditor,afterEndCellEditor:this.afterEndCellEditor,extKeyDownEvent:this.extKeyDownEvent,onSortClick:this.onSortClick,onSelectRow:this.onSelectRow,ondblClickRow:this.ondblClickRow,afterPaste:this.afterPaste,getControlGrid:this.getControlGrid,treeIconClick:this.treeIconClick};var e=this.dataModel.colModel.columns.length,c;this.options.selectFieldIndex=this.selectFieldIndex;if(this.pageInfo.isUsePaging){this.options.showPageSet=true;this.options.scrollPage=false;this.options.rowNum=this.dataModel.data.length;}else{this.options.scrollPage=true;this.options.rowNum=100;}if(this.treeColIndex!==undefined&&this.treeColIndex!==-1){this.options.treeColName=this.dataModel.colModel.columns[this.treeColIndex].name;}if(this.treeType!==undefined&&this.treeType!==-1){this.treeOldData=this.dataModel.data;this.dataModel.data=new Array();var b,d,a;if(this.treeExpand){for(b=0,a=this.treeOldData.length;b<a;b++){d=this.treeOldData[b];if(d.childRows.length>0){d.isExpand=true;}this.dataModel.data.push(d);}}else{for(b=0,a=this.treeOldData.length;b<a;b++){d=this.treeOldData[b];if(d.parentRow===undefined){this.dataModel.data.push(d);}}}this.options.data=this.dataModel.data;}},initGroupHeaders:function(){this.el.initGroupHeaders(this.groupHeaders);},initGridErrors:function(){var d=this;if(!((d.errorInfoes.cells==undefined||d.errorInfoes.cells.length==0)&&(d.errorInfoes.rows==undefined||d.errorInfoes.rows.length==0))){for(var h=0,a=d.dataModel.data.length;h<a;h++){var g=d.dataModel.data[h].rowID;if(d.errorInfoes.cells!==undefined){for(var c=0,f=d.errorInfoes.cells.length;c<f;c++){if(d.errorInfoes.cells[c].rowID==g){d.errorInfoes.cells[c].rowIndex=h;}}}if(d.errorInfoes.rows!==undefined){for(var b=0,e=d.errorInfoes.rows.length;b<e;b++){if(d.errorInfoes.rows[b].rowID==g){d.errorInfoes.rows[b].rowIndex=h;}}}}}d.setGridErrorCells(d.errorInfoes.cells);d.setGridErrorRows(d.errorInfoes.rows);},setGridErrorCells:function(a){this.el.setErrorCells(a);},setGridErrorRows:function(a){this.el.setErrorRows(a);},onRender:function(b){var a=this;this.base(b);this.initOptions();this.el[0].getControlGrid=function(){return a;};this.el.yGrid(this.options);this.initPageOpts();this.initGroupHeaders();this.initGridErrors();this.options=null;if(this.selectFieldIndex>=0){this.checkHeadSelect(this.selectFieldIndex);}},beforeDestroy:function(){this.dataModel=null;this.groupHeaders=null;this.errorInfoes=null;this.el.GridDestroy();}});YIUI.Control.Grid=YIUI.extend(YIUI.Control.Grid,{rowIDMask:0,randID:function(){return this.rowIDMask++;},setGridEnable:function(f){this.colInfoMap={};this.setEnable(f);this.el.setGridParam({enable:f});this.el.reShowCheckColumn();if(f&&!this.hasAutoRow()&&this.treeType===-1&&!this.hasRowExpand&&this.metaRowInfo.dtlRowIndex!=-1){if(!this.getMetaObj().isSubDetail&&this.newEmptyRow){if(this.hasGroupRow){this.appendAutoRowAndGroup();}else{this.addGridRow();}}if(this.hideGroup4Editing&&f){var g=this.dataModel.data.length,h;for(var c=g-1;c>=0;c--){h=this.dataModel.data[c];if(h.rowType=="Group"||(h.isDetail&&h.bookmark==undefined)){this.dataModel.data.splice(c,1);}}if(this.newEmptyRow){var b=this.metaRowInfo.dtlRowIndex,a=-1;for(var d=this.dataModel.data.length-1;d>=0;d--){h=this.dataModel.data[d];if(h.rowType=="Group"||h.rowType=="Detail"){a=d+1;break;}else{if(h.metaRowIndex<b){a=d+1;break;}}}if(a==-1&&this.dataModel.data.length>0){a=0;}this.addGridRow(null,a,false);}this.refreshGrid();}}else{if(!f&&this.treeType===-1){this.removeAutoRowAndGroup();}}this.el[0].updatePager();this.initPageOpts();var e=this.el[0].grid.bDiv.scrollTop;this.el[0].grid.bDiv.scrollTop=e+1;YIUI.SubDetailUtil.clearSubDetailData(YIUI.FormStack.getForm(this.ofFormID),this);},setColumnVisible:function(j,c){var n,l,g,h,a,k,e=false,f=false,b;c=YIUI.TypeConvertor.toBoolean(c);for(n=0,l=this.dataModel.colModel.columns.length;n<l;n++){g=this.dataModel.colModel.columns[n];b=g.key;if(g.isExpandCol&&g.refColumn){b=g.refColumn;}if(b===j){k=(c==null?false:!c);e=(g.hidden!==k);g.hidden=k;if(this.el){a=this.showRowHead?n+1:n;h=this.el[0].p.colModel[a];h.hidden=g.hidden;}f=true;if(!this.hasColExpand){break;}}else{if(this.hasColExpand&&f){break;}}}if(e){var m=this.el[0].grid.bDiv.scrollTop,d=this.el[0].grid.bDiv.scrollLeft;this.el[0].p.colModel.isChange=true;this.refreshGrid();this.el[0].grid.bDiv.scrollTop=m;this.el[0].grid.bDiv.scrollLeft=d;}},setValueByKey:function(h,b,f,e,d){var g=this.getColInfoByKey(b);for(var c=0,a=g.length;c<a;c++){this.setValueAt(h,g[c].colIndex,f,e,d,true);}},setValueAt:function(k,m,c,g,l,o){if(k==undefined||k<0||k>this.dataModel.data.length){return;}var n=this.dataModel.data[k],a=n.cellKeys[m],h;h=n.data[m][2];n.data[m]=this.getCellNeedValue(k,m,c,o);this.afterTextEditing=false;n.data[m][2]=h;this.el[0].p.data[k].data[m]=n.data[m];this.dataModel.data[k].data[m]=n.data[m];this.el[0].modifyGridCell(k,this.showRowHead?m+1:m,n);if(g){var b=YIUI.FormStack.getForm(this.ofFormID);this.gridHandler.setCellValueToDocument(b,this,k,m,n.data[m][0]);b.getViewDataMonitor().preFireCellValueChanged(this,k,m,a);if(l){this.gridHandler.fireCellChangeEvent(b,this,k,m);}b.getViewDataMonitor().postFireCellValueChanged(this,k,m,a);if(!n.isDetail){return;}var d=b.subDetailInfo[this.getMetaObj().key].cells[a],f;if(d!=null&&d.length>0){for(var e=0,j=d.length;e<j;e++){f=d[e];f=b.getComponent(f);if(f&&parseInt($.ygrid.stripPref($.ygrid.uidPref,this.el[0].p.selectRow),10)==k){f.setValue(n.data[m][0],true,false);}}}}this.checkCellRequired(k,m);},checkCellRequired:function(f,b){var c=this.getRowDataAt(f),e=c.cellKeys[b],d=this.dataModel.colModel.cells[e],a=this.getCellDataAt(f,b);if(!d.isRequired){return;}if(a[1]==null||a[1]==""){this.setCellRequired(f,b,true);}else{this.setCellRequired(f,b,false);}},getValueByKey:function(c,b){var a=this.getColInfoByKey(b)[0].colIndex;return this.getValueAt(c,a);},getValueAt:function(b,a){if(b==undefined){b=this.getFocusRowIndex();}if(this.dataModel.data[b]==undefined||this.dataModel.data[b].data==undefined){return null;}return this.dataModel.data[b].data[a][0];},addGridRow:function(l,m,u,e){var v=this.dataModel.data,h=v.length,r,b=YIUI.FormStack.getForm(this.ofFormID),k=false,p=this.metaRowInfo.dtlRowIndex,d=this.metaRowInfo.rows[p];e=(e==null?true:e);if(!l){l={};l.isDetail=true;l.isEditable=true;l.rowHeight=d.rowHeight;l.rowID=this.randID();l.metaRowIndex=p;l.rowType="Detail";l.cellKeys=d.cellKeys;l.data=[];l.cellBkmks=[];l.rowGroupLevel=d.rowGroupLevel;k=true;}m=parseInt(m,10);if(isNaN(m)||m<0||(m>=h&&!u)){m=-1;}if(m==-1){var q,f;for(var o=h-1;o>=0;o--){q=v[o];if(q.isDetail){f=o;break;}}if(h==0){l.insertRowID=-1;m=0;v.push(l);}else{if(f==undefined){l.insertRowID=(v[p-1]==undefined?-1:v[p-1].rowID);m=p;}else{l.insertRowID=v[f].rowID;m=f+1;}v.splice(m,0,l);}}else{if(m==0){l.insertRowID=-1;}else{l.insertRowID=v[m-1].rowID;}v.splice(m,0,l);}if(k){for(var s=0,t=this.dataModel.colModel.columns.length;s<t;s++){var j=this.dataModel.colModel.columns[s],n=v[m].cellKeys[s],c=this.dataModel.colModel.cells[n];if(j.name=="rowID"){continue;}if(c!==undefined&&c.tableKey==undefined&&c.columnKey==undefined&&(c.edittype=="label"||c.edittype=="button"||c.edittype=="hyperLink")){r=d.cells[s].caption;}r=this.getCellNeedValue(m,s,r,true);r.push(true);l.data[s]=r;r=null;}}var a=this.el[0];if(a.p.selectRow){var g=$(a).yGrid("getGridRowById",a.p.selectRow);g&&$(g.cells[a.p.selectCell]).removeClass("ui-state-highlight");if(this.selectionMode==YIUI.SelectionMode.ROW){$(g.cells).each(function(){$(this).removeClass("ui-state-highlight");});}}a.insertGridRow(m,l);a.p.selectRow=null;a.p.selectCell=null;a.grid.clearSelectCells();this.refreshErrors(m,false);if(e){b.getUIProcess().calcEmptyRow(this,m);b.getUIProcess().doPostInsertRow(this,m);}return l;},refreshErrors:function(g,d){var c=this,e,f;for(var b=c.errorInfoes.cells.length-1;b>=0;b--){e=c.errorInfoes.cells[b];if(e.rowIndex>=g){if(d&&e.rowIndex==g){c.errorInfoes.cells.splice(b,1);}else{e.rowIndex=(d?e.rowIndex-1:e.rowIndex+1);}}}for(var a=c.errorInfoes.rows.length-1;a>=0;a--){f=c.errorInfoes.rows[a];if(f.rowIndex>=g){if(d&&f.rowIndex==g){c.errorInfoes.rows.splice(a,1);}else{f.rowIndex=(d?f.rowIndex-1:f.rowIndex+1);}}}c.el.setErrorCells(c.errorInfoes.cells);c.el.setErrorRows(c.errorInfoes.rows);},appendAutoRowAndGroup:function(){var a=this.el,m=this,b=false,l=false,e=this.dataModel.data;for(var f=0;f<e.length;f++){var n=e[f],j;if(b&&!l&&!n.isDetail){j=this.addGridRow(null,f,false);f++;}b=n.isDetail;l=(n.bookmark===undefined);}if(b&&!l){this.addGridRow(null,f,false);}var k=function(q,r){var o=q.metaRowInfo.dtlRowIndex;for(var p=r.length-1,s;p>=0;p--){s=r[p];if(s.rowType=="Group"||s.rowType=="Detail"){return p+1;}else{if(s.metaRowIndex<o){return p+1;}}}if(r.length>0){return 0;}return -1;};var c=function(t){for(var q=0,v=t.length;q<v;q++){var x=t[q];if(x.length>0){c(x);}else{var w={},D;if(x.rowType==="Group"){w.cellKeys=x.cellKeys;w.rowType=x.rowType;w.isDetail=false;w.isEditable=false;w.rowHeight=x.rowHeight;w.rowID=m.randID();w.data=[];w.cellBkmks=[];for(var C=0,y=x.cells.length;C<y;C++){var u=x.cells[C];w.data[C]=["",u.caption,false];}var z,s=-1,B,p,o;for(var r=0,A=m.metaRowInfo.rows.length;r<A;r++){z=m.metaRowInfo.rows[r];if(z.key==x.key){s=r;B=z.rowGroupLevel;p=z.isGroupHead;o=z.isGroupTail;break;}}w.metaRowIndex=s;w.rowGroupLevel=B;w.isGroupHead=p;w.isGroupTail=o;D=k(m,e);if(D==-1){e.push(w);a[0].insertGridRow(e.length-1,w);}else{e.splice(D,0,w);a[0].insertGridRow(D,w);}}else{if(x.rowType==="Detail"){w=m.addGridRow(null,k(m,e),true);}}w.inAutoGroup=true;}}};for(var d=0,h=this.metaRowInfo.rowGroupInfo.length;d<h;d++){var g=this.metaRowInfo.rowGroupInfo[d];if(g.length>0){c(g);}}},removeAutoRowAndGroup:function(){var b=this.el,c=this.dataModel.data,d;for(var a=c.length-1;a>=0;a--){d=c[a];if(d.inAutoGroup||(d.isDetail&&d.bookmark===undefined)){c.splice(a,1);this.el[0].deleteGridRow(a);}}},deleteGridRow:function(g){g=parseInt(g,10);if(isNaN(g)||g<0||g>=this.dataModel.data.length){return false;}var j=function(l,p){var o=l.dataModel.data[p];if(!o.isDetail){return false;}var n=YIUI.FormStack.getForm(l.ofFormID);if(n.getOperationState()!=YIUI.Form_OperationState.Default){if(!$.isDefined(o.bookmark)){if(p==l.getRowCount()-1){return false;}var m=l.dataModel.data[p+1];if(m.rowType!="Detail"){return false;}}}return true;};if(!j(this,g)){return false;}var a=this.el[0].p.selectCell;var f=this.dataModel.data[g].bookmark;this.dataModel.data.splice(g,1);this.el[0].deleteGridRow(g);this.el[0].p.selectRow=null;this.el[0].p.selectCell=null;this.el[0].grid.clearSelectCells();this.refreshErrors(g,true);var k=$("#"+$.ygrid.uidPref+g,this.el);if(k.length>0){$(k[0].cells[a]).click();}var b=YIUI.FormStack.getForm(this.ofFormID),h=b.getDocument();YIUI.GridSumUtil.evalSum(b,this);if(f==undefined){return true;}if(!h){return true;}var c=h.getByKey(this.tableKey);if(!c){return true;}if(f.length==undefined){c.setByBkmk(f);c.delRow(c.pos);}else{for(var d=0,e=f.length;d<e;d++){c.setByBkmk(f[d]);c.delRow(c.pos);}}this.gridHandler.dealWithSequence(b,this);return true;},hasAutoRow:function(){for(var c=0,a=this.dataModel.data.length;c<a;c++){var e=this.dataModel.data[c],b=e.isDetail,d=parseInt(e.bookmark,10);if(isNaN(d)&&b){return true;}}return false;},setFocusRowIndex:function(b){var a=this.el.getGridRowAt(b+1);this.el[0].p.selectRow=a.id;},getRowIndexByID:function(c){for(var b=0,a=this.dataModel.data.length;b<a;b++){var d=this.dataModel.data[b];if(d.rowID===c){return b;}}return -1;},getRowDataByID:function(c){for(var b=0,a=this.dataModel.data.length;b<a;b++){var d=this.dataModel.data[b];if(d.rowID===c){return d;}}return null;},getRowDataAt:function(a){return this.dataModel.data[a];},getCellIndexByKey:function(a){return this.getColInfoByKey(a)[0].colIndex;},getCellDataByKey:function(c,b){var a=this.getColInfoByKey(b)[0].colIndex;return this.getCellDataAt(c,a);},getCellDataAt:function(b,a){if(b==undefined){b=this.getFocusRowIndex();}if(this.dataModel.data[b]==undefined){return null;}return this.dataModel.data[b].data[a];},setColumnEnable:function(b,a){this.dataModel.colModel.columns[b].editable=a;},getFixRowInfoByCellKey:function(d){var f=function(h,o,s,k){var l,m,q=false,t=[],n;for(var p=0,r=h.dataModel.colModel.columns.length;p<r;p++){l=o.cellKeys[p];if(l==k){n=h.dataModel.colModel.columns[p];m=h.dataModel.colModel.cells[k];if(h.hasColExpand){t.push({rowIndex:s,colIndex:p,col:n,cell:m,metaRowIndex:o.metaRowIndex});q=true;}else{return[{rowIndex:s,colIndex:p,col:n,cell:m,metaRowIndex:o.metaRowIndex}];}}else{if(h.hasColExpand&&q){return t;}}}return null;};var e,b;for(var c=0,g=this.dataModel.data.length;c<g;c++){e=this.dataModel.data[c];if(e.rowType=="Fix"||e.rowType=="Total"){b=f(this,e,c,d);if(b!==null){return b;}}else{if(e.rowType=="Detail"||e.rowType=="Group"){break;}}}for(var a=this.dataModel.data.length-1;a>=0;a--){e=this.dataModel.data[a];if(e.rowType=="Fix"||e.rowType=="Total"){b=f(this,e,a,d);if(b!==null){return b;}}else{if(e.rowType=="Detail"||e.rowType=="Group"){break;}}}return null;},getColumnAt:function(a){return this.dataModel.colModel.columns[a];},getColInfoByKey:function(h){var j=this.dataModel.colModel.cells[h],k,a,c=this.metaRowInfo.dtlRowIndex,g=this.metaRowInfo.rows[c];if(j==null||j==undefined){return null;}if(this.hasColExpand){var e=[],d;for(var b=0,f=g.cells.length;b<f;b++){d=g.cells[b];if(d.key==h){a=this.dataModel.colModel.columns[b];e.push({col:a,cell:j,colIndex:b,metaRow:g});}}return e;}else{k=j.colIndex;a=this.dataModel.colModel.columns[k];return[{col:a,cell:j,colIndex:k,metaRow:g}];}},colInfoMap:{},setCellEnable:function(m,a,g){var q=this.dataModel.data[m],c=this.el[0].p.data[m],n,l=this.colInfoMap[a];if(l==undefined){l=this.getColInfoByKey(a);if(l!==null){this.colInfoMap[a]=l;}}if(l==null){l=this.getFixRowInfoByCellKey(a);if(l!==null){this.colInfoMap[a]=l;}}if(l==null){return;}for(var f=0,j=l.length;f<j;f++){var p=l[f].colIndex,h,o,k=(this.showRowHead?1:0),e=l[f].cell;if(e==null||e.edittype=="label"){continue;}if(this.rowExpandIndex==p||this.treeColIndex==p){g=false;}q.data[p][2]=g;c.data[p][2]=g;h=this.el[0].p._indexMap[m];if(h==undefined||h==null){return;}n=this.el[0].rows[this.el[0].p._indexMap[m]];if(n===undefined||n==null){return;}o=n.cells[p+k];var d=YIUI.FormStack.getForm(this.ofFormID).getOperationState();var b=(d==YIUI.Form_OperationState.New||d==YIUI.Form_OperationState.Edit);if(b!==g){if(g){$(o).removeClass("ui-cell-disabled");}else{$(o).addClass("ui-cell-disabled");}}else{if(g){$(o).removeClass("ui-cell-disabled");}}if(e&&e.isAlwaysShow&&(q.isDetail||q.rowType=="Fix")){switch(e.formatter){case"button":$(".cellEditor .upload",o)[0]&&($(".cellEditor .upload",o)[0].enable=g);$(".cellEditor button",o)[0]&&($(".cellEditor button",o)[0].enable=g);break;case"hyperlink":case"image":$(".cellEditor",o)[0]&&($(".cellEditor",o)[0].enable=g);break;case"checkbox":$(".cellEditor",o)[0]&&($(".cellEditor",o)[0].enable=g);if(g){$("input",o).removeAttr("disabled");}else{$("input",o).attr("disabled","disabled");}break;}}}},getCellNeedValue:function(rowIndex,colIndex,value,isData){var options,edittype,opt={},self=this,row=this.dataModel.data[rowIndex],cellKey=row.cellKeys[colIndex],editOpt=this.dataModel.colModel.cells[cellKey],caption=value,form=YIUI.FormStack.getForm(this.ofFormID);if(value instanceof Decimal){caption=value.toString();}if(editOpt==undefined){return[value,caption];}options=editOpt.editOptions;if(editOpt.edittype=="dynamic"){var typeFormula=options.typeFormula;var typeDefKey=form.eval(typeFormula,{form:form,rowIndex:rowIndex,colIndex:colIndex});var cellTypeDef=DynamicCell.getCellTypeTable()[form.formKey][typeDefKey];if(cellTypeDef!=null){edittype=cellTypeDef.options.edittype;opt=$.extend(opt,cellTypeDef.options,{typeDefKey:typeDefKey});}}else{edittype=editOpt.edittype;}switch(edittype){case"numberEditor":opt=$.extend(true,opt,options);if(isData!=null&&!isData){value=value.replace(new RegExp(opt.sep,"gm"),"");}opt.newVal=value;opt.oldVal=null;var callBack=function(v,c){value=v;if(value&&value.isZero()&&editOpt.editOptions.zeroString!==undefined){caption=editOpt.editOptions.zeroString;}else{caption=c;}};YIUI.NumberEditorBehavior.checkAndSet(opt,callBack);if(value==null){value=new Decimal(0);}else{if(!(value instanceof Decimal)){value=new Decimal(value,10);}}if(value.isZero()&&editOpt.editOptions.zeroString!==undefined){caption=editOpt.editOptions.zeroString;}break;case"textButton":case"textEditor":if(!this.afterTextEditing){opt=$.extend(true,opt,options);value=caption=YIUI.TextFormat.format(value,opt);}break;case"comboBox":if(value==null||value.length==0||value===undefined){return[null,""];}opt=$.extend(true,opt,options);var combobox={key:editOpt.key,typeDefKey:opt.typeDefKey,sourceType:opt.sourceType,formula:opt.formula,globalItems:opt.globalItems,queryParas:opt.queryParas,needRebuild:(editOpt.needRebuild==null?true:editOpt.needRebuild),ofFormID:this.ofFormID,setItems:function(items){opt.items=items;},checkItem:$.noop,getValue:$.noop};YIUI.ComboBoxHandler.getComboboxItems(combobox,{form:form,rowIndex:rowIndex,colIndex:colIndex});var realValue="",realCaption="",length=(opt.items==undefined?0:opt.items.length);for(var i=0;i<length;i++){var item=opt.items[i];if(item.value==null){continue;}if(opt.type==="combobox"){if(isData?(item.value.toString()==value.toString()):(item.caption==value.toString())){realValue=item.value;realCaption=item.caption;break;}}else{var valueArray=value.split(",");if(isData?(valueArray.indexOf(item.value.toString())!==-1):(valueArray.indexOf(item.caption)!==-1)){realValue+=","+item.value;realCaption+=","+item.caption;}}}if(opt.type==="checklistbox"){realValue=realValue.substr(1);realCaption=realCaption.substr(1);}value=realValue;caption=realCaption;break;case"dict":if(value==null||value.length==0||value===undefined){return[null,""];}opt=$.extend(true,opt,options);if(opt.isDynamic){opt.itemKey=form.eval(opt.refKey,{form:form});}if(value instanceof YIUI.ItemData||typeof value=="object"){if(opt.multiSelect){var tempValue="";for(var di=0,dlen=value.length;di<dlen;di++){tempValue+=","+value[di].oid;}if(tempValue.length>0){value=tempValue.substr(1);}caption="";}else{value=value.oid;}}var values,ret,rootValue={oid:0,itemKey:opt.itemKey},dictFilter=editOpt.dictFilter;if(dictFilter==null||editOpt.needRefreshFilter){dictFilter=YIUI.DictHandler.getDictFilter(form,cellKey,opt.itemFilters,opt.itemKey);editOpt.needRefreshFilter=false;editOpt.dictFilter=dictFilter;}if(form.dictCaption==null){form.dictCaption={};}if(isData){if(opt.multiSelect){values=value.split(",");value=[];for(var index=0,len=values.length;index<len;index++){var tempCaption=form.dictCaption[opt.itemKey+"_"+values[index]];if(tempCaption==null){if(parseFloat(values[index])!=0){ret=YIUI.DictService.locate(opt.itemKey,"OID",values[index],dictFilter,rootValue,opt.stateMask);if(ret!=null){tempCaption=ret.caption;form.dictCaption[opt.itemKey+"_"+values[index]]=tempCaption;}}}if(tempCaption!=null){caption+=tempCaption+",";}value.push({oid:parseFloat(values[index]),caption:tempCaption,itemKey:opt.itemKey});}if(caption.length>0){caption=caption.substring(0,caption.length-1);}}else{caption=form.dictCaption[opt.itemKey+"_"+value];if(caption==null&&parseFloat(value)!=0){ret=YIUI.DictService.locate(opt.itemKey,"OID",parseFloat(value),dictFilter,rootValue,opt.stateMask);if(ret!=null){caption=ret.caption;form.dictCaption[opt.itemKey+"_"+value]=caption;}}value={oid:parseFloat(value),caption:caption,itemKey:opt.itemKey};}}else{if(opt.multiSelect){var str=value.split(",");values=[];for(var si=0,sLen=str.length;si<sLen;si++){values.push(str[si].split(" ")[0]);}value=[];caption=[];for(var ci=0,clen=values.length;ci<clen;ci++){ret=YIUI.DictService.locate(opt.itemKey,"Code",values[ci],dictFilter,rootValue,opt.stateMask);if(ret){value.push({oid:ret.value.oid,caption:ret.caption,itemKey:opt.itemKey});caption.push(ret.caption);caption.push(",");}}caption.pop();caption=caption.join("");}else{values=value.split(" ")[0];ret=YIUI.DictService.locate(opt.itemKey,"Code",values,dictFilter,rootValue,opt.stateMask);if(ret){value={oid:ret.oid,caption:ret.caption,itemKey:opt.itemKey};caption=ret.caption;}else{value=null;caption="";}}}break;case"datePicker":if(value==null||value.length==0||value===undefined){return[null,""];}var date,formatStr,dateStr;if(isData){if($.isNumeric(value)){date=new Date(parseFloat(value));}else{if($.isString(value)){dateStr=value.split(" ");if(dateStr.length==1){value=value+" 00:00:00";}date=new Date(Date.parse(value.replace(/-/g,"/")));}else{if(value instanceof Date){date=value;}}}}else{dateStr=value.split(" ");if(dateStr.length==1){value=value+" 00:00:00";}date=new Date(Date.parse(value.replace(/-/g,"/")));}value=date.getTime();formatStr=options.formatStr;caption=self.gridHandler.formatDate(date,formatStr);break;case"utcDatePicker":if(value==null||value.length==0||value===undefined||parseFloat(value)==0){return[null,""];}if($.isNumeric(value)){caption=YIUI.UTCDateFormat.formatCaption(parseFloat(value),options.isOnlyDate,true);}else{if($.isString(value)){caption=value;value=YIUI.UTCDateFormat.format(value,options);}}break;case"checkBox":if(value==null||value.length==0||value===undefined){return[false,"false"];}if(value instanceof Decimal){value=value.toNumber();}break;default:if(value==null||value.length==0||value===undefined){return[null,""];}}return[value,caption];},reload:function(){var a=YIUI.FormStack.getForm(this.ofFormID);var b=YIUI.ShowGridData(a,this);b.load(this);a.getUIProcess().doPostShowData(false);},repaint:function(){this.repaintHeaders();this.el[0].p.colModel.isChange=true;this.refreshGrid();},repaintHeaders:function(){var h=this.el[0],g=$("tr.ui-ygrid-headers",h.grid.hDiv),d=$("tr.ygfirstrow",h.grid.bDiv);$(h.grid.headers).each(function(m,n){if(h.p.colModel[m].hidden){$(n.el).css("display","none");d.find("td").eq(m).css("display","none");}else{$(n.el).css("display","");d.find("td").eq(m).css("display","");}});for(var b=0,e=h.grid.headers.length;b<e;b++){var f=h.grid.headers[b].el,k=g[0].cells;$("div",f).attr("style","");if($.inArray(k,f)==-1){g.append(f);}else{f.after(h.grid.headers[b-1].el);}}$(h.grid.hDiv).find("tr.ui-ygrid-columnheader").remove();var c,a;for(var l=0,j=this.dataModel.colModel.columns.length;l<j;l++){c=this.dataModel.colModel.columns[l];a=g[0].childNodes[l+(this.showRowHead?1:0)];$(a).attr("title",c.label);$(".colCaption",a).html(c.label);}$(h).initGroupHeaders(h.p.groupHeaders);},clearGridData:function(){this.dataModel.data=[];this.el.clearGridData();},refreshGrid:function(a){if(a==undefined||a==null){a={};}this.el.clearGridData();a.data=this.dataModel.data;if(this.pageInfo.isUsePaging||this.el[0].p.rowNum==0){a.rowNum=this.dataModel.data.length;}this.el.setGridParam(a);this.isActivity()&&this.el.trigger("reloadGrid");this.initPageOpts(a.needCalc);this.initGridErrors();YIUI.SubDetailUtil.showSubDetailData(this,-1);},getPageInfo:function(){return this.pageInfo;},getRowCount:function(){return this.dataModel.data.length;},addGridRows:function(m,g,c){var a,p,q,o,d=YIUI.FormStack.getForm(this.ofFormID),e=d.getDocument().getByKey(this.tableKey);var l=function(r){for(var j=r.dataModel.data.length-1,s;j>=0;j--){s=r.dataModel.data[j];if(s.isDetail&&s.bookmark!==undefined){return j;}}return -1;};for(var k=0,n=m.length;k<n;k++){a=m[k];this.initOneRow(a);p=l(this);a.rowID=this.randID();this.addGridRow(a,p+1,false,c);q=a.bookmark;g.setByBkmk(q);e.addRow();for(var h=0,b=e.cols.length,f;h<b;h++){f=e.cols[h];e.set(h,g.get(g.indexByKey(f.key)));}a.bookmark=e.getBkmk();}},getFieldArray:function(a,f,c){var k=a.getDocument(),j=new Array(),b;b=k.getByKey(this.tableKey);for(var e=0,g=this.dataModel.data.length;e<g;e++){var m=this.dataModel.data[e],h=m.bookmark,l;if(m.isDetail&&h!==undefined){b.setByBkmk(h);var d=false;if(this.selectFieldIndex!=-1){d=this.getValueAt(e,this.selectFieldIndex);}if(d){l=b.getByKey(f);j.push(l);}}}if(this.selectFieldIndex!=-1&&$.isEmptyObject(j)){YIUI.ViewException.throwException(YIUI.ViewException.DATA_BINDING_ERROR);}return j;},isCellNull:function(d,a){var c=this.getColInfoByKey(a)[0],b=this.getValueAt(d,c.colIndex);switch(c.cell.edittype){case"numberEditor":return b==0||b.isZero();case"textEditor":return b==null||b.length==0;case"datePicker":case"utcDatePicker":case"dict":case"comboBox":return b==null||b==undefined;}return false;},showDetailRow:function(k,d){var a=YIUI.FormStack.getForm(this.ofFormID),m=a.getDocument().getByKey(this.tableKey),f=this.metaRowInfo.dtlRowIndex,l=this.metaRowInfo.rows[f],n=this.dataModel.data[k];if(m==undefined||n==undefined||n==null||!n.isDetail||n.bookmark==undefined){return;}var j=n.bookmark,c,g,b;for(var e=0,h=this.dataModel.colModel.columns.length;e<h;e++){g=l.cells[e];c=this.dataModel.colModel.cells[n.cellKeys[e]];if(c.hasDB){if(g.isColExpand){b=n.cellBkmks[e];if(b){m.setByBkmk(b);this.setValueAt(k,e,m.getByKey(c.columnKey),false,false,true);}}else{m.setByBkmk(j);this.setValueAt(k,e,m.getByKey(c.columnKey),false,false,true);}}else{if(c.edittype=="label"||c.edittype=="button"||c.edittype=="hyperLink"){this.setValueAt(k,e,g.caption,false,false,false);}else{if(g.isSelect){m.setByBkmk(j);this.setValueAt(k,e,m.getByKey(YIUI.DataUtil.System_SelectField_Key),false,false,false);}}}}if(d){a.getUIProcess().calcEmptyRow(this,k);}},setColumnCaption:function(c,b){var e;for(var d=0,a=this.dataModel.colModel.columns.length;d<a;d++){e=this.dataModel.colModel.columns[d];if(e.key==c){e.label=b;break;}}this.repaintHeaders();},getColumnCount:function(){return this.dataModel.colModel.columns.length;},getMetaCellInDetail:function(a){var c=this.metaRowInfo.dtlRowIndex,b=this.metaRowInfo.rows[c];return b.cells[a];},setForeColor:function(a){this.el[0].p.foreColor=a;$(".ygrid-rownum,th",$("#gbox_"+this.id)).css({"color":a});},setBackColor:function(a){this.el[0].p.backColor=a;$(".ygrid-rownum,th",$("#gbox_"+this.id)).css({"background-image":"none","background-color":a});},initFirstFocus:function(){this.setCellFocus(0,0);},setCellFocus:function(b,a){this.el.setCellFocus(b+1,this.showRowHead?a+1:a);},requestNextFocus:function(){this.focusManager.requestNextFocus(this);},isActivity:function(){var b=this.el.parents(),d;for(var c=0,a=b.length;c<a;c++){d=b[c];if(d.style.display=="none"){return false;}}return true;},getLastDetailRowIndex:function(){for(var a=this.getRowCount()-1;a>=0;a--){var b=this.getRowDataAt(a);if(b.isDetail&&b.bookmark==null){return a;}}return -1;},setCellRequired:function(d,b,c){this.el.setCellRequired(d+1,this.showRowHead?b+1:b,c);var a=this.getCellDataAt(d,b);a[3]=c;},hasSubDetailData:function(f){var b=this.getRowDataAt(f);if(b==null){return false;}var e=b.bookmark,a=YIUI.FormStack.getForm(this.ofFormID),h=a.getDocument(),j=h.getByParentKey(this.tableKey),g;for(var c=0,d=j.length;c<d;c++){g=j[c];g.beforeFirst();while(g.next()){if(g.getParentBkmk()==e){return true;}}}return false;},clearAllSubDetailData:function(f){var d=this.getRowDataAt(f);if(d==null){return false;}var a=function(l,m){var h=e.getByParentKey(l),k;for(var j=0,g=h.length;j<g;j++){k=h[j];k.afterLast();while(k.previous()){if(k.getParentBkmk()==m){a(k.key,k.getBkmk());k.delRow();}}}};var b=d.bookmark,c=YIUI.FormStack.getForm(this.ofFormID),e=c.getDocument();a(this.tableKey,b);return true;},modifyCellErrors:function(h,d,e,f){var c,b,g,a=this.errorInfoes.cells.length;for(b=0;b<a;b++){g=this.errorInfoes.cells[b];if(g.rowIndex==h&&g.colIndex==d){c=b;break;}}if(e&&c!==undefined){this.errorInfoes.cells.splice(c,1);}else{if(!e&&c===undefined){this.errorInfoes.cells.push({rowIndex:h,colIndex:d,errorMsg:f});}}this.setGridErrorCells(this.errorInfoes.cells);},checkHeadSelect:function(d){var h=$(this.el[0].grid.hDiv).find(".ui-ygrid-htable"),c=true,f=0;for(var e=0,a=this.getRowCount();e<a;e++){var g=this.getRowDataAt(e),b=this.getCellDataAt(e,d);if(g.isDetail&&g.bookmark!=null){f++;if(b[0]==0||b[0]==null){c=false;break;}}}if(f==0){c=false;}$("input",h)[0].checked=c;},reShowCheckColumn:function(){this.el.reShowCheckColumn();},getHandler:function(){return this.gridHandler;},getMetaCellByKey:function(g){var c,e;for(var d=0,a=this.metaRowInfo.rows.length;d<a;d++){c=this.metaRowInfo.rows[d];for(var b=0,f=c.cells.length;b<f;b++){e=c.cells[b];if(e.key==g){return e;}}}return null;},dependedValueChange:function(b,c,a){this.gridHandler.dependedValueChange(this,b,c,a);},doPostCellValueChanged:function(d,c,b,a){this.gridHandler.doPostCellValueChanged(this,d,c,b,a);}});YIUI.reg("grid",YIUI.Control.Grid);(function(a){a.ygrid=a.ygrid||{};a.extend(a.ygrid,{defaults:{seqColText:"序号",emptyrecords:"无数据显示",recordtext:"{0} - {1}\u3000共 {2} 条",pgtext:" 跳转至：{0}页"},del:{caption:"删除",msg:"删除所选记录？",bSubmit:"删除",bCancel:"取消"},nav:{addtext:"",addtitle:"添加新记录",deltext:"",deltitle:"删除所选记录",uprowtext:"",uprowtitle:"上移数据行",downrowtext:"",downrowtitle:"下移数据行"},formatter:{integer:{thousandsSeparator:",",defaultValue:"0"},number:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,defaultValue:"0.00"},currency:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"",suffix:"",defaultValue:"0.00"}},error:{isNotTable:"表格初始化错误，初始化所用HtmlElement不是Table类型",isErrorMode:"表格所在页面的渲染模式(documentMode)低于5",model:"colNames 和 colModel 长度不等！",isSortError:"行分组情况下不允许进行排序",compDictNotDataBinding:"多选复合字典{0}不允许有数据绑定字段"},alert:{title:"提示",confirm:"确认"},cell_imgOpt:{open:"打开",show:"查看",clear:"清除"}});})(jQuery);(function($){$.ygrid=$.ygrid||{};$.extend($.ygrid,{version:"1.0.0",guid:1,uidPref:"ygd",msie:navigator.appName==="Microsoft Internet Explorer",getTextWidth:function(text,fontSize){var span=document.getElementById("__getWidth");if(span==null){span=document.createElement("span");span.id="__getWidth";document.body.appendChild(span);span.style.visibility="hidden";span.style.whiteSpace="nowrap";}span.innerText=text;span.style.fontSize=(fontSize==null?12:fontSize)+"px";return span.offsetWidth;},msiever:function(){var rv=-1;var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1);}return rv;},getCellIndex:function(cell){var c=$(cell);if(c.is("tr")){return -1;}c=(!c.is("td")&&!c.is("th")?c.closest("td,th"):c)[0];if($.ygrid.msie){return $.inArray(c,c.parentNode.cells);}return c.cellIndex;},formatString:function(format){var args=$.makeArray(arguments).slice(1);if(format==null){format="";}return format.replace(/\{(\d+)\}/g,function(m,i){return args[i];});},stripPref:function(pref,id){var obj=$.type(pref);if(obj==="string"||obj==="number"){pref=String(pref);id=pref!==""?String(id).replace(String(pref),""):id;}return id;},stripHtml:function(v){v=String(v);var regexp=/<("[^"]*"|'[^']*'|[^'">])*>/gi;if(v){v=v.replace(regexp,"");return(v&&v!=="&nbsp;"&&v!=="&#160;")?v.replace(/\"/g,"'"):"";}return v;},randId:function(prefix){return(prefix||$.ygrid.uidPref)+($.ygrid.guid++);},intNum:function(val,defval){val=parseInt(val,10);if(isNaN(val)){return defval||0;}return val;},extend:function(methods){$.extend($.fn.yGrid,methods);if(!this.no_legacy_api){$.fn.extend(methods);}}});$.fn.yGrid=function(options){if(this.grid){return;}if(typeof options==="string"){var fn=$.fn.yGrid[options];if(!fn){throw ("yGrid - No such method: "+options);}var args=$.makeArray(arguments).slice(1);return fn.apply(this,args);}return this.each(function(){var p={enable:true,width:100,height:150,rowNum:50,showPager:true,showPageSet:true,navButtons:{},scrollPage:false,colModel:[],colNames:[],data:[],editCells:[],_indexMap:{},viewRecords:true,rowSequences:true,rowSeqWidth:40,scrollTimeout:40,lastpage:1,onSelectRow:null,ondblClickRow:null,onSortClick:null,specialCellClick:null,createCellEditor:null,alwaysShowCellEditor:null,endCellEditor:null,afterEndCellEditor:null,extKeyDownEvent:null,afterCopy:null,afterPaste:null,groupHeaders:[]};for(var key in options){var value=options[key];if($.isArray(value)){p[key]=value.slice(0);}else{p[key]=value;}}options=null;var ts=this,grid={headers:[],cols:[],dragStart:function(i,x,y){var gridLeftPos=$(this.bDiv).offset().left;this.resizing={idx:i,startX:x.clientX,sOL:x.clientX-gridLeftPos};this.hDiv.style.cursor="col-resize";this.curGbox=$("#rs_m"+p.id,"#gbox_"+p.id);this.curGbox.css({display:"block",left:x.clientX-gridLeftPos,top:y[1],height:y[2]});document.onselectstart=function(){return false;};},dragMove:function(x){if(this.resizing){var diff=x.clientX-this.resizing.startX,h=this.headers[this.resizing.idx],newWidth=h.width+diff;if(newWidth>33){this.curGbox.css({left:this.resizing.sOL+diff});this.newWidth=p.tblwidth+diff;h.newWidth=newWidth;}}},dragEnd:function(){this.hDiv.style.cursor="default";if(this.resizing){var idx=this.resizing.idx,nw=this.headers[idx].newWidth||this.headers[idx].width;nw=parseInt(nw,10);this.resizing=false;this.curGbox&&this.curGbox.css({display:"none"});p.colModel[idx].width=nw;this.headers[idx].width=nw;this.headers[idx].el.style.width=nw+"px";this.cols[idx].style.width=nw+"px";p.tblwidth=this.newWidth||p.tblwidth;$("table:first",this.bDiv).css("width",p.tblwidth+"px");$("table:first",this.hDiv).css("width",p.tblwidth+"px");this.hDiv.scrollLeft=this.bDiv.scrollLeft;$(ts).triggerHandler("yGridResizeStop",[nw,idx]);}this.curGbox=null;document.onselectstart=function(){return true;};},populateVisible:function(){if(grid.timer){clearTimeout(grid.timer);}grid.timer=null;var dh=$(grid.bDiv).height();if(!dh){return;}var table=$("table:first",grid.bDiv);var rows,rh;if(table[0].rows.length){try{rows=table[0].rows[1];rh=rows?$(rows).outerHeight()||grid.prevRowHeight:grid.prevRowHeight;}catch(pv){rh=grid.prevRowHeight;}}if(!rh){return;}grid.prevRowHeight=rh;var rn=p.rowNum;var scrollTop=grid.scrollTop=grid.bDiv.scrollTop;var ttop=Math.round(table.position().top)-scrollTop;var tbot=ttop+table.height();var div=rh*rn;var page,npage,empty;if(tbot<dh&&ttop<=0&&(p.lastpage===undefined||parseInt((tbot+scrollTop+div-1)/div,10)<=p.lastpage)){npage=parseInt((dh-tbot+div-1)/div,10);if(tbot>=0||npage<2||p.scroll===true){page=Math.round((tbot+scrollTop)/div)+1;ttop=-1;}else{ttop=1;}}if(ttop>0){page=parseInt(scrollTop/div,10)+1;npage=parseInt((scrollTop+dh)/div,10)+2-page;empty=true;}if(npage){if(p.lastpage&&(page>p.lastpage||p.lastpage===1||(page===p.page&&page===p.lastpage))){return;}p.page=page;if(empty){grid.emptyRows.call(table[0],false);}grid.populate(npage);$(ts).setErrorCells();$(ts).setErrorRows();}},scrollGrid:function(e){if(p.scrollPage){var scrollTop=grid.bDiv.scrollTop;if(grid.scrollTop===undefined){grid.scrollTop=0;}if(scrollTop!==grid.scrollTop){grid.scrollTop=scrollTop;if(grid.timer){clearTimeout(grid.timer);}grid.timer=setTimeout(grid.populateVisible,p.scrollTimeout);}}grid.hDiv.scrollLeft=grid.bDiv.scrollLeft;if(e){e.stopPropagation();}}};var setColWidth=function(){var th=this;th.p.scrollOffset=18;var initwidth=0,scw=$.ygrid.intNum(th.p.scrollOffset),cw;$.each(th.p.colModel,function(index,col){if(this.hidden===undefined){this.hidden=false;}this.widthOrg=cw=$.ygrid.intNum(col.width);if(this.hidden===false){initwidth+=cw;}});if(isNaN(th.p.width)){th.p.width=initwidth+(!isNaN(th.p.height)?scw:0);}grid.width=th.p.width;th.p.tblwidth=initwidth;};var getOffset=function(iCol){var th=this,$th=$(th.grid.headers[iCol].el);var ret=[$th.position().left+$th.outerWidth()];ret[0]-=th.grid.bDiv.scrollLeft;ret.push($(th.grid.hDiv).position().top);ret.push($(th.grid.bDiv).offset().top-$(th.grid.hDiv).offset().top+$(th.grid.bDiv).height());return ret;};var getColumnHeaderIndex=function(th){var $t=this,i,headers=$t.grid.headers,ci,len=headers.length;for(i=0;i<len;i++){if(th===headers[i].el){ci=i;break;}}return ci;};ts.getCellEditOpt=function(rdata,colPos){if(rdata==undefined){return{};}var cellKey=rdata.cellKeys[colPos-(ts.p.rowSequences?1:0)],editOpt=ts.p.cellLookup[cellKey];if(editOpt==undefined){editOpt={};}return editOpt;};var formatCol=function(pos,rowInd,tv,cellval,rdata){var th=this,cm=th.p.colModel[pos],editOpt=th.getCellEditOpt(rdata,pos),ral=editOpt.align==undefined?cm.align:editOpt.align,result=["style='"],nm=cm.name;if(ral){result.push("text-align:");result.push(ral);result.push(";");}if(editOpt.backColor){result.push("background-color:");result.push(editOpt.backColor);result.push(";");}if(editOpt.foreColor){result.push("color:");result.push(editOpt.foreColor);result.push(";");}if(nm=="rn"){if(th.p.backColor){result.push("background-color:");result.push(th.p.backColor);result.push(";");}if(th.p.foreColor){result.push("color:");result.push(th.p.foreColor);result.push(";");}}if(cm.hidden===true){result.push("display:none;");}if(editOpt.edittype=="numberEditor"&&parseFloat(cellval[0])<0){result.push("color:");result.push(editOpt.editOptions.negtiveForeColor);}result.push("' class='");if(cellval!==undefined&&((cellval[2]==null&&!th.getControlGrid().isEnable())||cellval[2]===false)){result.push("ui-cell-disabled ");}if(editOpt.editOptions==null||editOpt.editOptions.edittype=="label"){result.push("ui-cell-disabled ");}var rowExpIndex=th.getControlGrid().rowExpandIndex;if((th.p.rowSequences==true?rowExpIndex+1:rowExpIndex)==pos){result.push("ui-cell-disabled ");}if(editOpt.isRequired&&(cellval==null||cellval[1]==null||cellval[1]=="")){result.push("ui-cell-required ");cellval[3]=true;}result.push("'");result.push($.fmatter.isEmpty(tv)?"":[" title='",$.ygrid.stripHtml(tv),"' "].join(""));result.push(" aria-describedby='");result.push([th.p.id,"_",nm,"'"].join(""));result=result.join("");return result;};var addCell=function(rowId,cell,pos,irow,srvr,isTreeCol){var v=cell[1];var prp=formatCol.call(ts,pos,irow,v,cell,srvr);var tcIcon="";if(isTreeCol){var pl=(srvr.treeLevel*16)+"px",icon=srvr.isExpand?"cell-expand":"cell-collapse";if(srvr.isLeaf){tcIcon=["<span class='cell-treeIcon ",ts.getControlGrid().treeExpand?" ui-state-disabled":"","' style='margin-left: ",pl,"'></span>"].join("");}else{tcIcon=["<span class='cell-treeIcon ",icon,ts.getControlGrid().treeExpand?" ui-state-disabled":"","' style='margin-left: ",pl,"'></span>"].join("");}}return['<td role="gridcell" ',prp,">",tcIcon,v,"</td>"].join("");};var addRowNum=function(pos,irow,pG,rN){var v=irow+1,prp=formatCol.call(ts,pos,irow,v);return['<td role="gridcell" class="ui-state-default ygrid-rownum" ',prp,">",v,"</td>"].join("");};var addGridRow=function(curRd,iRow,riOfData,isTemp){var rowData=[],th=this,nbIndex=th.p.rowSequences===true?1:0,asrds=[],rh="",rowId=$.ygrid.uidPref+(isTemp?-(riOfData+1):riOfData),treeColInd=-1;if(curRd.rowHeight){rh=curRd.rowHeight+"px";}rowData.push(['<tr style="height:',rh,'" role="row" id="',rowId,'" tabindex="-1" class="ui-widget-content ygrow ui-row-ltr">'].join(""));if(nbIndex){rowData.push(addRowNum(0,riOfData,th.p.page,th.p.rowNum));}for(var j=0,len=th.p.colModel.length;j<len-nbIndex;j++){var cm=th.p.colModel[j+nbIndex],cellKey=curRd.cellKeys[j],editOptions=th.p.cellLookup[cellKey];(editOptions&&editOptions.isAlwaysShow)?asrds.push(j+nbIndex):null;var v=curRd.data[cm.index],isTreeCol=(cm.name===th.p.treeColName);var cell=addCell(rowId,v,j+nbIndex,iRow,curRd,isTreeCol);if(isTreeCol){treeColInd=j+nbIndex;}rowData.push(cell);}rowData.push("</tr>");$("#"+th.p.id+" tbody:first").append(rowData.join(""));var row=th.rows[th.rows.length-1],treeCell,treeIcon,showFunc=th.p.alwaysShowCellEditor,rowHeight=(curRd.rowHeight===undefined?row.offsetHeight:curRd.rowHeight);for(var ci=0,adlen=asrds.length;ci<adlen;ci++){var iCol=asrds[ci],colM=th.p.colModel[iCol],nm=colM.name,editOpt=th.getCellEditOpt(curRd,iCol),val=curRd.data[colM.index],opt=$.extend({},editOpt.editOptions||{},{ri:riOfData,key:nm,id:iRow+"_"+nm,name:nm});if(editOpt.isAlwaysShow){if(showFunc&&$.isFunction(showFunc)){showFunc.call(th,$(row.cells[iCol]),iRow,iCol,colM,val,opt,rowHeight);}}}if(treeColInd!==-1){treeCell=row.cells[treeColInd];treeIcon=$("span.cell-treeIcon",treeCell);treeIcon.click(function(event){var grow=event.target.parentNode.parentNode,grind=parseInt($.ygrid.stripPref($.ygrid.uidPref,grow.id),10);if(th.p.treeIconClick&&$.isFunction(th.p.treeIconClick)&&!curRd.isLeaf){th.p.treeIconClick.call(th,th.p.data[grind],(grind+1));}});}return $(row);};var loadGridData=function(data,t,rcnt){if(data){if(!ts.p.scrollPage){grid.emptyRows.call(ts,false);rcnt=1;}else{rcnt=rcnt>1?rcnt:1;}}else{return;}ts.p.page=$.ygrid.intNum(data[ts.p.localReader.page],ts.p.page);ts.p.lastpage=$.ygrid.intNum(data[ts.p.localReader.total],1);ts.p.records=$.ygrid.intNum(data[ts.p.localReader.records]);ts.p.reccount=data.rows.length;for(var i=0,len=data.rows.length;i<len;i++){var ri=ts.p.data.indexOf(data.rows[i]);addGridRow.call(ts,data.rows[i],ri+rcnt,ri);}ts.refreshIndex();ts.updatePager.call(ts);};var afterRowOpt=function(ri,isDelete){var i,th=this,seq,rid,len=th.rows.length;for(i=ri;i<len;i++){if(th.p.rowSequences){seq=parseInt($(th.rows[i].cells[0]).html(),10);$(th.rows[i].cells[0]).html(seq+(isDelete?-1:+1));}rid=parseInt($.ygrid.stripPref($.ygrid.uidPref,th.rows[i].id),10);rid=rid+(isDelete?-1:+1);th.rows[i].id=$.ygrid.uidPref+rid;}ts.refreshIndex();};ts.refreshIndex=function(){ts.p._indexMap={};for(var ti=0,tlen=ts.rows.length;ti<tlen;ti++){ts.p._indexMap[$.ygrid.stripPref($.ygrid.uidPref,ts.rows[ti].id)]=ti;}};ts.deleteGridRow=function(ri){var th=this,gridRow=$(th).getGridRowById($.ygrid.uidPref+ri),rind;if(gridRow){rind=gridRow.rowIndex;th.p.data.splice(ri,1);$(gridRow).remove();afterRowOpt.call(th,rind,true);}};ts.insertGridRow=function(ri,rowData){var th=this,gridRow,lastRid=$.ygrid.stripPref($.ygrid.uidPref,th.rows[th.rows.length-1].id);var lri=isNaN(parseInt(lastRid,10))?0:parseInt(lastRid,10);th.p.data.splice(ri,0,rowData);if(ri<=lri+1){gridRow=addGridRow.call(th,rowData,ri+1,ri,true);gridRow.insertBefore($(th).getGridRowById($.ygrid.uidPref+ri));var seq,rid,nRi=gridRow[0].rowIndex+1,pRi=gridRow[0].rowIndex-1;if(th.rows[nRi]){if(th.p.rowSequences){seq=$(th.rows[nRi].cells[0]).html();$(gridRow[0].cells[0]).html(seq);}rid=th.rows[nRi].id;gridRow[0].id=rid;}else{if(th.rows[pRi]!==$("tr.ygfirstrow",th.grid.bDiv)[0]){if(th.p.rowSequences){seq=parseInt($(th.rows[pRi].cells[0]).html(),10);$(gridRow[0].cells[0]).html(seq+1);}rid=parseInt($.ygrid.stripPref($.ygrid.uidPref,th.rows[pRi].id),10);gridRow[0].id=$.ygrid.uidPref+(rid+1);}else{if(th.p.rowSequences){$(gridRow[0].cells[0]).html(1);}gridRow[0].id=$.ygrid.uidPref+0;}}afterRowOpt.call(th,gridRow[0].rowIndex+1,false);}};ts.modifyGridCell=function(ri,iCol,rowData){var th=this,cm=th.p.colModel[iCol],editOpt=th.getCellEditOpt(rowData,iCol),row=$(th).getGridRowById($.ygrid.uidPref+ri),cname=cm.name;if(row==undefined){return;}var cellV,cell=row.cells[iCol],value;if(cname=="rn"){return;}cellV=rowData.data[cm.index][1];value=rowData.data[cm.index][0];if(editOpt.isAlwaysShow){if(!rowData.isDetail){return;}$(".cellEditor",cell)[0].title=cellV;switch(editOpt.formatter){case"button":$(".cellEditor span.txt",cell).html(value);break;case"hyperlink":$(".cellEditor",cell).html(value);break;case"checkbox":$(".cellEditor input",cell)[0].checked=(value==1||value==true||value=="true");$(".cellEditor",cell)[0].title=(value==1||value==true||value=="true");break;case"image":cell.editor.setValue(value);break;}}else{$(cell).html(cellV);if(editOpt.edittype=="numberEditor"){if(value instanceof Decimal&&value.isNegative()){$(cell).css({color:editOpt.editOptions.negtiveForeColor});}else{$(cell).css({color:""});}}}};var initQueryData=function(){if(!$.isArray(ts.p.data)){return null;}var queryResults=ts.p.data,recordsperpage=parseInt(ts.p.rowNum,10),total=queryResults.length,page=parseInt(ts.p.page,10),totalpages=Math.ceil(total/recordsperpage),retresult={};queryResults=queryResults.slice((page-1)*recordsperpage,page*recordsperpage);retresult[ts.p.localReader.total]=totalpages==0?1:totalpages;retresult[ts.p.localReader.page]=page;retresult[ts.p.localReader.records]=total;retresult[ts.p.localReader.root]=queryResults;queryResults=null;return retresult;};grid.emptyRows=function(scroll){var firstrow=ts.rows.length>0?ts.rows[0]:null;$(this.firstChild).empty().append(firstrow);if(scroll&&ts.p.scrollPage){$(ts.grid.bDiv.firstChild).css({height:"auto"});$(ts.grid.bDiv.firstChild.firstChild).css({height:0,display:"none"});if(ts.grid.bDiv.scrollTop!==0){ts.grid.bDiv.scrollTop=0;}}};grid.populate=function(npage){var pvis=ts.p.scrollPage&&npage===false,lc;if(ts.p.page===undefined||ts.p.page<=0){ts.p.page=Math.min(1,ts.p.lastpage);}npage=npage||1;if(npage>1){lc=function(){if(ts.p.page==1&&ts.grid.scrollTop==0){return;}ts.p.page++;ts.grid.hDiv.loading=false;grid.populate(npage-1);};}var rcnt=!ts.p.scrollPage?1:ts.rows.length;var req=initQueryData();loadGridData(req,ts.grid.bDiv,rcnt);if(lc){lc.call(ts);}if(pvis){grid.populateVisible();}};ts.updatePager=function(){var th=this,from,to,total,base=parseInt(th.p.page,10)-1;if(base<0){base=0;}base=base*parseInt(th.p.rowNum,10);to=base+th.p.reccount;to=to>th.p.data.length?th.p.data.length:to;if(th.p.scrollPage){var rows=$("tbody:first > tr:gt(0)",th.grid.bDiv);base=to-rows.length;th.p.reccount=rows.length;var rh=rows.outerHeight()||th.grid.prevRowHeight;if(rh){var top=base*rh;var height=parseInt(th.p.records,10)*rh;$(">div:first",th.grid.bDiv).css({height:height}).children("div:first").css({height:top,display:top?"":"none"});if(th.grid.bDiv.scrollTop==0&&th.p.page>1){th.grid.bDiv.scrollTop=th.p.rowNum*(th.p.page-1)*rh;}}th.grid.bDiv.scrollLeft=th.grid.hDiv.scrollLeft;}var pgboxes=th.p.pager||"";if(pgboxes){$(["#add_",th.id,",#del_",th.id,", #upRow_",th.id,", #downRow_",th.id].join("")).each(function(){(th.p.enable&&th.p.treeType===-1&&!th.p.hasRowExpand)?$(this).removeClass("ui-state-disabled"):$(this).addClass("ui-state-disabled");});if(th.p.viewRecords){if(th.p.reccount===0){$(".ui-paging-info",pgboxes).html($.ygrid.defaults.emptyrecords);}else{from=base+1;total=th.p.records;$(".ui-paging-info",pgboxes).html($.ygrid.formatString($.ygrid.defaults.recordtext,from,to,total));}}if(th.p.showPageSet){$(".ui-pg-input",pgboxes).val(th.p.page);var cp=$.ygrid.intNum(th.p.page,1),last=$.ygrid.intNum(th.p.lastpage,1);var tspg="_"+th.p.pager.substr(1);if(cp===1){$("#first"+tspg+", #prev"+tspg).addClass("ui-state-disabled").removeClass("ui-state-hover");}else{$("#first"+tspg+", #prev"+tspg).removeClass("ui-state-disabled");}if(cp===last){$("#next"+tspg+", #last"+tspg).addClass("ui-state-disabled").removeClass("ui-state-hover");}else{$("#next"+tspg+", #last"+tspg).removeClass("ui-state-disabled");}}}};if(ts.tagName.toUpperCase()!=="TABLE"){alert($.ygrid.error.isNotTable);return;}if(document.documentMode!==undefined){if(document.documentMode<5){alert($.ygrid.error.isErrorMode);return;}}$(this).empty().attr("tabindex","0");this.p=p;this.grid=grid;this.p.useProp=!!$.fn.prop;if(this.p.colNames.length===0){for(var ci=0,len=this.p.colModel.length;ci<len;ci++){var name=this.p.colModel[ci].label||this.p.colModel[ci].name,formulaCaption=this.p.colModel[ci].formulaCaption;if(formulaCaption!=null&&formulaCaption.length>0){var form=YIUI.FormStack.getForm(this.getControlGrid().ofFormID);name=form.eval(formulaCaption,{form:form});}this.p.colNames[ci]=name;}}if(this.p.colNames.length!==this.p.colModel.length){alert($.ygrid.errors.model);return;}if(this.p.rowSequences){this.p.colNames.unshift($.ygrid.defaults.seqColText);this.p.colModel.unshift({label:$.ygrid.defaults.seqColText,name:"rn",width:ts.p.rowSeqWidth,sortable:false,resizable:true,align:"center"});}var gv=$("<div class='ui-ygrid-view'></div>");$(gv).insertBefore(this);$(this).removeClass("scroll").appendTo(gv);var eg=$("<div class='ui-ygrid ui-widget ui-widget-content'></div>");$(eg).attr({id:"gbox_"+this.id,dir:"ltr"}).insertBefore(gv);$(gv).attr("id",this.id+"_view").appendTo(eg);$(this).attr({cellspacing:"0",cellpadding:"0",border:"0","role":"grid","aria-labelledby":"gbox_"+this.id});this.p.id=this.id;ts.p.localReader=$.extend(true,{root:"rows",page:"page",total:"total",records:"records",cell:"cell",id:"id"},ts.p.localReader);if(ts.p.scrollPage){ts.p.showPageSet=false;}setColWidth.call(ts);$(eg).css("width",grid.width+"px");$(gv).before("<div class='ui-ygrid-resize-mark' id='rs_m"+ts.p.id+"'>&#160;</div>");var hTable=$(["<table class='ui-ygrid-htable' style='width:",ts.p.tblwidth,"px' role='ygrid' aria-labelledby='gbox_",this.id,"' cellspacing='0' cellpadding='0' border='0'></table>"].join("")),hb=$("<div class='ui-ygrid-hbox-ltr'></div>").append(hTable);grid.hDiv=document.createElement("div");$(grid.hDiv).addClass("ui-state-default ui-ygrid-hdiv").css({width:grid.width+"px"}).append(hb);grid.hDiv.onselectstart=function(){return false;};$(ts).before(grid.hDiv);var thead=["<thead><tr class='ui-ygrid-headers' role='rowheader'>"];var tdc=$.ygrid.msie?"class='ui-th-div-ie'":"";var imgs=["<span class='s-ico' style='position: absolute;top:0;right:0;display:none;'>","<span class='ui-ygrid-ico-sort ui-icon-asc ui-state-disabled ui-icon ui-sort-ltr'/>","<span class='ui-ygrid-ico-sort ui-icon-desc ui-state-disabled ui-icon ui-sort-ltr'/>","</span>"].join("");for(var i=0,clen=ts.p.colNames.length;i<clen;i++){var tooltip=[' title="',ts.p.colNames[i],'"'].join(""),cm=ts.p.colModel[i],cname=cm.name;thead.push("<th id='");thead.push([ts.p.id,"_",cname].join(""));thead.push("' role='columnheader' class='ui-state-default ui-th-column ui-th-ltr'");thead.push(tooltip);thead.push(">");thead.push("<div id='");thead.push([$.ygrid.uidPref,"_",ts.p.id,"_",cname].join(""));thead.push("' ");thead.push(tdc);thead.push("><span style='overflow: hidden;position: absolute;left: 0;width: 100%;' class='colCaption'>");var colIndex=(i+(ts.p.rowSequences?-1:0));if(ts.p.selectFieldIndex!=-1&&ts.p.selectFieldIndex==colIndex){var margin=(ts.p.colNames[i]==""?"":"margin-bottom: 3px;margin-right: 3px;");thead.push("<Input type='checkbox' style='");thead.push(margin);thead.push(["vertical-align: middle' ofColIndex=",i,ts.p.enable?"":" disabled='disabled'",">"].join(""));thead.push(ts.p.colNames[i]);thead.push(" </span>");}else{thead.push(ts.p.colNames[i]);thead.push("</span>");}if(!cm.width){cm.width=150;}else{cm.width=parseInt(cm.width,10);}thead.push(imgs);thead.push("</div></th>");}thead.push("</tr></thead>");imgs=null;hTable.append(thead.join(""));$("input",hTable).click(function(e){var ci=parseInt($(this).attr("ofColIndex"),10)-(ts.p.rowSequences?1:0),newValue=this.checked;ts.getControlGrid().gridHandler.doAllChecked(ts.getControlGrid(),ci,newValue);e.stopPropagation();});$(ts).reShowCheckColumn();thead=$("thead:first",grid.hDiv).get(0);var thr=$("tr:first",thead),w,res,sort,cModel;var firstRow=["<tr class='ygfirstrow' role='row' style='height:auto'>"];$("th",thr).each(function(j){cModel=ts.p.colModel[j];w=cModel.width;if(cModel.resizable===undefined){cModel.resizable=true;}if(cModel.resizable){res=document.createElement("span");$(res).html("&#160;").addClass("ui-ygrid-resize ui-ygrid-resize-ltr").css("cursor","col-resize");}else{res="";}$(this).css("width",w+"px").prepend(res);res=null;var hdcol="";if(cModel.hidden){$(this).css("display","none");hdcol="display:none;";}firstRow.push("<td role='gridcell' style='height:0px;width:");firstRow.push(w+"px;");firstRow.push(hdcol);firstRow.push("'></td>");grid.headers[j]={width:w,el:this};if(typeof cModel.sortable!=="boolean"){cModel.sortable=true;}$(">div",this).addClass("ui-ygrid-sortable");}).mousedown(function(e){if($(e.target).closest("th>span.ui-ygrid-resize").length==1){var ci=getColumnHeaderIndex.call(ts,this);grid.dragStart(ci,e,getOffset.call(ts,ci));}}).click(function(e){var ci=getColumnHeaderIndex.call(ts,this);var sort=ts.p.colModel[ci].sortable;if(!ts.p.lastsort){ts.p.sortorder="asc";}else{if(ts.p.lastsort===ci){ts.p.sortorder=(ts.p.sortorder=="asc"?"desc":"asc");}else{var previousSelectedTh=ts.grid.headers[ts.p.lastsort].el;$("div span.s-ico",previousSelectedTh).hide();$("div span.colCaption",previousSelectedTh).css({width:"100%"});$("span.ui-ygrid-ico-sort",previousSelectedTh).addClass("ui-state-disabled");ts.p.sortorder="asc";}}if(sort){$("div span.s-ico",this).show();var width=this.clientWidth-$("div span.s-ico",this)[0].clientWidth;$("div span.colCaption",this).css({width:width+"px"});$("span.ui-ygrid-ico-sort",this).addClass("ui-state-disabled");$("div span.ui-icon-"+ts.p.sortorder,this).removeClass("ui-state-disabled");if($.isFunction(ts.p.onSortClick)){ts.p.onSortClick.call(ts,getColumnHeaderIndex.call(ts,this),ts.p.sortorder=="asc"?"desc":"asc");}else{}ts.p.lastsort=ci;}else{ts.p.lastsort=null;}}).dblclick(function(e){var ci=getColumnHeaderIndex.call(ts,this),headTh=ts.grid.headers[ci].el;var oldWidth=headTh.offsetWidth,width=$.ygrid.getTextWidth(headTh.title);if($("input",headTh).length>0){width+=14;}$(".ygrow",ts.grid.bDiv).each(function(){var td=$("td",this)[ci],tdWidth=$.ygrid.getTextWidth(td.title);if(tdWidth>width){width=tdWidth;}});width+=5;grid.newWidth=p.tblwidth+(width-oldWidth);grid.resizing={idx:ci};grid.headers[ci].newWidth=width;grid.dragEnd();});firstRow.push("</tr>");var tbody=document.createElement("tbody");this.appendChild(tbody);$(this).addClass("ui-ygrid-btable").append(firstRow.join(""));firstRow=null;if($.ygrid.msie){if(String(ts.p.height).toLowerCase()==="auto"){ts.p.height="100%";}}grid.bDiv=document.createElement("div");var height=ts.p.height+(isNaN(ts.p.height)?"":"px");$(grid.bDiv).addClass("ui-ygrid-bdiv").css({height:height,width:grid.width+"px"}).append($('<div style="position:relative;'+($.ygrid.msie&&$.ygrid.msiever()<8?"height:0.01%;":"")+'"></div>').append("<div></div>").append(this)).scroll(grid.scrollGrid);$("table:first",grid.bDiv).css({width:ts.p.tblwidth+"px"});if(!$.support.tbody){if($("tbody",this).length===2){$("tbody:gt(0)",this).remove();}}$(grid.hDiv).after(grid.bDiv);$(gv).mousemove(function(e){if(grid.resizing){grid.dragMove(e);}});$(".ui-ygrid-labels",grid.hDiv).bind("selectstart",function(){return false;});$(document).bind("mouseup.yGrid"+ts.p.id,function(){if(grid.resizing){grid.dragEnd();return false;}return true;});if(ts.p.populate){grid.populate();}this.grid.cols=this.rows[0].cells;grid.clearSelectCells=function(){if(ts.p.selectCells){for(var i=0,len=ts.p.selectCells.length;i<len;i++){$(ts.p.selectCells[i]).removeClass("ui-state-highlight").removeClass("ui-cell-multiselect");}}ts.p.selectCells=[];};$(grid.bDiv).mousemove(function(e){if(ts.selecting&&e.target.tagName==="TD"){var fc=ts.p.selectCells[0],lc=e.target;if(fc==null){return;}var bri=Math.min(fc.parentElement.rowIndex,lc.parentElement.rowIndex),eri=Math.max(fc.parentElement.rowIndex,lc.parentElement.rowIndex),bci=Math.min(fc.cellIndex,lc.cellIndex),eci=Math.max(fc.cellIndex,lc.cellIndex);grid.clearSelectCells();ts.p.selectCells.push(fc);$(fc).addClass("ui-state-highlight");if(e.target==fc){return;}ts.p.selectRow=fc.parentElement.id;ts.p.selectCell=fc.cellIndex;for(var ri=bri;ri<=eri;ri++){var row=ts.rows[ri];if(!row){continue;}for(var ci=bci;ci<=eci;ci++){var cell=row.cells[ci];if($.inArray(ts.p.selectCells,cell)===-1&&cell!==fc){$(cell).addClass("ui-cell-multiselect");ts.p.selectCells.push(cell);}}}}});$(ts).mousedown(function(e){if(e.target.tagName==="TD"&&ts.p.selectionMode!=YIUI.SelectionMode.ROW){document.onselectstart=function(){return false;};var td=e.target;var ptr=$(td,ts.rows).closest("tr.ygrow");$("td.ui-state-highlight",ts.grid.bDiv).removeClass("ui-state-highlight");grid.clearSelectCells();ts.p.selectCells.push(e.target);$(e.target).addClass("ui-state-highlight");ts.selecting=true;}}).mouseup(function(e){if(e.target.tagName==="TD"){document.onselectstart=function(){return true;};}ts.selecting=false;if(e.target.tagName==="INPUT"){return;}window.setTimeout(function(){if(ts.grid){var scrollLeft=ts.grid.bDiv.scrollLeft,scrollTop=ts.grid.bDiv.scrollTop;$("#"+ts.p.knv).attr("tabindex","-1").focus();ts.grid.bDiv.scrollTop=scrollTop;ts.grid.bDiv.scrollLeft=scrollLeft;}},0);}).click(function(e){var td=e.target;var ptr=$(td,ts.rows).closest("tr.ygrow");if($(ptr).length===0||ptr[0].className.indexOf("ui-state-disabled")>-1){return;}var ri=ptr[0].id,ci=$.ygrid.getCellIndex(td);if(td.tagName!=="TD"){return;}if(ts.p.selectRow!=ri||ts.p.selectCell!=ci){if(ts.p.selectRow){var preSelRow=$(ts).yGrid("getGridRowById",ts.p.selectRow);if(preSelRow!=null){if(ts.p.selectionMode==YIUI.SelectionMode.ROW){$(preSelRow.cells).each(function(){$(this).removeClass("ui-state-highlight");});}else{$(preSelRow.cells[ts.p.selectCell]).removeClass("ui-state-highlight");}}}if(ts.p.editCells.length>0){$(ts).yGrid("saveCell",ts.p.editCells[0].ir,ts.p.editCells[0].ic);}if($.isFunction(ts.p.onSelectRow)){!td.notOnSelectRow&&ts.p.onSelectRow.call(ts,ptr[0].rowIndex,ri);ts.p.selectRow=ri;ts.p.selectCell=ci;window.setTimeout(function(){if(ts.p==null||ts.grid==null){return;}var scrollLeft=ts.grid.bDiv.scrollLeft,scrollTop=ts.grid.bDiv.scrollTop,knv=$("#"+ts.p.knv);knv.css({left:e.clientX+"px",top:e.clientY+"px"});knv.attr("tabindex","-1").focus();ts.grid.bDiv.scrollTop=scrollTop;ts.grid.bDiv.scrollLeft=scrollLeft;},0);}var cr=$(ts).yGrid("getGridRowById",ri);if(cr!=null){if(ts.p.selectionMode==YIUI.SelectionMode.ROW){grid.clearSelectCells();$(cr.cells).each(function(){$(this).addClass("ui-state-highlight");if(!$(this).hasClass("ygrid-rownum")){ts.p.selectCells.push(this);}});}else{$(cr.cells[ci]).addClass("ui-state-highlight");}}}else{$(ts).yGrid("editCell",ptr[0].rowIndex,ci,true,e);}}).dblclick(function(e){var td=e.target;if($.ygrid.msie){$(td).click();}var ptr=$(td,ts.rows).closest("tr.ygrow");if($(ptr).length===0){return;}var ri=ptr[0].rowIndex;if($.isFunction(ts.p.ondblClickRow)){ts.p.ondblClickRow.call(ts,ri);}}).bind("reloadGrid",function(e,opts){var $rowHeader=$("tr.ui-ygrid-headers",ts.grid.hDiv);var firstRow=$("tr.ygfirstrow",grid.bDiv);if(ts.p.colModel.isChange){ts.p.colModel.isChange=false;$(ts.grid.headers).each(function(iCol){var th=this.el;if(ts.p.colModel[iCol].hidden){$(th).css("display","none");firstRow.find("td").eq(iCol).css("display","none");}else{$(th).css("display","");firstRow.find("td").eq(iCol).css("display","");}});if(ts.p.groupHeaders.length>0){for(var i=0,len=ts.grid.headers.length;i<len;i++){var header=ts.grid.headers[i].el,cells=$rowHeader[0].cells;$("div",header).attr("style","");if($.inArray(cells,header)==-1){$rowHeader.append(header);}else{header.after(ts.grid.headers[i-1].el);}}$(ts.grid.hDiv).find("tr.ui-ygrid-columnheader").remove();$(ts).initGroupHeaders(ts.p.groupHeaders);}}if(opts&&opts.page){var page=opts.page;if(page>ts.p.lastpage){page=ts.p.lastpage;}if(page<1){page=1;}ts.p.page=page;if(ts.grid.prevRowHeight){ts.grid.bDiv.scrollTop=(page-1)*ts.grid.prevRowHeight*ts.p.rowNum;}else{ts.grid.bDiv.scrollTop=0;}}if(ts.grid.prevRowHeight&&ts.p.scrollPage){delete ts.p.lastpage;ts.grid.populateVisible();}else{ts.grid.populate();}});if(this.p.showPager){var op=$.extend(this.p.navButtons,$.ygrid.nav);var pager=$("<div id='"+this.p.id+"_pager'></div>");var toolbar=$("<div class='ui-ygrid-toolbar'></div>");var onHoverIn=function(){if(!$(this).hasClass("ui-state-disabled")){$(this).addClass("ui-state-hover");}},onHoverOut=function(){$(this).removeClass("ui-state-hover");};this.grid.toolbar=toolbar;ts.p.pager="#"+pager[0].id;pager.css({width:grid.width+"px"}).addClass("ui-state-default ui-ygrid-pager").attr("dir","ltr").appendTo(eg);toolbar.prependTo(eg);toolbar.append(["<table cellpadding='0' border='0' class='ui-toolbar-table' style='width:100%;' role='row'>","<tbody><tr><td id='",pager[0].id,"_left' align='left' style='width:300px'></td>","</tr></tbody></table>"].join(""));pager.append(["<div id='pg_",pager[0].id,"' class='ui-pager-control' role='group' style='height:100%'>","<table cellpadding='0' border='0' class='ui-pg-table' style='width:100%;height:100%;' role='row'>","<tbody><tr>","<td id='",pager[0].id,"_center' align='center' class='pager-center' style='white-space:pre;'></td>","<td id='",pager[0].id,"_right' align='right' style='width:300px'></td>","</tr></tbody></table></div>"].join(""));var tbd,navBTtbl=$("<table cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),sep="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>";if(op.add){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.addIcon,"'></span>",op.addtext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.addtitle||"",id:"add_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.addFunc)){op.addFunc.call(ts,"add");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.del){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.delIcon,"'></span>",op.deltext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.deltitle||"",id:"del_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.delFunc)){op.delFunc.call(ts,"del");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.upRow){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.upRowIcon,"'></span>",op.uprowtext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.uprowtitle||"",id:"upRow_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.upRowFunc)){op.upRowFunc.call(ts,"upRow");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.downRow){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.downRowIcon,"'></span>",op.downrowtext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.downrowtitle||"",id:"downRow_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.downRowFunc)){op.downRowFunc.call(ts,"downRow");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.add||op.del||op.upRow||op.downRow){$("tr",navBTtbl).append(sep);}$(ts.p.pager+"_left").append(navBTtbl);tbd=null;navBTtbl=null;if(ts.p.showPageSet){var pgcnt="pg_"+pager[0].id;var pgl=["<table cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>"];var po=["first_"+pager[0].id,"prev_"+pager[0].id,"next_"+pager[0].id,"last_"+pager[0].id];var pagination="<td><div id='pagination_"+pager[0].id+"' class='ui-pagination'><ul></ul></div></td>";pgl.push("<td id='");pgl.push(po[0]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-first'></span></td>");pgl.push("<td id='");pgl.push(po[1]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-prev'></span></td>");pgl.push(pagination);pgl.push("<td id='");pgl.push(po[2]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-next'></span></td>");pgl.push("<td id='");pgl.push(po[3]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-end'></span></td>");pgl.push("</tr></tbody></table>");$(ts.p.pager+"_center",ts.p.pager).append(pgl.join(""));var tp="_"+ts.p.pager.substr(1);$("#first"+tp+", #prev"+tp+", #next"+tp+", #last"+tp).click(function(){if($(this).hasClass("ui-state-disabled")){return false;}var cp=$.ygrid.intNum(ts.p.page,1),last=$.ygrid.intNum(ts.p.lastpage,1),selclick=false,fp=true,pp=true,np=true,lp=true,el=this;if(last===1){fp=false;pp=false;np=false;lp=false;}else{if(last>1&&cp>=1){if(cp===1){fp=false;pp=false;}else{if(cp===last){np=false;lp=false;}}}}if(el.id==="first"+tp&&fp){ts.p.page=1;selclick=true;}if(el.id==="prev"+tp&&pp){ts.p.page=(cp-1);selclick=true;}if(el.id==="next"+tp&&np){ts.p.page=(cp+1);selclick=true;}if(el.id==="last"+tp&&lp){ts.p.page=last;selclick=true;}if(selclick){grid.populate();}return false;});$("input.ui-pg-input","#"+pgcnt).keypress(function(e){var key=e.charCode||e.keyCode||0;if(key===13){$(this).val($.ygrid.intNum($(this).val(),1));ts.p.page=($(this).val()>0)?$(this).val():ts.p.page;if(ts.p.page>ts.p.lastpage){ts.p.page=ts.p.lastpage;}grid.populate();return false;}else{if(key>=48&&key<=57){return this;}}return false;});}if(ts.p.viewRecords===true){$(ts.p.pager+"_right",ts.p.pager).append("<div style='text-align:right' class='ui-paging-info'></div>");}ts.updatePager.call(ts);$(ts).bindKeys();}});};})(jQuery);(function(a){a.ygrid.extend({getGridParam:function(b){var c=this[0];if(!c||!c.grid){return null;}if(!b){return c.p;}return c.p[b]!==undefined?c.p[b]:null;},reShowCheckColumn:function(){return this.each(function(){var f=this,e=a(f.grid.hDiv).find(".ui-ygrid-htable"),d;for(var c=0,b=this.p.data.length;c<b;c++){d=this.p.data[c];if(d.isDetail&&d.bookmark!=undefined){break;}}a("input",e).each(function(){if(d==undefined){return;}var g=d.data[parseInt(a(this).attr("ofColIndex"),10)-(f.p.rowSequences?1:0)];if(g[2]){a(this).removeAttr("disabled");}else{if(g[2]==undefined&&f.p.enable){a(this).removeAttr("disabled");}else{a(this).attr("disabled","disabled");}}});});},setGridParam:function(b){return this.each(function(){if(this.grid&&typeof b==="object"){for(var c in b){var d=b[c];if(a.isArray(d)){this.p[c]=d.slice(0);}else{this.p[c]=d;}}}});},refreshData:function(){return this.each(function(){var e=this,d=e.grid.bDiv.scrollTop,c=e.grid.bDiv.scrollLeft;if(!e.grid){return;}var b=a("#"+e.p.id+" tbody:first tr:first")[0];a("#"+e.p.id+" tbody:first").empty().append(b);e.updatePager.call(e);e.grid.populate();a(e).setErrorCells();a(e).setErrorRows();e.grid.bDiv.scrollTop=d;e.grid.bDiv.scrollLeft=c;});},clearGridData:function(){return this.each(function(){var c=this;if(!c.grid){return;}var b=a("#"+c.p.id+" tbody:first tr:first")[0];a("#"+c.p.id+" tbody:first").empty().append(b);c.p.selectRow=null;c.p.selectCell=null;c.p.editCells=[];c.p.records=0;c.p.page=1;c.p.lastpage=1;c.p.reccount=0;c.p.data=[];c.updatePager.call(c);});},bindKeys:function(){return this.each(function(){var c=function(g,f,e){var h,d=g.length;if(e==="next"){for(h=f+1;h<d;h++){if(g[h].hidden!==true){return h;}}}else{if(e==="pre"){for(h=f-1;h>=0;h--){if(g[h].hidden!==true){return h;}}}}return -1;};this.p.knv=this.p.id+"_kn";var b=a("#"+this.p.knv);if(b.length==0){b=a(["<div tabindex='-1' style='left:-1px;width:1px;height:0px;' id='",this.p.knv,"'></div>"].join("")).insertBefore(a(this.grid.bDiv).parents(".ui-ygrid-view")[0]);}b.focus().keydown(function(u,e){if(e!=null&&e.isPropagationStopped()){return;}var j=a(".ui-ygrid-btable",u.target.nextSibling)[0],o=j.p.colModel;j.keyEvent=true;var m=u.charCode||u.keyCode||0;if(m==0&&e!==undefined){m=e.charCode||e.keyCode||0;}var r=j.p.selectRow,n=j.p.selectCell,f,k;if(a(j).getGridRowById(r)==undefined){k=false;}else{if(m===13||m===108||m===9){r=a(j).getGridRowById(r).rowIndex;n=c(o,n,"next");if(n==-1){n=j.p.rowSequences?1:0;r=r+1;}if(r==j.rows.length){var l=a(j).yGrid("getGridRowById",j.p.selectRow);l&&a(l.cells[j.p.selectCell]).removeClass("ui-state-highlight");if(j.p.editCells.length>0){a(j).yGrid("saveCell",j.p.editCells[0].ir,j.p.editCells[0].ic);}j.getControlGrid().requestNextFocus();}k=true;}else{if(m===38){r=a(j).getGridRowById(r).rowIndex-1;if(r<0){return;}k=true;}else{if(m===40){r=a(j).getGridRowById(r).rowIndex+1;if(r>=j.rows.length){return;}k=true;}else{if(m===37){r=a(j).getGridRowById(r).rowIndex;n=c(o,n,"pre");if(n<(j.p.rowSequences?1:0)){return;}k=true;}else{if(m===39){r=a(j).getGridRowById(r).rowIndex;n=c(o,n,"next");if(n===-1||n>=o.length){return;}k=true;}}}}}}if(k&&j.p.selectRow&&j.p.selectCell){j.grid.clearSelectCells();a(a(j).getGridRowById(j.p.selectRow).cells[j.p.selectCell]).find(".celleditor").blur();f=j.rows[r];if(f){f.cells[n].click();a(j).scrollVisibleCell(r,n);}u.preventDefault();u.stopPropagation();}if(j.p.extKeyDownEvent&&a.isFunction(j.p.extKeyDownEvent)&&!u.ctrlKey){j.p.extKeyDownEvent.call(j,u);}j.keyEvent=false;if(u.ctrlKey){var w=a("#copyText"+j.p.id),s=j.grid.bDiv.scrollTop,h=j.grid.bDiv.scrollLeft;if(!w[0]){w=a("<textarea id='copyText"+j.p.id+"'></textarea>").appendTo(a(document.body));w.css({position:"fixed",top:"-10000px",left:h+"px",width:"1000px",height:"200px"});}var x=[],q=-1,g=(j.p.selectCells==undefined?0:j.p.selectCells.length);for(var v=0;v<g;v++){var d=j.p.selectCells[v],p=a.ygrid.stripHtml(a(d).html());r=d.parentElement.rowIndex-1;var t="";if(parseInt(q,10)>=0){if(r>q){t="\n";q=r;}}else{q=r;}if(t.length>0){x.pop();}x.push(t);x.push(p);x.push("\t");}x.pop();w.val(x.join(""));w.focus();w.select();w.keyup(function(y){var z=y.charCode||y.keyCode||0;j.grid.bDiv.scrollTop=s;j.grid.bDiv.scrollLeft=h;if(y.ctrlKey&&z==86){w.blur();if(j.p.afterPaste&&a.isFunction(j.p.afterPaste)){j.p.afterPaste.call(j,a("#copyText"+j.p.id).val());}}else{if(y.ctrlKey&&z==67){if(j.p.afterCopy&&a.isFunction(j.p.afterCopy)){j.p.afterCopy.call(j,a("#copyText"+j.p.id).val());}}}w.remove();window.setTimeout(function(){var A=j.grid.bDiv.scrollTop;a("#"+j.p.knv).attr("tabindex","-1").focus();j.grid.bDiv.scrollTop=A;},0);});j.grid.bDiv.scrollTop=s;j.grid.bDiv.scrollLeft=h;}});});},setGridWidth:function(b){return this.each(function(){if(!this.grid){return;}var c=this;if(isNaN(b)){return;}b=parseInt(b,10);c.grid.width=c.p.width=b;a("#gbox_"+c.p.id).css("width",b+"px");a(c.p.id+"_view").css("width",b+"px");a(c.grid.bDiv).css("width",(b-5)+"px");a(c.grid.hDiv).css("width",(b-5)+"px");if(c.p.showPager){a(c.p.pager).css("width",b+"px");}});},setGridHeight:function(b){return this.each(function(){var h=this;if(!h.grid){return;}var f=a(h.grid.hDiv).height();if(f===0){var d=a("tr.ui-ygrid-headers",h.grid.hDiv);var e=a("tr.ui-ygrid-columnheader",h.grid.hDiv).length+d.length;var c=a("th",d).height();f=(c+2)*e;}console.log();b=b-f-a(h.p.pager).height()-h.grid.toolbar.outerHeight(true)-2;var g=a(h.grid.bDiv);g.css({height:(b)+(isNaN(b)?"":"px")});h.p.height=b;if(h.p.scroll){h.grid.populateVisible();}});},initGroupHeaders:function(b){return this.each(function(){var d=this,g=b.length;d.p.groupHeaders=[];if(g>0){for(var e=0;e<g;e++){var f=b[e];a(d).setGroupHeaders(f);d.p.groupHeaders.push(f);}}var n=a("tr.ui-ygrid-columnheader",d.grid.hDiv);for(var j=n.length-1;j>=0;j--){var m=n[j];for(var o=0,l=0,h=m.cells.length;o<h;o++){var k=a(m.cells[o]),c=a(d.grid.headers[l].el);if(k[0].colSpan>1){l+=k[0].colSpan;}else{if(k[0].style.display!=="none"){c[0].rowSpan+=1;c.insertBefore(k);a("div",c).css({height:c.height()+"px",lineHeight:c.height()+"px"});k.remove();}l++;}}}});},setGroupHeaders:function(b){return this.each(function(){var o=function(B,z){var A=z.length;for(var j=0;j<A;j++){if(z[j].startColumnName===B){return j;}}return -1;};var c=this,l=b,n=a("tr.ui-ygrid-headers",c.grid.hDiv),s=a("<tr class='ui-ygrid-columnheader' role='columnheader'></tr>").insertBefore(n),h=a(c.grid.hDiv).find("tr.yg-first-row-header");if(h[0]===undefined){h=a("<tr>",{role:"row","aria-hidden":"true"}).addClass("yg-first-row-header").css("height","auto");}else{h.empty();}for(var u=0,w=c.p.colModel.length;u<w;u++){var e={height:0,width:c.grid.headers[u].width+"px",display:(c.p.colModel[u].hidden?"none":"")};a("<th>",{role:"gridcell"}).css(e).addClass("ui-first-th-ltr").appendTo(h);}var k,g,t,d,f;for(var v=0,p=c.p.colModel.length;v<p;v++){g=o(c.p.colModel[v].name,l);if(g>=0){k=l[g];var y=0,q=0,r=k.numberOfColumns,x=c.p.colModel.length;for(t=0,d=0;d<r&&(v+d<x);d++){if(!c.p.colModel[v+d].hidden){t++;y+=c.grid.headers[v+d].width+1;}else{q++;}}f=a('<th class="ui-state-default ui-th-column ui-th-ltr" role="columnheader"></th>').html(k.titleText).appendTo(s);if(t>0){f.attr("colspan",String(t));f.css({width:y+"px"});f.attr("title",f.text());}if(t===0){f.hide();f.attr("colspan",String(q));}v+=t-1+q;}else{var m=a('<th class="ui-state-default ui-th-column ui-th-ltr" role="columnheader"></th>').appendTo(s);if(c.p.colModel[v].hidden){m.hide();}}}a(c.grid.hDiv).find(".ui-ygrid-htable").children("thead").prepend(h);a(c).bind("yGridResizeStop.setGroupHeaders",function(A,z,j){h.find("th").eq(j).width(z-1);});});},getGridRowById:function(b){var c;this.each(function(){try{var d=this.rows.length;while(d--){if(b.toString()===this.rows[d].id){c=this.rows[d];break;}}}catch(f){c=a(this.grid.bDiv).find("#"+b);}});return c;},getGridRowAt:function(c){var b;this.each(function(){var d=this;b=d.rows[c];});return b;},getGridCellAt:function(d,c){var b;this.each(function(){var e=this;var f=e.rows[d];if(f){b=f.cells[c];}});return b;},setCellRequired:function(d,b,c){this.each(function(){var f=this.rows[d],e;if(f){e=f.cells[b];}if(e==null){return;}if(c){a(e).addClass("ui-cell-required");}else{a(e).removeClass("ui-cell-required");}});},setCellFocus:function(c,b){this.each(function(){var d=a(this).getGridCellAt(c,b);d&&a(d).click();});},setErrorCells:function(b){return this.each(function(){var c=this;if(c.p.errorCells){for(var g=0,j=c.p.errorCells.length;g<j;g++){var h=c.p.errorCells[g].cell;if(h){h.find("div").remove();h.removeAttr("position");h.attr({title:h.html()});}}}var f=b||c.p.errorCells;c.p.errorCells=[];if(f==undefined||f.length==0){return;}var n,m,l,d;for(var e=0,k=f.length;e<k;e++){n=f[e];m=a.ygrid.uidPref+n.rowIndex;l=a(c).getGridRowById(m);if(l){d=a(l.cells[n.colIndex+(c.p.rowSequences?1:0)]);d.attr({title:n.errorMsg}).css({position:"relative"});a("<div></div>").addClass("ui-cell-error").appendTo(d);n.cell=d;}c.p.errorCells.push(n);}});},setErrorRows:function(b){return this.each(function(){var c=this;if(c.p.errorRows){for(var f=0,g=c.p.errorRows.length;f<g;f++){var l=c.p.errorRows[f].row;if(l){a(l.cells[0]).find("div").remove();a(l.cells[0]).removeAttr("position");}}}var h=b||c.p.errorRows;if(h==undefined||h.length==0){return;}var j,m,k;c.p.errorRows=[];for(var e=0,d=h.length;e<d;e++){j=h[e];m=a.ygrid.uidPref+j.rowIndex;k=a(c).getGridRowById(m);if(k){a(k.cells[0]).attr({title:j.errorMsg}).css({position:"relative"});a("<div></div>").addClass("ui-cell-error").appendTo(a(k.cells[0]));j.row=k;}c.p.errorRows.push(j);}});},editCell:function(e,c,b,d){return this.each(function(){var j=this;if(!j.grid){return;}c=parseInt(c,10);j.p.selectRow=j.rows[e].id;if(j.p.editCells.length>0){if(b===true){if(e==j.p.iRow&&c==j.p.iCol){return;}}a(j).yGrid("saveCell",j.p.editCells[0].ir,j.p.editCells[0].ic);}var n=j.p.colModel[c],l=a.ygrid.stripPref(a.ygrid.uidPref,j.rows[e].id),p=j.p.data[l],g=j.getCellEditOpt(p,c),m=g.formatter;var q=n.name;if(q==="rn"||m==undefined||m=="button"||m=="hyperlink"||m=="checkbox"||m=="image"){return;}var o=a("td:eq("+c+")",j.rows[e]),k=p.data[n.index][2];if(k===undefined||k===null){k=n.editable;}if(k===undefined||k===null){k=j.p.enable;}var h=(p.isEditable===undefined?true:p.isEditable);if(k===true&&b===true&&h&&!o.hasClass("not-editable-cell")){if(parseInt(j.p.iCol,10)>=0&&parseInt(j.p.iRow,10)>=0){a("td:eq("+j.p.iCol+")",j.rows[j.p.iRow]).removeClass("edit-cell ui-state-highlight");a(j.rows[j.p.iRow]).removeClass("selected-row ui-state-hover");}a(o).addClass("edit-cell ui-state-highlight");a(j.rows[e]).addClass("selected-row ui-state-hover");if(!g.edittype){g.edittype="label";}j.p.editCells.push({ir:e,ic:c,name:q,v:p.data[n.index],cell:o});var f=a.extend({},g.editOptions||{},{event:d,key:g.key,id:e+"_"+q,name:q});if(g.customedit&&j.p.createCellEditor&&a.isFunction(j.p.createCellEditor)){j.p.createCellEditor.call(j,o,g.edittype,e,c,f);}}j.p.iCol=c;j.p.iRow=e;});},saveCell:function(c,b){return this.each(function(){var h=this,m;if(!h.grid){return;}if(h.p.editCells.length>=1){m=0;}else{m=null;}if(m!==null){var d=a("td:eq("+b+")",h.rows[c]),q,o=a.ygrid.stripPref(a.ygrid.uidPref,h.rows[c].id),e=h.getCellEditOpt(h.p.data[o],b),r=false;if(e.customedit&&h.p.endCellEditor&&a.isFunction(h.p.endCellEditor)){q=h.p.endCellEditor.call(h,d,e.edittype,c,b);}var j=(q==undefined?"":q[0]);var p=h.p.editCells[m].v===undefined?"":h.p.editCells[m].v[0];var g=function(t){var s=false;if(t==undefined||t==null||t.length==0){s=true;}return s;};var n=function(y,x){if(y==null&&x!==null){return false;}else{if(y!==null&&x==null){return false;}else{if(y==null&&x==null){return true;}else{if(y instanceof Decimal&&x instanceof Decimal){return y.equals(x);}}}}switch(e.edittype){case"dict":if(e.editOptions.multiSelect){if(y.length!=x.length){return false;}else{for(var u=0,s=y.length;u<s;u++){var v=false;for(var t=0,w=x.length;t<w;t++){if(y[u].oid==x[t].oid){v=true;break;}}if(!v){return false;}}return true;}}return y.oid==x.oid;}return y==x;};if((g(j)&&g(p))||n(j,p)){a(h).yGrid("restoreCell",c,b);}else{r=true;a(h).yGrid("setCell",h.rows[c].id,b,q,false,false);h.p.editCells.splice(0,1);}if(h.p.afterEndCellEditor&&a.isFunction(h.p.afterEndCellEditor)){h.p.afterEndCellEditor.call(h,d,e.edittype,r,c,b);}}if(h.p.errorCells){for(var f=0,l=h.p.errorCells.length;f<l;f++){var k=h.p.errorCells[f];if(k.rowIndex+1==c&&(h.p.rowSequences?k.colIndex+1:k.colIndex)==b){k.cell.attr({title:k.errorMsg}).css({position:"relative"});a("<div></div>").addClass("ui-cell-error").appendTo(k.cell);}}}});},restoreCell:function(c,b){return this.each(function(){var f=this,d;if(!f.grid){return;}if(f.p.editCells.length>=1){d=0;}else{d=null;}if(d!==null){var e=a("td:eq("+b+")",f.rows[c]);a(e).empty().attr("tabindex","-1");a(f).yGrid("setCell",f.rows[c].id,b,f.p.editCells[d].v,false,false);f.p.editCells.splice(0,1);}});},setCell:function(d,e,b,f,c){return this.each(function(){var h=this,k=-1,p,l;if(!h.grid){return;}if(isNaN(e)){a(h.p.colModel).each(function(q){if(this.name===e){k=q;return false;}});}else{k=parseInt(e,10);}if(k>=0){var g=a(h).yGrid("getGridRowById",d),n=parseInt(a.ygrid.stripPref(a.ygrid.uidPref,d),10);if(g){var m=a("td:eq("+k+")",g);if(b!==undefined){p=b[1];l={"title":p};a(m).html(p).attr(l);var o=h.p.colModel[k],j;h.p.data[n].data[o.index]=b;}if(typeof f==="string"){a(m).addClass(f);}else{if(f){a(m).css(f);}}if(typeof c==="object"){a(m).attr(c);}}}});},scrollVisibleCell:function(c,b){return this.each(function(){var j=this;var d=j.grid.bDiv.clientHeight,n=j.grid.bDiv.scrollTop,e=j.rows[c].offsetTop+j.rows[c].clientHeight,m=j.rows[c].offsetTop;if(e>=d+n){j.grid.bDiv.scrollTop=e-d+2;}else{if(m<n){j.grid.bDiv.scrollTop=j.rows[c].offsetTop;}}var h=j.grid.bDiv.clientWidth,g=j.grid.bDiv.scrollLeft,k=j.rows[c].cells[b].offsetLeft+j.rows[c].cells[b].clientWidth,l=j.rows[c].cells[b].offsetLeft;if(k>=h+parseInt(g,10)){j.grid.bDiv.scrollLeft=j.grid.bDiv.scrollLeft+j.rows[c].cells[b].clientWidth;}else{if(l<g){var f=l-j.rows[c].cells[b].clientWidth;j.grid.bDiv.scrollLeft=f<0?0:f;}}});},clearBeforeUnload:function(){return this.each(function(){var d=this.grid;if(a.isFunction(d.emptyRows)){d.emptyRows.call(this,true,true);}a(document).unbind("mouseup.yGrid"+this.p.id);a(d.hDiv).unbind("mousemove");a(d.bDiv).unbind("mousemove");a(this).unbind();d.dragEnd=null;d.dragMove=null;d.dragStart=null;d.emptyRows=null;d.populate=null;d.populateVisible=null;d.scrollGrid=null;d.clearSelectCells=null;d.timer=null;d.prevRowHeight=null;d.bDiv=null;d.hDiv=null;d.cols=null;var c,b=d.headers.length;for(c=0;c<b;c++){d.headers[c].el=null;}this.updatepager=null;this.refreshIndex=null;this.modifyGridCell=null;this.formatter=null;this.grid=null;this.p._indexMap=null;this.p.data=null;this.p=null;});},GridDestroy:function(){return this.each(function(){if(this.grid){if(this.p.pager){a(this.p.pager).remove();}try{a(this).clearBeforeUnload();a("#gbox_"+this.id).remove();}catch(b){}}});}});})(jQuery);(function(a){a.fmatter={};a.fn.fmatter=function(g,h,f,b,c){var d=h;f=a.extend({},a.ygrid.formatter,f);try{d=a.fn.fmatter[g].call(this,h,f,b,c);}catch(e){}return d;};a.extend(a.fmatter,{isBoolean:function(b){return typeof b==="boolean";},isObject:function(b){return(b&&(typeof b==="object"||a.isFunction(b)))||false;},isString:function(b){return typeof b==="string";},isNumber:function(b){return typeof b==="number"&&isFinite(b);},isValue:function(b){return(this.isObject(b)||this.isString(b)||this.isNumber(b)||this.isBoolean(b));},isEmpty:function(b){if(!this.isString(b)&&this.isValue(b)){return false;}if(!this.isValue(b)){return true;}b=a.trim(b).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return b==="";},extend:function(b,c){if(a.isFunction(c)){a.fn.fmatter[b]=c;}}});a.fn.fmatter.defaultFormat=function(c,b){return(a.fmatter.isValue(c)&&c!=="")?c:b.defaultValue||"&#160;";};a.fn.fmatter.hyperlink=function(d,b){var f={baseLinkUrl:b.baseLinkUrl,showAction:b.showAction,addParam:b.addParam||"",target:b.target,idName:b.idName},c="",e;if(b.colModel!==undefined&&b.colModel.formatOptions!==undefined){f=a.extend({},f,b.colModel.formatOptions);}if(f.target){c="target="+f.target;}if(f.baseLinkUrl){e=f.baseLinkUrl+f.showAction+"?"+f.idName+"="+b.rowId+f.addParam;}else{e="#";}if(a.fmatter.isString(d)||a.fmatter.isNumber(d)){return["<a  style='width: 100%' ",c," href='",e,"' class='ui-hyperlink'>",d,"</a>"].join("");}return a.fn.fmatter.defaultFormat(d,b);};a.fn.fmatter.button=function(c,b){if(a.fmatter.isString(c)||a.fmatter.isNumber(c)){c=typeof(c)=="undefined"?"":c;return"<button style='width: 100%;height: 100%' class='ui-button'>"+c+"</button>";}return a.fn.fmatter.defaultFormat(c,b);};a.fn.fmatter.checkbox=function(e,c){var f=a.extend({},c.checkbox),d;if(c.colModel!==undefined&&c.colModel.formatOptions!==undefined){f=a.extend({},f,c.colModel.formatOptions);}if(f.disabled===true||(c.colModel.editable===undefined?!this.p.enable:!c.colModel.editable)){d='disabled="disabled"';}else{d="";}if(a.fmatter.isEmpty(e)||e===undefined){e=false;}e=String(e);e=(e+"").toLowerCase();var b=e.search(/(false|f|0|no|n|off|undefined)/i)<0?" checked='checked' ":"";return"<input type=\"checkbox\" style='text-align: center' "+b+' value="'+e+'" offval="false" '+d+"/>";};a.fn.fmatter.textEditor=function(c,b){return a.fn.fmatter.defaultFormat(c,b);};a.fn.fmatter.numberEditor=function(c,b){if(isNaN(parseFloat(c))){c="";}return a.fn.fmatter.defaultFormat(c,b);};a.fn.fmatter.datePicker=function(e,d){if(!a.fmatter.isEmpty(e)){var c=d.colModel.editOptions;var b=new Date(parseFloat(e,10));return b.Format(c.formatStr);}return a.fn.fmatter.defaultFormat(e,d);};})(jQuery);YIUI.CellEditor=YIUI.extend({yesCom:null,value:null,setValue:function(a){this.value=a;},getValue:function(){return this.value;},render:function(a){a.append(this.yesCom.getEl());this.onRender(a);this.install();},getText:function(){return this.text;},setText:function(a){this.text=a;},getEl:function(){return this.yesCom.getEl();},onRender:$.noop,beforeDestroy:$.noop,install:$.noop});YIUI.CellEditor.CellTextEditor=YIUI.extend(YIUI.CellEditor,{behavior:YIUI.TextEditorBehavior,init:function(b){var a=this;b.valueChange=function(c){a.setValueWithEvent(c,true,true);};this.yesCom=new YIUI.Yes_TextEditor(b);this.yesCom.el.addClass("ui-txted");},onRender:function(a){this.base(a);this.yesCom.setEmbedText(this.yesCom.embedText);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());this.yesCom.setClearable(false);},getInput:function(){return this.yesCom.getInput();},setValueWithEvent:function(c,d,b){var a={oldVal:this.value,newVal:c,trim:this.yesCom.trim,textCase:this.yesCom.textCase,maxLength:this.yesCom.maxLength,invalidChars:this.yesCom.invalidChars};var f=this.yesCom;var e=function(g){f.value=g;f.caption=g;$("input",f.el).val(g);};return this.behavior.checkAndSet(a,e);},setValue:function(a){this.setValueWithEvent(a,true,true);this.base(this.yesCom.value);},getValue:function(){return this.yesCom.value;},getText:function(){return this.yesCom.value;},finishInput:function(){return this.yesCom.finishInput();},install:function(){this.base();var a=this;this.getInput().blur(function(b){a.yesCom.saveCell();});}});YIUI.CellEditor.CellNumberEditor=YIUI.extend(YIUI.CellEditor,{init:function(c){var a="";for(var b=0;b<c.decPrecision-c.decScale;b++){a+="9";}if(c.decScale>0){a+=".";for(var b=0;b<c.decScale;b++){a+="9";}}this.settings={aNum:"0123456789",aSep:c.useSep?c.sep:"",dGroup:c.groupingSize,aDec:c.decSep,aSign:"",pSign:"s",vMax:a,vMin:"-"+a,mDec:c.decScale,mPre:c.decPrecision,mRound:c.roundingMode,altDec:null};c.settings=this.settings;this.yesCom=new YIUI.Yes_NumberEditor(c);this.yesCom.el.addClass("ui-numed");},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());this.yesCom.getInput().css({width:"100%",height:"100%",padding:"0 2px 0 2px",margin:0});},getInput:function(){return this.yesCom.getInput();},setValue:function(a){this.base(a);this.yesCom.setValue(a);},getValue:function(){return this.yesCom.getValue();},getText:function(){return this.yesCom.getInput().val();},finishInput:function(){return this.yesCom.finishInput();},install:function(){this.base();var a=this;this.getInput().blur(function(b){a.yesCom.saveCell();});}});YIUI.CellEditor.CellDatePicker=YIUI.extend(YIUI.CellEditor,{init:function(a){this.yesCom=new YIUI.Yes_DatePicker(a);this.yesCom.el.addClass("ui-dp");a.formatStr&&this.yesCom.setFormatStr(a.formatStr);a.isNoTimeZone&&this.yesCom.setIsNoTimeZone(a.isNoTimeZone);a.isOnlyDate&&this.yesCom.setOnlyDate(a.isOnlyDate);a.regional&&this.yesCom.setRegional(a.regional);a.calendars&&this.yesCom.setCalendars(a.calendars);},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());},setValue:function(a){this.base(a);this.yesCom.setValue(a);},getValue:function(){return this.yesCom.getValue();},getDropBtn:function(){return this.yesCom.getBtn();},getDropView:function(){return this.yesCom.getDropView();},getInput:function(){return this.yesCom.getInput();},finishInput:function(){},beforeDestroy:function(){this.yesCom.getDropView().remove();},getText:function(){return this.yesCom.getInput().val();},install:function(){}});YIUI.CellEditor.CellComboBox=YIUI.extend(YIUI.CellEditor,{init:function(a){a=$.extend(true,a,{multiSelect:a.type!=="combobox",getItems:function(){YIUI.ComboBoxHandler.getComboboxItems(this,a.cxt);},getValue:function(){return this.getSelValue();}});this.yesCom=new YIUI.Yes_Combobox(a);this.yesCom.setEditable(a.editable);this.yesCom.getEl().addClass("ui-cmb");a.items&&this.yesCom.setItems(a.items);},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());},setValue:function(a){this.base(a);this.yesCom.setSelValue(a);},getValue:function(){var a=this.yesCom.getSelValue();if(this.integerValue){a=YIUI.TypeConvertor.toInt(a);}return a;},getText:function(){return this.yesCom.getText();},setText:function(a){this.yesCom.setText(a);},getInput:function(){return this.yesCom._textBtn;},getDropBtn:function(){return this.yesCom._dropBtn;},beforeDestroy:function(){this.yesCom._dropView.remove();}});YIUI.CellEditor.CellDict=YIUI.extend(YIUI.CellEditor,{cellDictHandler:YIUI.DictHandler,init:function(b){var a=this;var c=YIUI.FormStack.getForm(b.ofFormID);a.cellDictHandler.setContext({form:c,rowIndex:b.rowIndex,colIndex:b.colIndex});b=$.extend(true,b,{getDictChildren:function(d){var f=this;var e=function(m){if(m){var l=d.attr("id");var n=f.dictTree.formatAsyncData(m);var k=m.totalRowCount;m=f.secondaryType==5?m.data:m;for(var h=0,g=m.length;h<g;h++){if(f.secondaryType==5){var j=l+"_"+m[h].OID;m[h].id=j;}}n=f.secondaryType==5?m:n;f.dictTree.buildTreenode(n,l,parseInt(d.attr("level"))+1,f.secondaryType,k);f.secondaryType==5?d.attr("isLoaded",false):d.attr("isLoaded",true);}};if(f.secondaryType!=5){YIUI.DictService.getDictChildren(f.itemKey,f.dictTree.getNodeValue(d),f.dictTree.dictFilter,f.stateMask,e);}else{YIUI.DictService.getQueryData(f.itemKey,f.dictTree.startRow,10,f.dictTree.pageIndicatorCount,f.dictTree.fuzzyValue,f.stateMask,f.getDictTree().dictFilter,f.getDictTree().getNodeValue(d),e);}},getItemKey:function(){return this.itemKey;},setValue:function(d){var e=false;if(this.value){e=!this.value.equals(d);}else{if(d){e=true;}}this.value=d;if(this._resetTree&&this.multiSelect){this.dictTree.reset();this.setDictTreeCheckedNodes();}if(a.yesCom.isShowQuery&&b.saveCell!=null){b.saveCell();}return e;},checkDict:function(){a.cellDictHandler.checkDict(this);},doLostFocus:function(d){a.cellDictHandler.autoComplete(this,d);if(a.yesCom.isShowQuery){b.stopClickCell();}},beforeExpand:function(d,e){var f=function(g){if(g){$.each(g,function(h){var j=this.itemKey+"_"+this.oid;d.indeterminatedNodes[j]=this;});}};YIUI.DictService.getAllParentID(a.yesCom.itemKey,a.yesCom.getSelValue(),f);}});this.yesCom=new YIUI.Yes_Dict(b);this.yesCom.getEl().addClass("ui-dict");b.items&&this.yesCom.setItems(b.items);},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());},getDropBtn:function(){return this.yesCom._dropBtn;},getValue:function(){return this.yesCom.getSelValue();},setValue:function(a){this.yesCom.setSelValue(a);},getInput:function(){return this.yesCom._textBtn;},setText:function(a){this.yesCom.text=a;this.yesCom.setText(a);},getText:function(){return this.yesCom.getText();},beforeDestroy:function(){this.yesCom._dropView.remove();}});YIUI.CellEditor.CellImage=YIUI.extend(YIUI.CellEditor,{init:function(b){var c="",a=this;this.yesCom=$("<div class='ui-img cellEditor' style='width: 100%;height: 100%'></div>");this.yesCom.getEl=function(){return a.yesCom;};this.options=b;if(this.options.maxSize==-1){this.options.maxSize=1024;}this.yesCom[0].enable=b.enable;if(b.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){if(b.value!==null){c=b.value;}}else{c=b.image;}this.image=$("<img class='img' style='width: 100%;height: 100%'>").appendTo(this.yesCom);this.setValue(c);this.yesCom[0].enable=b.enable;this.pathV=c;},onRender:function(a){this.base(a);},getEl:function(){return this.yesCom;},setEnable:function(a){this.yesCom[0].enable=a;},setValue:function(d){var a=this;this.base(d);if(d===undefined||d===null||d.length==0){this.image.attr("src",YIUI.Image.EmptyImg);}else{if(this.options.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){var c=YIUI.FormStack.getForm(this.options.ofFormID);var f=c.formKey;var e=encodeURIComponent(d);var b=Svr.SvrMgr.AttachURL+"?path="+e+"&formKey="+f+"&service=DownloadImage&mode=1&r="+Math.random();this.image.attr("src",b);this.image.attr("formKey",f);}else{this.image.attr("src","Resource/"+d);}}if(d!==undefined&&d!==null&&d.length!==0){window.setTimeout(function(){if(a.options.stretch!=="true"&&a.options.stretch!==true){var g=a.yesCom.width(),k=a.yesCom.height(),j=a.image.clientWidth,l=a.image.clientHeight;if((j/g)>(l/k)){a.image.css({width:g+"px",height:""});}else{a.image.css({width:"",height:k+"px"});}}else{a.image.css({width:"100%",height:"100%"});}},0);}this.pathV=d;},install:function(){var b=this;this.yesCom.delegate($(b.image),"click",function(d){if(b.pathV.length>0&&d.delegateTarget.enable){b.options.click();}});var a=function(g,d){var e=YIUI.FormStack.getForm(b.options.ofFormID);var h=new Array("gif","jpg","jpeg","png","bmp");var f=function(k){var j=$.checkFile(k,b.options.maxSize,h);if(!j||e.OID==null||e.OID==-1){return;}d=$.extend({service:"UploadImage",controlKey:b.options.gridKey,rowIndex:b.options.rowIndex,colIndex:b.options.colIndex,formKey:e.formKey,operatorID:$.cookie("userID"),fileID:-1,oid:e.OID,mode:1},d);$.ajaxFileUpload({url:Svr.SvrMgr.AttachURL,secureuri:false,fileElement:k,data:d,type:"post",success:function(m,l,n){n.attr("accept","image/*");m=JSON.parse(m);b.setValue(m.data.replace(/\\/g,"/"));b.options.change(b.getValue());b.yesCom.delegate($(b.image),"click",function(o){o.delegateTarget.enable&&b.options.click();});},error:function(m,l,n){alert(n);}});};f(g);};var c=function(e){if(e==undefined||e==null){return;}var d={service:"DeleteImage",filePath:e,operatorID:$.cookie("userID"),mode:1};$.ajax({url:Svr.SvrMgr.AttachURL,data:d,type:"post",error:function(g,f,h){alert(h);}});};this.yesCom.delegate(".upbtn","change",function(g){var e=g.target.files[0],f=e.type.split("/")[1];if(b.options.imageCut){var d={type:f,callback:function(h){a($(g.target),h);}};$(this).photoCut(d);}else{a($(g.target),{fileName:e.name,imgType:f});}$(".opt,.bar",b.yesCom).remove();g.stopPropagation();});this.yesCom.mouseover(function(){if($(".opt",b.yesCom).length==0){var h=(b.options.sourceType==YIUI.IMAGE_SOURCETYPE.DATA&&b.yesCom[0].enable)?"block":"none",j=$("<div class='bar'></div>").appendTo(b.yesCom),f=$("<div class='opt upload' title='"+$.ygrid.cell_imgOpt.open+"'></div>").appendTo(b.yesCom),e=$("<div class='opt show' title='"+$.ygrid.cell_imgOpt.show+"'></div>").appendTo(b.yesCom),d=$("<div class='opt clear' title='"+$.ygrid.cell_imgOpt.clear+"'></div>").appendTo(b.yesCom),g=$("<input type='file' name='file' data-url='upload' class='opt upbtn' accept='image/*' title='"+$.ygrid.cell_imgOpt.open+"'>").appendTo(b.yesCom);j.css({top:(b.yesCom.height()-25)+"px"});f.css({left:(b.yesCom.width()-22)+"px",top:(b.yesCom.height()-22)+"px",display:h});g.css({left:(b.yesCom.width()-22)+"px",top:(b.yesCom.height()-22)+"px",opacity:0,display:h});e.css({left:(b.yesCom.width()-((h=="none")?22:46))+"px",top:(b.yesCom.height()-22)+"px"});d.css({left:(b.yesCom.width()-68)+"px",top:(b.yesCom.height()-22)+"px",display:h});$(".opt",b.yesCom).mouseover(function(l){var k=$(l.target);if(k.hasClass("upbtn")){f.addClass("sel");}else{k.addClass("sel");}}).mouseout(function(l){var k=$(l.target);if(k.hasClass("upbtn")){f.removeClass("sel");}else{k.removeClass("sel");}});d.click(function(k){if(b.getValue()!==""){b.setValue("");b.options.change("");}b.setValue("");k.stopPropagation();});g.click(function(k){k.stopPropagation();});e.click(function(o){var n;if(b.options.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){if(b.getValue()==undefined||b.getValue()==null||b.getValue().length==0){return;}var m=b.image.attr("formKey");var l=encodeURIComponent(b.value);n=Svr.SvrMgr.AttachURL+"?path="+l+"&formKey="+m+"&service=DownloadImage&mode=1&r="+Math.random();}else{n="Resource/"+b.options.image;}var q=$("<div class='ui-img-showDiv'></div>").appendTo(document.body);var k=$("<img class='ui-img-showImg' src='"+n+"'>").appendTo(document.body);k.load(function(){k.css({left:(q.width()-this.width)/2+"px",top:(q.height()-this.height)/2+"px",width:this.width,height:this.height});});q.click(function(){q.remove();k.remove();});k.click(function(){q.remove();k.remove();});o.stopPropagation();});if($.ygrid.msie){g[0].onchange=function(o){var m=this;var l=$(this).val().substring($(this).val().lastIndexOf("\\")+1),n=l.split(".")[1];if(b.options.imageCut){var k={type:n,callback:function(p){a($(m),p);}};$(m).photoCut(k);}else{a($(this),{fileName:l,imgType:n});}$(".opt,.bar",b.yesCom).remove();};}}}).mouseout(function(d){if(!$(d.relatedTarget).hasClass("opt")&&!$(d.relatedTarget).hasClass("bar")){$(".opt,.bar",b.yesCom).remove();}});}});YIUI.CellEditor.CellTextButton=YIUI.extend(YIUI.CellEditor.CellTextEditor,{init:function(a){this.base(a);this.opt=a;},onRender:function(a){this.base(a);this.yesCom.el.addClass("ui-txtbtn");this._btn=$("<button class='btn'>...</button>");this._btn.appendTo(this.yesCom.el);this._btn.css({height:this.yesCom.getInput().outerHeight()+"px",padding:"0",verticalAlign:"top"});this.yesCom.getInput().css({width:(a.width()-this._btn.outerWidth())+"px"});},finishInput:function(){return this.yesCom.finishInput();},install:function(){var a=this;a.clicking=false;this._btn.mousedown(function(b){$(this).addClass("hover");a.clicking=true;}).mouseup(function(b){$(this).removeClass("hover");window.setTimeout(function(){a.getInput().focus();},50);});this._btn.bind("click",function(){a.opt.click();});this.getInput().blur(function(b){window.setTimeout(function(){if(!a.clicking){a.yesCom.saveCell();}else{a.clicking=false;}},10);});}});YIUI.layout={};YIUI.layout.AutoLayout=YIUI.extend({prepared:false,init:function(a){$.extend(this,a);},layout:function(a,g){g-=this.getPlaceholderHeight();a-=this.getPlaceholderWidth();var d=this.container,h=d.items,j;for(var c=0,e=h.length;c<e;c++){j=h[c];var f=$.getReal("100%",a),b;if(j.height==-1){b=j.getHeight();}else{b=$.getReal(j.height,g);}j.setWidth(f);j.setHeight(b);if(j.hasLayout){j.doLayout(j.getWidth(),j.getHeight());}}},render:function(){var a=this.container.getRenderTarget();if(this.prepared||this.beforeRender()!==false){this.prepared=true;this.onRender(this.container,a);this.afterRender();}},onRender:function(a,b){this.renderChildren(a,b);},beforeRender:function(){var d=this.container,f=d.getRenderTarget();var b=d.items,e;var a;for(var c=0;c<b.length;c++){e=b[c];a=$("<div></div>").appendTo(f);e.doRender(a);}},afterRender:$.noop,isValidParent:function(b,a){return a&&b.getOuterEl().parent()[0]==a[0];},renderChildren:function(e,g){var b=e.items;for(var d=0,a=b.length;d<a;d++){var h=b[d],f=this.getItemTarget(h,d);if(h&&(!h.rendered)){this.renderItem(h,f);}}},getItemTarget:function(a,b){return a.container||this.container.getRenderTarget();},renderItem:function(b,a){if(b&&!b.rendered){b.doRender(a);}else{if(b&&!this.isValidParent(b,a)){a.insertBefore(b.getEl());b.container=a;}}},setContainer:function(a){this.container=a;},setActiveItem:function(a){},getPlaceholderWidth:function(){var a=this.container;var b=0;b=parseInt(a.getMetaObj().leftPadding||a.getMetaObj().padding||0)+parseInt(a.getMetaObj().rightPadding||a.getMetaObj().padding||0);return b;},getPlaceholderHeight:function(){var b=this.container;var a=0;a=parseInt(b.getMetaObj().topPadding||b.getMetaObj().padding||0)+parseInt(b.getMetaObj().bottomPadding||b.getMetaObj().padding||0);return a;}});YIUI.layout["auto"]=YIUI.layout.AutoLayout;YIUI.layout["flow"]=YIUI.layout.AutoLayout;(function(a,b){var c={top:true,bottom:true,left:true,right:true,center:true};YIUI.layout.BorderLayout=YIUI.extend(YIUI.layout.AutoLayout,{init:function(d){this.base(d);},layout:function(d,q){var o=this.container,r=this.top,e=this.bottom,j=this.left,v=this.right,f=this.center,m=[];d-=this.getPlaceholderWidth();q-=this.getPlaceholderHeight();var u=d,n=q,l=u,g=n,s;if(r!=b){r.setWidth(u);if(r.height!=-1){s=a.getReal(r.height,n);r.setHeight(s);}else{s=r.getHeight();}g-=s;m.push(r);}if(e!=b){e.setWidth(u);if(e.height!=-1){s=a.getReal(e.height,n);e.setHeight(s);}else{s=e.getHeight();}g-=s;m.push(e);}if(j!=b){if(j.width!=-1){s=a.getReal(j.width,u);j.setWidth(s);}else{s=j.getWidth();}l-=s;j.setHeight(g);m.push(j);}if(v!=b){if(v.width!=-1){s=a.getReal(v.width,u);v.setWidth(s);}else{s=v.getWidth();}l-=s;v.setHeight(g);m.push(v);}l=a.isNumeric(l)?l:"auto";g=a.isNumeric(g)?g:"auto";f.setWidth(l);f.setHeight(g);m.push(f);for(var k=0,p=m.length;k<p;k++){var x=m[k];if(x.hasLayout){x.doLayout(x.getWidth(),x.getHeight());}}},beforeRender:function(){var h=this.container,k=h.getRenderTarget();var l=h.items,q,m;for(var g=0,j=l.length;g<j;g++){q=l[g];m=q.getMetaObj().region;if(c[m]){this[m]=q;}}var n=this.top,e=this.bottom,f=this.left,p=this.right,d=this.center;if(!d){throw"No center region defined in borderlayout "+h.id;}h.el.addClass("ui-blp");k.addClass("ui-nooverflow");if(n){n.container=this.topEl=a('<div class="item-ct"></div>').attr("id",n.id).appendTo(k);}var o=a('<div class="mid"></div>').appendTo(k);if(e){e.container=this.bottomEl=a('<div class="item-ct"></div>').attr("id",e.id).appendTo(k);}if(f){f.container=this.leftEl=a('<div class="item-ct"></div>').attr("id",f.id).appendTo(o);}d.container=this.centerEl=a('<div class="item-ct"></div>').attr("id",d.id).appendTo(o);if(p){p.container=this.rightEl=a('<div class="item-ct"></div>').attr("id",p.id).appendTo(o);}this.midEl=o;},isValidParent:function(e,d){return true;}});YIUI.layout["BorderLayout"]=YIUI.layout.BorderLayout;})(jQuery);YIUI.layout.ColumnLayout=YIUI.extend(YIUI.layout.AutoLayout,{ctCls:"container-fluid",colClsPrefix:"col-xs-",layout:function(a,h){var f=this.container,j=f.items,m,c,o,n;o=$(".row",f.el).data("height",0);a-=this.getPlaceholderWidth();h-=this.getPlaceholderHeight();for(var d=0,g=j.length;d<g;d++){m=j[d];var l=0,b=0,k=m.getMetaObj().colspan||1;if(m.height==-1){l=m.getHeight();}else{l=$.getReal(m.height,h);}b=$.getReal(m.width,a);if(b=="auto"){b=a;}var e=k/12*b;m.setWidth(parseInt(e));m.container.width(parseInt(e));c=m.container.parent();if(c.data("height")<l){c.data("height",l);m.setHeight(l);m.container.height(l);}else{m.setHeight(c.data("height"));m.container.height(c.data("height"));}if(m.hasLayout){m.doLayout(m.getWidth(),m.getHeight());}}for(var d=0,g=o.length;d<g;d++){n=o.eq(d);n.height(n.data("height"));}},beforeRender:function(){var c=this.container,t=c.getRenderTarget(),k=c.items,q,e,d,m,b=[],r={row:0,len:0};for(var n=0,o=k.length;n<o;n++){q=k[n];e=q.getMetaObj().y;d=q.getMetaObj().x;m=q.getMetaObj().colspan||1;if(r.row!=e){r.row=e;r.len=0;}if(r.row==e&&r.len>=12||d>11||d+m>12){}r.len=d+m;b[e]=b[e]||[];b[e][d]=q;}this.rows=b;var h=$("<div></div>").addClass(this.ctCls),s,a;for(var n=0,o=b.length;n<o;n++){a=b[n];if(!a){continue;}s=$("<div></div>").addClass("row").appendTo(t);for(var l=0,f=a.length;l<f;l++){q=a[l];if(q){m=q.getMetaObj().colspan||1;q.container=$("<div></div>").attr("col",l).attr("span",m).addClass(this.colClsPrefix+m).appendTo(s);}}}for(var n=0,o=b.length;n<o;n++){a=b[n];if(!a){delete b[n];continue;}for(var l=0,f=a.length;l<f;l++){delete a[l];}delete b[n];}delete b;for(var n=0,g=t.children(),o=g.length;n<o;n++){var e=g[n];for(var l=0,a=e.childNodes,f=a.length;l<f;l++){var p;if(l==0&&$(a[0]).attr("col")>0){p=$(a[0]).attr("col")-0;$("<div></div>").attr("col",0).attr("span",p).addClass(this.colClsPrefix+p).insertBefore($(a[0]));}else{p=$(a[l+1]).attr("col")-$(a[l]).attr("col")-$(a[l]).attr("span");if(p>0){var d=parseInt($(a[l]).attr("col"))+parseInt($(a[l]).attr("span"))+1;$("<div></div>").attr("col",d).attr("span",p).addClass(this.colClsPrefix+p).insertAfter($(a[l]));}}}}}});YIUI.layout["ColumnLayout"]=YIUI.layout.ColumnLayout;YIUI.layout.FluidColumnLayout=YIUI.extend(YIUI.layout.AutoLayout,{fill:false,colClsPrefix:"col-md-",init:function(a){this.base(a);if(!this.fill){this.ctCls="container";}}});YIUI.layout["FluidLayout"]=YIUI.layout.FluidColumnLayout;YIUI.layout.GridLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(b,d){var h=this.container,s=h.getMetaObj(),E=h.getRenderTarget(),f=s.rowGap||0,F=s.columnGap||0,o=h.widths,r=h.minWidths,z=h.heights,A=this.table,c,m;if(!o||!z){YIUI.ViewException.throwException(YIUI.ViewException.NO_WIDTH_OR_HEIGHT);}d-=f*(z.length-1)+this.getPlaceholderHeight();b-=F*(o.length-1)+this.getPlaceholderWidth();var a=this.calcRealValues(b,o);var D=-1;var g=this.calcRealValues(d,z);for(var w=0;w<g.length;w++){c=$(A[0].rows[w+1]).height(g[w]);}var p=$("tr.first",A);for(var v=0;v<a.length;v++){m=$(p[0].cells[v]);var n=m.attr("col");D=this.getRealWidth(r[n],a[n]);m.width(D);if(h.oddColumnColor&&v%2==0){m.css("background-color",h.oddColumnColor);}}var q=h.items,B,l,k,e,C;for(var w=0,y=q.length;w<y;w++){B=q[w];k=B.getMetaObj().x;l=B.getMetaObj().y;e=B.getMetaObj().colspan||1;C=B.getMetaObj().rowspan||1;var t=this.getRealWidth(r[k],a[k]),u=g[l];if(e>1){for(var v=1;v<e;v++){D=this.getRealWidth(r[k+v],a[k+v]);t+=D+F;}}if(C>1){for(var v=1;v<C;v++){u+=g[l+v]+f;}}if(l>0){B.topMargin=f;B.getOuterEl().css("margin-top",f+"px");}if(k>0){B.leftMargin=f;B.getOuterEl().css("margin-left",F+"px");}B.setWidth(t);B.setHeight(u);if(B.hasLayout){B.doLayout(B.getWidth(),B.getHeight());}}},getRealWidth:function(b,a){var c=a;if(b!=-1&&b>a){c=b;}return c;},beforeRender:function(){var g=this.container,p=g.getMetaObj(),y=g.getRenderTarget(),m=g.widths,u=g.heights;if(!m||!u){YIUI.ViewException.throwException(YIUI.ViewException.NO_WIDTH_OR_HEIGHT);}var b=this.calcRealValues(g.getWidth(),m);var f=this.calcRealValues(g.getHeight(),u);var v=$('<table class="layout"></table>').attr({border:0,cellpadding:0,cellspacing:0}).appendTo(y),a=true,e=p.rowGap||0,c,l;this.table=v;var q=0,n;for(var s=0;s<f.length;s++){if(s==0){n=$("<tr></tr>").addClass("first").appendTo(v);}c=$('<tr row="'+s+'"></tr>').appendTo(v);for(var r=0;r<b.length;r++){if(s==0){$('<td col="'+r+'"></td>').appendTo(n);}l=$('<td col="'+r+'"></td>').appendTo(c);}q+=f[s];}q+=(f.length-1)*e;v.css("height",q);var o=g.items,w,k,h,d,x;for(var s=0,t=o.length;s<t;s++){w=o[s];h=w.getMetaObj().x;k=w.getMetaObj().y;d=w.getMetaObj().colspan||1;x=w.getMetaObj().rowspan||1;c=$(v[0].rows[k+1]);l=this.getCell(k,h);if(!w.getMetaObj().visible&&l.attr("colspan")){continue;}l.nextAll("td:lt("+(d-1)+")").remove();c.nextAll("tr:lt("+(x-1)+")").each(function(){var j=$("td[col="+h+"]",$(this));j.nextAll("td:lt("+(d-1)+")").remove();j.remove();});l.attr("colspan",d).attr("rowspan",x);w.width=b[h];w.height=f[k];}},calcRealValues:function(n,b){var r=[],d=0,k,l=b.length,a=[],m=0,h,g;for(h=0;h<l;h++){g=b[h];if($.isPercentage(g)){g=parseInt(g,10)/100;d+=g;a.push(h);}else{if($.isNumeric(g)&&g<1){a.push(h);}else{if(g=="auto"){a.push(h);}else{if(g=="pref"){a.push(h);}else{m+=g;}}}}r[h]=g;}if(m<=n){k=n-m;if(d==0){d=1;}l=a.length;for(h=0;h<l;h++){if((g=r[a[h]])>0){r[a[h]]=Math.floor(k*g);m+=r[a[h]];}else{if((g=r[a[h]])=="auto"){r[a[h]]=Math.floor(k/l);}else{if((g=r[a[h]])=="pref"){var q,e,o=-1;for(var f=0,c=this.container.items.length;f<c;f++){q=this.container.items[f];var p=q.height==-1?q.getHeight():q.height;e=q.rowspan||1;if(q.y==a[h]&&e==1&&p>o){o=p;}}r[a[h]]=o;}}}}}return r;},getCell:function(c,a){var b=$(this.table[0].rows[c+1]);return $("td[col="+a+"]",b);},getItemTarget:function(a,b){return this.getCell(a.getMetaObj().y,a.getMetaObj().x);}});YIUI.layout["GridLayout"]=YIUI.layout.GridLayout;YIUI.layout.TabsLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(g,e){var d=this.container;var a=$(d.el.children()[1]),h=a.css("overflow");e-=this.getPlaceholderHeight();g-=this.getPlaceholderWidth();if(d.items&&d.items.length!=0){var c=$(d.el.children("ul")),a=$(d.el.children(".tab-body"));var b=d.tabPosition;switch(b){case YIUI.DirectionType.TOP:case YIUI.DirectionType.BOTTOM:c.width(g);a.height(e-c.outerHeight(true));a.width(g);break;case YIUI.DirectionType.LEFT:case YIUI.DirectionType.RIGHT:a.height(e);var f=c.outerHeight(true);if($.browser.isIE){f=c.outerWidth();}a.width(g-f);c.width(e);break;}tab=d.items[d.activeTab];if(tab){tab.setWidth(a.width());tab.setHeight(a.height());if(tab.hasLayout){tab.doLayout(tab.getWidth(),tab.getHeight());}}}},beforeRender:function(){var d=this.container,h=d.getRenderTarget(),k=d.items,m;var j=$("<ul class='ui-tabs-nav tab-head'/>");var e=$("<div class='tab-body'>");var n=d.tabPosition;switch(n){case YIUI.DirectionType.TOP:j.addClass("top");j.appendTo(h);e.appendTo(h);break;case YIUI.DirectionType.BOTTOM:j.addClass("bottom");e.appendTo(h);j.appendTo(h);break;case YIUI.DirectionType.LEFT:j.addClass("left");e.appendTo(h);j.appendTo(h);e.css("float","right");break;case YIUI.DirectionType.RIGHT:j.addClass("right");e.appendTo(h);j.appendTo(h);e.css("float","left");break;}for(var b=0,g=k.length;b<g;b++){m=k[b];m.id=m.id||YIUI.allotId();var f="tab_"+m.id;var l=m.getMetaObj().title;if(!l){l=m.caption;}var c=$(YIUI.Panel.TabPanel.prototype.tabTemplate.replace(/#\{href\}/g,"#"+f).replace(/#\{title\}/g,l)).appendTo(j);c.addClass("ui-state-default ui-corner-top").attr("role","tab").attr("aria-controls",f);$("[href=#"+f+"]",c).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+f+"] label",c).addClass("ui-anchor-label");var a=$("<div>").attr("id",f).appendTo(e);m.container=a;a.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");if(d.activeTab<0&&m.visible){d.selectedTab=c;d.activeTab=b;c.toggleClass("aria-selected");a.toggleClass("aria-show");a.show();}else{a.hide();}if(!m.visible){c.css("display","none");}}},afterRender:function(){var b=this.container;var a=$(b.el.children()[1]),c=a.css("overflow");},isValidParent:function(b,a){return true;}});YIUI.layout["TabLayout"]=YIUI.layout.TabsLayout;YIUI.layout.Tab=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(f,d){var c=this.container;d-=this.getPlaceholderHeight();f-=this.getPlaceholderWidth();if(c.items&&c.items.length!=0){var b=$("ul.ui-tabs-nav",c.el),a=$(c.el.children(".ui-tabs-body"));a.width(f);a.height(d-b.outerHeight(true));$(".ui-tabs-header",this.el).width(f-30);var e=c.items[c.activeTab];if(e){e.setWidth(a.width());e.setHeight(a.height());if(e.hasLayout){e.doLayout(e.getWidth(),e.getHeight());}if(c.selectedTab){$(".ui-tabs-header",c.el).scrollLeft(c.selectedTab.position().left-$(".ui-tabs-header",c.el).width()+c.selectedTab.width());}}}c.setDropBtnView();c.setTabListColor();},beforeRender:function(){var e=this.container,h=e.getRenderTarget(),l=e.items,m;var j=$("<ul/>");var c=$("<div></div>").addClass("ui-tabs-header").appendTo(h).append(j);var k=e._dropBtn=$("<span></span>").addClass("ui-tabs dropdownBtn").appendTo(h);e._dropView=$("<div><ul/></div>").addClass("ui-tabs tabs-list");$(document.body).append(e._dropView);j.addClass("ui-tabs-nav ui-corner-all");j.attr("role","tablist");var f=$("<div>").addClass("ui-tabs-body").appendTo(h);for(var b=0,g=l.length;b<g;b++){m=l[b];m.id=m.id||YIUI.allotId();if(!m.title){m.title=m.caption;}var d=$(YIUI.Panel.TabPanel.prototype.tabTemplate.replace(/#\{href\}/g,"#"+m.id).replace(/#\{title\}/g,m.title)).appendTo(j);if(b==0){e.selectedTab=d;e.activeTab=0;}else{}d.addClass("ui-state-default ui-corner-top").attr("role","tab").attr("aria-controls",m.id);$("[href=#"+m.id+"]",d).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+m.id+"] label",d).addClass("ui-anchor-label");var a=$("<div>").attr("id",m.id).appendTo(f);m.container=a;a.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");if(b==0){d.toggleClass("aria-selected");a.toggleClass("aria-show");}}},afterRender:function(){var b=this.container;var a=$(b.el.children()[1]),c=a.css("overflow");},isValidParent:function(b,a){return true;}});YIUI.layout["tab"]=YIUI.layout.Tab;(function(a,b){YIUI.layout.SplitLayout=YIUI.extend(YIUI.layout.AutoLayout,{resizerSize:4,regionMinSize:0,init:function(c){this.base(c);this.resize={};},layout:function(c,k){var h=this.container,l=h.items,o,e=h.el.children(".spl-item"),n=h.el.children(".spl-resizer"),f=h.getMetaObj().orientation==="vertical",m=h.splitSizes;k-=this.getPlaceholderHeight();c-=this.getPlaceholderWidth();for(var g=0,j=n.length;g<j;g++){if(f){n.eq(g).width(c);}else{n.eq(g).height(k);}}for(var g=0,j=e.length;g<j;g++){var d=e.eq(g);if(f){d.height(a.getReal(m[g].size,(k-this.getPlaceholderSize())));}else{d.width(a.getReal(m[g].size,(c-this.getPlaceholderSize())));}}for(var g=0,j=l.length;g<j;g++){o=l[g];if(f){o.setWidth(c);o.setHeight(o.container.height());}else{o.setWidth(o.container.width());o.setHeight(k);}if(o.hasLayout){o.doLayout(o.getWidth(),o.getHeight());}}},beforeRender:function(){var f=this.container,h=f.getRenderTarget(),j=f.items,l=f.splitSizes,c=f.getMetaObj().orientation==="vertical",k,m,d;h.css("overflow","hidden");for(var e=0,g=l.length;e<g;e++){k=l[e];m=j[e];d=a('<div class="spl-item"></div>').appendTo(h);if(m){m.container=d;}if(e<g-1){a('<div class="spl-resizer"></div>').addClass(c?"resizer-h":"resizer-v").attr("region",e).appendTo(h);}if(c){d.addClass("v-item");}else{d.addClass("h-item");}}},getPlaceholderSize:function(){var g=0,e=this.container,f=e.splitSizes;for(var d=0,c=f.length;d<c;d++){if(!a.isPercentage(f[d].size)&&f[d].size>0){g+=f[d].size;}}return g;},afterRender:function(){this.base();},getPlaceholderWidth:function(){var f=this.base();var e=this.container,d=e.items,c=e.getMetaObj().orientation==="vertical";f+=(c?0:this.resizerSize*(d.length-1));return f;},getPlaceholderHeight:function(){var c=this.base();var f=this.container,e=f.items,d=f.getMetaObj().orientation==="vertical";c+=(d?this.resizerSize*(e.length-1):0);return c;}});YIUI.layout["SplitLayout"]=YIUI.layout.SplitLayout;})(jQuery);YIUI.layout.FlexFlowLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(g,e){var d=this.container,b=d.items,f;g-=this.getPlaceholderWidth();e-=this.getPlaceholderHeight();for(var c=0,a=b.length;c<a;c++){f=b[c];f.setWidth(g);f.setHeight($.getReal(f.height,(e-this.getPlaceholderSize())));if(f.hasLayout){f.doLayout(f.getWidth(),f.getHeight());}}},getPlaceholderSize:function(){var f=0,d=this.container,b=d.items,e;for(var c=0,a=b.length;c<a;c++){e=b[c];if($.isNumeric(e.height)){f+=(e.height==-1?e.getHeight():e.height);}else{if(e.height=="pref"){f+=e.getHeight();}}}return f;}});YIUI.layout["FlexFlowLayout"]=YIUI.layout.FlexFlowLayout;YIUI.layout.FlowLayout=YIUI.extend(YIUI.layout.AutoLayout,{});YIUI.layout["FlowLayout"]=YIUI.layout.FlowLayout;YIUI.layout.TableLayout=YIUI.extend(YIUI.layout.AutoLayout,{beforeRender:function(){var g=this.container,E=g.getRenderTarget(),o=g.widths,A=g.heights;if(!o||!A){throw"widths or heights not defined!";}var b=YIUI.layout.GridLayout.prototype.calcRealValues.call(this,g.getWidth(),o);var e=YIUI.layout.GridLayout.prototype.calcRealValues.call(this,g.getHeight(),A);var B=$('<div class="table"></div>').appendTo(E),a=true,F=0;this.table=B;for(var w=0;w<e.length;w++){var h=$('<div class="table-row" row="'+w+'"></div>').appendTo(B);for(var v=0;v<b.length;v++){var c=$('<div col="'+v+'"></td>').addClass("table-cell").css({height:e[w]}).appendTo(h);if(a){F+=b[v];c.css({width:b[v],"max-width":b[v]});}}a=false;}if(F<g.getWidth()){$(B.children(null,".table-row")[0]).append($('<div class="table-cell" style="visibility:hidden;"></div>').css("width",g.getWidth()-F));}var s=g.items,n=B[0].childNodes,p=n[0].childNodes;for(var w=0,z=s.length;w<z;w++){var C=s[w],m=C.x,l=C.y,d=C.colspan||1,D=C.rowspan||1,c=this.getCell(l,m);if(d==1&&D==1){c.attr("pos",l+"_"+m);}else{var t=0,r=0,f=0,q=0;for(var v=0;v<d;v++){t+=b[m+v];}for(var v=0;v<D;v++){r+=e[l+v];}for(var v=D-1;v>=0;v--){for(var u=d-1;u>=0;u--){if(v==0&&u==0){continue;}this.getCell(l+v,m+u).css("visibility","hidden");}}c.css({position:"absolute",width:t,height:r}).attr("pos",l+"_"+m);}C.width=c.width();C.height=c.height();}},afterRender:function(){},getCell:function(b,a){return $(this.table[0].childNodes[b].childNodes[a]);},getItemTarget:function(a,b){return $("div[pos="+a.y+"_"+a.x+"]");}});YIUI.layout["TableLayout"]=YIUI.layout.TableLayout;YIUI.layout.FluidTableLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(c,e){var h=this.container,y=h.getRenderTarget(),b=h.repeatCount||1,r=h.items,f=h.rowHeight,g=h.rowGap||0,z=h.columnGap||0,x=h.repeatGap||0,n=h.widths;if(!n){throw"widths is undefined";}var v=this.table,a=true,d,l,k=0;for(var u=0;u<r.length;u++){if(r[u].getMetaObj().buddyKey){k++;}}k=r.length-2*k;var m=(r.length+k)/2;if(m%b==0){m=m/b;}else{m=parseInt(m/b)+1;}var o=2*b;c-=n.length*z*b+(b-1)*x+this.getPlaceholderWidth();e-=m*f+this.getPlaceholderHeight();var p=this.getRealWidth(n,c/b);var w;for(var u=0;u<m;u++){d=$(v[0].rows[u]).height(f);for(var t=0;t<o;t++){l=$(d[0].cells[t]);var s=$.getReal(n[t%2==0?0:1],p);if(a){l.width(s);}if(l.children().length>0){var q=l.attr("index");w=r[q];w.setWidth(s);w.setHeight(f);w.getOuterEl().css("margin-left","0");w.getOuterEl().css("margin-top","0");if(z>0&&!w.hasBuddyKey){w.getOuterEl().css("margin-left",z+"px");}if(b>1&&t>1){if(w.hasBuddyKey){w.getOuterEl().css("margin-left",x+"px");}}if(u>0){w.getOuterEl().css("margin-top",g+"px");}if(w.hasLayout){w.doLayout(w.getWidth(),w.getHeight());}}}a=false;}},getRealWidth:function(c,b){var d=0;for(var a=0;a<c.length;a++){if($.isNumeric(c[a])&&c[a]>0){d+=c[a];}}return b-d;},repaint:function(){this.reset();var a=this.container;this.layout(a.getWidth(),a.getHeight());},reset:function(){var d=this.container,v=d.getRenderTarget(),a=d.repeatCount||1,n=d.items,c=d.rowHeight,k=d.widths;if(!k){throw"widths is undefined";}var s=this.table,b,g;var e=0;for(var p=0;p<n.length;p++){if(n[p].getMetaObj().buddyKey){e++;}}e=n.length-2*e;var h=(n.length+e)/2;if(h%a==0){h=h/a;}else{h=parseInt(h/a)+1;}for(var p=0;p<n.length;p++){t=n[p];if(t.getMetaObj().buddyKey!=undefined){for(var o=0;o<n.length;o++){var l=n[o];if(l.getMetaObj().key==t.getMetaObj().buddyKey){l.rgtVisible=t.visible;l.hasBuddyKey=true;t.leftVisible=l.visible;continue;}}}}var u=0;var f=[];for(var p=0;p<h;p++){b=$("tr[row="+p+"]",s);for(var o=0;o<(2*a);o++){var t=n[u];var m=u;if(t){u++;if(t.hasBuddyKey){if(!t.rgtVisible){o--;f.push(t);}}else{if(t.visible){if(!t.getMetaObj().buddyKey){o++;}}else{if(t.getMetaObj().buddyKey){if(!t.visible){o--;f.push(t);}}else{o--;}continue;}}g=$("td[col="+o+"]",b);g.attr("index",m);t.container=g;t.el.appendTo(g);t.width=k[o%2==0?0:1];t.height=c;}}}var r=f.length/a/2+h;$("tr[row]",s).slice(h).remove();for(var p=h;p<r;p++){b=$("<tr row="+p+"/>").appendTo(s);for(var o=0,q=f.length;o<q;o++){var t=f[o];g=$("<td/>").appendTo(b);t.el.appendTo(g);}b.hide();}},beforeRender:function(){var e=this.container,w=e.getRenderTarget(),a=e.repeatCount||1,o=e.items,d=e.rowHeight,l=e.widths;if(!l){throw"widths is undefined";}var t=$('<table class="layout"></table>').attr({border:0,cellpadding:0,cellspacing:0}).appendTo(w),b,h;this.table=t;var f=0;for(var q=0;q<o.length;q++){if(o[q].getMetaObj().buddyKey){f++;}}f=o.length-2*f;var k=(o.length+f)/2;if(k%a==0){k=k/a;}else{k=parseInt(k/a)+1;}for(var q=0;q<o.length;q++){u=o[q];if(u.getMetaObj().buddyKey!=undefined){for(var p=0;p<o.length;p++){var m=o[p];if(m.getMetaObj().key==u.getMetaObj().buddyKey){m.hasBuddyKey=true;m.rgtVisible=u.getMetaObj().visible;continue;}}}}var v=0;var g=[];for(var q=0;q<k;q++){b=$('<tr row="'+q+'"></tr>').appendTo(t);for(var p=0;p<(2*a);p++){var u=o[v];var n=v;if(u){if(!u.getMetaObj().visible){g.push(u);v++;p--;continue;}if(!u.getMetaObj().buddyKey&&!u.hasBuddyKey){$('<td col="'+p+'"></td>').appendTo(b);p++;}if(u.getMetaObj().buddyKey){var c=e.get(u.getMetaObj().buddyKey);if(!c.visible){$('<td col="'+p+'"></td>').appendTo(b);p++;}}h=$('<td col="'+p+'"></td>').appendTo(b);h.attr("index",n);u.container=h;if(u.width==-1){u.width=l[p%2==0?0:1];}u.height=d;}else{$('<td col="'+p+'"></td>').appendTo(b);}v++;}}var s=g.length/a/2+k;for(var q=k;q<s;q++){b=$('<tr row="'+q+'"></tr>').appendTo(t);b.hide();for(var p=0,r=g.length;p<r;p++){var u=g[p];h=$('<td col="'+p+'"></td>').appendTo(b);u.container=h;}}}});YIUI.layout["FluidTableLayout"]=YIUI.layout.FluidTableLayout;YIUI.layout.Wizardlayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(a,f){var c=this.container;var e=c.selectItem.index();var k=e*a;c.body.css("right",k+"px");var h=(f-$(".wizard-btn",this.el).height())/2;$(".wizard-btn",this.el).css("margin-top",h+"px");f-=this.getPlaceholderHeight();a-=this.getPlaceholderWidth();var g=c.items;if(g&&g.length!=0){for(var b=0,d=g.length;b<d;b++){var m=g[b];var j=m.container.next(".wizard-foot");var l=f-j.outerHeight();m.setHeight(l);m.setWidth(a);if(m.hasLayout){m.doLayout(m.getWidth(),m.getHeight());}}}},beforeRender:function(){var e=this.container,g=e.getRenderTarget(),h=e.items,k,j=e.funcMap,d=$(".ui-wizard-warp",e.el);for(var b=0,f=h.length;b<f;b++){k=h[b];var a=$("<div class='wizard-item'></div>").attr("key",k.getMetaObj().key).appendTo(e.body);var c=$("<div class = 'wizard-body'></div>").appendTo(a);if(k){k.container=c;if(b==0){d.addClass("first");e.selectItem=a;}a.attr("index",b);j[k.getMetaObj().key]={check:k.check,leave:k.leave,active:k.active};}}},isValidParent:function(b,a){return true;}});YIUI.layout["WizardLayout"]=YIUI.layout.Wizardlayout;YIUI.Panel=YIUI.extend(YIUI.Component,{defaultType:"component",layout:"auto",overflowX:"visible",overflowY:"visible",backImage:"",backImagePosition:"",isBackImageRepeatX:false,isBackImageRepeatY:false,padding:1,init:function(b){this.base(b);var a=this.items;if(a){delete this.items;this.add(a);}},needClean:function(){return false;},build:function(b){var a=b.getRoot();this.add(a);this.doRenderChildren();this.doLayout(this.el[0].clientWidth,this.el[0].clientHeight);b.setContainer(this);},removeForm:function(b){var a=b.getRoot();this.remove(a);},initDefaultValue:function(a){this.el=a.el;this.container=a.container;this.layout=a.layout;this.items=a.items;},setOverflowX:function(a){if(a.toLowerCase()!="visible"){this.overflowX=a;this.el.css("overflow-x",a.toLowerCase());}},setOverflowY:function(a){if(a.toLowerCase()!="visible"){this.overflowY=a;this.el.css("overflow-y",a.toLowerCase());}},setBackImage:function(a){this.backImage=a;this.el.css("background-image","url('Resource/"+a+"')");},setLeftMargin:function(a){this.el.css("margin-left",a);},setRightMargin:function(a){this.el.css("margin-right",a);},setTopMargin:function(a){this.el.css("margin-top",a);},setBottomMargin:function(a){this.el.css("margin-bottom",a);},setBackImagePosition:function(a){this.backImagePosition=a;switch(a){case"top":this.el.css("background-position","top left");break;case"bottom":this.el.css("background-position","bottom left");break;case"left":this.el.css("background-position","center left");break;case"right":this.el.css("background-position","center right");break;case"center":this.el.css("background-position","center center");break;}this.el.css("background-position",a);},setBackImageRepeatX:function(a){this.isBackImageRepeatX=a;if(a){this.el.css("background-repeat","repeat-x");}},setbackImageRepeatY:function(a){this.isBackImageRepeatY=a;if(a){this.el.css("background-repeat","repeat-y");}},add:function(a){this.initItems();if(this.beforeAdd(a)!==false){if($.isArray(a)){var d=this;$.each(a,function(c){d.add(this);});return;}if(this.get(a.id)){return;}var b=this.lookupComponent(a);this.items.push(b);b.ownerCt=this;this.afterAdd(b);}},beforeAdd:$.noop,afterAdd:$.noop,reduceVisible:$.noop,get:function(c){if($.isNumeric(c)){return this.items[c];}else{if($.isString(c)){var b=this.items,e;for(var d=0,a=b.length;d<a;d++){e=b[d];if(e&&(e.id===c||e.getMetaObj().key===c)){return e;}}}}return null;},indexOf:function(c){var b=this.items;for(var d=0,a=b.length;d<a;d++){if(b[d]===c){return d;}}return -1;},remove:function(a,c){var b=this.indexOf(a);if(b===-1){return;}if(c===false){a.getEl().remove();}else{a.destroy();}this.items.splice(b,1);return a;},lookupComponent:function(a){if($.isString(a)){return YIUI.ComponentMgr.get(a);}else{if(!(a instanceof YIUI.Component)){return YIUI.create(a,this.defaultType);}}return a;},doLayout:function(b,a){if(this.layout){if(this.layouted){if(this.height=="pref"){return;}}else{this.layouted=true;}this.layout.layout(b,a);}},onRenderChildren:function(){if(this.html){this.el.html(this.html);}else{this.getOuterEl().addClass("ui-pnl");if($.isObject(this.layout)&&!this.layout.layout){this.layoutConfig=this.layout;this.layout=this.layoutConfig.type;}if($.isString(this.layout)){if(this.layout=="auto"||this.layout=="flow"){this.el.css("white-space","normal");}this.layout=new YIUI.layout[this.layout](this.layoutConfig);}this.setLayout(this.layout);if(this.activeItem!==undefined){var a=this.activeItem;delete this.activeItem;this.layout.setActiveItem(a);}this.doRenderChildren(false,true);}},setTip:$.noop,afterRender:function(){this.base();var a=this.getMetaObj();a.overflowX&&this.setOverflowX(a.overflowX);a.overflowY&&this.setOverflowY(a.overflowY);a.backImage&&this.setBackImage(a.backImage);a.backImagePosition&&this.setBackImagePosition(a.backImagePosition);a.isBackImageRepeatX&&this.setBackImageRepeatX(a.isBackImageRepeatX);a.isBackImageRepeatY&&this.setbackImageRepeatY(a.isBackImageRepeatY);a.leftMargin&&this.setLeftMargin(a.leftMargin);a.rightMargin&&this.setRightMargin(a.rightMargin);a.topMargin&&this.setTopMargin(a.topMargin);a.bottomMargin&&this.setBottomMargin(a.bottomMargin);},setLayout:function(a){if(this.layout&&this.layout!=a){this.layout.setContainer(null);}this.layout=a;this.initItems();a.setContainer(this);},initItems:function(){if(!this.items){this.items=[];}},beforeDoRenderChildren:$.noop,afterDoRenderChildren:$.noop,doRenderChildren:function(b,a){if(!this.html&&this.beforeDoRenderChildren()!==false){var d=this.rendered;var c=a;if(!this.canLayout()||this.collapsed){this.deferLayout=this.deferLayout||!b;if(!c){return;}b=b&&!this.deferLayout;}else{delete this.deferLayout;}if(d&&this.layout){this.layout.render();}if(d){this.afterDoRenderChildren(b,c);}this.hasLayout=true;}},canLayout:function(){var a=this.getEl();return a&&a.css("display")!="none";},getRenderTarget:function(){return this.getEl();},getValidWidth:function(){return this.el.width();},getValidHeight:function(){if(this.ownerCt&&this.ownerCt.type==YIUI.CONTROLTYPE.TABPANEL){return this.ownerCt.el.height()-$(".ui-tabs-nav",this.ownerCt.getEl()).outerHeight(true)-this.getToolBarHeight()-this.layout.getPlaceholderHeight();}if(this.type==YIUI.CONTROLTYPE.TABPANEL){return $(".ui-tabs-body",this.getEl()).height()-this.getToolBarHeight()-this.layout.getPlaceholderHeight();}if(!this.height||this.height<=0){return 0;}return this.el.height()-this.getToolBarHeight();},getToolBarHeight:function(){var a=0;$.each(this.items,function(b,c){if(c.type==YIUI.CONTROLTYPE.TOOLBAR){a=c.getHeight();return false;}});return a;},beforeDestroy:function(){var a=this.items;if(a){for(var b=a.length-1;b>=0;b--){a[b].destroy();delete a[b];}}delete this.items;this.base();},getWidth:function(){if(this.rendered){return this.getOuterEl()[0].clientWidth||this.getOuterEl().width();}return this.width;},getHeight:function(){if(this.rendered){return this.getOuterEl()[0].clientHeight;}return this.height;},needTip:function(){return false;},reLayout:$.noop,getNoTabOrderComps:function(e){for(var c=0,b,a=this.items.length;c<a;c++){b=this.items[c];if(b==undefined||b==null){continue;}var d=b.getMetaObj().tabOrder;if(b.getMetaObj().crFocus&&(d==-1||d==undefined||d==null)){e.push(b);}else{if(b.isPanel){b.getNoTabOrderComps(e);}}}},diff:function(a){if(a.items){var b=this.items;$.each(a.items,function(d,e){var c=e.metaObj.key;$.each(b,function(g,f){if(f.metaObj.key==c){f.diff(e);return false;}});});}}});YIUI.reg("panel",YIUI.Panel);YIUI.reg("body",YIUI.Panel);YIUI.Panel.BorderLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"BorderLayout",initDefaultValue:function(n){this.base(n);var d=this.el;var j,a,e,m,b;if(d.find(".border-north").length>0){j=this.el.find(".border-north");}if(d.find(".border-south").length>0){a=this.el.find(".border-south");}if(d.find(".border-western").length>0){e=this.el.find(".border-western");}if(d.find(".border-east").length>0){m=this.el.find(".border-east");}if(d.find(".border-center").length>0){b=this.el.find(".border-center");}var l=d.width(),g=d.height(),f=l,c=g,k;if(j!=undefined){k=j.height();c-=k;j.width(l);}if(a!=undefined){k=a.height();c-=k;a.width(l);}if(e!=undefined){k=e.width();f-=k;e.height(c);}if(m!=undefined){k=m.width();f-=k;m.height(c);}f=$.isNumeric(f)?f:"100%";c=$.isNumeric(c)?c:"100%";b.width(f);b.height(c);},getNoTabOrderComps:function(h){var g=[];for(var d=0,a=this.items.length,e;d<a;d++){e=this.items[d];switch(e.getMetaObj().region){case"top":g.splice(0,0,e);break;case"left":g.splice(1,0,e);break;case"center":g.splice(2,0,e);break;case"right":g.splice(3,0,e);break;case"bottom":g.splice(4,0,e);break;}}for(var c=0,b;c<g.length;c++){b=g[c];if(b==undefined||b==null){continue;}var f=b.getMetaObj().tabOrder;if(b.getMetaObj().crFocus&&(f==-1||f==undefined||f==null)){h.push(b);}else{if(b.isPanel){b.getNoTabOrderComps(h);}}}},install:function(){var a=this;}});YIUI.reg("borderlayoutpanel",YIUI.Panel.BorderLayoutPanel);YIUI.Panel.ColumnLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"ColumnLayout",onRender:function(a){this.base(a);this.el.addClass("ui-clp");}});YIUI.reg("columnlayoutpanel",YIUI.Panel.ColumnLayoutPanel);YIUI.Panel.FlowLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FlowLayout"});YIUI.reg("flowlayoutpanel",YIUI.Panel.FlowLayoutPanel);YIUI.Panel.FlexFlowLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FlexFlowLayout",initDefaultValue:function(c){this.base(c);var b=this.items,f,e=this.el.outerHeight()-this.getPlaceholderSize();for(var d=0,a=b.length;d<a;d++){f=b[d].el;if($.isPercentage(f.attr("height"))){f.height($.getReal(f.attr("height"),e));}}},getPlaceholderSize:function(){var e=0,b=this.items,d;for(var c=0,a=b.length;c<a;c++){d=b[c].el;if(!$.isPercentage(d.attr("height"))){e+=d.height();}}return e;}});YIUI.reg("flexflowlayoutpanel",YIUI.Panel.FlexFlowLayoutPanel);YIUI.Panel.FluidColumnLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FluidLayout",fill:false,init:function(a){this.base(a);this.layoutConfig=this.layoutConfig||{};this.layoutConfig.fill=this.fill;}});YIUI.reg("fluidcolumnlayoutpanel",YIUI.Panel.FluidColumnLayoutPanel);YIUI.Panel.FluidTableLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FluidTableLayout",widths:null,rowGap:0,columnGap:0,repeatCount:1,repeatGap:0,rowHeight:30,init:function(a){this.base(a);},setRowGap:function(a){this.rowGap=a;},setColumnGap:function(a){this.columnGap=a;},setRepeatCount:function(a){if(a>1){this.repeatCount=a;}},setRepeatGap:function(a){this.repeatGap=a;},setRowHeight:function(a){this.rowHeight=a;},onRender:function(b){this.base(b);var a=this.getMetaObj();a.rowGap&&this.setRowGap(a.rowGap);a.columnGap&&this.setColumnGap(a.columnGap);a.repeatGap&&this.setRepeatGap(a.repeatGap);a.repeatCount&&this.setRepeatCount(a.repeatCount);a.rowHeight&&this.setRowHeight(a.rowHeight);this.el.addClass("ui-ftlp");},reLayout:function(){this.layout.repaint();},initDefaultValue:function(p){this.base(p);var j=this,h=j.repeatCount=p.repeatCount,k=j.items=p.items,b=j.rowHeight=p.rowHeight,c=j.rowGap=p.rowGap,d=j.columnGap=p.columnGap,q=j.repeatGap=p.repeatGap,f=j.widths=p.widths,a=this.el.outerWidth();if(!f){throw"widths is undefined";}var n=$("table",this.el),g=true,l,e;var o=$("tr",this.el).length;var m=$("tr",this.el).eq(0).children().length;}});YIUI.reg("fluidtablelayoutpanel",YIUI.Panel.FluidTableLayoutPanel);YIUI.Panel.GridLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"GridLayout",widths:null,minWidths:null,heights:null,rowGap:0,columnGap:0,oddColumnColor:null,forceLayout:true,setOddColumnColor:function(a){this.oddColumnColor=a;this.el.addClass("oddColumnColor");},setForceLayout:function(a){this.forceLayout=a;this.layout.layout=$.noop;this.layout.render=$.noop;},setRowGap:function(a){this.rowGap=a;},setColumnGap:function(a){this.columnGap=a;},onRender:function(b){this.base(b);this.el.addClass("ui-glp");var a=this.getMetaObj();a.oddColumnColor&&this.setOddColumnColor(a.oddColumnColor);a.rowGap&&this.setRowGap(a.rowGap);a.columnGap&&this.setColumnGap(a.columnGap);},afterRender:function(){this.base();if(this.forceLayout==false){this.setForceLayout(this.forceLayout);}},initDefaultValue:function(w){this.base(w);var m=this.rowGap=w.rowgap;var B=this.columnGap=w.columngap;var C=this.heights=w.heights;var f=this.widths=w.widths;var v=this,a=v.getRenderTarget(),I=v.el,A=I.innerHeight(),K=I.innerWidth();if(!f||!C){throw"widths or heights undefined";}var G=parseInt(I.css("padding")),x=parseInt(I.css("padding-left")),D=parseInt(I.css("padding-right")),L=parseInt(I.css("padding-top")),E=parseInt(I.css("padding-bottom")),g=parseInt(I.css("margin")),q=parseInt(I.css("margin-left")),y=parseInt(I.css("margin-right")),c=parseInt(I.css("margin-top")),r=parseInt(I.css("margin-bottom"));A-=(G==0?(L+E):G*2)+(g==0?(c+r):g*2);K-=(G==0?(x+D):G*2)+(g==0?(q+y):g*2);var k=v.layout.calcRealValues(K,f),o=v.layout.calcRealValues(A,C),t=I.find("table"),n=true,J,e;for(var H=0;H<o.length;H++){J=$(t[0].rows[H]).height(o[H]);for(var F=0;F<k.length;F++){e=$(J[0].cells[F]);if(n){e.width(k[F]);}var z=e.children();var b;if(z.length>0){b=z[0].nodeName.toLowerCase();}var h=parseInt(e.attr("col")),p=parseInt(e.parent().attr("row")),s=parseInt(e.attr("colspan")),u=parseInt(e.attr("rowspan"));var l=k[h],d=o[p];if(s>1){for(var F=1;F<s;F++){l+=k[h+F];}}if(u>1){for(var F=1;F<u;F++){d+=o[p+F];}}z.height(d);if(b=="label"){z.css("line-height",d+"px");}if(B>0){z.width(l-B);}else{z.width(l);}z.css("margin-top",m+"px");z.css("margin-left",B+"px");}n=false;}}});YIUI.reg("gridlayoutpanel",YIUI.Panel.GridLayoutPanel);YIUI.Panel.SplitPanel=YIUI.extend(YIUI.Panel,{layout:"SplitLayout",orientation:"vertical",splitSizes:null,init:function(a){this.base(a);},afterAdd:function(b){var a=this.items,c=a.length-1;if(this.orientation=="vertical"){if(!b.width){b.width="100%";}}else{if(!b.height){b.height="100%";}}},setOrientation:function(a){this.orientation=a;},onRender:function(a){this.base(a);this.el.addClass("ui-spl");this.getMetaObj().orientation&&this.setOrientation(this.getMetaObj().orientation);},install:function(){var a=this.getRenderTarget();a.children(".spl-resizer").off("mousedown").on("mousedown",null,this,resizeStart);},initDefaultValue:function(n){this.el=n.el;this.splitSizes=n.splitsizes;this.orientation=n.orientation;this.layout.container=this;var f=this,j=f.items,m,a=f.el.outerWidth(),h=f.el.outerHeight(),c=f.el.children(".spl-item"),l=f.el.children(".spl-resizer"),d=f.orientation==="vertical",k=f.splitSizes;for(var e=0,g=l.length;e<g;e++){if(d){l.eq(e).width(a);}else{l.eq(e).height(h);}}for(var e=0,g=c.length;e<g;e++){var b=c.eq(e);if(d){b.height($.getReal(k[e].size,(h-f.layout.getPlaceholderSize())));}else{b.width($.getReal(k[e].size,(a-f.layout.getPlaceholderSize())));}}for(var e=0,g=j.length;e<g;e++){m=j[e].el;if(d){m.height($.getReal("100%",c.eq(e).height()));m.width(a);}else{m.height(h);m.width($.getReal("100%",c.eq(e).width()));}}}});YIUI.reg("splitpanel",YIUI.Panel.SplitPanel);function resizeStart(b){b.preventDefault();var e=b.data.layout,f=b.data,a=$(this),g=parseInt(a.attr("region")),h=f.items[g],j=f.items[g+1],c=e.resize,d=f.orientation!=="horizontal";e.container=f;if(f.splitSizes&&(f.splitSizes[g].resizable===false||f.splitSizes[g+1].resizable===false)){return;}c.splitter=a;c.startPos=a.cssNum(!d?"left":"top",0);c.startMouse=!d?b.screenX:b.screenY;a.addClass("r-moving");$(document).off("mousemove").off("mouseup.splitter").on("mousemove",null,e,resizeMove).on("mouseup.splitter",null,e,resizeStop);}function resizeMove(b){b.preventDefault();var j=b.data,k=j.container,e=j.resize,a=e.splitter,m=parseInt(a.attr("region")),g=k.getRenderTarget().children(".spl-item"),h=$(g[m]),d=$(g[m+1]),f=k.orientation!=="horizontal",l=!f?b.screenX:b.screenY,n=l-e.startMouse,c=j.regionMinSize;if(f){if(h.height()+n<c){n=c-h.height();}else{if(d.height()-n<c){n=d.height()-c;}}}else{if(h.width()+n<c){n=c-h.width();}else{if(d.width()-n<c){n=d.width()-c;}}}e.delta=n;a.css(!f?"left":"top",e.startPos+n);}function resizeStop(c){c.preventDefault();var l=c.data,m=l.container,g=l.resize,b=g.splitter,p=parseInt(b.attr("region")),f=m.getRenderTarget(),j=f.children(".spl-item"),k=$(j[p]),e=$(j[p+1]),o=m.items[p],q=m.items[p+1],h=m.orientation!=="horizontal",d=l.regionMinSize,r=g.delta||0,a=m.getWidth(),n=m.getHeight();$(document).off("mousemove",resizeMove).off("mouseup.splitter",resizeStop);if(r!==0){if(h){k.height(k.height()+r);e.height(e.height()-r);if(o.height==-1){o.setHeight($.getReal("100%",k.height()));}else{o.setHeight($.getReal(o.height,k.height()));}if(q.height==-1){q.setHeight($.getReal("100%",e.height()));}else{q.setHeight($.getReal(q.height,e.height()));}n-=m.layout.getPlaceholderHeight();m.splitSizes[p].size=k.height();m.splitSizes[p+1].size="100%";}else{k.width(k.width()+r);e.width(e.width()-r);if(o.width==-1){o.setWidth($.getReal("100%",k.width()));}else{o.setWidth($.getReal(o.width,k.width()));}if(q.width==-1){q.setWidth($.getReal("100%",e.width()));}else{q.setWidth($.getReal(q.width,e.width()));}a-=m.layout.getPlaceholderWidth();m.splitSizes[p].size=k.width();m.splitSizes[p+1].size="100%";}if(o.hasLayout){o.doLayout(o.getWidth(),o.getHeight());}if(q.hasLayout){q.doLayout(q.getWidth(),q.getHeight());}}b.removeClass("r-moving");b.css(!h?"left":"top",0);$.destroy(g);}YIUI.Panel.TabPanel=YIUI.extend(YIUI.Panel,{layout:"TabLayout",tabTemplate:'<li><a href="#{href}"><label style="float: left;">#{title}</label></a></li>',activeTab:-1,selectedTab:null,height:"100%",tabPosition:YIUI.DirectionType.TOP,setTabPosition:function(a){this.tabPosition=a;},onRender:function(a){this.base(a);this.el.addClass("ui-tabpnl");this.getMetaObj().tabPosition&&this.setTabPosition(this.getMetaObj().tabPosition);if(this.height=="pref"){this.height="100%";}},afterAdd:function(c){if(!this.rendered){return;}var h=c.getMetaObj().title||item.caption,a=c.id||YIUI.allotId(),e="tab_"+a,j=$(this.tabTemplate.replace(/#\{href\}/g,"#"+e).replace(/#\{title\}/g,h)),f=this.getEl(),g=f.children(".ui-tabs-nav"),d=f.children(".tab-body");$("[href=#"+e+"]",j).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+e+"] label",j).addClass("ui-anchor-label");g.append(j);var b=$("<div id="+e+"></div>").appendTo(d);c.el.appendTo(b);b.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").toggleClass("aria-show").attr("role","tabpanel");j.addClass("ui-state-default ui-corner-top").attr("role","tab").toggleClass("aria-selected").attr("aria-controls",e);if(this.selectedTab){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}this.setActiveTab(c);this.layout.layout(this.getWidth(),this.getHeight());this.selectedTab=j;},reduceVisible:function(h,c){var e=c.key;var f=$("[aria-controls='tab_"+c.id+"']",this.el);if(h){var d=$("li:not(':hidden')",this.el);if(d.length==0){this.setTabSel($("a",f));}f.show();}else{f.hide();if(f.attr("aria-controls")!=this.selectedTab.attr("aria-controls")){return;}var a=f.prevAll().not(":hidden").last();var b=f.nextAll().not(":hidden").first();var g=null;if(a.length>0){g=a;}else{if(b.length>0){g=b;}}if(!g){return;}this.setTabSel($("a",g));}},setTabSel:function(target,event){var _this=this;if(target.hasClass("ui-anchor-label")||target.hasClass("ui-tans-anchor")){var $sel_li=target.closest("li");if(_this.selectedTab&&_this.selectedTab.attr("aria-controls")!=$sel_li.attr("aria-controls")){$sel_li.toggleClass("aria-selected");}var tabID=$sel_li.attr("aria-controls");if(_this.selectedTab.attr("aria-controls")==$sel_li.attr("aria-controls")){if(event){if(event.stopPropagation){event.stopPropagation();}else{event.cancelBubble=true;}}return false;}else{var form=YIUI.FormStack.getForm(_this.ofFormID);var cxt={form:form};if(_this.itemChanged){form.eval(_this.itemChanged,cxt);}var tab=_this.get(tabID.substr(4));var active=tab.active;if(active){form.eval(active,cxt);}_this.selectedTab.toggleClass("aria-selected");$("#"+_this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}$("#"+tabID).toggleClass("aria-show");_this.setActiveTab(tabID);$("#"+tabID).show();_this.layout.layout(_this.getWidth(),_this.getHeight());_this.selectedTab=$sel_li;}},install:function(){var a=this;a.el.children("ul").click(function(b){var c=$(b.target);a.setTabSel(c,b);b.stopPropagation();return false;});},setActiveTab:function(c){var a=-1;if($.isNumeric(c)){if(c<0&&c>this.items.length-1){return;}a=c;}else{if($.isString(c)){for(var b=0;b<this.items.length;b++){if(c=="tab_"+this.items[b].getId()){a=b;break;}}}else{if($.isObject(c)){for(var b=0;b<this.items.length;b++){if(c==this.items[b]){a=b;break;}}}}}if(a!=-1){if(this.activeTab!=a){this.activeTab=a;}}},initDefaultValue:function(d){this.base(d);this.lookupComponent(d);this.selectedTab=$(".ui-tabs-nav",this.el).children().eq(0);this.setActiveTab(0);var g=this,f=$("ul",this.el),b=$(".tab-body",this.el);if(g.items&&g.items.length!=0){f=$(g.el.children()[0]);b=$(g.el.children()[1]);b.height(g.el.outerHeight()-f.outerHeight(true));var c=this.items;for(var e=0,a=c.length;e<a;e++){c[e]=g.lookupComponent(c[e]);}}}});YIUI.reg("tabpanel",YIUI.Panel.TabPanel);YIUI.Panel.TabPanelEx=YIUI.extend(YIUI.Panel.TabPanel,{listeners:{closetab:function(b){var a=$(b.target);var d=a.closest("li").attr("aria-controls");var c=a.closest("li").index()-2;if((this.activeTab==c&&this.activeTab!=0)||c<this.activeTab){this.activeTab-=1;}this.remove(this.get(d));}},afterRender:function(){this.base();var c=this.el;var b=$(".ui-tabs-nav",c);b.addClass("ui-tabs-ex");var a="<li><img alt='图片' src='Resource/file.png'><label class='ui-tabs-nav-label' style='vertical-align: middle;'>物料订单</label></li>"+"<li class='customView_li' style='float: right;'></li>";b.prepend(a);},remove:function(a,b){this.base(a,b);var c;if($(".tab-body",tabs).children().length<=0){$(".ui-tabs-nav-label",tabs).html("物料订单");}else{c=this.items[this.activeTab];$(".ui-tabs-nav-label",tabs).html(c.title);}},setActiveTab:function(a){this.base(a);if(index!=-1&&this.rendered){$(".ui-tabs-nav-label",this.el).html(a.title);}}});YIUI.reg("tabpanelex",YIUI.Panel.TabPanelEx);YIUI.TREEPANEL_CKBOXTYPE_NORMAL_SELECT={"Y":"ps","N":"ps"};YIUI.TREEPANEL_CKBOXTYPE_SINGLE_SELECT={"Y":"","N":""};YIUI.TreePanel=YIUI.extend(YIUI.Panel,{showIcon:true,showLine:true,width:null,height:null,showCheckBox:false,checkBoxType:YIUI.TREEPANEL_CKBOXTYPE_NORMAL_SELECT,dblClickExpand:true,dataSource:null,tree:null,addDiyDom:null,async:{autoParam:[],dataFilter:null,enable:false,otherParam:[],type:"post",url:""},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null},initEvert:function(){},init:function(a){this.base(a);},onRender:function(a){this.base(a);this.el.addClass("ztree");var b={check:{enable:this.showCheckBox,chkboxType:this.checkBoxType},data:{simpleData:{enable:true}},view:{showLine:this.showLine,showIcon:this.showIcon,selectedMulti:false,dblClickExpand:this.dblClickExpand,addDiyDom:this.addDiyDom},callback:this.callback,async:this.async};$.fn.zTree.init(this.el,b,this.dataSource);this.tree=$.fn.zTree.getZTreeObj(this.id);},expandNode:function(d,e,c,a,b){return this.tree.expandNode(d,e,c,a,b);},selectNode:function(b,a){this.tree.selectNode(b,a);},getNodes:function(){return this.tree.getNodes();},getCheckedNodes:function(a){return this.tree.getCheckedNodes(a);}});YIUI.reg("treepanel",YIUI.TreePanel);YIUI.Panel.TabContainer=YIUI.extend(YIUI.Panel,{layout:"tab",tabTemplate:'<li><a href="#{href}"><label style="float: left;">#{title}</label><span class="ui-icon ui-icon-close" role="presentation">Remove Tab</span></a></li>',activeTab:-1,selectedTab:null,_hasShow:false,listeners:{closetab:function(b){var a=$(b.target);var c=a.closest("li").attr("aria-controls");YIUI.EventHandler.doCloseForm(this.get(c));}},close:function(a){var b=$("[aria-controls="+a+"]").index();if((this.activeTab==b&&this.activeTab!=0)||b<this.activeTab){this.activeTab-=1;}this.remove(this.get(a));},afterAdd:function(c){if(!this.rendered){return;}var g=c.abbrCaption||"",h=c.id||YIUI.allotId(),b=$(this.tabTemplate.replace(/#\{href\}/g,"#"+h).replace(/#\{title\}/g,g)),e=this.getEl(),d=$("ul.ui-tabs-nav",e.children(".ui-tabs-header")),a=e.children(".ui-tabs-body");$("[href=#"+h+"]",b).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+h+"] label",b).addClass("ui-anchor-label");b.data("key",this.key);d.append(b);c.el=$("<div id="+h+"></div>").appendTo(a);c.el.addClass("ui-tabs-tabcontainer ui-widget-content ui-corner-bottom").toggleClass("aria-show").attr("role","tabpanel");b.addClass("ui-state-default ui-tabcontainer").attr("role","tab").toggleClass("aria-selected").attr("aria-controls",c.id);if(this.selectedTab){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}this.setActiveTab(c);this.layout.layout(this.getWidth(),this.getHeight());this.selectedTab=b;var f=$("<li/>").attr("aria-controls",b.attr("aria-controls")).html($("label",b).text());$("ul",this._dropView).append(f);this.setDropBtnView();this.setTabListColor();},setDropViewLeft:function(){this._dropView.css({"top":this._dropBtn.offset().top+this._dropBtn.height(),"left":document.body.clientWidth-this._dropView.outerWidth()-30});},setSelectedTab:function(a){if(!this.selectedTab||this.selectedTab.attr("aria-controls")==a.attr("aria-controls")){return;}else{a.toggleClass("aria-selected");this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}var b=this.get(a.attr("aria-controls"));$("#"+b.id).toggleClass("aria-show");this.setActiveTab(b);this.layout.layout(this.getWidth(),this.getHeight());this.selectedTab=a;var c=a.position().left-$(".ui-tabs-header",this.el).width()+a.width();$(".ui-tabs-header",this.el).scrollLeft(c<0?0:c);this.setTabListColor();},setDropBtnView:function(){var a=$(".ui-tabs-header li",this.el).last();if(a.length==0||!this.selectedTab){return;}if(a.position().left+a.width()<=$(".ui-tabs-header",this.el).width()){this._dropBtn.removeClass("show");}a=this.selectedTab;if(a.position().left+a.width()>$(".ui-tabs-header",this.el).width()){if(!this._dropBtn.hasClass("show")){this._dropBtn.addClass("show");}$(".ui-tabs-header",this.el).scrollLeft(a.position().left-$(".ui-tabs-header",this.el).width()+a.width());}},setTabListColor:function(){var f=$(".ui-tabs-header",this.el).offset().left;var b=$(".ui-tabs-header li",this.el),e,c;for(var d=0,a=b.length;d<a;d++){e=b.eq(d);c=$("li[aria-controls = "+e.attr("aria-controls")+"]",this._dropView);if(e.offset().left>=f&&e.offset().left<=f+$(".ui-tabs-header",this.el).width()){c.addClass("lightColor");}else{c.removeClass("lightColor");}}},install:function(){var a=this;$(".ui-tabs-header",a.el).delegate("li","click",function(b){var c=$(b.target);if(c.hasClass("ui-icon-close")){a.fireEvent("closetab",b);}else{if(c.hasClass("ui-anchor-label")||c.hasClass("ui-tans-anchor")){a.setSelectedTab(c.closest("li"));}}b.stopPropagation();return false;});a._dropBtn.click(function(b){if(!$(this).hasClass("show")){return;}if(a._hasShow){a.hideTabList();a._dropView.removeClass("showList");return;}else{a._dropView.addClass("showList");}a.setDropViewLeft();a._dropView.slideDown("fast");a._dropView.css("z-index",$.getZindex(a._dropBtn)+1);$(document).on("mousedown",function(d){var c=$(d.target);if((c.closest(a._dropView).length==0)&&(c.closest(a._dropBtn).length==0)){a.hideTabList();a._dropView.removeClass("showList");}});a._hasShow=true;b.stopPropagation();});$("ul",a._dropView).delegate("li","click",function(d){var b=$(this).attr("aria-controls");var c=$("li[aria-controls = "+b+"]",a.el);a.setSelectedTab(c);a.hideTabList();});},hideTabList:function(){this._dropView.hide();this._hasShow=false;},remove:function(a,b){var f=a.getId();var e=a.ofFormID;a=this.base(a,b);if(!a){return;}var c=this.getEl();YIUI.FormStack.removeForm(e);$("#"+f,c).remove();$("[aria-controls="+f+"]",c).remove();$("li[aria-controls="+f+"]",this._dropView).remove();this.setDropBtnView();var d;if($(".ui-tabs-body",c).children().length<=0){this.activeTab=-1;return;}else{d=this.items[this.activeTab];}if(this.selectedTab&&this.selectedTab.attr("aria-controls")==f){d.el.toggleClass("aria-show");$("li[aria-controls = "+d.id+"]").toggleClass("aria-selected");}this.selectedTab=$("li[aria-controls = "+d.id+"]");this.layout.layout(this.getWidth(),this.getHeight());},setActiveTab:function(c){var a=-1;if($.isNumeric(c)){if(c<0&&c>this.items.length-1){return;}a=c;}else{if($.isString(c)){for(var b=0;b<this.items.length;b++){if(c==this.items[b].getId()){a=b;break;}}}else{if($.isObject(c)){for(var b=0;b<this.items.length;b++){if(c==this.items[b]){a=b;break;}}}}}if(a!=-1){if(this.activeTab!=a){this.activeTab=a;}}}});YIUI.reg("tabcontainer",YIUI.Panel.TabContainer);YIUI.Panel.TabExContainer=YIUI.extend(YIUI.Panel.TabPanelEx,{afterRender:function(){this.base();var a;switch(this.customTag){case"UserInfoPane":a=YIUI.CUSTOMVIEW.USERINFOPANE;break;default:a="";}$(a).appendTo($(".customView_li"));}});YIUI.reg("tabexcontainer",YIUI.Panel.TabExContainer);YIUI.Panel.StackContainer=YIUI.extend(YIUI.Panel,{init:function(a){this.base(a);this.formID=null;},onSetHeight:function(a){this.base(a);},afterAdd:function(a){if(this.items.length>=2){this.items.shift();}if(this.el){this.el.empty();if(!this.isReplace){this.formID&&YIUI.FormStack.removeForm(this.formID);this.isReplace=false;}}this.formID=a.ofFormID;},remove:function(a,b){this.base(a,b);this.formID&&YIUI.FormStack.removeForm(this.formID);},getActivePane:function(){return YIUI.FormStack.getForm(this.formID);},build:function(b){var a=b.getRoot();this.add(a);this.doRenderChildren();this.doLayout(this.el[0].clientWidth,this.el[0].clientHeight);b.setContainer(this);var c=$('<div class="errorinfo"><label/><span class="closeIcon"></span></div>');c.prependTo(a.el);b.setErrDiv(c);},removeForm:function(a){this.remove(a.getRoot());this.formID&&YIUI.FormStack.removeForm(this.formID);}});YIUI.reg("stackcontainer",YIUI.Panel.StackContainer);YIUI.Panel.WizardPanel=YIUI.extend(YIUI.Panel,{layout:"WizardLayout",funcMap:{},onRender:function(a){this.base(a);this.el.addClass("ui-wizard");$("<div class = 'ui-wizard-warp'></div>").appendTo(this.el);this.body=$("<div class = 'body'></div>").appendTo(this.el);},afterRender:function(){this.base();var h=this.el.children();var b=h.length;var g=$(h.get(0)).width();var f=this.el.css("padding");var a=this.el.children().css("padding");f=parseInt(f.substring(0,f.length-2));a=parseInt(a.substring(0,a.length-2));g=g+a*2;$(".ui-wizard-warp").width(g);var c=$('<div class="wizard-btn left"><span class="btn-left"></span><span class="prev">上一步</span></div>');var d=$('<div class="wizard-btn right"><span class="btn-right"></span><span class="next">下一步</span><span class="finish">完成</span></div>');var e=$('<div class="paginfo"></div>');c.appendTo($(".ui-wizard-warp"));d.appendTo($(".ui-wizard-warp"));e.appendTo($(".ui-wizard-warp"));},install:function(){var self=this;$(".ui-wizard-warp .btn-left",this.el).click(function(){$(".ui-wizard-warp .prev",self.el).click();});$(".ui-wizard-warp .btn-right",this.el).click(function(){if($(".ui-wizard-warp",self.el).hasClass("last")){$(".ui-wizard-warp .finish",self.el).click();}else{$(".ui-wizard-warp .next",self.el).click();}});$(".ui-wizard-warp .next",this.el).click(function(){if(!self.enable){return false;}var next_div=self.selectItem.next();if(next_div.length==0){return;}var key=self.selectItem.attr("key");var item=self.funcMap[key];var form=YIUI.FormStack.getForm(self.ofFormID);if(item){var check=item.check;var ret=true;if(check){ret=form.eval(check,{form:form});}if(!ret){return;}}var right=(parseInt(self.body.css("right"))||0)+self.getWidth();self.body.animate({right:right+"px"},"slow");if(item){var leave=item.leave;if(leave){form.eval(leave,{form:form});}}var next_key=next_div.attr("key");var next_item=self.funcMap[next_key];if(next_item){var next_active=next_item.active;if(next_active){form.eval(next_active,{form:form});}}var warp=$(".ui-wizard-warp",self.el);if(warp.hasClass("first")){warp.removeClass("first");}if(next_div.index()==self.items.length-1){warp.addClass("last");}self.selectItem=next_div;});$(".ui-wizard-warp .prev",this.el).click(function(){if(!self.enable){return false;}var prev_div=self.selectItem.prev();if(prev_div.length==0){return;}var key=self.selectItem.attr("key");var item=self.funcMap[key];var form=YIUI.FormStack.getForm(self.ofFormID);if(item){var leave=item.leave;if(leave){form.eval(leave,{form:form});}}var right=(parseInt(self.body.css("right"))||0)-self.getWidth();self.body.animate({right:right+"px"},"slow");var prev_key=prev_div.attr("key");var prev_item=self.funcMap[prev_key];if(prev_item){var prev_active=prev_item.active;if(prev_active){form.eval(prev_active,{form:form});}}self.selectItem=prev_div;var warp=$(".ui-wizard-warp",self.el);if(warp.hasClass("last")){warp.removeClass("last");}if(prev_div.index()==0){warp.addClass("first");}});$(".ui-wizard-warp .finish",this.el).click(function(){var finish=self.finish;if(finish){var form=YIUI.FormStack.getForm(self.ofFormID);form.eval(finish,{form:form});}});}});YIUI.reg("wizardpanel",YIUI.Panel.WizardPanel);(function(){YIUI.TabContainer=function(){var Return={tabTemplate:'<li><a href="#{href}"><label style="float: left;">#{title}</label><span class="ui-icon ui-icon-close">Remove Tab</span></a></li>',activeTab:-1,selectedTab:null,_hasShow:false,aueltoEl:"<div></div>",items:[],close:function(comp){this.removeTimermsg(comp);var li=$("[aria-controls="+comp.id+"]",this.el);var _index=li.index();if(li.hasClass("aria-selected")&&this.activeTab!=_index){this.activeTab=_index>0?_index-1:0;}else{if((this.activeTab==_index&&this.activeTab!=0)||_index<this.activeTab){this.activeTab-=1;}}this.remove(comp);if(this.items.length>0){this.el.removeClass("empty");}else{this.el.addClass("empty");}},removeTimermsg:function(comp){var D=comp.ofFormID.toString().length;for(var t in timerArray){if(comp.ofFormID==t.substring(0,D)){window.clearInterval(timerArray[t]);delete timerArray[t];}}},closeAll:function(){var head=$("ul.ui-tabs-nav",this.el),body=this.el.children(".ui-tabs-body");head.empty();body.empty();if(this.items){for(var i=0,len=this.items.length;i<len;i++){var item=this.items[i];item.destroy();}}this.items=[];YIUI.FormStack.removeAll();this.el.addClass("empty");this._dropBtn.removeClass("show");this._dropView.removeClass("showList");$("ul",this._dropView).empty();},removeForm:function(form){this.close(form.getRoot());},initTimer:function(form){var timertaskcol=form.timerTask;if(timertaskcol!=undefined||timertaskcol!=null){var newcxt={"form":form};var KeyArray=new Array();var i=0;for(var t in timertaskcol){if(timerContent[form.formID+t]==undefined){timerContent[form.formID+t]=timertaskcol[t].enable;}KeyArray[i]=t;i++;}var timerNum=KeyArray.length;var timerAr=new Array();for(var k=0;k<timerNum;k++){if(timertaskcol[KeyArray[k]].repeat){var enable=timertaskcol[KeyArray[k]].enable==timerContent[form.formID+KeyArray[k]]?timertaskcol[KeyArray[k]].enable:timerContent[form.formID+KeyArray[k]];timerAr[k]=new timerTask(timertaskcol[KeyArray[k]].key,enable,newcxt,timertaskcol[KeyArray[k]].delay,timertaskcol[KeyArray[k]].period,(timertaskcol[KeyArray[k]].content).trim(),form);timerAr[k].startTimer();}}}},afterAdd:function(comp){if(!this.rendered){return;}var form=YIUI.FormStack.getForm(comp.ofFormID);var title=comp.abbrCaption||"",tabs=this.getEl(),head=$("ul.ui-tabs-nav",tabs.children(".ui-tabs-header")),body=tabs.children(".ui-tabs-body"),id=comp.id||YIUI.allotId(),li=$(this.tabTemplate.replace(/#\{href\}/g,"#"+id).replace(/#\{title\}/g,title));if(form.isStack){var $li=this.selectedTab;var tab=this.items[this.activeTab];var stack=tab.stack=tab.stack||[];stack.push(comp.id);tab.activeItem=comp;var div=$("#"+$li.attr("aria-controls"));div.toggleClass("aria-show");var ct=div.parent();comp.el=$("<div id="+id+"></div>").appendTo(body);comp.el.addClass("tabcnt-cont ui-widget-content ui-corner-bottom").toggleClass("aria-show");$("label",$li).html(title);$li.attr("aria-controls",id);return;}$("[href=#"+id+"]",li).addClass("ui-tans-anchor");$("[href=#"+id+"] label",li).addClass("ui-anchor-label");if(form.entryPath){li.attr("formKey",form.formKey);li.attr("paras",form.entryParas);}li.data("key",this.key);head.append(li);comp.el=$("<div id="+id+"></div>").appendTo(body);var errDiv=$('<div class="errorinfo"><label/><span class="closeIcon"></span></div>');errDiv.prependTo(comp.el);form.setErrDiv(errDiv);comp.el.addClass("tabcnt-cont ui-widget-content ui-corner-bottom").toggleClass("aria-show");li.addClass("ui-state-default ui-tabcontainer").toggleClass("aria-selected").attr("aria-controls",comp.id);if(this.selectedTab&&this.selectedTab.attr("aria-controls")!=li.attr("aria-controls")){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}this.setActiveTab(comp);this.selectedTab=li;var _li=$("<li/>").attr("aria-controls",li.attr("aria-controls")).html($("label",li).text());$("ul",this._dropView).append(_li);this.setDropBtnView();this.setTabListColor();this.el.removeClass("empty");this.initTimer(form);},setDropViewLeft:function(){this._dropView.css({"top":this._dropBtn.offset().top+this._dropBtn.height(),"left":document.body.clientWidth-this._dropView.outerWidth()});},clearSelect:function(){if(this.selectedTab){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");this.selectedTab=null;}},setSelectedTab:function(li){if(!this.selectedTab){li.toggleClass("aria-selected");}else{if(this.selectedTab.attr("aria-controls")==li.attr("aria-controls")){return;}else{li.toggleClass("aria-selected");this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}}var tab=this.get(li.attr("aria-controls"));$("#"+tab.id).toggleClass("aria-show");this.setActiveTab(tab);this.layout(this.getWidth(),this.getHeight());this.selectedTab=li;var scrollLeft=li.position().left-$(".ui-tabs-header",this.el).width()+li.width();$(".ui-tabs-header",this.el).scrollLeft(scrollLeft<0?0:scrollLeft);this.setTabListColor();},setDropBtnView:function(){this._dropView.removeClass("showList");var li=$(".ui-tabs-header li",this.el).last();if(li.length==0||!this.selectedTab){return;}if(li.position().left+li.width()<=$(".ui-tabs-header",this.el).width()){this._dropBtn.removeClass("show");}else{this._dropBtn.addClass("show");}},setTabListColor:function(){var _left=$(".ui-tabs-header",this.el).offset().left;var _childs=$(".ui-tabs-header li",this.el),_child,selectedLi;for(var i=0,len=_childs.length;i<len;i++){_child=_childs.eq(i);selectedLi=$("li[aria-controls = "+_child.attr("aria-controls")+"]",this._dropView);if(_child.offset().left>=_left&&_child.offset().left<=_left+$(".ui-tabs-header",this.el).width()){selectedLi.addClass("lightColor");}else{selectedLi.removeClass("lightColor");}}},install:function(){var _this=this;$(".ui-tabs-header",_this.el).delegate("li","click",function(event){var target=$(event.target);if(target.hasClass("ui-icon-close")){var target=$(event.target);var itemId=target.closest("li").attr("aria-controls");YIUI.EventHandler.doCloseForm(_this.get(itemId));}else{_this.setSelectedTab(target.closest("li"));}event.stopPropagation();return false;});_this._dropBtn.click(function(event){if(!$(this).hasClass("show")){return;}if(_this._hasShow){_this.hideTabList();_this._dropView.removeClass("showList");return;}else{_this._dropView.addClass("showList");}_this.setDropViewLeft();_this._dropView.slideDown("fast");_this._dropView.css("z-index",$.getZindex(_this._dropBtn)+1);$(document).on("mousedown",function(e){var target=$(e.target);if((target.closest(_this._dropView).length==0)&&(target.closest(_this._dropBtn).length==0)){_this.hideTabList();_this._dropView.removeClass("showList");}});_this._hasShow=true;event.stopPropagation();});$("ul",_this._dropView).delegate("li","click",function(event){var aria_controls=$(this).attr("aria-controls");var _li=$("li[aria-controls = "+aria_controls+"]",_this.el);_this.setSelectedTab(_li);_this.hideTabList();});$(".ui-tabs-body",_this.el).delegate(".errorinfo .closeIcon","click",function(){$(this).parent().hide();var panel=$(this).parents(".aria-show");_this.items[_this.activeTab].doLayout(panel.width(),panel.height());});},hideTabList:function(){this._dropView.hide();this._hasShow=false;},indexOf:function(comp){var items=this.items;for(var i=0,len=items.length;i<len;i++){if(items[i]===comp){return i;}}return -1;},closeTo:function(key){var f,form;for(var i=this.items.length-1;i>=0;i--){f=this.items[i];form=YIUI.FormStack.getForm(f.ofFormID);if(form.formKey==key){break;}this.removeForm(form);}},remove:function(comp,autoDestroy){if(!comp){return;}var id=comp.getId();var formId=comp.ofFormID;var index=this.indexOf(comp);if(index===-1){return;}var tabs=this.getEl();YIUI.FormStack.removeForm(formId);$("#"+id,tabs).remove();if(autoDestroy===false){comp.getEl().remove();}else{comp.destroy();}var tab=this.items[this.activeTab];this.items.splice(index,1);if(tab.stack&&tab.stack.length>0){var stack=tab.stack;var c_index=stack.indexOf(id);var i=-1;if(c_index==0&&stack.length>1){i=1;}else{if(c_index>0){i=c_index-1;}}var activeTab=null;if(i>-1){var activeItem=this.get(stack[i]);tab.activeItem=activeItem;activeTab=activeItem;}else{tab.activeItem=null;activeTab=tab;}var title=activeTab.abbrCaption||"";activeTab.el.toggleClass("aria-show");var $li=this.selectedTab;$("label",$li).html(title);$li.attr("aria-controls",activeTab.id);stack.splice(c_index,1);}else{$("[aria-controls="+id+"]",tabs).remove();$("li[aria-controls="+id+"]",this._dropView).remove();this.setDropBtnView();if($(".ui-tabs-body",tabs).children(".tabcnt-cont").length<=0){this.activeTab=-1;return;}tab=this.items[this.activeTab];if(this.selectedTab&&this.selectedTab.attr("aria-controls")==id){tab.el.toggleClass("aria-show");$("li[aria-controls = "+tab.id+"]").toggleClass("aria-selected");}this.selectedTab=$("li[aria-controls = "+tab.id+"]");}this.layout(this.getWidth(),this.getHeight());},setActiveTab:function(tab){var index=-1;if($.isNumeric(tab)){if(tab<0&&tab>this.items.length-1){return;}index=tab;}else{if($.isString(tab)){for(var i=0;i<this.items.length;i++){if(tab==this.items[i].getId()){index=i;break;}}}else{if($.isObject(tab)){for(var i=0;i<this.items.length;i++){if(tab==this.items[i]){index=i;break;}}}}}if(index!=-1){if(this.activeTab!=index){this.activeTab=index;}}},add:function(comp){if($.isArray(comp)){var _this=this;$.each(comp,function(i){_this.add(this);});return;}if(this.get(comp.id)){return;}var c=this.lookupComponent(comp);this.items.push(c);this.afterAdd(c);},get:function(comp){if($.isNumeric(comp)){return this.items[comp];}else{if($.isString(comp)){var items=this.items,item;for(var i=0,len=items.length;i<len;i++){item=items[i];if(item&&item.id===comp){return item;}}}}return null;},setWidth:function(width){if(!width||!$.isNumeric(width)||width<=0){return;}if(!this.rendered){this.width=width;return;}var lastSize=this.lastSize;if(lastSize.width!==width){lastSize.width=width;this.onSetWidth(width);}},onSetWidth:function(width){this.el.css("width",width);},getWidth:function(){if(this.rendered){return this.getEl().width();}return this.width;},setHeight:function(height){if(!height||!$.isNumeric(height)||height<=0){return;}if(!this.rendered){this.height=height;return;}var lastSize=this.lastSize;if(lastSize.height!==height){lastSize.height=height;this.onSetHeight(height);}},onSetHeight:function(height){this.el.css("height",height);},getHeight:function(){if(this.rendered){return this.getEl().height();}return this.height;},lookupComponent:function(comp){if($.isString(comp)){return YIUI.ComponentMgr.get(comp);}else{if(!(comp instanceof YIUI.Component)){return YIUI.create(comp,this.defaultType);}}return comp;},doLayout:function(panelWidth,panelHeight){if(this.layout){this.layout(panelWidth,panelHeight);}},onRenderChildren:function(){this.el.addClass("ui-panel");this.doRenderChildren(false,true);},doRenderChildren:function(shallow,force){if(!this.html){var rendered=this.rendered;var forceLayout=force;if(rendered){this.layoutRender();}this.hasLayout=true;this.doLayout(this.getWidth(),this.getHeight());}},render:function(container){if(!this.rendered){this.rendered=true;this.container=container?$(container):(this.container?$(this.container):$.getBody());this.onRender(this.container);this.onRenderChildren();this.install();}},onRender:function(ct){var el=this.el;this.el.addClass("ui-tabcnt empty");if(el&&(!ct||ct.length==0)){this.container=ct=$(el).parent();}if(!el&&this.autoEl){if($.isString(this.autoEl)){el=$(this.autoEl);}}if(el){if(!el.attr("id")){el.attr("id",this.getId());}this.el=$(el);if(this.el.parents("body")[0]!=$.getBody()[0]){ct.append(this.el);}}},layoutRender:function(){var target=this.getRenderTarget();if(this.prepared||this.beforeLayoutRender()!==false){this.prepared=true;this.onLayoutRender(this,target);}},getRenderTarget:function(){return this.getEl();},getEl:function(){return this.el;},onLayoutRender:function(ct,target){this.renderLayoutChildren(ct,target);},renderLayoutChildren:function(ct,target){var items=ct.items;for(var i=0,len=items.length;i<len;i++){var c=items[i],itemTarget=this.getItemTarget(c,i);if(c&&(!c.rendered)){this.renderItem(c,itemTarget);}}},getItemTarget:function(comp,index){return comp.container||this.getRenderTarget();},renderItem:function(c,target){if(c&&!c.rendered){c.doRender(target);}else{if(c&&!this.isValidParent(c,target)){target.insertBefore(c.getEl());c.container=target;}}},layout:function(panelWidth,panelHeight){var ct=this;if(ct.items&&ct.items.length!=0){var ul=$("ul.ui-tabs-nav",ct.el),body=$(ct.el.children(".ui-tabs-body"));body.width(panelWidth);body.height(panelHeight-ul.outerHeight(true));$(".ui-tabs-header",this.el).width(panelWidth-30);tab=ct.items[ct.activeTab];if(tab){if(tab.activeItem){tab=tab.activeItem;}tab.setWidth(body.width());tab.setHeight(body.height());if(tab.hasLayout){tab.doLayout(tab.getWidth(),tab.getHeight());}if(ct.selectedTab){$(".ui-tabs-header",ct.el).scrollLeft(ct.selectedTab.position().left-$(".ui-tabs-header",ct.el).width()+ct.selectedTab.width());}}}ct.setDropBtnView();ct.setTabListColor();},beforeLayoutRender:function(){var ct=this,target=ct.getRenderTarget(),items=ct.items,item;var ul=$("<ul/>");var header=$("<div></div>").addClass("ui-tabs-header").appendTo(target).append(ul);var tabs_list=ct._dropBtn=$("<span></span>").addClass("ui-tabs dropdownBtn").appendTo(target);ct._dropView=$("<div><ul/></div>").addClass("ui-tabs tabs-list");$(document.body).append(ct._dropView);ul.addClass("ui-tabs-nav ui-corner-all");var body=$("<div>").addClass("ui-tabs-body").appendTo(target);for(var i=0,len=items.length;i<len;i++){item=items[i];item.id=item.id||YIUI.allotId();if(!item.title){item.title=item.caption;}var _li=$(YIUI.Panel.TabPanel.prototype.tabTemplate.replace(/#\{href\}/g,"#"+item.id).replace(/#\{title\}/g,item.title)).appendTo(ul);if(i==0){ct.selectedTab=_li;ct.activeTab=0;}else{}_li.addClass("ui-state-default ui-corner-top").attr("aria-controls",item.id);$("[href=#"+item.id+"]",_li).addClass("ui-tans-anchor");$("[href=#"+item.id+"] label",_li).addClass("ui-anchor-label");var _div=$("<div>").attr("id",item.id).appendTo(body);item.container=_div;_div.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(i==0){_li.toggleClass("aria-selected");_div.toggleClass("aria-show");}}},afterLayoutRender:function(){var container=this.container;var body=$(container.el.children()[1]),overflow=body.css("overflow");}};return Return;};var timerTask=function(key,enable,cxt,delay,period,content,form){this.enable=enable;this.cxt=cxt;this.delay=delay;this.period=period;this.content=content;this.form=form;this.key=key;};timerContent={};timerArray={};timerTask.prototype={startTimer:function(){var enable=this.enable;var cxt=this.cxt;var form=this.form;var period=this.period;var delay=this.delay;var content=this.content;var key=this.key;setTimeout(function(){timerArray[form.formID+key]=setInterval(function(){var timerkey=timerArray[form.formID+key];if(window.tab.ofFormID==form.formID&&enable==true&&$(".dialog-mask").length<=0){try{form.eval(content,cxt,null);}catch(err){clearInterval(timerkey);}}},period);},delay);}};})();(function(){YIUI.MainTree=function(rootEntry,dom,container){$("ul.tm",dom).remove();var el=$("<ul></ul>").addClass("tm").appendTo(dom);var options={el:el,_open:false,menuType:rootEntry.style,_openedItem:null,_data:[],rootEntry:rootEntry,clickEvent:{expandNode:function($this,self){var nodeId=$this.attr("id");var node=self.getTreeNode(nodeId);self.callback.beforeExpand(node);var expandNode=node.id+"-"+self.el.attr("id");if(!node.isLoaded){node.isLoaded=true;}$this.next().show();$this.removeClass("close collapse").addClass("open expand cursel");$this.parent().addClass("sel");$this.parent().siblings().find(".open.expand").removeClass("open expand cursel").addClass("close collapse").next().hide();},collapse:function($this,self){if($this.has("open expand")){$this.parent().removeClass("sel");$this.parent().find(".open.expand").removeClass("open expand cursel").addClass("close collapse").next().hide();}},selectNode:function($this,self){var id=$this.attr("id");var treeId=self.el.attr("id");if(self.selectedNodeId){$("#"+self.selectedNodeId).removeClass("clicked");$("#"+self.selectedNodeId).parent().removeClass("clicked");}self.selectedNodeId=id;$("#"+id).addClass("clicked");$("#"+id).parent().addClass("clicked");self.callback.onSelect($this,$("#"+treeId),self.getTreeNode(id));}},callback:$.extend({beforeExpand:$.noop,onSelect:function($this,$tree,node){if(node.children){if(self.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$("#"+node.id+" span.icon").click();}else{if(self.menuType==YIUI.TREEMENU_TYPE.TREE){if($("#"+node.id).attr("open")){self.clickEvent.collapse($this,self,null);$("#"+node.id).attr("open",false);$(this).removeClass("cursel");$(this).parent().removeClass("sel");}else{self.clickEvent.expandNode($this,self,null);$("#"+node.id).attr("open",true);$(this).addClass("cursel");$(this).parent().addClass("sel");}}}}else{YIUI.EventHandler.doTreeClick(node,container);}}}),getTreeNode:function(nodeId){for(var i=0,len=this._data.length;i<len;i++){if(this._data[i].id==nodeId){return this._data[i];}}},initDataSource:function(dataSource){if(dataSource){if(!dataSource.length){dataSource=$(dataSource);}var data;for(var i=0,len=dataSource.length;i<len;i++){data=dataSource[i];if(!data.id){data.id=data.key+i;}if(data.children){data.isParent=true;this.initDataSource(data.children);}}}},dataSourceCopy:function(dataSource,parentID){if(dataSource){if(!dataSource.length){dataSource=$(dataSource);}for(var i=0,len=dataSource.length;i<len;i++){var ds=dataSource[i];var parent=ds.parent;var d=new Object();d.name=ds.name;d.id=ds.id;d.itemKey=ds.itemKey;d.layerItemKey=ds.layerItemKey;if(ds.isLoaded){d.isLoaded=ds.isLoaded;}else{d.isLoaded=false;}if(ds.children&&ds.children.length>0){d.open=ds.open;var children=[];for(var j=0,length=ds.children.length;j<length;j++){var child=ds.children[j];children.push(child.id);this.dataSourceCopy($(child),ds.id);}d.children=children;}else{d.key=ds.key;d.formKey=ds.formKey;d.paras=ds.parameters;d.single=ds.single;d.target=ds.target;}d.path=ds.path;if(ds.parent){d.parentId=ds.parent.id;}if(parentID){d.parentID=parentID;}this._data.push(d);}}},buildTreenode:function(el,nodes,parentId){if(!nodes){return;}if(!nodes.length){if(!parentId){nodes=nodes.children;}}nodes&&this.addChilds(nodes,parentId,0,this);},calcBoolean:function(str){if(!this.parser){this.parser=new View.Parser();}return this.parser.eval(str);},addChilds:function(nodes,parentId,level,options){if(nodes.length<=0){if(parentId){$("#"+parentId,options.el).next().remove();$("#"+parentId,options.el).children().first().removeClass("tm-collapse");}return;}var node,nid,isTree=options.menuType!=YIUI.TREEMENU_TYPE.GROUPTREE?true:false;if(parentId){var parentNode=options.getTreeNode(parentId);parentNode.children=[];}if(isTree){options.el.addClass("tree");}for(var i=0,len=nodes.length;i<len;i++){node=nodes[i];nid=node.id;node.parentId=parentId;var isVisible=node.visible==""?true:this.calcBoolean(node.visible);if(!isVisible){continue;}var _li=$("<li class='tm-node' level='"+level+"'></li>").attr("path",node.path);if(node.single){_li.attr("single","true").attr("formKey",node.formKey).attr("paras",node.parameters);}if(node.target){_li.attr("target",node.target);}if(!node.parentId){_li.addClass("top-level");}if(parentId){parentNode.children.push(nid);_li.appendTo($("#"+parentId,options.el).next());}else{_li.appendTo(options.el);}var _a=$("<a id='"+nid+"' class='tm-anchor'></a>").appendTo(_li),_ul;if(node.isParent){if(level==1){_a.css({"backgroundPosition":30,"padding-left":50});}if(level>1){var disX=level*8+50;_a.css({"backgroundPosition":disX,"padding-left":disX+15+"px"}).addClass("multi-level");}}else{if(level==1){_a.css("padding-left",50);}if(level>1){_a.css("padding-left",level*8+50).addClass("multi-level");}}if(node.isParent){_li.addClass("isparent");_ul=$("<ul class='tm-ul'></ul>");if(node.open&&!options._isOpen&&!node.parentId){_li.addClass("sel");_a.addClass("cursel open expand").attr("open",true);options._isOpen=true;options._openedItem=_a;}else{_a.attr("open",false).addClass("close collapse");_ul.css("display","none");}_ul.appendTo(_li);}var _span=$("<span class='tm-name'>"+node.name+"</span>").appendTo(_a);if(node.icon){var _img=$("<img>");_img.one("error",function(){$(this).attr("src","yesui/ui/res/css/blue/images/not-exist.png");}).attr("src","Resource/"+node.icon).css({"vertical-align":"middle","display":"inline-block","margin-right":5}).prependTo(_span);}if(node.children){this.addChilds(node.children,node.id,level+1,options);}else{_a.addClass("noExpand");}}},install:function(){var self=this;self.el.delegate("a","click",function(e){if($(this).hasClass("open")){self.clickEvent.collapse($(this),self);return;}if($(this).hasClass("close")){self.clickEvent.expandNode($(this),self);return;}});self.el.delegate("a","dblclick",function(e){if($(this).hasClass("noExpand")){self.clickEvent.selectNode($(this),self);return;}});},init:function(){this.initDataSource(this.rootEntry);this.dataSourceCopy(this.rootEntry.children);this.buildTreenode(this.el,this.rootEntry);this.install();},reload:function(entry){this.el.empty();this._data=[];this.initDataSource(entry);this.dataSourceCopy(entry.children);this.buildTreenode(this.el,entry);}};options.init();return options;};})();