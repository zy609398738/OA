var Svr=Svr||{};Svr.Request=(function(){var a=function(f){if(f==null){return f;}var e=$.toJSON(f);if(e.length<20000){return f;}var d={};d.yigoData=YIUI.Base64.encode64(pako.gzip(e));return d;};var c=function(e){var d=e.data;if(e.type===YIUI.JavaDataType.STR_USER_DATATABLE){d=YIUI.DataUtil.fromJSONDataTable(d);}else{if(e.type===YIUI.JavaDataType.STR_USER_DOCUMENT){d=YIUI.DataUtil.fromJSONDoc(d);}}return d;};var b={getSyncData:function(f,j,h,e){j.mode=1;var g=null;var d=window.navigator.language||window.navigator.browserLanguage;var k=jstz.determine();var i=k.name();j.locale=d;j.timezone=i;$.ajax({contentType:"application/x-www-form-urlencoded;charset=UTF-8",type:"post",url:f,data:a(j),async:false,dataType:"json",success:function(l){g=c(l);if($.isFunction(h)){g=h(g);}},complete:function(m,l){m=null;},error:function(w,m,n){if(w.readyState==0){$.error("请求状态未初始化，检查服务器连接！");return;}if($.isFunction(e)){}else{var r=w.responseJSON.error;var v=w.responseJSON.data;if(v){for(var q=0;q<v.length;q++){var o=v[q];var u=o["cmd"];var l=o["pFormID"];var p=o["value"];if(u=="diff"){YIUI.UIUtil.diffForm(l,p);}}}var t=r.error_info;var s=r.error_code;if(s!=-1){s=(parseInt(s,10)>>>0).toString(16).toLocaleUpperCase();t=s+"<br/>"+t;}$.error(t);return;}}});return g;},getAsyncData:function(f,j,h,e){j.mode=1;var g=null;var d=window.navigator.language||window.navigator.browserLanguage;var k=jstz.determine();var i=k.name();j.locale=d;j.timezone=i;$.ajax({contentType:"application/x-www-form-urlencoded;charset=UTF-8",type:"post",url:f,data:a(j),async:true,dataType:"json",beforeSend:function(){$(".loading").show();$(".image").css({top:$(window).height()/2,left:$(window).width()/2});},success:function(l){g=c(l);if($.isFunction(h)){g=h(g);}},complete:function(l){l=null;$(".loading").hide();},error:function(w,m,n){$(".loading").hide();if(w.readyState==0){$.error("请求状态未初始化，检查服务器连接！");return;}if($.isFunction(e)){}else{var r=w.responseJSON.error;var v=w.responseJSON.data;if(v){for(var q=0;q<v.length;q++){var o=v[q];var u=o["cmd"];var l=o["pFormID"];var p=o["value"];if(u=="diff"){YIUI.UIUtil.diffForm(l,p);}}}var t=r.error_info;var s=r.error_code;if(s!=-1){s=(parseInt(s,10)>>>0).toString(16).toLocaleUpperCase();t=s+"<br/>"+t;}$.error(t);return;}}});return g;}};return b;})();var Svr=Svr||{};Svr.SvrMgr=(function(){var c=document.location.pathname;while(c.indexOf("/")==0){c=c.substr(1);}var e=unescape(c.substr(0));var a=e.substring(0,e.indexOf("/"));var b={Service:{Authenticate:"Authenticate",LoadTreeMenu:"LoadTreeMenu",DealWithPureForm:"DealWithPureForm",DeleteAttachment:"DeleteAttachment",GetPublicKey:"GetPublicKey",PureFormData:"PureFormData",DelFormData:"DeleteData",GoToPage:"GoToPage",PureDictView:"PureDictView",PureViewMap:"PureViewMap",PureTreeEvent:"PureTreeEvent",GetAppList:"GetAppList"},EventType:{Click:0,DBLClick:1,GainFocus:2,LostFocus:3,EnterPress:4,Expand:5,Collapse:6,GotoPage:7,DictViewSearch:8,CellClick:9,CellSelect:10,RowDelete:11,RowInsert:12,RowChange:13,ValueChanged:14,RowClick:15,RowDblClick:16},getAppList:function(f){f=$.extend({async:false,url:b.ServletURL,service:b.Service.GetAppList},f);return d(f);},doPureTreeEvent:function(f,g){f=$.extend({url:b.ServletURL,service:b.Service.PureTreeEvent},f);return d(f,null,g);},loadTreeMenu:function(f){f=$.extend({async:false,url:b.ServletURL,service:b.Service.LoadTreeMenu},f);return d(f);},dealWithPureForm:function(g,f){g=$.extend({async:true,url:b.ServletURL,service:b.Service.DealWithPureForm},g);return d(g,null,f);},deleteAttachment:function(f){f=$.extend({url:b.AttachURL,service:b.Service.DeleteAttachment},f);d(f);},doLogin:function(i,m,g,j,f){var k=new RSAKey();var l=Svr.SvrMgr.getPublicKey({async:false});k.setPublic(l.modulus,l.exponent);var o={};o.user=i;o.password=m;o.mode=j;var h=k.encrypt($.toJSON(o));h=BASE64.encoder(h);f=$.extend({url:b.ServletURL,logininfo:h,paras:$.toJSON(g),cmd:"Login",service:b.Service.Authenticate},f);var n=function(p){if(p){if(f.cmd=="Login"){$.cookie("userName",p.Name);$.cookie("oldURL",window.location.href);var s=p.Time;var r=new Date(s);var q=r.Format("yyyy/MM/dd HH:mm:ss");$.cookie("login_time",q);if(p.SessionParas){$.cookie("sessionParas",p.SessionParas);}}location.reload();}};d(f,null,n);},doLogout:function(f){f=$.extend({url:b.ServletURL,cmd:"Logout",service:b.Service.Authenticate},f);d(f,null);},getPublicKey:function(f){f=$.extend({url:b.ServletURL,isWeb:true,service:b.Service.GetPublicKey},f);return d(f,null);},dealWithPureData:function(f){f=$.extend({url:b.ServletURL,service:b.Service.PureFormData},f);return d(f);},delPureData:function(f){f=$.extend({url:b.ServletURL,service:b.Service.DelFormData},f);return d(f);},loadFormData:function(f){f=$.extend({url:b.ServletURL,service:b.Service.PureFormData},f);return d(f);},doGoToPage:function(f){f=$.extend({url:b.ServletURL,service:b.Service.GoToPage},f);return d(f);},doDictViewEvent:function(f){f=$.extend({url:b.ServletURL,service:b.Service.PureDictView},f);return d(f);},doMapEvent:function(f){f=$.extend({url:b.ServletURL,service:b.Service.PureViewMap},f);return d(f);},cutImg:function(f){f=$.extend({url:b.ServletURL,service:"CutImage"},f);return d(f);},loadGanttData:function(f,g){f=$.extend({url:b.ServletURL,service:"Gantt",cmd:"LoadGanttData"},f);return d(f,null,g);},saveGanttData:function(f,g){f=$.extend({url:b.ServletURL,service:"Gantt",cmd:"SaveGanttData"},f);return d(f,null,g);},loadForm:function(f,g){f=$.extend({url:b.ServletURL,service:"LoadForm"},f);return d(f,null,g);}};b.ServletURL=[window.location.protocol,"//",window.location.host,"/",a,"/","servlet"].join("");b.UIProxyURL=[window.location.protocol,"//",window.location.host,"/",a,"/","uiproxy"].join("");b.AttachURL=[window.location.protocol,"//",window.location.host,"/",a,"/","attach"].join("");var d=function(g,i,j,f){var h;if(g.async==true){h=Svr.Request.getAsyncData(g.url,g,j,f);}else{h=Svr.Request.getSyncData(g.url,g,j,f);}return h;};return b;})();YIUI.DictService=(function(){var a={getAllParentID:function(g,c,f){var b=true;var d={};d.itemKey=g;d.itemDatas=$.toJSON(c);d.service="DictService";d.cmd="GetParentPath";var e=function(h){if($.isFunction(f)){f(h);}else{b=h;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,d,e);return b;},getAllItems:function(h,d,c,g){var b=true;var e={};e.service="DictService";e.cmd="GetAllItems";e.itemKey=h;if(d!=null){e.filter=d;}e.stateMask=c;var f=function(i){if($.isFunction(g)){g(i);}else{b=i;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,e,f);return b;},getDictChildren:function(i,c,e,d,h){var b=true;var f={};f.itemKey=i;f.itemData=$.toJSON(c);if(e!=null){f.filter=$.toJSON(e);}f.service="WebDictService";f.cmd="GetDictChildren";f.stateMask=d;var g=function(j){if($.isFunction(h)){h(j);}else{b=j;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,f,g);return b;},locate:function(b,g,h,c,f,d,j){var k=true;var e={};e.itemKey=b;if(g!=null){e.field=g;}e.value=h;if(c!=null){e.filter=$.toJSON(c);}e.root=$.toJSON(f);e.statMask=d;e.service="DictService";e.cmd="Locate";var i=function(l){if($.isFunction(j)){j(l);}else{k=l;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,e,i);return k;},getItem:function(h,d,c,g){var e={};e.itemKey=h;e.oid=d;e.statMask=c;e.cmd="GetItem";e.service="WebDictService";var b=true;var f=function(j){var i=null;if(j){i=YIUI.DataUtil.fromJSONItem(j);}if($.isFunction(g)){g(i);}else{b=i;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,e,f);return b;},getQueryData:function(b,j,i,e,f,h,c,g,l){var m=true;var d={};d.itemKey=b;d.startRow=j;d.maxRows=i;d.pageIndicatorCount=e;d.value=f;d.stateMask=h;if(c!=null){d.filter=$.toJSON(c);}if(g!=null){d.root=$.toJSON(g);}d.service="WebDictService";d.cmd="GetQueryData";var k=function(n){if($.isFunction(l)){l(n);}else{m=n;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,d,k);return m;},getSuggestData:function(b,e,d,c,g,i){var j=true;var f={};f.itemKey=b;f.value=e;f.statMask=d;if(c!=null){f.filter=$.toJSON(c);}if(g!=null){f.root=$.toJSON(g);}f.service="WebDictService";f.cmd="GetSuggestData";var h=function(k){if($.isFunction(i)){i(k);}else{j=k;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,f,h);return j;},getParentID:function(g,c,f){var b=true;var d={};d.itemKey=g;d.itemData=$.toJSON(c);d.cmd="GetParentID";d.service="WebDictService";var e=function(h){if($.isFunction(f)){f(h);}else{b=h;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,d,e);return b;},enableDict:function(i,e,d,c,h){var b=true;var f={};f.itemKey=i;f.oid=e;if(typeof(d)==undefined||d==null){d=1;}f.enable=d.toString();f.allChildren=c;f.cmd="EnableDict";f.service="WebDictService";var g=function(j){if($.isFunction(h)){h(j);}else{b=j;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,f,g);return b;},getCaption:function(g,c,f){var b=true;var d={};d.itemKey=g;if($.isArray(c)){c=$.toJSON(c);}d.oids=c;d.cmd="getCaption";d.service="WebDictService";var e=function(h){if($.isFunction(f)){f(h);}else{b=h;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,d,e);return b;},getDictValue:function(h,d,c,g){if(d==undefined||d==null){return null;}var b=true;var e={};e.itemKey=h;e.oid=d.toString();e.fieldKey=c;e.cmd="GetDictValue";e.service="WebDictService";var f=function(i){if($.isFunction(g)){g(i);}else{b=i;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,e,f);return b;},getTreePath:function(e,d){var c={service:"DictService",cmd:"GetParentPath",itemKey:e,itemData:$.toJSON(d)};var b=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,c);return b;},getParentPath:function(e,d){var c={service:"DictService",cmd:"GetParentPath",itemKey:e,itemData:$.toJSON(d)};var b=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,c);return b;}};return a;})();