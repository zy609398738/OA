var YIUI=YIUI||{};var UI=UI||{};var Svr=Svr||{};(function(){var b=0;YIUI.allotId=function(){b++;return"c-"+b;};var a=false;YIUI.extend=function(d,f){if(typeof(d)==="object"){f=d;d=null;}function e(){if(!a){if(d){this.baseprototype=d.prototype;}this.init.apply(this,arguments);}}if(d){a=true;e.prototype=new d();e.prototype.constructor=e;a=false;}for(var c in f){if(f.hasOwnProperty(c)){if(d&&typeof(f[c])==="function"&&typeof(e.prototype[c])==="function"){e.prototype[c]=(function(g,h){return function(){this.base=d.prototype[g];return h.apply(this,arguments);};})(c,f[c]);}else{e.prototype[c]=f[c];}}}return e;};})();(function(b,c){var a=navigator.userAgent.toLowerCase();b.extend(b,{browser:{isIE:/msie/.test(navigator.userAgent.toLowerCase())&&!/opera/.test(navigator.userAgent.toLowerCase()),isSafari:/webkit/.test(a),opera:/opera/.test(a),isMozilla:/mozilla/.test(a)&&!/(compatible|webkit)/.test(a),version:(navigator.userAgent.toLowerCase().match(/.+(?:msie|firefox|opera|chrome|netscape)[/: ]([\d.]+)/)||[])[1]},isDefined:function(d){return typeof d!="undefined";},isObject:function(d){return d&&typeof d=="object";},isString:function(d){return d&&typeof d=="string";},isPercentage:function(d){return d&&/^(\d{1,2}%)$|^(100%)$/.test(d);},getReal:function(f,e){if(!b.isDefined(f)||f==null||f<=0){return"auto";}var g;if(b.isNumeric(f)&&f>1){g=f;}else{if(b.isNumeric(f)&&f<=1){var d=parseFloat(f,10);g=e*d;}else{if(b.isPercentage(f)){var d=parseFloat(f,10)/100;g=e*d;}else{g=parseInt(f,10);}}}return Math.floor(g);},getBody:function(){return b(document.body||document.documentElement);},escapeRe:function(d){return d.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1");},destroy:function(e){for(var d in e){delete e[d];}},trim:function(d){return d.replace(/(^\s*)|(\s*$)/g,"");},capitalizeFirst:function(d){return d.charAt(0).toUpperCase()+d.slice(1);},lowerFirst:function(d){return d.charAt(0).toLowerCase()+d.slice(1);},getZindex:function(e){var d,f;while(e.length&&e[0]!==document){d=e.css("position");if(d==="absolute"||d==="relative"||d==="fixed"){f=parseInt(e.css("zIndex"),10);if(!isNaN(f)&&f!==0){return f;}}e=e.parent();}return 0;},checkFile:function(g,j,f){if(j==null||j==-1){return true;}j=j||1024;var e=0;if(b.browser.isIE){}else{e=g[0].files[0].size/1024;}var h=g.val().toLowerCase();var d=h.substring(h.lastIndexOf(".")+1);if(e>j){alert("超出指定大小！! ("+j+"KB)");return false;}if(f&&b.inArray(d,f)==-1){alert("非指定文件类型！！ ("+f+")");return false;}return true;},getUrlParam:function(d){var e=new RegExp("(^|&)"+d+"=([^&]*)(&|$)");var f=window.location.search.substr(1).match(e);if(f!=null){return unescape(f[2]);}return null;},InputMask:{getCursor:function(k){var h=new Object();var l=0,d=0;if(b.browser.isIE){var f=k.createTextRange();var j=f.text;var g=document.selection.createRange();var e=g.text;g.moveStart("character",-k.value.length);l=k.value.length;d=e.length;}else{l=k.selectionStart;d=k.selectionEnd;}h.start=l;h.end=d;return h;}}});b.extend(b.fn,{cssNum:function(f,e){var d=parseFloat(this.css(f));return b.isNumeric(d)?d:(e||0);},destroy:function(){this.unbind();this.remove();},nextUntilFn:function(e,h){var f=this.nextAll(e);if(h){for(var g=0,d=f.length;g<d;g++){if(h.call(f[g])===false){f.length=g;break;}}}return f;},filterInput:function(f,e,d){if(!f){return this;}b.each(this,function(){var g=new RegExp("[^"+b.escapeRe(f)+"]");var h=new RegExp("["+b.escapeRe(f)+"]","g");var j,k;b(this).keypress(function(m){var n=String.fromCharCode((m.which||m.keyCode));n=e==YIUI.TEXTEDITOR_CASE.UPPER?n.toUpperCase():(e==YIUI.TEXTEDITOR_CASE.LOWER?n.toLowerCase():n);if(!g.test(n)){m.preventDefault();}var l="";if(b.browser.isIE){if(document.selection&&document.selection.createRange){l=document.selection.createRange().text;}}else{l=window.getSelection().toString();}if(!m.ctrlKey&&b(this).val().length>=d&&l.length==0){m.preventDefault();}}).keyup(function(l){var m=l.keyCode||l.which;if(m>=37&&m<=40){return;}b(this).val(b(this).val().replace(h,""));}).focus(function(m){var l=b(this);j=l.val();k=setInterval(function(){if(l.val()!=j){l.val(l.val().replace(h,""));j=l.val();}},100);}).blur(function(l){k&&clearInterval(k);});});return this;}});}(jQuery));(function(a){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){for(var b=0;b<this.length;b++){if(this[b]==c){return b;}}return -1;};}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};}if(!window.console){console={};console.log=function(){return;};}Date.prototype.Format=function(c){var d={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(c)){c=c.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var b in d){if(new RegExp("("+b+")").test(c)){c=c.replace(RegExp.$1,(RegExp.$1.length==1)?(d[b]):(("00"+d[b]).substr((""+d[b]).length)));}}return c;}};})(jQuery);YIUI.EventHandler=(function(){var a={doTreeClick:function(e,b){var k=e.path;var c=$("[path='"+k+"']");if(c.length>0){var f=YIUI.TypeConvertor.toBoolean(c.attr("single"));if(f){var j=c.attr("formKey");var l=c.attr("paras");var g=$("[formKey='"+j+"'][paras='"+l+"']",b.el);if(g.length>0){g.click();return;}}}var d={};d.path=k;d.async=true;var h=function(o){var m;var n=YIUI.FormBuilder.build(o);n.entryPath=k;n.entryParas=l;if(n.target!=YIUI.FormTarget.MODAL){b.build(n);m=n.formID;}if(n.getOperationState()==YIUI.Form_OperationState.New){n.resetUIStatus(YIUI.FormUIStatusMask.ENABLE|YIUI.FormUIStatusMask.VISIBLE|YIUI.FormUIStatusMask.OPERATION);n.getUIProcess().checkAll();n.initFirstFocus();}};Svr.SvrMgr.doPureTreeEvent(d,h);},doCloseForm:function(d){var c=d.ofFormID;var b=YIUI.FormStack.getForm(c);b.fireClose();}};return a;})();YIUI.Handler=(function(){var Return={formatDate:function(date,format){var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"H+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),"S":date.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length));for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)));}}return format;}},convertValue:function(value,type){var ret;switch(type){case DataType.STRING:if(value==null||value==undefined){ret="";}else{ret=""+value;}break;case DataType.INT:case DataType.LONG:case DataType.DOUBLE:case DataType.FLOAT:case DataType.NUMERIC:if(value==undefined||value==null||value==""){ret=0;}else{if(value.toString().toLowerCase()=="true"){value=1;}if(value.toString().toLowerCase()=="false"){value=0;}ret=new Decimal(value,10);}break;case DataType.BOOLEAN:ret=value?true:false;default:ret=value;}return ret;},doOnClick:function(control){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),clickContent=control.clickContent;var cxt={form:form};if(clickContent){form.eval(clickContent,cxt,null);}},setValueToDocument:function(control,dataTable,columnKey,bookmark,newValue){if(dataTable.indexByKey(columnKey)==-1){return;}var type=control.type;var dataType=dataTable.cols[dataTable.indexByKey(columnKey)].type;bookmark==-1?dataTable.first():dataTable.setByBkmk(bookmark);if(newValue==undefined||newValue==null){newValue=Return.convertValue(newValue,dataType);dataTable.setByKey(columnKey,newValue);}else{switch(type){case YIUI.CONTROLTYPE.DICT:case YIUI.CONTROLTYPE.DYNAMICDICT:case YIUI.CONTROLTYPE.COMPDICT:if(control.multiSelect){if(newValue.length>0){var str="";for(var i=0;i<newValue.length;i++){str+=","+newValue[i].oid;}str=str.substring(1);dataTable.setByKey(columnKey,str);if(type==YIUI.CONTROLTYPE.DYNAMICDICT||type==YIUI.CONTROLTYPE.COMPDICT){dataTable.setByKey(columnKey+"ItemKey",newValue[0].itemKey);}}}else{dataTable.setByKey(columnKey,newValue.oid);if(type==YIUI.CONTROLTYPE.DYNAMICDICT||type==YIUI.CONTROLTYPE.COMPDICT){dataTable.setByKey(columnKey+"ItemKey",newValue.itemKey);}}break;case YIUI.CONTROLTYPE.DATEPICKER:if(newValue instanceof Date){newValue=newValue.getTime();}else{newValue=new Date(newValue).getTime();}dataTable.setByKey(columnKey,newValue);break;default:newValue=Return.convertValue(newValue,dataType);dataTable.setByKey(columnKey,newValue);}}},doValueChanged:function(control,newValue,commitValue,fireEvent){var formID=control.ofFormID,metaObj=control.getMetaObj(),form=YIUI.FormStack.getForm(formID),columnKey=metaObj.columnKey,tableKey=metaObj.tableKey,dataTable,document=form.getDocument();if(tableKey){dataTable=document.getByKey(tableKey);}if(commitValue){if(control.getMetaObj().isSubDetail){var cellKey=control.getMetaObj().bindingCellKey;var isToDo=(cellKey!==undefined&&cellKey.length>0);var grid=form.getComponent(control.getMetaObj().parentGridKey),row,colInfoes,colInfo,rowIndex=(grid==null?-1:grid.getFocusRowIndex());if(grid&&rowIndex>=0&&rowIndex<grid.dataModel.data.length){if(isToDo){colInfoes=grid.getColInfoByKey(cellKey);if(colInfoes!==null){for(var ci=0,clen=colInfoes.length;ci<clen;ci++){colInfo=colInfoes[ci];grid.setValueAt(rowIndex,colInfo.colIndex,newValue,true,fireEvent,true);}}}else{row=grid.dataModel.data[rowIndex];if(row&&row.isDetail&&row.bookmark!==undefined){if(dataTable){if(dataTable.tableMode==YIUI.TableMode.HEAD){this.setValueToDocument(control,dataTable,columnKey,-1,newValue);}else{this.setValueToDocument(control,dataTable,columnKey,row.bookmark,newValue);}}}}}else{if(grid&&rowIndex==-1&&isToDo){var lastRowIndex=grid.getLastDetailRowIndex();if(lastRowIndex!=-1){colInfoes=grid.getColInfoByKey(cellKey);if(colInfoes!==null){grid.setFocusRowIndex(lastRowIndex);grid.setCellFocus(lastRowIndex,grid.getCellIndexByKey(cellKey));for(var ci=0,clen=colInfoes.length;ci<clen;ci++){colInfo=colInfoes[ci];grid.setValueAt(lastRowIndex,colInfo.colIndex,newValue,true,fireEvent,true);}}}}}}else{if(dataTable){this.setValueToDocument(control,dataTable,columnKey,-1,newValue);}}if(fireEvent){form.getUIProcess().doValueChanged(metaObj.key);}form.getUIProcess().doPostValueChanged(metaObj.key);}},validated:function(control){var passed=true;var validation=control.validation;if(validation){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID);passed=form.eval(validation,{form:form});}return passed;},hasChanging:function(control){var hasChanging=false;var changing=control.valueChanging;if(changing){hasChanging=true;}return hasChanging;},changing:function(control){var changing=control.valueChanging;if(changing){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID);form.eval(changing,{form:form});}}};return Return;})();YIUI.AttachmentHandler=(function(){var a={doDeleteAttachement:function(f,b,e,d){var c={fileID:b,formKey:e,controlKey:d};Svr.SvrMgr.deleteAttachment(c);},preview:function(d,b,c){}};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.ButtonHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.ComboBoxHandler=(function(){var Return={getComboboxItems:function(combobox,cxt){if(!combobox.needRebuild&&typeof(combobox.needRebuild)!="undefined"){return;}var items=[];if(!combobox.editable&&!combobox.multiSelect){var empty={value:null};items.push(empty);}var sourceType=combobox.sourceType,formID=combobox.ofFormID;switch(sourceType){case YIUI.COMBOBOX_SOURCETYPE.ITEMS:case YIUI.COMBOBOX_SOURCETYPE.STATUS:case YIUI.COMBOBOX_SOURCETYPE.PARAGROUP:combobox.needRebuild=false;break;case YIUI.COMBOBOX_SOURCETYPE.FORMULA:var form=YIUI.FormStack.getForm(formID);if(cxt==undefined){cxt={form:form};}if(combobox.formula){var rs=form.eval($.trim(combobox.formula),cxt,null);if($.isString(rs)){var item_Arr=rs.split(";");for(var i=0,len=item_Arr.length;i<len;i++){var item_obj=item_Arr[i].split(",");var i1=item_obj[0];var i2="";if(item_obj.length>1){i2=item_obj[1];}else{i2=i1;}var item={value:i1,caption:i2};items.push(item);}}else{if(rs instanceof DataDef.DataTable){rs.beforeFirst();if(rs.cols.length==1){var globalItems=combobox.globalItems;var pItems=form.eval($.trim(globalItems),cxt,null);while(rs.next()){var value=YIUI.TypeConvertor.toString(rs.get(0));var caption="";if(pItems&&pItems.length>0){for(var i=0,len=pItems.length;i<len;i++){var pItem=pItems[i];if(pItem.value==value){caption=pItem.caption;break;}}}caption=caption==""?value:caption;var item={value:value,caption:caption};items.push(item);}}else{if(rs.cols.length>1){while(rs.next()){var value=YIUI.TypeConvertor.toString(rs.get(0));var caption=YIUI.TypeConvertor.toString(rs.get(1));var item={value:value,caption:caption};items.push(item);}}}}else{items=items.concat(rs);}}}combobox.setItems(items);break;case YIUI.COMBOBOX_SOURCETYPE.QUERY:var form=YIUI.FormStack.getForm(formID);var data={},type;var queryParas=combobox.queryParas;data.formID=formID;data.key=combobox.key;data.formKey=form.getFormKey();data.fieldKey=combobox.key;data.typeDefKey=combobox.typeDefKey;data.service="PureUIService";data.cmd="getQueryItems";var sourceType,value,paras=[];for(var i=0,len=queryParas.length;i<len;i++){sourceType=queryParas[i].sourceType;value=queryParas[i].value;switch(sourceType){case YIUI.COMBOBOX_PARAMETERSOURCETYPE.CONST:paras.push(value);break;case YIUI.COMBOBOX_PARAMETERSOURCETYPE.FORMULA:case YIUI.COMBOBOX_PARAMETERSOURCETYPE.FIELD:if(cxt==undefined){cxt={form:form};}paras.push(form.eval(value,cxt,null));break;}}data.paras=$.toJSON(paras);var success=function(result){if(result){var items=[];if(!combobox.editable&&!combobox.multiSelect){var empty={value:null};items.push(empty);}items=items.concat(result);combobox.setItems(items);combobox.checkItem(combobox.getValue());combobox.needRebuild=false;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,data,success);break;}},doSuggest:function(combobox,value){if($.isEmptyObject(value)){combobox.yesCombobox.$suggestView.empty().hide();return;}var sourceType=combobox.sourceType,formID=combobox.ofFormID,items,viewItems=[];var form=YIUI.FormStack.getForm(formID);switch(sourceType){case YIUI.COMBOBOX_SOURCETYPE.FORMULA:var cxt={form:form};if(combobox.formula){items=form.eval($.trim(combobox.formula),cxt,null);}for(var i=0,len=items.length;i<len;i++){if(items[i].caption.indexOf(value)>0){viewItems.push(items[i]);}if(viewItems.length==5){break;}}break;default:items=combobox.items;for(var i=0,len=items.length;i<len;i++){if(items[i].caption.indexOf(value)>=0){viewItems.push(items[i]);}if(viewItems.length==5){break;}}break;}if(viewItems.length==0){combobox.yesCombobox.$suggestView.empty().hide();return;}var list=$("<ul/>"),_li;var view=combobox.yesCombobox.$suggestView.html(list);for(var i=0,len=viewItems.length;i<len;i++){_li=$('<li itemValue="'+viewItems[i].value+'">'+viewItems[i].caption+"</li>");list.append(_li);}var cityObj=$("input",combobox.el);var cityOffset=cityObj.offset();view.css({width:cityObj.outerWidth(),top:cityOffset.top+cityObj.outerHeight(),left:cityOffset.left});view.show();combobox.hasText=true;}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.CheckBoxHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.DictHandler=(function(){var Return={setContext:function(cxt){this.cxt=cxt;},doLostFocus:function(control,extParas){},getFilter:function(form,fieldKey,itemFilters,itemKey){var filter=null;if(itemFilters){var itemFilter=itemFilters[itemKey];if(itemFilter!=null&&itemFilter!=undefined&&itemFilter.length>0){for(var i=0,len=itemFilter.length;i<len;i++){var cond=itemFilter[i].cond;if(cond&&cond.length>0){var cxt=this.cxt;if(!cxt){cxt={form:form};}var ret=form.eval(cond,cxt,null);if(ret==true){filter=itemFilter[i];break;}}else{filter=itemFilter[i];break;}}}}return filter;},getDictFilter:function(form,fieldKey,itemFilters,itemKey){var filter=Return.getFilter(form,fieldKey,itemFilters,itemKey);if(filter){var filterVal,paras=[];if(filter.filterVals!==null&&filter.filterVals!==undefined&&filter.filterVals.length>0){for(var j in filter.filterVals){filterVal=filter.filterVals[j];switch(filterVal.type){case YIUI.FILTERVALUETYPE.CONST:paras.push(filterVal.refVal);break;case YIUI.FILTERVALUETYPE.FORMULA:case YIUI.FILTERVALUETYPE.FIELD:var cxt=this.cxt;if(!cxt){cxt={form:form};}paras.push(form.eval(filterVal.refVal,cxt,null));break;}}}var dictFilter={};dictFilter.itemKey=itemKey;dictFilter.formKey=form.formKey;dictFilter.fieldKey=fieldKey;dictFilter.filterIndex=filter.filterIndex;dictFilter.values=paras;dictFilter.dependency=filter.dependency;dictFilter.typeDefKey=filter.typeDefKey;return dictFilter;}else{return null;}},checkDict:function($this){if(!$this.needRebuild&&typeof($this.needRebuild)!="undefined"){return;}var formID=$this.ofFormID;var form=YIUI.FormStack.getForm(formID);var cxt=this.cxt;if(!cxt){cxt={form:form};}if($this.isDynamic){$this.itemKey=form.eval($this.refKey,cxt,null);}var rootItem={};if($this.root&&$this.root.length>0){rootItem=form.getComponentValue($this.root,cxt);if(rootItem==null){rootItem={};rootItem.oid=0;rootItem.itemKey=$this.itemKey;}}else{rootItem.oid=0;rootItem.itemKey=$this.itemKey;}if($this.rootItemKey){rootItem.itemKey=$this.rootItemKey;}$this.getDictTree().dictFilter=Return.getDictFilter(form,$this.key,$this.itemFilters,$this.itemKey);var data={};data.itemKey=$this.itemKey;data.itemData=$.toJSON(rootItem);data.service="PureUIService";data.cmd="CheckDict";var success=function(result){if(result){var rootCaption=result.rootCaption;if($this.getDictTree().rootNode!=null){$this.getDictTree().rootNode.remove();}$this.getDictTree().createRootNode(rootItem,rootCaption,rootItem.itemKey+"_"+rootItem.oid);$this.getDictTree().itemKey=$this.itemKey;$this.setSecondaryType(result.secondaryType);$this.needRebuild=false;}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,data,success);},autoComplete:function($this,text){this.checkDict($this);var rootValue=null;if($this.getDictTree().rootNode!=null){rootValue=$this.getDictTree().getNodeValue($this.getDictTree().rootNode);}var ret=null;if(!$.isEmptyObject(text)){ret=YIUI.DictService.locate($this.itemKey,"Code",text,$this.getDictTree().dictFilter,rootValue,$this.stateMask);}if(ret){var value={oid:ret.oid,itemKey:ret.itemKey,caption:ret.caption};var mul_sel=$this.multiSelect;var change=false;if(mul_sel){var val=[];val.push(value);change=$this.setValue(val,true,true);}else{change=$this.setValue(value,true,true);}if(!change){$this.setText($this.text);}}else{if(mul_sel){$this.setValue(null,true,true);return;}var options={fuzzyValue:text,itemKey:$this.itemKey,rootValue:rootValue,stateMask:$this.stateMask,dictFilter:$this.getDictTree().dictFilter,displayCols:$this.displayCols,startRow:0,maxRows:5,pageIndicatorCount:3,columns:$this.displayColumns,textInput:$("input",$this.el),callback:function(itemData){if(itemData){$this.setValue(itemData,true,true);$this.setText(itemData.caption);}else{$this.setText($this.text);}$this.isShowQuery=false;}};var dictquery=new YIUI.DictQuery(options);$this.isShowQuery=true;}},doSuggest:function($this,text){if($this.multiSelect){return;}if($.isEmptyObject(text)){$this.yesDict.$suggestView.empty().hide();return;}this.checkDict($this);var rootValue=null;if($this.getDictTree().rootNode!=null){rootValue=$this.getDictTree().getNodeValue($this.getDictTree().rootNode);}var viewItems=YIUI.DictService.getSuggestData($this.itemKey,text,$this.stateMask,$this.getDictTree().dictFilter,rootValue);if(viewItems.length==0){$this.yesDict.$suggestView.empty().hide();$this.hasSuggest=false;return;}$this.hasSuggest=true;var list=$("<ul/>"),_li;var view=$this.yesDict.$suggestView.html(list),item,_a;for(var i=0,len=viewItems.length;i<len;i++){item=viewItems[i];_li=$("<li oid="+item.oid+" itemkey = "+item.itemKey+"></li>");$("<div class='dt-wholerow'/>").appendTo(_li);_a=$("<a class='dt-anchor'></a>").appendTo(_li);_spanIcon=$("<span class='branch'></span>").appendTo(_a);if(item.NodeType==0){_spanIcon.addClass("p_node");}_spanText=$("<span class='b-txt'></span>").text(item.caption).appendTo(_a);list.append(_li);}var cityObj=$("input",$this.el);var cityOffset=cityObj.offset();view.css({width:cityObj.outerWidth(),top:cityOffset.top+cityObj.outerHeight(),left:cityOffset.left});view.show();$this.hasText=true;}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.DatePickerHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.DropdownButtonHandler=(function(){var Return={doOnClick:function(control,btnKey){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),clickContent;var items=control.dropdownItems;for(var i=0,len=items.length;i<len;i++){if(items[i].key==btnKey){clickContent=items[i].formula;break;}}var cxt={form:form};if(clickContent){form.eval(clickContent,cxt,null);}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.GridHandler=(function(){var Return={doOnCellClick:function(control,rowID,colIndex,value){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),row=control.getRowDataByID(rowID),rowIndex=control.getRowIndexByID(rowID),cellKey=row.cellKeys[colIndex],editOpt=control.getColInfoByKey(cellKey)[0].cell;switch(editOpt.edittype){case"button":case"hyperLink":case"image":case"textButton":if(editOpt.editOptions.onclick){form.eval($.trim(editOpt.editOptions.onclick),{form:form,rowIndex:rowIndex},null);}break;case"checkBox":var oldV=control.getValueAt(rowIndex,colIndex);if(oldV!==value){control.setValueAt(rowIndex,colIndex,value,true,true);}break;}},doOnRowClick:function(control,rowID){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),rowIndex=control.getRowIndexByID(rowID),clickContent=control.rowClick===undefined?"":$.trim(control.rowClick);var cxt={form:form,rowIndex:rowIndex};if(clickContent){form.eval(clickContent,cxt,null);}},doOnRowDblClick:function(control,rowID){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),rowIndex=control.getRowIndexByID(rowID),clickContent=control.rowDblClick===undefined?"":$.trim(control.rowDblClick);var cxt={form:form,rowIndex:rowIndex};if(clickContent){form.eval(clickContent,cxt,null);}},doOnFocusRowChange:function(control,oldRowID,rowID){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),rowIndex=control.getRowIndexByID(rowID),oldRowIndex=control.getRowIndexByID(oldRowID),clickContent=control.focusRowChanged===undefined?"":$.trim(control.focusRowChanged);var cxt={form:form,newRowIndex:rowIndex,oldRowIndex:oldRowIndex};if(clickContent){form.eval(clickContent,cxt,null);}YIUI.SubDetailUtil.showSubDetailData(control,rowIndex);},doOnSortClick:function(control,colIndex,sortType){if(control.hasGroupRow){alert("表格排序不支持行分组！");return;}var data=control.dataModel.data;data.sort(function(row1,row2){if(row1.rowType=="Fix"||row1.rowType=="Total"||row2.rowType=="Fix"||row2.rowType=="Total"){return row1.metaRowIndex-row2.metaRowIndex;}var value1=row1.data[colIndex][0],value2=row2.data[colIndex][0];if(row2.bookmark===undefined){return -1;}if(row1.bookmark===undefined){return 1;}if(value1==undefined&&value2==undefined){return 0;}if(value1!==undefined&&value2==undefined){return sortType==="asc"?-1:1;}if(value1==undefined&&value2!==undefined){return sortType==="asc"?1:-1;}var editOpt=control.dataModel.colModel.cells[row1.cellKeys[colIndex]];switch(editOpt.edittype){case"dict":value1=JSON.parse(value1).oid;value2=JSON.parse(value2).oid;case"datePicker":case"numberEditor":return sortType==="asc"?value2-value1:value1-value2;case"textEditor":return sortType==="asc"?value2.localeCompare(value1):value1.localeCompare(value2);case"comboBox":if(!isNaN(value1)&&!isNaN(value2)){value1=parseFloat(value1);value2=parseFloat(value2);return sortType==="asc"?value2-value1:value1-value2;}else{value1=value1.toString();value2=value2.toString();return sortType==="asc"?value2.localeCompare(value1):value1.localeCompare(value2);}}return 1;});control.dataModel.data=data;control.refreshGrid();},doGridCellSelect:function(control,rowID,colIndex){},doShiftRow:function(control,rowIndex,isUp){var rowData=control.getRowDataAt(rowIndex);if(!rowData.isDetail||(rowData.isDetail&&rowData.bookmark==null)){return;}var preRowIndex=rowIndex-1,nextRowIndex=rowIndex+1;if((isUp&&preRowIndex<0)||(!isUp&&nextRowIndex>=control.getRowCount())){return;}var preRowData=control.getRowDataAt(preRowIndex),nextRowData=control.getRowDataAt(nextRowIndex);if(isUp&&(!preRowData.isDetail||(preRowData.isDetail&&preRowData.bookmark==null))){return;}if(!isUp&&(!nextRowData.isDetail||(nextRowData.isDetail&&nextRowData.bookmark==null))){return;}this.doExchangeRow(control,rowIndex,isUp?rowIndex-1:rowIndex+1);},doExchangeRow:function(control,rowIndex,excRowIndex){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),row=control.getRowDataAt(rowIndex),excRow=control.getRowDataAt(excRowIndex);control.dataModel.data.splice(rowIndex,1,excRow);control.dataModel.data.splice(excRowIndex,1,row);control.el[0].deleteGridRow(rowIndex);control.el[0].insertGridRow(rowIndex,excRow);control.el[0].deleteGridRow(excRowIndex);control.el[0].insertGridRow(excRowIndex,row);$(control.el.getGridCellAt(excRowIndex+1,control.el[0].p.selectCell)).click();this.dealWithSequence(form,control);},doCellValueChanged:function(control,rowID,colIndex,newValue){var rowIndex=control.getRowIndexByID(rowID);control.setValueAt(rowIndex,colIndex,newValue,true,true,true);},doCellPast:function(control,bgRowID,bgColIndex,copyText){var rowInd=control.getRowIndexByID(bgRowID),rowV=copyText.split("\n");for(var i=0,len=rowV.length;i<len;i++){if(rowV[i]===""){continue;}var rowIndex=rowInd+i;var cellV=rowV[i].split("\t"),cellVObj;for(var j=0,clen=cellV.length;j<clen;j++){var iCol=bgColIndex+j,value=cellV[j];if(iCol>=control.dataModel.colModel.columns.length){continue;}control.setValueAt(rowIndex,iCol,value,true,true,false);}}},doAllChecked:function(control,colIndex,newValue){var len=control.dataModel.data.length;for(var i=0;i<len;i++){var rd=control.dataModel.data[i];if(rd.isDetail&&rd.bookmark!=undefined&&rd.bookmark!=null){control.setValueAt(i,colIndex,newValue,true,true,false);}}},doGoToPage:function(control,pageInfo){pageInfo=JSON.parse(pageInfo);var curPageIndex=control.pageInfo.currentPage,rowIndex=-1;if(pageInfo.optType=="firstPage"){control.pageInfo.currentPage=1;}else{if(pageInfo.optType=="prevPage"){control.pageInfo.currentPage=curPageIndex-1;}else{if(pageInfo.optType=="nextPage"){control.pageInfo.currentPage=curPageIndex+1;}else{if(pageInfo.optType=="lastPage"){control.pageInfo.currentPage=control.pageInfo.totalPage;}else{if(pageInfo.optType=="turnToPage"){control.pageInfo.currentPage=pageInfo.pageIndex;}}}}}if(control.pageInfo.pageLoadType=="UI"){control.reload();}else{var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),filterMap=form.getFilterMap(),startRi=(control.pageInfo.currentPage-1)*control.pageInfo.pageRowCount;filterMap.setOID(form.getDocument().oid==undefined?-1:form.getDocument().oid);filterMap.getTblFilter(control.tableKey).startRow=startRi;filterMap.getTblFilter(control.tableKey).maxRows=control.pageInfo.pageRowCount;var paras={formKey:form.formKey,cmd:"gridgotopage",filterMap:$.toJSON(filterMap),gridKey:control.key,formOptState:form.getOperationState()};var result=JSON.parse(Svr.SvrMgr.doGoToPage(paras)),dataTable;if(result.dataTable){dataTable=YIUI.DataUtil.fromJSONDataTable(result.dataTable);form.getDocument().setByKey(control.tableKey,dataTable);}else{dataTable=form.getDocument().getByKey(control.tableKey);}control.dataModel.data=result.data;control.errorInfoes=result.errorInfoes;control.pageInfo.totalPage=result.totalPage;control.rowIDMask=0;}control.initRowDatas();control.refreshGrid({needCalc:control.pageInfo.pageLoadType=="DB"});if(control.pageInfo.pageLoadType=="DB"){}},doGoToFirstPage:function(control,pageInfo){},doGoToLastPage:function(control,pageInfo){},doGoToPrevPage:function(control,pageInfo){},doGoToNextPage:function(control,pageInfo){},doInsertGridRow:function(control,rowID){var ri=control.getRowIndexByID(rowID),rd=control.getRowDataByID(rowID),bookmark=parseInt(rd.bookmark,10);if(!rd.isDetail||(isNaN(bookmark)&&ri==(control.dataModel.data.length-1))){return;}var form=YIUI.FormStack.getForm(control.ofFormID);YIUI.SubDetailUtil.clearSubDetailData(form,control);control.addGridRow(null,ri);},doDeleteGridRow:function(control,rowID){var ri=control.getRowIndexByID(rowID);var callback=function(){control.clearAllSubDetailData(ri);control.deleteGridRow(ri);var form=YIUI.FormStack.getForm(control.ofFormID);form.getUIProcess().doPostDeleteRow(control,ri);};if(control.hasSubDetailData(ri)){var dialog=new YIUI.Yes_Dialog({msg:"清空子明细数据？",YesEvent:callback});dialog.show();var btns=$(".dlg-btn",dialog.el),btn;for(var i=0;i<btns.length;i++){btn=$(btns[i]);if(btn.attr("key")==YIUI.Dialog_Btn.STR_YES){btn.click(function(){callback();});}btn.click(function(){dialog.close();});}}else{callback();}},setCellValueToDocument:function(form,grid,rowIndex,colIndex,newValue){var row=grid.dataModel.data[rowIndex];switch(row.rowType){case"Fix":this.setFixValueToDoc(form,grid,rowIndex,colIndex,newValue);break;case"Detail":this.setDtlValueToDoc(form,grid,rowIndex,colIndex,newValue);break;}},setNewValue:function(colKey,cEditOpt,dataTable,newValue){if(dataTable==undefined||colKey==""){return;}var editOpts=cEditOpt.editOptions,dataType;switch(cEditOpt.edittype){case"dict":if(newValue==null||newValue==undefined){if(editOpts.multiSelect){dataTable.setByKey(colKey,null);}else{dataTable.setByKey(colKey,0);}break;}if(editOpts.multiSelect){var oids=[],itemKey="";if(editOpts.isCompDict){$.error($.ygrid.formatString($.ygrid.compDictNotDataBinding,cEditOpt.key));}for(var i=0,len=newValue.length;i<len;i++){oids.push(newValue[i].oid);oids.push(",");}if(oids&&oids.length>0){oids.pop();itemKey=newValue[0].itemKey;}dataTable.setByKey(colKey,oids.join(""));if(editOpts.isDynamic){dataTable.setByKey(colKey+"ItemKey",itemKey);}}else{dataTable.setByKey(colKey,newValue.oid);if(editOpts.isCompDict||editOpts.isDynamic){dataTable.setByKey(colKey+"ItemKey",newValue.itemKey);}}break;default:dataType=dataTable.cols[dataTable.indexByKey(colKey)].type;dataTable.setByKey(colKey,YIUI.Handler.convertValue(newValue,dataType));break;}},newRow:function(form,grid,row,dataTable){var cm,editOpt,cellV,dataType;dataTable.addRow();for(var i=0,len=grid.dataModel.colModel.columns.length;i<len;i++){cm=grid.dataModel.colModel.columns[i];editOpt=grid.dataModel.colModel.cells[row.cellKeys[i]];if(editOpt==undefined||editOpt.columnKey===undefined||editOpt.columnKey===""){continue;}cellV=row.data[i][0];if(editOpt.edittype==="dict"&&cellV!==null){if(editOpt.editOptions.multiSelect){var realV=[];for(var n=0,clen=cellV.length;n<clen;n++){realV.push(cellV[n].oid);realV.push(",");}realV.pop();cellV=realV.join("");}else{cellV=cellV.oid;}}dataType=dataTable.cols[dataTable.indexByKey(editOpt.columnKey)].type;dataTable.setByKey(editOpt.columnKey,YIUI.Handler.convertValue(cellV,dataType));}return dataTable.getBkmk();},setFixValueToDoc:function(form,grid,rowIndex,colIndex,newValue){var row=grid.dataModel.data[rowIndex],cEditOpt=grid.dataModel.colModel.cells[row.cellKeys[colIndex]],doc=form.getDocument(),dataTable,dataType,tableKey=cEditOpt.tableKey,colKey=cEditOpt.columnKey;if(doc==undefined||doc==null){return;}if(tableKey==undefined||colKey==undefined){return;}dataTable=doc.getByKey(tableKey);if(dataTable==undefined||dataTable==null){return;}if(!dataTable.first()){dataTable.addRow();}this.setNewValue(colKey,cEditOpt,dataTable,newValue);},selectRow:function(form,grid,rowIndex,colIndex,newValue){var rd=grid.getRowDataAt(rowIndex),tableKey=grid.tableKey,doc=form.getDocument(),dataTable=doc.getByKey(tableKey),dataType=dataTable.cols[dataTable.indexByKey("SelectField")].type;if(rd.isDetail&&rd.bookmark==undefined||doc==undefined||dataTable==undefined){return;}if(grid.hasColExpand){for(var i=0,len=rd.bookmark.length;i<len;i++){var detailBkmk=rd.bookmark[i];dataTable.setByBkmk(detailBkmk);dataTable.setByKey(YIUI.DataUtil.System_SelectField_Key,YIUI.Handler.convertValue(newValue,dataType));}}else{if(grid.pageInfo.pageLoadType=="DB"){var shadowTableKey=YIUI.DataUtil.getShadowTableKey(tableKey);var shadowTable=doc.getByKey(shadowTableKey);if(shadowTable==null||shadowTable==undefined){shadowTable=YIUI.DataUtil.newShadowDataTable(dataTable);doc.add(shadowTableKey,shadowTable);}dataTable.setByBkmk(rd.bookmark);if(dataTable.allRows[dataTable.pos].state==DataDef.R_New){return;}var curOID=dataTable.getByKey(YIUI.DataUtil.System_OID_Key),primaryKeys;if(curOID!=null&&curOID!=undefined){primaryKeys=[YIUI.DataUtil.System_OID_Key];}else{primaryKeys=grid.primaryKeys;}var pos=YIUI.DataUtil.getPosByPrimaryKeys(dataTable,shadowTable,primaryKeys);if(YIUI.TypeConvertor.toBoolean(newValue)){if(pos!=-1){shadowTable.setPos(pos);}else{shadowTable.addRow();for(var j=0,clen=shadowTable.cols.length;j<clen;j++){shadowTable.set(j,dataTable.get(j));}}shadowTable.setByKey(YIUI.DataUtil.System_SelectField_Key,1);shadowTable.allRows[shadowTable.pos].state=dataTable.allRows[dataTable.pos].state;}else{if(pos!=-1){if(shadowTable.rows[pos].state==DataDef.R_Normal){shadowTable.rows[pos].state=DataDef.R_New;shadowTable.delRow(pos);}else{shadowTable.setByKey(YIUI.DataUtil.System_SelectField_Key,0);}}}}else{dataTable.setByBkmk(rd.bookmark);dataTable.setByKey(YIUI.DataUtil.System_SelectField_Key,YIUI.Handler.convertValue(newValue,dataType));}}},setDtlValueToDoc:function(form,grid,rowIndex,colIndex,newValue){var row=grid.dataModel.data[rowIndex],cEditOpt=grid.dataModel.colModel.cells[row.cellKeys[colIndex]],doc=form.getDocument(),dataTable,tableKey=cEditOpt.tableKey,colKey=cEditOpt.columnKey,dtlRowIndex=grid.metaRowInfo.dtlRowIndex,metaRow=grid.metaRowInfo.rows[dtlRowIndex],metaCell=metaRow.cells[colIndex];if(grid.selectFieldIndex!=-1&&grid.selectFieldIndex==colIndex){this.selectRow(form,grid,rowIndex,colIndex,newValue);}if(doc==undefined||doc==null){return;}if(tableKey==undefined||colKey==undefined){return;}dataTable=doc.getByKey(tableKey);if(dataTable==undefined||dataTable==null){return;}var oldTableSize=dataTable.getRowCount();if(row.isDetail&&row.bookmark==undefined){this.flushRow(form,grid,rowIndex);}else{if(grid.hasColExpand){if(metaCell.isColExpand){dataTable.setByBkmk(row.cellBkmks[colIndex]);this.setNewValue(colKey,cEditOpt,dataTable,newValue);}else{for(var i=0,len=row.bookmark.length;i<len;i++){dataTable.setByBkmk(row.bookmark[i]);this.setNewValue(colKey,cEditOpt,dataTable,newValue);}}}else{dataTable.setByBkmk(row.bookmark);this.setNewValue(colKey,cEditOpt,dataTable,newValue);}}if(oldTableSize!==dataTable.getRowCount()){this.dealWithSequence(form,grid);}},flushRow:function(form,grid,rowIndex){var row=grid.dataModel.data[rowIndex],tableKey=grid.tableKey,dtlRowIndex=grid.metaRowInfo.dtlRowIndex,metaRow=grid.metaRowInfo.rows[dtlRowIndex],doc=form.getDocument(),dataTable=doc.getByKey(tableKey),rowBkmk;if(doc==undefined||doc==null){return;}if(dataTable==undefined||dataTable==null){return;}if(grid.hasColExpand){rowBkmk=[];var cell,metaCell,newBkmk,cEditOpt,colExpandMap={};for(var i=0,len=row.data.length;i<len;i++){cell=row.data[i];metaCell=metaRow.cells[i];cEditOpt=grid.dataModel.colModel.cells[row.cellKeys[i]];if(metaCell.isColExpand){newBkmk=colExpandMap[metaCell.columnArea+"-"+metaCell.crossValue];if(newBkmk==undefined||newBkmk==null){newBkmk=this.newRow(form,grid,row,dataTable);rowBkmk.push(newBkmk);row.cellBkmks[i]=newBkmk;colExpandMap[metaCell.columnArea+"-"+metaCell.crossValue]=newBkmk;this.setNewValue(metaCell.columnKey,cEditOpt,dataTable,cell[0]);var expInfo=grid.expandModel[metaCell.columnArea],crsValue,cKey;for(var k=0,cLen=metaCell.crossValue.length;k<cLen;k++){crsValue=metaCell.crossValue[k];cKey=expInfo[k];if(cKey!==undefined&&cKey!==null&&cKey.length>0){dataTable.setByKey(cKey,crsValue);}}}else{row.cellBkmks[i]=newBkmk;}}}for(var m=0,eLen=rowBkmk.length;m<eLen;m++){dataTable.setByBkmk(rowBkmk[m]);for(var n=0,nLen=row.data.length;n<nLen;n++){metaCell=metaRow.cells[n];cEditOpt=grid.dataModel.colModel.cells[row.cellKeys[n]];if(!metaCell.isColExpand&&metaCell.columnKey!=undefined&&metaCell.columnKey.length>0){this.setNewValue(metaCell.columnKey,cEditOpt,dataTable,row.data[n][0]);}}}}else{rowBkmk=this.newRow(form,grid,row,dataTable);dataTable.setByBkmk(rowBkmk);for(var j=0,jLen=row.data.length;j<jLen;j++){metaCell=metaRow.cells[j];cEditOpt=grid.dataModel.colModel.cells[row.cellKeys[j]];if(metaCell.columnKey!=undefined&&metaCell.columnKey.length>0){this.setNewValue(metaCell.columnKey,cEditOpt,dataTable,row.data[j][0]);}}if(grid.parentGrid&&grid.parentGrid.length>0){var parentGrid=form.getComponent(grid.parentGrid),pRowIndex=parentGrid.getFocusRowIndex(),pRow=parentGrid.dataModel.data[pRowIndex];dataTable.rows[dataTable.pos].parentBkmk=pRow.bookmark;}}row.bookmark=rowBkmk;YIUI.SubDetailUtil.showSubDetailData(grid,rowIndex);return row;},copyRow:function(form,grid,rowIndex,splitKeys,splitValues,layer){var dataTable=form.getDocument().getByKey(grid.tableKey),newRowIndex=rowIndex+1;if(dataTable==undefined){return -1;}var row=grid.getRowDataAt(rowIndex);if(row.isDetail&&row.bookmark==undefined){return -1;}var rd=grid.addGridRow(null,newRowIndex,false);if(rd.bookmark==undefined){rd=this.flushRow(form,grid,newRowIndex);}if(row.bookmark!==undefined){var values={},OID=-1,tCol,value;dataTable.setByBkmk(row.bookmark);for(var i=0,len=dataTable.cols.length;i<len;i++){tCol=dataTable.cols[i];value=dataTable.get(i);if(tCol.key.toLowerCase()=="oid"&&value!==null){OID=value;}values[tCol.key]=value;}dataTable.setByBkmk(rd.bookmark);for(var ci=0,clen=dataTable.cols.length;ci<clen;ci++){tCol=dataTable.cols[ci];if(splitKeys.indexOf(tCol.key)>=0){var dataType=dataTable.cols[dataTable.indexByKey(tCol.key)].type;dataTable.set(ci,YIUI.Handler.convertValue(splitValues[splitKeys.indexOf(tCol.key)],dataType));}else{dataTable.set(ci,values[tCol.key]);}if(tCol.key.toLowerCase()=="oid"){dataTable.set(ci,null);}if(tCol.key.toLowerCase()=="poid"){dataTable.set(ci,OID);}if(tCol.key.toLowerCase()=="sequence"){dataTable.set(ci,null);}}}if(layer!=-1){dataTable.setByKey("Layer",layer);}dataTable.beforeFirst();grid.showDetailRow(newRowIndex,false);this.dealWithSequence(form,grid);return newRowIndex;},fireCellChangeEvent:function(form,grid,rowIndex,colIndex){var row=grid.dataModel.data[rowIndex],cellKey=row.cellKeys[colIndex],editOpt=grid.dataModel.colModel.cells[cellKey],meatRow=grid.metaRowInfo.rows[row.metaRowIndex];var cellCEvent=meatRow.cells[colIndex].valueChanged;if(cellCEvent!==undefined&&cellCEvent.length>0){form.eval($.trim(cellCEvent),{form:form,rowIndex:rowIndex},null);}form.uiProcess.doCellValueChanged(grid,rowIndex,colIndex,cellKey);YIUI.GridSumUtil.evalAffectSum(form,grid,rowIndex,colIndex);if(editOpt==undefined||editOpt.columnKey===undefined||editOpt.columnKey.length==0||!grid.isEnable()){return;}var nextRow=grid.dataModel.data[rowIndex+1];if(!row.isDetail){return;}var sr=grid.el[0].p.selectRow,sc=grid.el[0].p.selectCell;if((nextRow===undefined||!nextRow.isDetail)&&grid.newEmptyRow&&!grid.hasRowExpand&&(grid.treeColIndex==null||grid.treeColIndex==-1)){if(grid.hasGroupRow){if(row.inAutoGroup){var pRow,nRow;for(var i=rowIndex-1;i>=0;i--){pRow=grid.dataModel.data[i];if(!pRow.inAutoGroup){break;}pRow.inAutoGroup=false;}row.inAutoGroup=false;for(var ind=rowIndex+1,len=grid.dataModel.data.length;ind<len;ind++){nRow=grid.dataModel.data[ind];if(!nRow.inAutoGroup){break;}nRow.inAutoGroup=false;}grid.appendAutoRowAndGroup();}else{grid.addGridRow(null,rowIndex+1);}}else{grid.addGridRow();}}if(sr!==undefined&&sc!==undefined){grid.el.setGridParam({selectRow:sr,selectCell:sc});}},doPostCellChangeEvent:function(form,grid,rowIndex,colIndex){var row=grid.dataModel.data[rowIndex],cellKey=row.cellKeys[colIndex];form.uiProcess.doPostCellValueChanged(grid,rowIndex,colIndex,cellKey);},dealWithSequence:function(form,grid){var SYS_SEQUENCE="Sequence";if(grid.seqColumn==undefined){return;}var row,bkmk,seq,curSeq=0,dataTable=form.getDocument().getByKey(grid.tableKey);for(var i=0,len=grid.dataModel.data.length;i<len;i++){row=grid.dataModel.data[i];bkmk=row.bookmark;if(!row.isDetail||row.bookmark==undefined){continue;}if(grid.hasColExpand){dataTable.setByBkmk(bkmk[0]);seq=dataTable.getByKey(SYS_SEQUENCE);if(seq==undefined||seq==null||seq<=curSeq){seq=curSeq+1;for(var j=0,jlen=bkmk.length;j<jlen;j++){dataTable.setByBkmk(bkmk[j]);dataTable.setByKey(SYS_SEQUENCE,seq);}curSeq=parseInt(seq);}}else{dataTable.setByBkmk(bkmk);seq=dataTable.getByKey(SYS_SEQUENCE);if(seq==undefined||seq==null||seq<=curSeq){seq=curSeq+1;dataTable.setByKey(SYS_SEQUENCE,seq);}curSeq=parseInt(seq);}}},dependedValueChange:function(grid,targetField,dependencyField,value){var formID=grid.ofFormID,form=YIUI.FormStack.getForm(formID),cellLocation=form.getCellLocation(targetField);if(grid.treeColIndex==cellLocation.column||grid.rowExpandIndex==cellLocation.column){this.reloadGridByFilter(grid,form,dependencyField,value);}else{if(cellLocation.row==null||cellLocation.row==-1){for(var i=0,len=grid.getRowCount();i<len;i++){var row=grid.getRowDataAt(i);if(row.isDetail&&row.bookmark!=null){Return.dependedValueChangeAt(grid,i,dependencyField,targetField,value);}}}else{Return.dependedValueChangeAt(grid,cellLocation.row,dependencyField,targetField,value);}}},reloadGridByFilter:function(grid,form,dependencyField,value){if(value==null){value=form.getComponent(dependencyField).getValue();if(value instanceof YIUI.ItemData){value=value.oid;}}var jsonDoc=YIUI.DataUtil.toJSONDoc(form.getDocument());var params={service:"PureGridOpt",cmd:"ReloadGridByFilter",document:$.toJSON(jsonDoc),formKey:form.getFormKey(),dependencyField:dependencyField,dependencyFieldValue:value};var result=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,params);this.diffFromFormJson(grid,result.form);},diffFromFormJson:function(grid,formJson){var block=formJson.body.items[formJson.body.index_of_block];var getDiffJSON=function(items,gridKey){var item,result;for(var i=0,len=items.length;i<len;i++){item=items[i];if(item.metaObj!=null&&item.metaObj.key==gridKey){result=item;break;}else{if(item.items!=null&&item.items.length>0){result=getDiffJSON(item.items,gridKey);}if(result!=null){break;}}}return result;};var gridDiffJson=getDiffJSON(block.rootPanel.items,grid.key);grid.diff(gridDiffJson);},doPostCellValueChanged:function(grid,rowIndex,dependencyField,targetField,value){var formID=grid.ofFormID,form=YIUI.FormStack.getForm(formID),comp=form.getComponent(targetField);if(comp!=null){comp.dependedValueChange(dependencyField);}else{Return.dependedValueChangeAt(grid,rowIndex,dependencyField,targetField,value);}},dependedValueChangeAt:function(grid,rowIndex,dependencyField,targetField,value){var row=grid.getRowDataAt(rowIndex),metaRow=grid.metaRowInfo.rows[row.metaRowIndex];var updateDynamicCell=function(cell,cellTypeDef,editOpt,rowData,rowIndex,cellIndex){if(cellTypeDef.options.isAlwaysShow){var iRow=rowIndex+1,iCol=grid.showRowHead?cellIndex+1:cellIndex,cm=grid.dataModel.colModel[iCol],opt=$.extend({},editOpt.editOptions||{},{ri:rowIndex,key:cm.name,id:iRow+"_"+cm.name,name:cm.name}),gRow=grid.el.getGridRowAt(iRow);grid.alwaysShowCellEditor(cell,iRow,iCol,cm,[null,"",cell.enable],opt,gRow.offsetHeight);}};for(var i=0,len=metaRow.cells.length;i<len;i++){var metaCell=metaRow.cells[i],editOpt=grid.dataModel.colModel.cells[metaCell.key];if(metaCell.key==targetField){if(metaCell.cellType==YIUI.CONTROLTYPE.DYNAMIC){var cell=grid.el.getGridCellAt(rowIndex+1,grid.showRowHead?i+1:i),cellTypeDef=cell.cellTypeDef;if(cellTypeDef!=null){var newOpt=$.extend(true,{},editOpt),newOptions=$.extend(true,cellTypeDef.options,editOpt.editOptions);newOpt.editOptions=newOptions;Return.dependencyValueChangedByType(grid,cellTypeDef.type,newOpt,rowIndex,i,dependencyField,value);updateDynamicCell(cell,cellTypeDef,rowIndex,i);}}else{Return.dependencyValueChangedByType(grid,metaCell.cellType,editOpt,rowIndex,i,dependencyField,value);}}}},dependencyValueChangedByType:function(grid,cellType,editOpt,rowIndex,colIndex,dependencyField,value){var formID=grid.ofFormID,form=YIUI.FormStack.getForm(formID);if(cellType==YIUI.CONTROLTYPE.DICT||cellType==YIUI.CONTROLTYPE.COMPDICT||cellType==YIUI.CONTROLTYPE.DYNAMICDICT){if(editOpt.editOptions.isDynamic){var refKey=editOpt.editOptions.refKey;if(refKey==dependencyField){grid.setValueAt(rowIndex,colIndex,value,true,true,true);return;}}var root=editOpt.editOptions.root;if(root==dependencyField){grid.setValueAt(rowIndex,colIndex,value,true,true,true);return;}var dictFilter=editOpt.dictFilter;if(dictFilter!=null){var filterDependency=dictFilter.dependency;if(filterDependency!=null&&filterDependency.indexOf(dependencyField)>=0){grid.setValueAt(rowIndex,colIndex,value,true,true,true);editOpt.needRefreshFilter=true;}}else{var curFilter=YIUI.DictHandler.getFilter(form,editOpt.key,editOpt.editOptions.itemFilters,editOpt.editOptions.itemKey);if(curFilter!=null){grid.setValueAt(rowIndex,colIndex,value,true,true,true);}}}else{if(cellType==YIUI.CONTROLTYPE.COMBOBOX||cellType==YIUI.CONTROLTYPE.CHECKLISTBOX){var dependedFields=editOpt.editOptions.dependedFields;if(dependedFields.indexOf(dependencyField)>=0){grid.setValueAt(rowIndex,colIndex,value,true,true,true);editOpt.needRebuild=true;}}}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.HyperLinkHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.ImageHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.ListViewHandler=(function(){var Return={doGoToPage:function(control,pageIndex){var formID=control.ofFormID,metaObj=control.getMetaObj(),controlKey=metaObj.key,tableKey=metaObj.tableKey,startRow=pageIndex*metaObj.pageRowCount,form=YIUI.FormStack.getForm(formID);var filterMap=form.getFilterMap();filterMap.setOID(form.getDocument().oid);var paras={cmd:"pagination",compKey:controlKey,pageIndex:pageIndex,formKey:form.getFormKey(),form:form.toJSON()};var result=Svr.SvrMgr.doGoToPage(paras);var newForm=YIUI.FormBuilder.build(result);var listView=newForm.getComponent(controlKey);if(listView.totalRowCount<metaObj.pageRowCount){control._pagination.hidePagination();}else{if(listView.totalRowCount){control.totalRowCount=listView.totalRowCount;control._pagination.setTotalRowCount(control.totalRowCount,false);}}control.data=listView.data;control.clearDataRow();control.addDataRow(control.data);},doOnRowDblClick:function(control,rowIndex){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),rowDblClick=control.rowDblClick;var cxt={form:form,rowIndex:rowIndex};if(rowDblClick){form.eval(rowDblClick,cxt,null);}},doOnRowClick:function(control,rowID){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),rowClick=control.rowClick;var cxt={form:form,rowIndex:rowID};if(rowClick){form.eval(rowClick,cxt,null);}},doOnFocusRowChange:function(control,oldRowID,newRowID){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),focusRowChanged=control.focusRowChanged;var cxt={form:form,rowIndex:newRowID};if(focusRowChanged){form.eval(focusRowChanged,cxt,null);}},doCellValueChanged:function(control,rowIndex,colIndex,newValue){var column=control.columnInfo[colIndex];var dbKey=column.key;control.data[rowIndex][dbKey].value=newValue;var valueChanged=column.valueChanged;if(valueChanged){var form=YIUI.FormStack.getForm(control.ofFormID);form.eval(valueChanged,{form:form});}},doOnCellClick:function(control,rowID,colKey){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),columns=control.columnInfo,column;for(var i=0,len=columns.length;i<len;i++){column=columns[i];if(column.key==colKey){break;}}var clickCont=column.clickContent;if(clickCont){form.eval(clickCont,{form:form,rowIndex:rowID},null);}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.NumberEditorHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.PasswordEditorHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.RadioButtonHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.SplitButtonHandler=(function(){var Return={doOnClick:function(control,btnKey){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),clickContent;var items=control.dropdownItems;for(var i=0,len=items.length;i<len;i++){if(items[i].key==btnKey){clickContent=items[i].formula;break;}}var cxt={form:form};if(clickContent){form.eval(clickContent,cxt,null);}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.SearchBoxHandler=(function(){var Return={needRefresh:true,providerKey:null,getProviderKey:function(control){var metaObj=control.getMetaObj();var providerKey=this.providerKey;if(providerKey){return providerKey;}var formulaKey=metaObj.formulaKey;if(formulaKey){var o=form.eval(formulaKey,this.cxt,null);if(o){return o.toString();}}},setNeedRefresh:function(needRefresh){this.needRefresh=needRefresh;},popSearchDialog:function(control,text){var callParas={SearchContent:text};var params={formKey:control.popConfigKey,cmd:"PureShowForm",callParas:JSON.stringify(callParas)};var success=function(jsonObj){var newForm=YIUI.FormBuilder.build(jsonObj,YIUI.FormTarget.MODAL,control.ofFormID);newForm.regEvent(YIUI.FormEvent.Close,{doTask:function(form,paras){var o=form.getResult();if(!o){control.setValue(control.getValue(),true,false);}else{control.setValue(o,true,true);}}});};Svr.SvrMgr.dealWithPureForm(params,success);},doOnClick:function(control){var providerKey=this.providerKey;if(!providerKey||bNeedRefresh){providerKey=this.getProviderKey(control);this.needRefresh=false;}this.popSearchDialog(control,"");},autoComplete:function(control,value){var providerKey=this.providerKey;if(!providerKey||this.needRefresh){providerKey=this.getProviderKey(control);this.needRefresh=false;}var form=YIUI.FormStack.getForm(control.ofFormID);var data={cmd:"Locate",service:"SearchBoxProviderService",formKey:form.getFormKey(),value:value,providerKey:providerKey};var ret=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,data);if(ret){control.setValue(ret,true,true);return;}this.popSearchDialog(control,value);}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.TextAreaHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.TextEditorHandler=(function(){var TextCase={CASETYPE_NONE:0,CASETYPE_LOWER:1,CASETYPE_UPPER:2};var Return={doEnterPress:function(control){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),keyEnter=control.keyEnter;var cxt={form:form};if(keyEnter){form.eval(keyEnter,cxt,null);}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.ToolBarHandler=(function(){var Return={doOnClick:function(control){var formID=control.ofFormID;var item=control.item;if(item.formID){formID=item.formID;}var form=YIUI.FormStack.getForm(formID);var cxt={form:form,optKey:item.key};var excpAction=item.excpAction;try{var action=item.action;var preAction=item.preAction;if(preAction){form.eval(preAction,cxt,null);}if(action){form.eval(action,cxt,null);}if(form.getUIProcess()){form.getUIProcess().resetUIStatus(YIUI.FormUIStatusMask.OPERATION);}}catch(e){if(excpAction){try{form.eval(excpAction,cxt);}catch(t){}}$.error(e.message);}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.TreeHandler=(function(){var a={doTreeClick:function(d,b){var e=d.nodeKey;var h=d.parameters;var g=d.formKey;var k={};k.nodeKey=e;k.eventType=Svr.SvrMgr.EventType.Click;k.formKey=d.formKey;k.entryParas=h;var j=Svr.SvrMgr.doPureTreeEvent(k);if(!j){var f=$("#tab_"+g+"_"+e);f.click();return;}var c=YIUI.FormBuilder.build(j);c.entryKey=e;b.add(c);}};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.DialogHandler=(function(){var Return={doOnClick:function(control,opt){var callback=control.getEvent(opt);var excp=control.excp;control.dialog.close();if(callback){try{callback(opt);}catch(e){if(excp){try{var form=control.getOwner();form.eval(excp,{form:form});}catch(t){}}$.error(e.message);}}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.DictViewHandler=(function(){var Return={doOnRowClick:function(control,rowIndex,extParas){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),rowClick=control.rowClick;var cxt={form:form};if(rowClick){form.eval(rowClick,cxt,null);}},doOnFocusRowChange:function(dictView,node){var formID=dictView.ofFormID;var form=YIUI.FormStack.getForm(formID);var content=dictView.focusRowChanged;var itemData=dictView.getNodeValue(node);var item=YIUI.DictService.getItem(itemData.itemKey,itemData.oid);dictView._selectItem=item;var cxt={form:form};if(content){form.eval(content,cxt,null);}},doOnRowDblClick:function(control,rowIndex,extParas){var formID=control.ofFormID,form=YIUI.FormStack.getForm(formID),clickContent=control.clickContent;if(control.type===YIUI.CONTROLTYPE.GRID){rowIndex=control.getRowIndexByID(rowIndex);clickContent=control.rowDblClick===undefined?"":$.trim(control.rowDblClick);}var cxt={form:form,rowIndex:rowIndex};if(clickContent){form.eval(clickContent,cxt,null);}},doExpand:function(dictView,pNode){var success=function(nodes){if(nodes){var len=nodes.length;if(len>0){var pId=pNode.attr("id")||0;nodes[len-1].islast=true;var prevId=null;for(var i=0,len=nodes.length;i<len;i++){nodes[i].id=nodes[i].itemKey+"_"+nodes[i].OID;nodes[i].pid=pId;if(dictView.dictType==YIUI.SECONDARYTYPE.COMPDICT){var path=pNode.attr("path");if(!path){path=pId+"_"+nodes[i].OID;}else{path+="_"+nodes[i].OID;}nodes[i].path=path;nodes[i].id=path;}if(prevId!=null){nodes[i].previd=prevId;}prevId=nodes[i].id;}dictView.addNodes(nodes);}}};YIUI.DictService.getDictChildren(dictView.itemKey,dictView.getNodeValue(pNode),dictView.dictFilter,null,success);},doCollapse:function(control,extParas){},doEnterPress:function(control,extParas){},doGoToPage:function(dictView,index,isResetPageNum){var itemKey=dictView.itemKey;var maxRows=dictView.pageRowCount;var pageIndicatorCount=dictView.pageIndicatorCount;var value=dictView.getQueryValue();var startRow=index<=0?0:dictView.pageRowCount*index;var success=function(result){if(result){dictView.isResetPageNum=isResetPageNum;$("tr:gt(1)",dictView._$table).remove();var nodes=result.data;var len=nodes.length;if(len>0){var pId=dictView.root.id;nodes[len-1].islast=true;var prevId=null;for(var i=0,len=nodes.length;i<len;i++){if(prevId!=null){nodes[i].previd=prevId;}nodes[i].id=nodes[i].itemKey+"_"+nodes[i].OID;prevId=nodes[i].id;nodes[i].pid=pId;}dictView.addNodes(nodes);dictView.setTotalRowCount(startRow+result.totalRowCount);dictView.focusNode(nodes[0].id);}else{dictView.setTotalRowCount(len);}}};YIUI.DictService.getQueryData(itemKey,startRow,maxRows,pageIndicatorCount,value,null,dictView.dictFilter,null,success);},doDictViewSearch:function(dictView){this.doGoToPage(dictView,0,true);},getDictFilter:function(dictview){var filter=null;var dictFilter=null;var formID=dictview.ofFormID;var form=YIUI.FormStack.getForm(formID);var cxt={form:form};if(dictview.itemFilters){var itemFilter=dictview.itemFilters[dictview.itemKey];for(var i in itemFilter){var cond=itemFilter[i].cond;if(cond&&cond.length>0){var ret=form.eval(cond,cxt,null);if(ret==true){filter=itemFilter[i];break;}}else{filter=itemFilter[i];break;}}}if(filter){var filterVal;var paras=[];for(var j in filter.filterVals){filterVal=filter.filterVals[j];switch(filterVal.type){case YIUI.FILTERVALUETYPE.CONST:paras.push(filterVal.refVal);break;case YIUI.FILTERVALUETYPE.FORMULA:case YIUI.FILTERVALUETYPE.FIELD:var cxt={form:form};paras.push(form.eval(filterVal.refVal,cxt,null));break;}}var dictFilter={};dictFilter.itemKey=dictview.itemKey;dictFilter.formKey=form.formKey;dictFilter.fieldKey=dictview.key;dictFilter.filterIndex=filter.filterIndex;dictFilter.values=paras;dictFilter.dependency=filter.dependency;dictFilter.typeDefKey=filter.typeDefKey;}return dictFilter;},refreshNode:function(dictview,id){var index=id.lastIndexOf("_");var itemKey=id.substring(0,index);var oid=id.substring(index+1);var item=YIUI.DictService.getItem(itemKey,oid);var $tr=$("#"+id,dictview._$table);if(item.nodeType==1){$tr.attr("haschild",true);}if(item.enable!=undefined){$tr.attr("enable",item.enable);$tr.removeClass("invalid").removeClass("disabled");switch(item.enable){case -1:$tr.addClass("invalid");break;case 0:$tr.addClass("disabled");break;case 1:break;}}var value;for(var j=0,len=dictview.colModel.length;j<len;j++){value=item.getValue(dictview.colModel[j].key);if(!value){value="";}var $td=$tr.children("td").eq(j);if($td.children().length>0){var child=$td.children();$td.empty();$td.append(child).append(value);}else{$td.html(value);}}}};Return=$.extend({},YIUI.Handler,Return);return Return;})();YIUI.FileChooserHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.MapDrawHandler=(function(){var a={};a=$.extend({},YIUI.Handler,a);return a;})();YIUI.BaseBehavior=(function(){var a={checkAndSet:function(d,e){var b=d.oldVal;var c=d.newVal;if(c instanceof Decimal){c=c.toString();}if(b==c){return false;}if($.isFunction(e)){e(c);}return true;}};return a;})();YIUI.ButtonBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.CheckBoxBehavior=(function(){var a={checkAndSet:function(e,f){var c=e.oldVal;var d=e.newVal;if(c==d){return false;}var b=YIUI.TypeConvertor.toBoolean(d);if($.isFunction(f)){f(b);}return true;}};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.ComboBoxBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.DatePickerBehavior=(function(){var a={checkAndSet:function(e,f){var b=e.oldVal;var d=e.newVal;if(b instanceof Date&&$.isNumeric(d)){b=b.getTime();}if(b==d){return false;}var c;if(!(d==undefined||d==null||d.length==0)){if(d instanceof Date){c=d;}else{if($.isNumeric(d)){d=parseFloat(d);}else{d=d.replace(/-/g,"/");}c=new Date(d);}}if($.isFunction(f)){f(c);}return true;}};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.DictBehavior=(function(){var a={isEqual:function(h,g){var f=true;if($.isArray(h)&&$.isArray(g)){if(h.length!=g.length){f=false;}else{for(var e=0,d=h.length;e<d;e++){for(var c=0,b=g.length;c<b;c++){if(h[e].oid!=g[e].oid){f=false;break;}}}}}else{if(h&&g){f=h.oid==g.oid;}else{f=h==g;}}return f;},checkAndSet:function(q,n){var m=q.oldVal;var d=q.newVal;if(d instanceof Decimal){d=d.toString();}var l=this.isEqual(m,d);if(l){return false;}if(d==null||d==""){if($.isFunction(n)){n(null);}return true;}var o="",b;if(q.dictCaption==null){q.dictCaption={};}if(q.multiSelect){var c=[];if($.isString(d)){c=d.split(",");var k=[],h=[];for(var g=0;g<c.length;g++){var f=parseFloat(c[g]);k.push(f);if(f!=0){var p=q.dictCaption[q.itemKey+"_"+f];if(p==null){p=YIUI.DictService.getCaption(q.itemKey,f);q.dictCaption[q.itemKey+"_"+f]=p;}}b={oid:f,itemKey:q.itemKey,caption:p};var e=new YIUI.ItemData(b);h.push(e);}d=h;}}else{if(m&&d){if((m.itemKey+"_"+m.oid)==(d.itemKey+"_"+d.oid)){return false;}}if($.isNumeric(d)){if(parseFloat(d)!=0){o=q.dictCaption[q.itemKey+"_"+parseFloat(d)];if(o==null){o=YIUI.DictService.getCaption(q.itemKey,parseFloat(d));q.dictCaption[q.itemKey+"_"+f]=o;}}b={oid:d,itemKey:q.itemKey,caption:o};d=new YIUI.ItemData(b);}else{if(d){if(d.oid=="0"){d=null;}else{if(d.caption==null||d.caption==""){o=q.dictCaption[q.itemKey+"_"+parseFloat(d.oid)];if(o==null){o=YIUI.DictService.getCaption(q.itemKey,parseFloat(d.oid));q.dictCaption[q.itemKey+"_"+parseFloat(d.oid)]=o;}d.caption=o;}}}}}if($.isFunction(n)){n(d);}return true;}};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.GridBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.HyperLinkBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.ImageBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.ListViewBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.NumberEditorBehavior=(function(){var a={checkAndSet:function(n,l){var j=n.oldVal;var c=n.newVal;var g=n.decScale;var b=n.roundingMode;var h=null,k=0,m="";if(c!=null){h=YIUI.TypeConvertor.toDecimal(c);k=h.toFormat(g,b);var e={aSep:n.useSep?n.sep:"",dGroup:n.groupingSize,aDec:n.decSep,mDec:n.decScale};m=YIUI.DecimalFormat.format(k,e);c=new Decimal(k);}else{c=new Decimal(0);}j=YIUI.TypeConvertor.toDecimal(j);var f=!j.eq(c);if(f&&$.isFunction(l)){l(c,m);}return f;}};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.RadioButtonBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.SplitButtonBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.SearchBoxBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.TextAreaBehavior=(function(){var a={};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.TextEditorBehavior=(function(){var a={checkAndSet:function(m,k){var j=m.oldVal;var c=m.newVal;if(j==c){return false;}var d=m.trim;var l=m.textCase;var b=m.maxLength;var g=m.invalidChars;var e={trim:m.trim,textCase:m.textCase,maxLength:m.maxLength,invalidChars:m.invalidChars};var h=YIUI.TextFormat.format(c,e);var f=(j!==h);if($.isFunction(k)){k(h);}return true;}};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.UTCDatePickerBehavior=(function(){var a={checkAndSet:function(d,f){var b=d.oldVal;var c=d.newVal;if(b==c){return false;}var e=YIUI.UTCDateFormat.format(c);if($.isFunction(f)){f(e);}return true;}};a=$.extend({},YIUI.BaseBehavior,a);return a;})();YIUI.DateFormat=(function(){var a={format:function(c,d){var e={formatStr:"yyyy-MM-dd HH:mm:ss",isOnlyDate:true};d=$.extend(e,d);var b=d.formatStr;var g=d.isOnlyDate;if(g){b=b.split(" ")[0];}var f="";if(c){f=c.Format(b);}return f;}};return a;})();YIUI.DecimalFormat=(function(){var a={checkEmpty:function(c,d,b){if(c===""||c===d.aNeg){return c;}return null;},format:function(c,f){var h={aSep:",",dGroup:"3",aDec:".",aSign:"",pSign:"",mDec:"2"};f=$.extend(h,f);c=YIUI.TypeConvertor.toString(c);var g=this.checkEmpty(c,f,true);if(g!==null){return g;}var b="";if(f.dGroup===2){b=/(\d)((\d)(\d{2}?)+)$/;}else{if(f.dGroup===4){b=/(\d)((\d{4}?)+)$/;}else{b=/(\d)((\d{3}?)+)$/;}}var e=c.split(f.aDec);var d=e[0];if(f.aSep){while(b.test(d)){d=d.replace(b,"$1"+f.aSep+"$2");}}if(f.mDec!==0&&e.length>1){if(e[1].length>f.mDec){e[1]=e[1].substring(0,f.mDec);}c=d+f.aDec+e[1];}else{c=d;}if(f.aSign){c=f.pSign==="p"?f.aSign+c:c+f.aSign;}return c;}};return a;})();YIUI.UTCDateFormat=(function(){var a={format:function(d,b){var c={formatStr:"yyyy-MM-dd HH:mm:ss",isOnlyDate:true};b=$.extend(c,b);var e;if(!(d==undefined||d==null||d.length==0)){if(d instanceof Date){e=d.Format(b.formatStr)||"";e=e.replace(/(\W+)/g,"");}else{if($.isNumeric(d)){e=parseFloat(d);}else{e=d.replace(/(\W+)/g,"");}}}return e;},formatCaption:function(h,b,c){if(b){var f=parseInt(h/10000);var g=h%10000;var k=parseInt(g/100);g=g%100;var l=g;if(c&&!this.check(f,k,l,0,0,0)){throw new RuntimeException("错误的时间："+h);}if(k<10){k="0"+k;}if(l<10){l="0"+l;}text=f+"-"+k+"-"+l;}else{var f=parseInt(h/10000000000);var g=h%10000000000;var k=parseInt(g/100000000);g=g%100000000;var l=parseInt(g/1000000);g=g%1000000;var j=parseInt(g/10000);g=g%10000;var e=parseInt(g/100);g=g%100;var m=g;if(c&&!this.check(f,k,l,j,e,m)){throw new RuntimeException("错误的时间："+h);}if(k<10){k="0"+k;}if(l<10){l="0"+l;}if(j<10){j="0"+j;}if(e<10){e="0"+e;}if(m<10){m="0"+m;}text=f+"-"+k+"-"+l+" "+j+":"+e+":"+m;}return text;},check:function(h,g,b,d,e,c){if(h>9999){return false;}if(g>12){return false;}var f=30;switch(g){case 2:if((h%4==0&&h%100!=0)||h%400==0){f=29;}else{f=28;}break;case 1:case 3:case 5:case 7:case 8:case 10:case 12:f=31;break;}if(b>f){return false;}if(d>23){return false;}if(e>59||c>59){return false;}return true;}};return a;})();YIUI.TextFormat=(function(){var b={CASETYPE_NONE:0,CASETYPE_LOWER:1,CASETYPE_UPPER:2};var a={format:function(k,f){var d={maxLength:Number.MAX_VALUE,textCase:YIUI.TEXTEDITOR_CASE.DEFAULT,invalidChars:null,trim:true};f=$.extend(d,f);var e=f.trim;var m=f.textCase;var c=f.maxLength;var g=f.invalidChars;var l="";if(k!==undefined&&k!==null){l=k.toString();switch(m){case b.CASETYPE_LOWER:l=l.toLowerCase();break;case b.CASETYPE_UPPER:l=l.toUpperCase();break;}if(g!==undefined&&g!==null&&g!==""){var j="";for(var h=0;h<l.length;h++){if(g.indexOf(l.charAt(h))>=0){continue;}j+=l.charAt(h);}l=j;}if(c>=0&&c<l.length){l=l.substring(0,c);}if(e){l=$.trim(l);}}return l;}};return a;})();(function(){YIUI.Yes_Button=function(b){var a={el:$("<button></button>"),icon:null,init:function(){var c=this;$("<span class='txt'></span>").appendTo(this.el);b.icon&&this.setIcon(b.icon);},getEl:function(){return this.el;},setEnable:function(d){this.enable=d;var e=this.el,c=this.el;if(this.enable){e.removeAttr("disabled");c.removeClass("ui-readonly");}else{e.attr("disabled","disabled");c.addClass("ui-readonly");}},setIcon:function(e){this.icon=e;var c=$("span.txt",this.el),d=$("span.icon",this.el);if(d.length>0){d.css("background-image","url(Resource/"+e+")");}else{d=$("<span class='icon'></span>").css("background-image","url(Resource/"+e+")");c.before(d);}},getTextButton:function(){return $("span.txt",this.el);},setWidth:function(d){this.el.css("width",d);$(".txt",this.el).css("width",d);var c=$("span.icon",this.el),e=0;if(c.length>0){e+=c.width();}},setHeight:function(c){this.el.css("height",c);}};a=$.extend(a,b);a.init();return a;};})();(function(){YIUI.Yes_HyperLink=function(b){var a={el:$("<a class='ui-hlk'></a>"),targetType:"Current",url:"",init:function(){var c=this;c.enable=b.enable;this.el.mousedown(function(){c.enable&&$(this).addClass("hover");}).mouseup(function(){c.enable&&$(this).removeClass("hover");});b.url&&this.setURL(b.url);b.targetType&&this.setTarget(b.targetType);},getEl:function(){return this.el;},setText:function(c){this.el.html(c);},getText:function(){return this.el.html();},setURL:function(c){if(c){this.url=c;this.el.attr("href",c);}},setEnable:function(c){this.enable=c;},setTarget:function(c){this.targetType=c;this.el.attr("target",YIUI.Hyperlink_target[c]);},setHeight:function(c){this.el.css({"line-height":c+"px",height:c+"px"});},setWidth:function(c){this.el.css({width:c+"px"});}};a=$.extend(a,b);if(!b.isPortal){a.init();}return a;};})();(function(){YIUI.Yes_Image=function(b){var a={el:$("<div></div>"),sourceType:YIUI.IMAGE_SOURCETYPE.DATA,image:"",stretch:false,imageCut:false,init:function(){this._img=$("<img />").appendTo(this.el);},getEl:function(){return this.el;},setSourceType:function(c){this.sourceType=c;},setImagePath:function(c){this.image="Resource/"+c;this._img.attr("src",this.image.replace(/\\/g,"/"));},setImageCut:function(c){this.imageCut=c;},setStretch:function(c){this.stretch=c;},getImage:function(){return this._img;},setHeight:function(c){var d=this.getImage();if(this.stretch){d.css({height:c});}else{if(c<this.el.width()){d.height("100%");d.width("auto");}else{d.width("100%");d.height("auto");}}},setWidth:function(d){var c=this.getImage();if(this.stretch){c.css("width",this.el.innerWidth());}else{if(d>this.el.height()){c.height("100%");c.width("auto");}else{c.width("100%");c.height("auto");}}},setEnable:function(d){this.enable=d;var e=this.el,c=this.el;if(this.enable){c.removeClass("ui-readonly");}else{c.addClass("ui-readonly");}},setValue:function(c){this.value=c;},uploadImg:function(){},change:function(){},click:function(){},install:function(){var c=this;c.el.delegate(".upbtn","change",function(h){var f=h.target.files[0],g=f.type.split("/")[1];if(c.imageCut){var e={type:g,callback:function(j){c.uploadImg($(h.target),j);}};$(".upbtn",c.el).photoCut(e);}else{c.uploadImg($(this),{fileName:f.name,imgType:g});}});this._img.bind("click",function(f){if(c.enable){c.click();}});var d=function(f){if(f==undefined||f==null){return;}var e={service:"DeleteImage",filePath:f,operatorID:$.cookie("userID"),mode:1};$.ajax({url:Svr.SvrMgr.AttachURL,data:e,type:"post",error:function(h,g,j){alert(j);}});};this.el.mouseover(function(){if($(".opt",c.el).length==0){var j=(c.sourceType==YIUI.IMAGE_SOURCETYPE.DATA&&c.enable)?"block":"none",k=$("<div class='bar'></div>").appendTo(c.el),g=$("<span class='opt upload' title='"+$.ygrid.cell_imgOpt.open+"'/>").appendTo(c.el),f=$("<span class='opt show' title='"+$.ygrid.cell_imgOpt.show+"'/>").appendTo(c.el),e=$("<span class='opt clear' title='"+$.ygrid.cell_imgOpt.clear+"'/>").appendTo(c.el),h=$("<input type='file' name='file' data-url='upload' class='opt upbtn' accept='image/*' title='"+$.ygrid.cell_imgOpt.open+"'/>").appendTo(c.el);k.css({top:(c.el.height()-25)+"px"});g.css({left:(c.el.width()-22)+"px",top:(c.el.height()-22)+"px",display:j});h.css({left:(c.el.width()-22)+"px",top:(c.el.height()-22)+"px",opacity:0,display:j});f.css({left:(c.el.width()-((j=="none")?22:46))+"px",top:(c.el.height()-22)+"px"});e.css({left:(c.el.width()-68)+"px",top:(c.el.height()-22)+"px",display:j});$(".opt",c.el).mouseover(function(m){var l=$(m.target);if(l.hasClass("upbtn")){g.addClass("sel");}else{l.addClass("sel");}}).mouseout(function(m){var l=$(m.target);if(l.hasClass("upbtn")){g.removeClass("sel");}else{l.removeClass("sel");}});e.click(function(){c.setValue("");c._img.attr("src",YIUI.Image.EmptyImg);c.change();});f.click(function(){var n;if(c.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){if(c.value==undefined||c.value==null||c.value.length==0){return;}var m=c.el.attr("formKey");n=Svr.SvrMgr.AttachURL+"?path="+BASE64.encoder(c.value)+"&formKey="+m+"&service=DownloadImage&mode=1&r="+Math.random();}else{n=c.image;}var o=$("<div class='ui-img-showDiv'></div>").appendTo(document.body);var l=$("<img class='ui-img-showImg' src='"+n+"'>").appendTo(document.body);l.load(function(){l.css({left:(o.width()-this.width)/2+"px",top:(o.height()-this.height)/2+"px",width:this.width,height:this.height});});o.click(function(){o.remove();l.remove();});l.click(function(){o.remove();l.remove();});});if($.ygrid.msie){h[0].onchange=function(){var n=this;var m=$(this).val().substring(m.lastIndexOf("\\")+1),o=m.split(".")[1];if(c.imageCut){var l={type:o,callback:function(p){c.uploadImg($(n),p);}};$(n).photoCut(l);}else{c.uploadImg($(this),{imgType:o});}$(".opt,.bar",c.yesCom).remove();};}}}).mouseout(function(f){if(!$(f.relatedTarget).hasClass("opt")&&!$(f.relatedTarget).hasClass("bar")){$(".opt,.bar",c.el).remove();}});}};a=$.extend(a,b);if(!b.isPortal){a.init();}a.install();return a;};})();(function(){YIUI.Yes_TextEditor=function(b){var a={el:$("<span></span>"),_input:"",types:{txt:$("<input type='text'/>"),pwd:$("<input type='password'/>")},inputType:null,maxLength:Number.MAX_VALUE,textCase:YIUI.TEXTEDITOR_CASE.DEFAULT,invalidChars:null,promptText:null,trim:true,focus:true,required:false,selectOnFocus:true,mask:null,icon:null,embedText:null,preIcon:null,init:function(){if(this.inputType=="password"){this._input=this.types.pwd;}else{this._input=this.types.txt;}this._input.appendTo(this.el);if(this.icon){this.setIcon(this.icon);}else{this.setClearable(true);}this.setValue(this.value);this.setTextCase(this.textCase);this.setMaxLength(this.maxLength);this.preIcon&&this.setPreIcon(this.preIcon);this.promptText&&this.setPromptText(this.promptText);this.embedText&&this.setEmbedText(this.embedText);this.setMask(this.mask);},setMask:function(c){this.mask=c;if(this.mask){this._input.mask(this.mask);}},getInput:function(){return this._input;},setInput:function(c){this._input.attr("type",c);},setValue:function(c){this.value=c;if(this.getEl()){this._input.val(c);}},getValue:function(){var c=this._input.val();return c;},setEnable:function(d){this.enable=d;var e=this._input,c=this.getEl();if(this.enable){e.removeAttr("readonly");c.removeClass("ui-readonly");}else{e.attr("readonly","readonly");c.addClass("ui-readonly");}},setRequired:function(c){if(c){this.getEl().addClass("ui-required");}else{this.getEl().removeClass("ui-required");}},setBackColor:function(c){this.backColor=c;this._input.css({"background-image":"none","background-color":c});},setForeColor:function(c){this.foreColor=c;this._input.css("color",c);},setFormatStyle:function(c){this._input.css(c);},setHeight:function(c){this.getEl().css("height",c+"px");this._input.css("height",c+"px");if($.browser.isIE){this._input.css("line-height",(c-2)+"px");}if(this.embedText){$(".embed",this.getEl()).css("height",c+"px");$(".embed",this.getEl()).css("line-height",c+"px");}if(this.preIcon){var d=$(".pre-icon",this.getEl());d.css("top",(this.getEl().height()-d.height())/2+"px");}},setWidth:function(g){var h,e;if(this.preIcon){h=$(".pre-icon",this.getEl());h.css("left","5px");}var f=this.getEl(),d,c;if(this.preIcon){d=h.outerWidth()+8;}else{d=8;}if(this.embedText){e=$(".embed",this.getEl());e.css("padding-left",d+"px");d=e.outerWidth();}this._input.css("padding-left",d+"px");this.getEl().css("width",g+"px");this._input.css("width",g+"px");},getEl:function(){return this.el;},setTextCase:function(d){var c=this._input;this.textCase=d;if(d===YIUI.TEXTEDITOR_CASE.UPPER){c.addClass("uppercase");}else{c.removeClass("uppercase");}if(d===YIUI.TEXTEDITOR_CASE.LOWER){c.addClass("lowercase");}else{c.removeClass("lowercase");}},setInvalidChars:function(c){if($.isString(c)){this.invalidChars=c;}},setMaxLength:function(c){if($.isNumeric(c)&&c>0){this.maxLength=c;}},setIcon:function(c){this.icon=c;$('<span class="icon" />').css("background-image","url(Resource/"+c+")").appendTo(this.getEl());},setPreIcon:function(d){this.preIcon=d;var c=this.getEl();$('<span class="pre-icon" />').css("background-image","url(Resource/"+d+")").appendTo(c);},setEmbedText:function(e){if(e!=""&&e!==null){$(".embed",this.getEl()).remove();this.embedText=e;var g=this._input.outerWidth(),f=this.getEl(),h=$('<span class="embed" />').html(e).prependTo(f),d,c;}},setPromptText:function(c){this.promptText=c;this._input.placeholder(this.promptText);},setClearable:function(c){var e=this.getEl(),d=this._input;if(c){$("<span class='clear'/>").appendTo(e);}else{$(".clear",e).remove();d.css({paddingRight:"2px"});}},setSelOnFoc:function(c){this.selectOnFocus=c;},finishInput:function(){var c=this,d=this._input.val();if(c.trim){d=$.trim(d);}if(d!=c.value){c.setValue(d);c.valueChange(d);if(c.required){var e=(d=="");c.setRequired(e);}}},valueChange:$.noop,install:function(){var d=this;var c=this._input;var e=$("span.clear",this.el);e.mousedown(function(){c.val("").focus();e.hide();}).hide();c.on("click",function(){if(d.needSelectAll){d.focus&&this.select();d.needSelectAll=false;}}).on("focusin",function(){if(d.selectOnFocus){d.needSelectAll=d.selectOnFocus;}}).keyup(function(){if(!$.isDefined($(this).attr("readonly"))){if($(this).val()){e.show();}else{e.hide();}}}).keydown(function(g){var f=g.keyCode||g.which;if(f!=8&&$.InputMask.getCursor(this).start>=d.maxLength){g.preventDefault();return true;}if(g.ctrlKey){if(f==86){window.setTimeout(function(){d.finishInput();},0);}}}).focus(function(){if(!$.isDefined($(this).attr("readonly"))&&$(this).val()){e.show();}}).blur(function(){d.finishInput();e.hide();}).filterInput(this.invalidChars,this.textCase,this.maxLength);}};a=$.extend(a,b);if(!b.isPortal){a.init();}else{a._input=$("input",a.el);a.setMaxLength(a.maxLength);a.promptText&&a.setPromptText(a.promptText);}a.install();return a;};})();(function(){YIUI.Yes_Label=function(b){var a={el:$("<div></div>"),icon:null,init:function(){this.label=$("<label></label>").appendTo(this.el);this.icon&&this.setIcon(this.icon);this.caption&&this.setCaption(this.caption);},setWidth:function(c){this.el.css("width",c);this.label.css("width",c-$("span",this.el).width());},setHeight:function(c){this.el.css("height",c);this.label.css("height",c);this.label.css("line-height",c+"px");if(this.icon){var d=$(".icon",this.el);d.css("top",(c-d.height())/2+"px");}},setCssStyle:function(c){this.label.css(c);},getEl:function(){return this.el;},setCaption:function(c){this.caption=c||"";var d=new RegExp("\n","g");var e=this.caption.replace(d,"<br/>").replace(/\ /g,"&nbsp;");this.label.html(e);},setValue:function(c){this.setCaption(c==null?"":c.toString());},setIcon:function(c){this.icon=c;var d=this.getEl();if($("span.icon",d).length==0){$('<span class="icon" />').css("background-image","url(Resource/"+c+")").prependTo(d);}else{$("span.icon",d).css("background-image","url(Resource/"+c+")");}}};a=$.extend(a,b);if(!b.isPortal){a.init();}return a;};})();(function(){function j(r,q){if(q.aSign){while(r.indexOf(q.aSign)>-1){r=r.replace(q.aSign,"");}}r=r.replace(q.skipFirstAutoStrip,"$1$2");r=r.replace(q.skipLastAutoStrip,"$1");r=r.replace(q.allowedAutoStrip,"");if(q.altDec){r=r.replace(q.altDec,q.aDec);}var p=r.match(q.numRegAutoStrip);r=p?[p[1],p[2],p[3]].join(""):"";return r;}function o(q,p){if(typeof(q[p])==="string"){q[p]*=1;}}function c(t,s){s.oEvent=null;var w=s.vMax.toString().split("."),r=(!s.vMin&&s.vMin!==0)?[]:s.vMin.toString().split(".");o(s,"vMax");o(s,"vMin");o(s,"mDec");s.aNeg=s.vMin<0?"-":"";w[0]=w[0].replace("-","");r[0]=r[0].replace("-","");s.mInt=Math.max(w[0].length,r[0].length,1);if(s.mDec===null){var v=0,q=0;if(w[1]){v=w[1].length;}if(r[1]){q=r[1].length;}s.mDec=Math.max(v,q);}if(s.altDec===null&&s.mDec>0){if(s.aDec==="."&&s.aSep!==","){s.altDec=",";}else{if(s.aDec===","&&s.aSep!=="."){s.altDec=".";}}}var p=s.aNeg?"([-\\"+s.aNeg+"]?)":"(-?)";s.aNegRegAutoStrip=p;s.skipFirstAutoStrip=new RegExp(p+"[^-"+(s.aNeg?"\\"+s.aNeg:"")+"\\"+s.aDec+"\\d]"+".*?(\\d|\\"+s.aDec+"\\d)");s.skipLastAutoStrip=new RegExp("(\\d\\"+s.aDec+"?)[^\\"+s.aDec+"\\d]\\D*$");var u="-"+s.aNum+"\\"+s.aDec;s.allowedAutoStrip=new RegExp("[^"+u+"]","gi");s.numRegAutoStrip=new RegExp(p+"(?:\\"+s.aDec+"?(\\d+\\"+s.aDec+"\\d+)|(\\d*(?:\\"+s.aDec+"\\d*)?))");return s;}function f(r,q,p){if(p&&p!=="-"){r=r.replace("-",p);}if(q&&q!=="."){r=r.replace(".",q);}return r;}function k(q,p){q=j(q,p);q=m(q,p.aDec,p.mDec);q=n(q,p.aDec,p.aNeg);var r=+q;if(r<p.vMin||r>p.vMax){window.setTimeout(function(){YIUI.ViewException.throwException(YIUI.ViewException.Exceed_Value_Max_Accuracy);},0);}return r>=p.vMin&&r<=p.vMax;}function m(q,p,t){if(p&&t){var r=q.split(p);if(r[1]&&r[1].length>t){if(t>0){r[1]=r[1].substring(0,t);q=r.join(p);}else{q=r[0];}}}return q;}function n(r,q,p){if(q&&q!=="."){r=r.replace(q,".");}if(p&&p!=="-"){r=r.replace(p,"-");}if(!r.match(/\d/)){r+="0";}return r;}function e(u,t){u=(u==="")?"0":u.toString();var p="",x=0,A="";if(u.charAt(0)==="-"){A="-";u=u.replace("-","");}if(!u.match(/^\d/)){u="0"+u;}if(A==="-"&&+u===0){A="";}var z=u.lastIndexOf("."),w=(z===-1)?u.length-1:z,y=(u.length-1)-w;if(y<=t.mDec){p=u;if(z===-1){p+=".";}var q="0";while(y<t.mDec){p+=q;y+=q.length;}}else{var r=z+t.mDec,s=+u.charAt(r+1),v=u.substring(0,r+1).split("");if((s>4&&t.mRound===YIUI.NUMBEREDITOR_ROUNDINGMODE.HALF_UP)||(s>0&&t.mRound===YIUI.NUMBEREDITOR_ROUNDINGMODE.ROUND_UP)){var x=v.length-1;v[x]=+v[x]+1;}v=v.slice(0,r+1);p=v.join("");}return(+p===0)?p:A+p;}function d(r,w){r=j(r,w);var v=r.replace(",",".");var x=a(r,w,true);if(x!==null){return x;}var p="";if(w.dGroup===2){p=/(\d)((\d)(\d{2}?)+)$/;}else{if(w.dGroup===4){p=/(\d)((\d{4}?)+)$/;}else{p=/(\d)((\d{3}?)+)$/;}}var u=r.split(w.aDec);if(w.altDec&&u.length===1){u=r.split(w.altDec);}var t=u[0];if(w.aSep){while(p.test(t)){t=t.replace(p,"$1"+w.aSep+"$2");}}if(w.mDec!==0&&u.length>1){if(u[1].length>w.mDec){u[1]=u[1].substring(0,w.mDec);}r=t+w.aDec+u[1];}else{r=t;}if(w.aSign){var q=r.indexOf(w.aNeg)!==-1;r=r.replace(w.aNeg,"");r=w.pSign==="p"?w.aSign+r:r+w.aSign;if(q){r=w.aNeg+r;}}return r;}function a(q,r,p){if(q===""||q===r.aNeg){return q;}return null;}function l(r){var q={};if(r.selectionStart===undefined){r.focus();var p=document.selection.createRange();q.length=p.text.length;p.moveStart("character",-r.value.length);q.end=p.text.length;q.start=q.end-q.length;}else{q.start=r.selectionStart;q.end=r.selectionEnd;q.length=q.end-q.start;}return q;}function b(s,t,p){if(s.selectionStart===undefined){s.focus();var q=s.createTextRange();q.collapse(true);q.moveEnd("character",p);q.moveStart("character",t);q.select();}else{s.selectionStart=t;s.selectionEnd=p;}}function h(q,p){this.settings=p;this.that=q;this.$that=$(q);this.formatted=false;this.settingsClone=c(this.$that,this.settings);this.value=q.value;}h.prototype={init:function(p){this.value=this.that.value;this.settingsClone=c(this.$that,this.settings);this.ctrlKey=p.ctrlKey;this.cmdKey=p.metaKey;this.shiftKey=p.shiftKey;this.selection=l(this.that);if(p.type==="keydown"||p.type==="keyup"){this.kdCode=p.keyCode;}this.which=p.which;this.processed=false;this.formatted=false;},setSelection:function(r,p,q){r=Math.max(r,0);p=Math.min(p,this.that.value.length);this.selection={start:r,end:p,length:p-r};if(q===undefined||q){b(this.that,r,p);}},setPosition:function(q,p){this.setSelection(q,q,p);},getBeforeAfter:function(){var q=this.value,r=q.substring(0,this.selection.start),p=q.substring(this.selection.end,q.length);return[r,p];},getBeforeAfterStriped:function(){var p=this.getBeforeAfter();p[0]=j(p[0],this.settingsClone);p[1]=j(p[1],this.settingsClone);return p;},normalizeParts:function(t,s){var q=this.settingsClone;s=j(s,q);t=j(t,q);var r=t+s;if(q.aDec){var p=r.match(new RegExp("^"+q.aNegRegAutoStrip+"\\"+q.aDec));if(p){t=t.replace(p[1],p[1]+"0");r=t+s;}}return[t,s];},processKeypress:function(){var p=this.settingsClone,q=String.fromCharCode(this.which),t=this.getBeforeAfterStriped(),s=t[0],r=t[1];if(q===p.aDec||(p.altDec&&q===p.altDec)||((q==="."||q===",")&&this.kdCode===110)){if(!p.mDec||!p.aDec){return true;}if(p.aNeg&&r.indexOf(p.aNeg)>-1){return true;}if(s.indexOf(p.aDec)>-1){return true;}if(r.indexOf(p.aDec)>0){return true;}if(r.indexOf(p.aDec)===0){r=r.substr(1);}this.setValueParts(s+p.aDec,r);return true;}if(q==="-"||q==="+"){if(!p.aNeg){return true;}if(s===""&&r.indexOf(p.aNeg)>-1){s=p.aNeg;r=r.substring(1,r.length);}if(s.charAt(0)===p.aNeg){s=s.substring(1,s.length);}else{s=(q==="-")?p.aNeg+s:s;}this.setValueParts(s,r);return true;}if(q>="0"&&q<="9"){if(p.aNeg&&s===""&&r.indexOf(p.aNeg)>-1){s=p.aNeg;r=r.substring(1,r.length);}if(p.vMax<=0&&p.vMin<p.vMax&&this.value.indexOf(p.aNeg)===-1&&q!=="0"){s=p.aNeg+s;}this.setValueParts(s+q,r);return true;}return true;},setValueParts:function(u,s){var q=this.settingsClone,t=this.normalizeParts(u,s),r=t.join(""),p=t[0].length;if(k(r,q)){r=m(r,q.aDec,q.mDec);if(p>r.length){p=r.length;}this.value=r;this.setPosition(p,false);return true;}return false;},processAllways:function(){var p;if(this.kdCode===8||this.kdCode===46){if(!this.selection.length){p=this.getBeforeAfterStriped();if(this.kdCode===8){p[0]=p[0].substring(0,p[0].length-1);}else{p[1]=p[1].substring(1,p[1].length);}this.setValueParts(p[0],p[1]);}else{p=this.getBeforeAfterStriped();this.setValueParts(p[0],p[1]);}return true;}return false;},checkPaste:function(){if(this.valuePartsBeforePaste!==undefined){var q=this.getBeforeAfter(),p=this.valuePartsBeforePaste;delete this.valuePartsBeforePaste;q[0]=q[0].substr(0,p[0].length)+j(q[0].substr(p[0].length),this.settingsClone);if(!this.setValueParts(q[0],q[1])){this.value=p.join("");this.setPosition(p[0].length,false);}}},skipAllways:function(s){var t=this.kdCode,r=this.which,q=this.ctrlKey,w=this.cmdKey,u=this.shiftKey;if(((q||w)&&s.type==="keyup"&&this.valuePartsBeforePaste!==undefined)||(u&&t===45)){this.checkPaste();return false;}if((t>=112&&t<=123)||(t>=91&&t<=93)||(t>=9&&t<=31)||(t<8&&(r===0||r===t))||t===144||t===145||t===45){return true;}if((q||w)&&t===65){return true;}if((q||w)&&(t===67||t===86||t===88)){if(t===86||t===45){if(s.type==="keydown"||s.type==="keypress"){if(this.valuePartsBeforePaste===undefined){this.valuePartsBeforePaste=this.getBeforeAfter();}}else{this.checkPaste();}}return s.type==="keydown"||s.type==="keypress"||t===67;}if(q||w){return true;}if(t===37||t===39){var v=this.settingsClone.aSep,p=this.selection.start,x=this.that.value;if(s.type==="keydown"&&v&&!this.shiftKey){if(t===37&&x.charAt(p-2)===v){this.setPosition(p-1);}else{if(t===39&&x.charAt(p+1)===v){this.setPosition(p+1);}}}return true;}if(t>=34&&t<=40){return true;}return false;},formatQuick:function(){var x=this.settingsClone,q=this.getBeforeAfterStriped(),y=this.value;if((x.aSep===""||(x.aSep!==""&&y.indexOf(x.aSep)===-1))&&(x.aSign===""||(x.aSign!==""&&y.indexOf(x.aSign)===-1))){var p=[],z="";p=y.split(x.aDec);if(p[0].indexOf("-")>-1){z="-";p[0]=p[0].replace("-","");q[0]=q[0].replace("-","");}if(p[0].length>x.mInt&&q[0].charAt(0)==="0"){q[0]=q[0].slice(1);}q[0]=z+q[0];}var w=d(this.value,this.settingsClone),s=w.length;if(w){var t=q[0].split(""),r=0;for(r;r<t.length;r+=1){if(!t[r].match("\\d")){t[r]="\\"+t[r];}}var u=new RegExp("^.*?"+t.join(".*?"));var v=w.match(u);if(v){s=v[0].length;if(((s===0&&w.charAt(0)!==x.aNeg)||(s===1&&w.charAt(0)===x.aNeg))&&x.aSign&&x.pSign==="p"){s=this.settingsClone.aSign.length+(w.charAt(0)==="-"?1:0);}}else{if(x.aSign&&x.pSign==="s"){s-=x.aSign.length;}}}this.that.value=w;this.setPosition(s);this.formatted=true;}};function g(p,r,t){var s=p.data("NumberEditor");if(!s){s={};p.data("NumberEditor",s);}var q=s.handler;if((q===undefined&&r)||t){q=new h(p.get(0),r);s.handler=q;}return q;}YIUI.Yes_NumberEditor=function(q){var p={el:$("<span></span>"),selectOnFocus:true,required:false,promptText:null,settings:{aNum:"0123456789",aSep:",",dGroup:"3",aDec:".",aSign:"",pSign:"",vMax:"99999999999999.99",vMin:"-99999999999999.99",mDec:"2",mPre:"16",mRound:YIUI.NUMBEREDITOR_ROUNDINGMODE.HALF_UP,altDec:null},init:function(){$("<input type='text' />").appendTo(this.el);var r=g(this.getInput(),this.settings);this.setValue(this.value);},getValue:function(){var r=null;if(this.value==null){r=0;}else{r=n(this.value,this.settings.aDec,this.settings.aNeg);}return new Decimal(r);},getInput:function(){return $("input",this.el);},getEl:function(){return this.el;},setValue:function(r){if(r==null){r="";}var t=this.getInput();var s=r.toString();if(r instanceof Decimal){s=r.toFixed();}if(!$.isNumeric(+s)){this.value=null;return"";}this.value=s;if(s!==""){s=e(s,this.settings);}s=f(s,this.settings.aDec,this.settings.aNeg);if(!k(s,this.settings)){s=e("",this.settings);}s=d(s,this.settings);if(!(!this.showZero&&s==0)){t.val(s);}},setEnable:function(s){this.enable=s;var t=this.getInput(),r=this.getEl();if(this.enable){t.removeAttr("readonly");r.removeClass("ui-readonly");}else{t.attr("readonly","readonly");r.addClass("ui-readonly");}},setBackColor:function(r){this.backColor=r;this.getInput().css({"background-image":"none","background-color":r});},setForeColor:function(r){this.foreColor=r;this.getInput().css("color",r);},setFormatStyle:function(r){this.getInput().css(r);},setHeight:function(r){this.el.css("height",r+"px");this.getInput().css("height",r+"px");if($.browser.isIE){this.getInput().css("line-height",(r-3)+"px");}},setWidth:function(r){this.el.css("width",r+"px");this.getInput().css("width",r+"px");},setPromptText:function(r){this.promptText=r;this.getInput().placeholder(this.promptText);},autoStrip:function(t,r){return j(t,r);},getHandler:function(r,s,t){return g(r,s,t);},valueChange:$.noop,setRequired:function(r){this.required=r;if(r){this.getEl().addClass("ui-required");}else{this.getEl().removeClass("ui-required");}},finishInput:function(){var s=this,v=this.getInput(),t=s.getHandler(v),r=t.settingsClone;var u=s.autoStrip(v[0].value,r);if(u!=s.value){s.setValue(u);s.valueChange(u);if(s.required){s.setRequired(u=="");}}},install:function(){var s=this.getInput();var r=this;s.on("keydown.numbereditor",function(u){var t=g(s);if(t.settings.aDec===t.settings.aSep){$.error("error");return this;}if(t.that.readOnly){t.processed=true;return true;}t.init(u);t.settings.oEvent="keydown";if(t.skipAllways(u)){t.processed=true;return true;}if(t.processAllways()){t.processed=true;t.formatQuick();u.preventDefault();return false;}t.formatted=false;return true;});s.on("keypress.numbereditor",function(u){var t=g(s);var v=t.processed;t.init(u);t.settings.oEvent="keypress";if(t.skipAllways(u)){return true;}if(v){u.preventDefault();return false;}if(t.processAllways()||t.processKeypress()){t.formatQuick();u.preventDefault();return false;}t.formatted=false;});s.on("keyup.numbereditor",function(v){var t=g(s);t.init(v);t.settings.oEvent="keyup";var u=t.skipAllways(v);t.kdCode=0;delete t.valuePartsBeforePaste;if(s[0].value===t.settings.aSign){if(t.settings.pSign==="s"){b(this,0,0);}else{b(this,t.settings.aSign.length,t.settings.aSign.length);}}if(u){return true;}if(this.value===""){return true;}if(!t.formatted){t.formatQuick();}});s.on("focusin.numbereditor",function(){if(r.selectOnFocus){r.needSelectAll=true;}var u=g(s);u.settingsClone.oEvent="focusin";u.inVal=s.val();var t=a(u.inVal,u.settingsClone,true);if(t!==null){s.val(t);if(u.settings.pSign==="s"){b(this,0,0);}else{b(this,u.settings.aSign.length,u.settings.aSign.length);}}});s.on("focusout.numbereditor",function(){var w=g(s),u=w.settingsClone,x=s.val(),t=x;w.settingsClone.oEvent="focusout";if(x!==""){x=j(x,u);if(a(x,u)===null&&k(x,u,s[0])){x=n(x,u.aDec,u.aNeg);x=e(x,u);x=f(x,u.aDec,u.aNeg);}else{x="";}}var v=a(x,u,false);if(v===null){v=d(x,u);}if(v!==t){s.val(v);}if(v!==w.inVal){s.change();delete w.inVal;}});s.on("click",function(t){if(r.needSelectAll){r.selectOnFocus&&s.select();r.needSelectAll=false;}});s.on("blur",function(t){r.finishInput();});}};p=$.extend(true,p,q);if(!q.isPortal){p.init();}p.install();return p;};})();(function(){var a=0;YIUI.Yes_CheckBox=function(c){a++;var b={id:a,el:$("<div></div>"),checked:false,text:"",getEl:function(){return this.el;},init:function(){$("<input type='checkbox' class='chk'/>").attr("id","chk_"+this.id).appendTo(this.el);$("<label></label>").attr("for","chk_"+this.id).appendTo(this.el);},setChecked:function(e){this.checked=e;var d=$("input",this.el);if(e===true){d.attr("isChecked",true);d.addClass("checked");d[0].checked=true;}else{d.attr("isChecked",false);d.removeClass("checked");d[0].checked=false;}},setText:function(f){var e=$("label",this.el);var d=!(f===undefined||f.length==0);e.css({display:(d?"inline-block":"none")});e.html(f);},getCheckBox:function(){return $("input",this.el);},getLabel:function(){return $("label",this.el);},getValue:function(){return $("input",this.el).attr("isChecked")==="true"?1:0;},getText:function(){return $("label",this.el).html();},setHeight:function(d){$("label",this.el).css({height:d+"px",lineHeight:d+"px"});var e=$("input",this.el);e.css("margin-top",(d-e.height())/2);},setWidth:function(d){$("label",this.el).css("width",d-$("span",this.el).outerWidth());},setEnable:function(e){this.enable=e;var f=this.getCheckBox(),d=this.el;if(this.enable){f.removeAttr("disabled");d.removeClass("ui-readonly");}else{f.attr("disabled","disabled");d.addClass("ui-readonly");}},install:function(){var d=this;this.getCheckBox().click(function(f){if(!d.enable){return;}});}};b=$.extend(b,c);if(!c.isPortal){b.init();}b.install();return b;};})();(function(){YIUI.Yes_DictTree=function(b){var a={el:$("<div></div>"),independent:true,showCheckBox:false,checkedNodes:{},indeterminatedNodes:null,_pMap:{},rootNode:null,buildTreenode:function(c,d,e){if(!c){return;}if(!c.length){c=$(c);}this.addNodes(c,d,e);},addNodes:function(p,f,e){var n=$("#"+f,this.el);if(p.length<=0){n.children("span:first").removeClass("dt-collapse");return;}var q,m,c,u;this._pMap[f]||(this._pMap[f]=[]);for(var r=0,s=p.length;r<s;r++){q=p[r];m=q.id;c=q.OID;u=q.itemKey;this._pMap[f].push(m);var h=$("<li id='"+m+"' oid = '"+c+"'parentid='"+f+"' itemKey='"+u+"'></li>");h.attr("level",e).css("padding-left",15);var t=n.attr("itemKey");var y=parseInt(n.attr("comp_Level"));if(u!=t){y+=1;}h.attr("comp_Level",y);var v="comp_Level"+y;h.addClass(v);$("<div class='dt-wholerow'/>").appendTo(h);var o=n.children("ul");if(o.length==0){o=$("<ul class='dt-ul'></ul>").appendTo(n);}h.appendTo(o);var k=$("<a class='dt-anchor'></a>");var j,l,d;if(q.NodeType==1){if(q.open){l=$("<span class='icon dt-expand'/>").appendTo(h);_explore=$("<span class='branch b-expand'/>").appendTo(k);}else{l=$("<span class='icon dt-collapse'/>").appendTo(h);_explore=$("<span class='branch b-collapse'/>").appendTo(k);}}else{l=$("<span class='icon'/>").appendTo(h);_explore=$("<span class='branch'/>").appendTo(k);}switch(q.Enable){case YIUI.DictState.Enable:_explore.addClass("enable");break;case YIUI.DictState.Disable:_explore.addClass("disable");break;case YIUI.DictState.Discard:_explore.addClass("discard");break;}if(this.showCheckBox){d=$("<span class='dt-chk' />");l.after(d);}k.appendTo(h);var z=$("<span class='b-txt'>"+q.caption+"</span>").appendTo(k);n.attr("isLoaded",true);}if(this.showCheckBox){for(var r=0,s=p.length;r<s;r++){q=p[r];m=q.id;var g=0;if(m in this.checkedNodes){g=1;}else{if(!this.independent&&m in this.indeterminatedNodes){g=2;}}if(g==0&&!this.independent&&n){var x=n.children(".dt-chk").attr("chkstate")||0;if(x==1){g=1;}}var w=$("#"+m,this.el);w.children(".dt-chk").attr("chkstate",g).addClass("chkstate"+g);}}},checkTreeNode:function(g,c){var h,m,l,j;var n=this;function f(p,u){var s=p.children(".dt-chk");s.removeClass("chkstate"+s.attr("chkstate"));s.attr("chkstate",u).addClass("chkstate"+u);if(u!=2){var q=p.attr("id");n._pMap[q]||(n._pMap[q]=[]);for(var r=0;r<n._pMap[q].length;r++){var o=n._pMap[q][r];var t=$("#"+o,n.el);if(u==0){delete n.checkedNodes[o];}f(t,u);}}}function e(A,o){var v=A.attr("parentid");if(!v){return;}var x=$("#"+v,n.el);var z=x.children(".dt-chk");if(o==2){z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",2).addClass("chkstate"+2);e(x,2);}else{if(o==1){n._pMap[v]||(n._pMap[v]=[]);var p=false;for(var s=0;s<n._pMap[v].length;s++){var w=n._pMap[v][s];var r=$("#"+w,n.el);var q=r.children(".dt-chk").attr("chkstate")||0;if(q!=o){p=true;break;}}if(p){o=2;}z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",o).addClass("chkstate"+o);e(x,o);}else{var t=z.attr("chkstate")||0;var y=A.attr("id");if(t==1){var u=n._pMap[v].length;if(u==1){o=0;}else{for(var s=0;s<n._pMap[v].length;s++){var w=n._pMap[v][s];if(w==y){continue;}var r=$("#"+w,n.el);n.checkedNodes[w]=n.getNodeValue(r);}o=2;}z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",o).addClass("chkstate"+o);}else{if(t==2){var p=true;for(var s=0;s<n._pMap[v].length;s++){var w=n._pMap[v][s];var r=$("#"+w,n.el);var q=r.children(".dt-chk").attr("chkstate")||0;if(q!=o){p=false;break;}}if(p){o=0;z.removeClass("chkstate"+z.attr("chkstate"));z.attr("chkstate",o).addClass("chkstate"+o);}}}e(x,o);}}if(o==1){n.checkedNodes[v]=n.getNodeValue(x);}else{delete n.checkedNodes[v];}}var d=g.attr("id");if(c==1){this.checkedNodes[d]=this.getNodeValue(g);}else{delete this.checkedNodes[d];}if(!this.independent){f(g,c);e(g,c);}else{var k=g.children(".dt-chk");k.removeClass("chkstate"+k.attr("chkstate"));k.attr("chkstate",c).addClass("chkstate"+c);}},setCheckedNodes:function(e){if(this.showCheckBox){var d=this;this.clearCheckedNodes();this.checkedNodes=e;this.indeterminatedNodes=null;if(this.rootNode){var c=this.rootNode.attr("id");if(c in this.checkedNodes){this.rootNode.children(".dt-chk").attr("chkstate",1).addClass("chkstate"+1);}else{if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".dt-chk").attr("chkstate",2).addClass("chkstate"+2);}}}}},clearCheckedNodes:function(){this.checkedNodes={};this.indeterminatedNodes=null;$("[chkstate=1],[chkstate=2]").removeClass("chkstate1").removeClass("chkstate2").attr("chkstate",0).addClass("chkstate0");},createRootNode:function(g,c,d){var f=$("<li id='"+d+"' oid = '"+g.oid+"' itemKey='"+g.itemKey+"'></li>");f.attr("level",-1).attr("comp_Level",1);f.appendTo(this.el);f.addClass("root");$("<div class='dt-wholerow'/>").appendTo(f);var e=$("<a class='dt-anchor'></a>");$("<span class='icon dt-expand'/>").appendTo(f);if(this.showCheckBox){$("<span class='dt-chk' />").addClass("chkstate0").attr("chkstate",0).appendTo(f);}$("<span class='branch b-expand'/>").appendTo(e);$("<span class='b-txt'>"+c+"</span>").appendTo(e);e.appendTo(f);$("<ul class='dt-ul'></ul>").appendTo(f);this.rootNode=$("#"+d,this.el);if(this.showCheckBox){if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".dt-chk").attr("chkstate",2).addClass("chkstate"+2);}else{if(d in this.checkedNodes){this.rootNode.children(".dt-chk").attr("chkstate",1).addClass("chkstate"+1);}}}},render:function(c){this.el.appendTo($(c));this.el.addClass("dt");},collapseNode:function(d){d.children("ul").hide();var c=d.children("span:first");c.removeClass("dt-expand").addClass("dt-collapse");c.next(".dt-anchor").find(".branch").removeClass("b-expand").addClass("b-collapse");},expandNode:$.noop,checkboxClick:function(c){if(this.clearChkNodes){this.checkedNodes={};}var e=c.children(".dt-chk").attr("chkstate")==0?1:0;this.checkTreeNode(c,e);this.callback.onChecked(this,c);var d=c.attr("id");if(e==1){this.checkedNodes[d]=this.getNodeValue(c);}else{delete this.checkedNodes[d];}this.clearChkNodes=false;},selectNode:function(c){if(this.selectedNodeId){$("#"+this.selectedNodeId).removeClass("sel");}this.selectedNodeId=c.attr("id");c.addClass("sel");this.callback.onSelected(this,c);},getNodeValue:function(c){},getCheckedValues:function(){if(this.showCheckBox){var f=this;var e=[];var d="";if(f.rootNode){var c=f.rootNode.attr("id");if(c in f.checkedNodes&&!f.independent){e.push(f.getNodeValue(f.rootNode));f._showCaption="";return e;}}$.each(f.checkedNodes,function(l,m){var h=$("#"+l,f.el);if(!f.independent){var k=h.attr("parentid");var g=$("#"+k,f.el);if(g){var j=g.children(".dt-chk").attr("chkstate")||0;if(j==1){}else{e.push(m);}}else{e.push(m);}}else{e.push(m);}});return e;}},formatAsyncData:function(c){return c;},reset:function(){if(this.rootNode){this._pMap={};this.collapseNode(this.rootNode);this.rootNode.children(".dt-ul").children().remove();this.rootNode.removeAttr("isLoaded");this.indeterminatedNodes=null;}}};a.callback=$.extend({beforeExpand:$.noop,onSelected:$.noop,onChecked:$.noop});a.clickEvent={};a.el.bind("click",function(f){var c=$(f.target);var d;if(c.prop("tagName").toLowerCase()=="li"){d=c;}else{d=c.parents("li:first");}if(c.hasClass("dt-collapse")){a.expandNode(d);return;}if(c.hasClass("dt-expand")){a.collapseNode(d);return;}if(c.hasClass("dt-chk")){a.checkboxClick(d);return;}$(".dt-wholerow.sel",this).removeClass("sel");if(d.hasClass("comp_Level1")){$(".dt-wholerow:first",d).addClass("sel");}if(!a.showCheckBox){a.selectNode(d);return;}});a.el.delegate("li","mouseover",function(d){$(".dt-wholerow.hover",a.el).removeClass("hover");var c=$(".dt-wholerow:first",this);if(!c.hasClass("sel")){$(".dt-wholerow:first",this).addClass("hover");}d.stopPropagation();}).delegate("li","mouseleave",function(c){$(".dt-wholerow.hover",a.el).removeClass("hover");c.stopPropagation();});a=$.extend(a,b);return a;};YIUI.Yes_Dict=function(b){var a={_hasShow:false,el:$("<div></div>"),multiSelect:false,rootNode:null,id:"",_dropBtn:$('<div id="'+b.id+'_dropbtn"/>'),_textBtn:$('<input id="'+b.id+'_textbtn" type="text" />'),_dropView:$('<div id="'+b.id+'_dropview"/>'),$suggestView:$('<div class="dt-autovw dt-vw"/>'),checkBoxType:YIUI.Control.DICT_CKBOXTYPE_NORMAL_SELECT,independent:true,itemKey:null,dictTree:null,_resetTree:true,stateMask:YIUI.DictStateMask.Enable,needRebuild:true,enable:true,editable:true,secondaryType:0,init:function(){this._textBtn.addClass("txt").appendTo(this.el);this._dropBtn.addClass("arrow").appendTo(this.el);this._dropView.addClass("dt-vw");$(document.body).append(this._dropView);$(document.body).append(this.$suggestView);},setEditable:function(d){this.editable=d;var e=this._textBtn;if(this.editable){e.removeAttr("readonly");}else{e.attr("readonly","readonly");}},setEnable:function(e){this.enable=e;var f=this._textBtn,d=this.el;if(e){f.removeAttr("readonly");d.removeClass("ui-readonly");}else{f.attr("readonly","readonly");d.addClass("ui-readonly");}},getEl:function(){return this.el;},setMultiSelect:function(d){this.multiSelect=d;},setDictTree:function(d){this.dictTree=d;},getDictTree:function(d){return this.dictTree;},setBackColor:function(d){this.backColor=d;this._textBtn.css({"background-image":"none","background-color":d});},setForeColor:function(d){this.foreColor=d;this._textBtn.css("color",d);},setFormatStyle:function(d){this._textBtn.css(d);},setDropViewTop:function(){var g=this._textBtn;var e=this._textBtn.offset();var d=$(window).height()-e.top-this.el.height();var f=e.top+g.outerHeight();if(d<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");f="auto";d=$(window).height()-e.top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");d="auto";}if(f!="auto"){this._dropView.css("top",f+"px");this._dropView.css("bottom","auto");}if(d!="auto"){this._dropView.css("bottom",d+"px");this._dropView.css("top","auto");}this._dropView.css("width",g.outerWidth()+"px");},setDropViewLeft:function(){var g=this._textBtn;var e=this._textBtn.offset();var d=$(window).width()-e.left;var f=$(window).width()-this._dropView.outerWidth();if(d<this._dropView.outerWidth()){f="auto";d=$(window).width()-e.left-g.outerWidth();}else{f=e.left;d="auto";}if(f!="auto"){this._dropView.css("left",f+"px");this._dropView.css("right","auto");}if(d!="auto"){this._dropView.css("right",d+"px");this._dropView.css("left","auto");}},setSelValue:function(d){this.value=d;if(this._resetTree&&this.multiSelect){this.dictTree.reset();this.setDictTreeCheckedNodes();}},setDictTreeCheckedNodes:function(){if(this.multiSelect){var d={};if(this.value){$.each(this.value,function(e){var f=this.itemKey+"_"+this.oid;d[f]=this;});}this.dictTree.setCheckedNodes(d);}},getSelValue:function(){if(this.value){return this.value;}else{return null;}},setWidth:function(d){this.el.css("width",d);this._textBtn.css("width",d);this._dropBtn.css("left",this._textBtn.outerWidth()-26+"px");},setHeight:function(d){this.el.css("height",d+"px");this._textBtn.css("height",d+"px");if($.browser.isIE){this._textBtn.css("line-height",(d-3)+"px");}this._dropBtn.css("top",(this._textBtn.outerHeight()-16)/2+"px");},setValue:function(d){this.value=d;},setText:function(d){this._textBtn.val(d);},getText:function(){return this._textBtn.val();},getInput:function(){return this._textBtn;},checkDict:$.noop,hiding:$.noop,getItemKey:$.noop,showing:function(){if(!this.value){return;}if(this.multiSelect){var f=this.value;for(var g=0,d=f.length;g<d;g++){var l=f[g];this.setSelectionValue(this.getItemKey(),l);}}else{if(this.secondaryType!=YIUI.SECONDARYTYPE.CHAINDICT){$(".sel",this._dropView).removeClass("sel");this.setSelectionValue(this.getItemKey(),this.value);var j=this.value.oid;var e=$("[oid='"+j+"']",this.dictTree.el).eq(0);if(e.length>0){var h=e.offset().top-e.parent().height();if(h>0){this.dictTree.el.scrollTop(h);}var k=$(".dt-wholerow:first",e);if(!k.hasClass("sel")&&e.hasClass("comp_Level1")){k.addClass("sel");}}}}},setSelectionValue:function(e,n){var p=YIUI.DictService.getTreePath(e,n);if(p.length>0){var m=p[0];var l=m[0].oid;if(m){for(var k=0,h=m.length;k<h;k++){var o=m[k];var g=o.oid;if(k>0&&g==l){break;}var d=$("[oid='"+g+"']",this.dictTree.el);if(d.length>0){this.dictTree.expandNode(d);}}var f=$("[oid='"+n.oid+"']",this.dictTree.el);if(f.length==0){this.dictTree.clearChkNodes=true;}else{this.dictTree.checkTreeNode(f,1);}}}else{$(".dt-wholerow.sel",this._dropView).removeClass("sel");}},setSecondaryType:function(d){this.secondaryType=d;},destroy:function(){this._dropView.remove();this.$suggestView.remove();},hideDictList:function(){this._dropView.hide();this._hasShow=false;this._resetTree=false;if(this.multiSelect){this.setSelValue(this.dictTree.getCheckedValues());}else{this.setSelValue(this.value);}this._resetTree=true;$(document).off("mousedown");this.hiding();},hideSuggestView:function(){this.$suggestView.hide();this.hiding();$(document).off("mousedown");},getEditor:function(){return this._textBtn;},install:function(){var e=this;this._dropBtn.click(function(f){if(!e.enable){return;}e._textBtn.focus();if(e._hasShow){e.hideDictList();return;}e.checkDict();if(e.secondaryType==YIUI.SECONDARYTYPE.CHAINDICT){e.doLostFocus(null,true);return;}e.dictTree.expandNode(e.dictTree.rootNode);e.setDropViewTop();e.setDropViewLeft();e.showing();e._dropView.slideDown("fast");$(document).on("mousedown",function(h){var g=$(h.target);if((g.closest(e._dropView).length==0)&&(g.closest(e._dropBtn).length==0)){e.hideDictList();}});e._hasShow=true;f.stopPropagation();});this.$suggestView.delegate("li","click",function(){var g={oid:$(this).attr("oid"),itemKey:$(this).attr("itemkey"),caption:$(this).text()};var f=new YIUI.ItemData(g);e.setSelValue(f);e.hideSuggestView();});var d;this._textBtn.focus(function(){d=$(this).val();}).blur(function(f){var g=$(this).val();if(g!=d){e.doLostFocus(g);}});}};a=$.extend(a,b);a.init();var c=new YIUI.Yes_DictTree({showCheckBox:a.multiSelect,independent:a.independent,formatAsyncData:function(d){$.each(d,function(e,f){var g=f.itemKey+"_"+f.OID;f.id=g;});return d;},getNodeValue:function(e){if(e.length>0){var g="";if(e.attr("oid")>0){g=e.children("a").text();}var f={};f.oid=e.attr("oid")||0;f.itemKey=e.attr("itemKey");f.caption=g;var d=new YIUI.ItemData(f);return d;}},expandNode:function(e){if(!e){e=this.rootNode;}if(!e.attr("isLoaded")){this.callback.beforeExpand(this,e);a.getDictChildren(e);}e.children("ul").show();var d=e.children("span:first");if(d.hasClass("dt-collapse")){d.removeClass("dt-collapse").addClass("dt-expand");d.next(".dt-anchor").find(".branch").removeClass("b-collapse").addClass("b-expand");}},callback:{beforeExpand:function(d,f){if(a.multiSelect&&!a.independent&&d.indeterminatedNodes==null){var e=a.getSelValue();a.setDictTreeCheckedNodes();d.indeterminatedNodes=[];if(e&&e.length>0){a.beforeExpand(d,f);}}},onSelected:function(e,d){a.value=e.getNodeValue(d);if(a._hasShow){a.hideDictList();}},onChecked:function(e,d){}}});a.setDictTree(c);a._dropView.hide();a._textBtn.val(this.text);c.render(a._dropView);a.install();return a;};})();(function(){YIUI.Yes_DatePicker=function(b){var a={el:$("<div></div>"),dropView:$("<div class='dp-vw'></div>"),formatStr:"yyyy-MM-dd HH:mm:ss",isNoTimeZone:false,isOnlyDate:false,regional:"zh-CN",calendars:1,enable:true,editable:true,init:function(){this._input=$("<input type='text' class='txt'>").appendTo(this.el);this._btn=$("<span class='arrow'></span>").appendTo(this.el);this.initDatePicker(b.id);},getEl:function(){return this.el;},getInput:function(){return this._input;},getBtn:function(){return this._btn;},getDropView:function(){return this.dropView;},getDetailTime:function(){return this.detailTime;},setFormatStr:function(){if(this.isOnlyDate){this.formatStr="yyyy-MM-dd";}else{this.formatStr="yyyy-MM-dd HH:mm:ss";}},setRegional:function(c){this.regional=c;},setCalendars:function(c){this.calendars=c;},setOnlyDate:function(c){this.isOnlyDate=c;},setIsNoTimeZone:function(c){this.isNoTimeZone=c;},setWidth:function(c){this.el.css("width",c);this.getInput().css("width",c);this.getBtn().css({left:this.el.outerWidth()-26+"px"});this.setDropViewLeft();},setHeight:function(c){this.el.css("height",c);this.getInput().css("height",c);var d=(c-16)/2;this.getBtn().css({top:d});if($.browser.isIE){this.getInput().css("line-height",(c-3)+"px");}},setEditable:function(c){this.editable=c;var d=this.getInput();if(this.editable){d.removeAttr("readonly");}else{d.attr("readonly","readonly");}},setEnable:function(d){this.enable=d;var e=this.getInput(),c=this.el;if(d){e.removeAttr("readonly");c.removeClass("ui-readonly");}else{e.attr("readonly","readonly");c.addClass("ui-readonly");}},setValue:function(d){if(!d){return;}var c;if($.isNumeric(d)){c=new Date(parseFloat(d));}else{var e=d.split(/\W+/);if(this.isOnlyDate){c=new Date(e[0],e[1]-1,e[2]);}else{c=new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5]);}}this.text=c.Format(this.formatStr);this.getInput().val(this.text);},getText:function(){var c=this.getInput().val()||"";if(c!=""&&this.isOnlyDate){c+=" 00:00:00";}return c;},getValue:function(){if(this.getText()!=""){var d=this.getText().split(/\W+/);var c=new Date(d[0],d[1]-1,d[2],d[3]?d[3]:"00",d[4]?d[4]:"00",d[5]?d[5]:"00");if(isNaN(c)){return null;}else{return c.getTime();}}else{return null;}},initDatePicker:function(d){var c=this;this.getInput().attr("id","dateInput_"+d);this.getInput().DateTimeMask({masktype:(this.isOnlyDate?3:1)});this.getBtn().attr("id","dateImg_"+d);this.setFormatStr();this.dropView.attr("id",d+"_datepickerView");this.dropView.html("");this.dropView.DatePicker({flat:true,format:c.formatStr,date:[new Date()],current:c.getInput().val(),calendars:c.calendars,starts:7,regional:c.regional,onChange:function(g){var f=g;if(!c.isOnlyDate){var e=g.split(" ")[1];if(c.getInput().val().split(" ")[1]){e=c.getInput().val().split(" ")[1];}f=g.split(" ")[0]+" "+e;c.getInput().val(f);}else{c.getInput().val(f);c.dropView.hide();c.dropView.blur();}}});this.detailTime=$("<div class='time'></div>");if(!this.isOnlyDate){$("<button class='btn'>今天</button>").click(function(){c.getInput().val((new Date()).Format(c.formatStr));if(!c.isOnlyDate){c.setDetailTime(c.getInput().val());}else{c.dropView.hide();c.dropView.blur();}}).appendTo(this.detailTime);$("<button class='btn'>确认</button>").click(function(){c.dropView.hide();c.dropView.blur();}).appendTo(this.detailTime);$("<input/>").appendTo(this.detailTime).spinit({max:23}).data("index",0);$("<input/>").appendTo(this.detailTime).spinit({max:59}).data("index",1);$("<input/>").appendTo(this.detailTime).spinit({max:59}).data("index",2);this.detailTime.appendTo(this.dropView);}this.install();},setDetailTime:function(d){var c=d.split(" ");if(c.length<2){return;}var f=d.split(" ")[1].split(":");for(var e=0;e<f.length;e++){$("input",this.detailTime).eq(e).val(f[e]);}},clearDateTime:function(){$("input",this.detailTime).each(function(){$(this).val(0);});},setDropViewTop:function(){var f=this.getInput();var d=this.getInput().offset();var c=$(window).height()-d.top-this.el.height();var e=d.top+f.outerHeight();if(c<this.dropView.outerHeight()){this.dropView.addClass("toplst");this.el.addClass("toplst");e=d.top-this.dropView.outerHeight();}else{this.dropView.removeClass("toplst");this.el.removeClass("toplst");}if(e!="auto"){this.dropView.css("top",e+"px");}},setDropViewLeft:function(){var f=this.getInput();var d=this.getInput().offset();var c=$(window).width()-$(this.getInput()).offset().left;var e=$(window).width()-this.dropView.outerWidth();if(c<this.dropView.outerWidth()){e="auto";c=$(window).width()-d.left-f.outerWidth();}else{e=d.left;c="auto";}if(e!="auto"){this.dropView.css("left",e+"px");this.dropView.css("right","auto");}if(c!="auto"){this.dropView.css("right",c+"px");this.dropView.css("left","auto");}},install:function(){var c=this;this.getBtn().click(function(g){if(!c.enable){return;}if($("#"+c.dropView[0].id).length<=0){$(document.body).append(c.dropView);}if(!c.dropView.is(":hidden")){c.dropView.hide();return;}var e=c.dropView.find("tr:first").find("table");for(var d=0;d<e.length;d++){if(!e.eq(d).hasClass("datepickerViewDays")){e.eq(d).attr("class","datepickerViewDays");}}if(c.getInput().val()){c.dropView.DatePickerSetDate(c.getInput().val(),true);if(!c.isOnlyDate){c.setDetailTime(c.getInput().val());}}else{c.dropView.DatePickerSetDate((new Date()).Format(c.formatStr));c.clearDateTime();}var f=c.calendars*210+$(".datepickerSpace",c.dropView).children().width()*(c.calendars-1);if(!c.isOnlyDate){f+=160;}c.dropView.css({"min-width":"210px","min-height":"205px",width:f});c.dropView.css("z-index",$.getZindex(c.getInput())+1);$(".datepicker",c.dropView).css({width:c.calendars*210,height:c.dropView.height()});c.setDropViewTop();c.setDropViewLeft();c.dropView.slideDown("fast");$(document).on("mousedown.datePicker",function(j){var h=$(j.target);if((h.closest(c.dropView).length==0)&&(h.closest(c.getInput()).length==0)&&(h.closest(c.getBtn()).length==0)&&!c.dropView.is(":hidden")){c.dropView.hide();c.dropView.blur();$(document).off("mousedown.datePicker");}});g.stopPropagation();});$("input",c.getDetailTime()).bind("blur",function(h){if(c.getInput().val()){var d=c.getInput().val();var f=d.substring(0,d.split(" ")[0].length+1);var g=d.split(" ")[1].split(":");if(h.target.value.length==1){g[$(this).data("index")]="0"+h.target.value;}else{g[$(this).data("index")]=h.target.value;}c.getInput().val(f+g.join(":"));}});}};a=$.extend(a,b);if(!b.isPortal){a.init();}return a;};})();(function(){YIUI.Yes_Combobox=function(b){var a={_hasShow:false,el:$("<div></div>"),_textBtn:$('<input type="text" />'),_dropBtn:$("<div/>"),_dropView:$("<div/>"),$suggestView:$("<div/>"),init:function(){this._textBtn.addClass("txt").appendTo(this.el);this._dropBtn.addClass("arrow").appendTo(this.el);this._dropView.addClass("cmb-vw").appendTo($(document.body));this.$suggestView.addClass("cmb-autovw cmb-vw").appendTo($(document.body));},items:null,multiSelect:false,sourceType:YIUI.COMBOBOX_SOURCETYPE.ITEMS,editable:true,enable:true,getEl:function(){return this.el;},setEditable:function(c){this.editable=c;var d=this._textBtn;if(this.editable){d.removeAttr("readonly");d.removeAttr("unselectable");d.removeClass("unsel");}else{d.attr("readonly","readonly");d.attr("unselectable","on");d.addClass("unsel");}},setEnable:function(d){this.enable=d;var e=this._textBtn,c=this.el;if(d){e.removeAttr("disabled");c.removeClass("ui-readonly");}else{e.attr("disabled","disabled");c.addClass("ui-readonly");}},setFormatStyle:function(c){this._textBtn.css(c);},setDropViewTop:function(){var f=this._textBtn;var d=this._textBtn.offset();var c=$(window).height()-d.top-this.el.height();var e=d.top+f.outerHeight();if(c<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");e="auto";c=$(window).height()-$(this._textBtn).offset().top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");c="auto";}if(e!="auto"){this._dropView.css("top",e+"px");this._dropView.css("bottom","auto");}if(c!="auto"){this._dropView.css("bottom",c+"px");this._dropView.css("top","auto");}},setDropViewLeft:function(){var f=this._textBtn;var d=this._textBtn.offset();var c=$(window).width()-$(this._textBtn).offset().left;var e=$(window).width()-this._dropView.outerWidth();if(c<this._dropView.outerWidth()){e="auto";c=$(window).width()-d.left-f.outerWidth();}else{e=d.left;c="auto";}if(e!="auto"){this._dropView.css("left",e+"px");this._dropView.css("right","auto");}if(c!="auto"){this._dropView.css("right",c+"px");this._dropView.css("left","auto");}this._dropView[0].style.width=f.outerWidth()+"px";},getItemCaption:function(f){if(f==null){return"";}var d=this._textBtn.val();var c=new Array();c[0]=f;if(this.multiSelect){c=f.split(",");}var d=new Array();for(var e in c){for(var g in this.items){if(c[e]==this.items[g].value){d.push(this.items[g].caption);break;}}}return d.join(",");},setWidth:function(c){this.el.css("width",c+"px");this._textBtn.css("width",c+"px");this._dropBtn.css({left:this._textBtn.outerWidth()-26+"px"});},setHeight:function(c){this.el.css("height",c+"px");this._textBtn.css("height",c+"px");if($.browser.isIE){this._textBtn.css("line-height",(c-3)+"px");}this._dropBtn.css({top:(this._textBtn.outerHeight()-16)/2+"px"});},destroy:function(){this._dropView.remove();this.$suggestView.remove();},getItems:function(){return this.items;},hiding:$.noop,hideComboList:function(){this._dropView.hide();this._hasShow=false;$(document).off("mousedown");this.hiding();},setItems:function(e){if(e==null){e=[];}this.items=e;var d=$("<ul/>"),g;this._dropView.html(d);for(var f=0,c=e.length;f<c;f++){var h=e[f].value==undefined?"":e[f].value;if(this.multiSelect){g=$('<li><input type="checkbox"  itemValue="'+h+'"/><span>'+e[f].caption+"</span></li>");}else{g=$('<li itemValue="'+h+'">'+(e[f].caption||"")+"</li>");if(h==""){g.addClass("empty");}if(this.value&&this.value==e[f].value){g.addClass("sel");this._selectedLi=g;}}d.append(g);}},checkItem:function(g){if(this.multiSelect&&g){var c=g.split(",");for(var e in c){var d=this._dropView.find('input[type="checkbox"]');for(var f=0;f<d.length;f++){if(c[e]==$(d[f]).attr("itemValue")){d[f].checked=true;break;}}}}},setSelValue:function(c){this.value=c;},getSelValue:function(){return this.value;},setText:function(c){this.text=c;this._textBtn.val(this.text);},getText:function(){return this._textBtn.val();},install:function(){var c=this;this._dropBtn.click(function(g){if(!c.enable){return;}c._textBtn.focus();if(c._hasShow){c.hideComboList();return;}c.getItems();c.checkItem(c.getSelValue());c.setDropViewTop();c.setDropViewLeft();c._dropView.show();c._dropView.children("ul").css("width",c._dropView[0].scrollWidth-2);if(c._selectedLi&&(c._selectedLi.attr("itemValue")==c.getSelValue())){var d=c._dropView.outerHeight()-c._dropView[0].clientHeight;var f=c._selectedLi.position().top-c._dropView.height()+c._selectedLi.height()+d;c._dropView.scrollTop(f<0?0:f);}else{$(".sel",c._dropView).removeClass("sel");var h=$("[itemValue='"+c.getSelValue()+"']");if(h.length>0&&!h.hasClass("empty")){c._selectedLi=h;h.addClass("sel");}}$(document).on("mousedown",function(k){var j=$(k.target);if((j.closest(c._dropView).length==0)&&(j.closest(c._dropBtn).length==0)){c.hideComboList();}});c._hasShow=true;g.stopPropagation();});this._dropView.delegate("li","mouseup",function(f){if(c.multiSelect){return;}if(c._selectedLi){c._selectedLi.removeClass("sel");}if(!$(this).hasClass("empty")){$(this).addClass("sel");c._selectedLi=$(this);}else{c._selectedLi=null;}var d=$(f.target).attr("itemValue");c.setSelValue(d);c._textBtn.val($(f.target).text());c.hideComboList();});this.$suggestView.delegate("li","mouseup",function(f){var d=$(f.target).attr("itemValue");c.setSelValue(d);c._textBtn.val($(f.target).text());c.$suggestView.hide();c.hiding();c._selectedLi=$("li[itemvalue="+d+"]",c._dropView).addClass("sel");$(document).off("mousedown");});if(this.multiSelect){this._dropView.delegate("input[type='checkbox']","click",function(h){var f=c._dropView.find('input[type="checkbox"]');var d=f.filter(":checked").map(function(){return $(this).next().html();}).get().join(",");var g=f.filter(":checked").map(function(){return $(this).attr("itemValue");}).get().join(",");c._textBtn.val(d);c.setSelValue(g);});}}};a=$.extend(a,b);if(!b.isPortal){a.init();}a.install();return a;};})();(function(){YIUI.Yes_Dialog=function(n){var m={el:$("<div></div>"),msg:"是否关闭",msgType:YIUI.Dialog_MsgType.YES_NO,items:[]};n=$.extend(m,n);var f=n.msgType,k;var c={key:"OK",caption:"确定"};var h={key:"YES",caption:"是"};var g={key:"NO",caption:"否"};var e={key:"Cancel",caption:"取消"};switch(f){case YIUI.Dialog_MsgType.DEFAULT:k=[c];break;case YIUI.Dialog_MsgType.YES_NO:k=[h,g];break;case YIUI.Dialog_MsgType.YES_NO_CANCEL:k=[h,g,e];break;}n.items=k;var l=n.el.attr("id","close_dialog");var d={};var a=function(w,t,o,y){var v=new YIUI.Control.Label({metaObj:{x:1,y:1,colspan:2,topMargin:0,visible:true},caption:n.msg});var x,p;var u=new YIUI.Panel.GridLayoutPanel({metaObj:{rowGap:5,columnGap:2},widths:[5,"50%","50%"],minWidths:["-1","-1","-1"],heights:[5,"pref",5,25,5]});u.add(v);var s=new YIUI.Panel.FlexFlowLayoutPanel({metaObj:{x:1,y:3,colspan:2,visible:true,cssClass:"dialog_btns"}});for(var q=0,r=k.length;q<r;q++){x=k[q];p=new YIUI.Control.Button({metaObj:{key:x.key,width:60,height:25,left:q*5},caption:x.caption,listeners:null,value:x.caption});d[x.key]=p;s.add(p);}u.add(s);return u;};var j=a();var b={el:l,show:function(){l.modalDialog(null,{title:n.title,showClose:false,width:"auto",height:"100px"});j.render(l.dialogContent());var p;for(var o in d){p=d[o];p.el.attr("key",o);p.el.addClass("dlg-btn");p.el.unbind();}var r=($(window).width()/2-l.width()/2)+"px";var q=($(window).height()/2-l.height()/2)+"px";l.css({left:r,top:q});},parseOpt:function(p){var o=-1;if(p==YIUI.Dialog_Btn.STR_YES){o=YIUI.Dialog_Btn.YES_OPTION;}else{if(p==YIUI.Dialog_Btn.STR_NO){o=YIUI.Dialog_Btn.NO_OPTION;}else{if(p==YIUI.Dialog_Btn.STR_CANCEL){o=YIUI.Dialog_Btn.CANCEL_OPTION;}else{if(p==YIUI.Dialog_Btn.STR_OK){o=YIUI.Dialog_Btn.OK_OPTION;}}}}return o;},close:function(){l.close();}};return b;};})();YIUI.ComponentMgr=function(){var c={};var b={};var a={register:function(d){c[d.id]=d;},unregister:function(d){c[d.id]=null;},get:function(d){return c[d];},all:c,isRegistered:function(d){return b[d]!==undefined;},registerType:function(e,d){b[e]=d;d.type=e;},eachType:function(e){if($.isFunction(e)){for(var d in b){e(d,b[d]);}}},create:function(d,e){if(!b[d.tagName]){YIUI.ViewException.throwException(YIUI.ViewException.NO_COMPONENT,d.tagName);}return d.render?d:new b[d.tagName||e](d);}};return a;}();YIUI.reg=YIUI.ComponentMgr.registerType;YIUI.create=YIUI.ComponentMgr.create;YIUI.get=YIUI.ComponentMgr.get;YIUI.Component=YIUI.extend({autoEl:"<div></div>",editable:true,enable:true,visible:true,width:-1,height:-1,required:false,format:null,listeners:null,error:null,errorInfo:{},active:null,buddyKey:null,metaObj:{},buddy:false,init:function(a){$.extend(this,a);this.getId();this.events=this.events||{};if(this.listeners){this.addListener(this.listeners);delete this.listeners;}this.lastSize={width:-1,height:-1};this.lastPosition={top:-1,left:-1};this.lastFontSize={fontSize:-1};},setWidth:function(b){if(!b||!$.isNumeric(b)||b<=0){return;}if(!this.rendered){this.width=b;return;}var a=this.lastSize;if(a.width!==b){a.width=b;this.onSetWidth(b);}},onSetWidth:function(a){this.el.css("width",a);},getWidth:function(){if(this.rendered){return this.getOuterEl().outerWidth();}return this.width;},setHeight:function(a){if(!a||!$.isNumeric(a)||a<=0){return;}if(!this.rendered){this.height=a;return;}var b=this.lastSize;if(b.height!==a){b.height=a;this.onSetHeight(a);}},onSetHeight:function(a){this.el.css("height",a);},getHeight:function(){if(this.rendered){return this.getOuterEl().outerHeight();}return this.height;},getInnerWidth:function(){return this.el.width();},getInnerHeight:function(){return this.el.height();},setLeft:function(b){if(!b||!$.isNumeric(b)||b<=0){return;}var a=this.lastPosition;if(a.left!==b){a.left=b;if(this.rendered){this.el.css("position","absolute");this.onSetLeft(b);}else{this.left=b;}}},onSetLeft:function(a){this.el.css("left",a);},setTop:function(b){if((!b&&b!=0)||b=="auto"){return;}var a=this.lastPosition;if(a.top!==b){a.top=b;if(this.rendered){this.el.css("position","absolute");this.onSetTop(b);}else{this.top=b;}}},onSetTop:function(a){this.el.css("top",a);},setPadding:function(a){this.el.css("padding",a);},setLeftPadding:function(a){this.el.css("padding-left",a);},setRightPadding:function(a){this.el.css("padding-right",a);},setTopPadding:function(a){this.el.css("padding-top",a);},setBottomPadding:function(a){this.el.css("padding-bottom",a);},setMargin:function(a){this.el.css("margin",a);},setLeftMargin:function(a){this.el.css("margin-left",a);},setRightMargin:function(a){this.el.css("margin-right",a);},setTopMargin:function(a){this.el.css("margin-top",a);},setBottomMargin:function(a){this.el.css("margin-bottom",a);},setBorderColor:function(a){this.el.css("border-color",a);},setBorderRadius:function(a){this.el.css("border-radius",a);},setVAlign:function(a){this.vAlign=a;switch(this.vAlign){case YIUI.HAlignment.TOP:this.el.css("vertical-align","top");break;case YIUI.VAlignment.CENTER:this.el.css("vertical-align","middle");break;case YIUI.VAlignment.BOTTOM:this.el.css("vertical-align","bottom");break;}},setHAlign:function(a){this.hAlign=a;},getId:function(){if(this.ofFormID){return this.id||(this.id=this.ofFormID+"_"+this.key);}else{return this.id||YIUI.allotId();}},setColumnKey:function(a){this.columnKey=a;},setTableKey:function(a){this.tableKey=a;},setDefaultFormulaValue:function(a){this.defaultFormulaValue=a;},getColumnKey:function(){return this.columnKey;},getTableKey:function(){return this.tableKey;},getDefaultFormulaValue:function(){return this.defaultFormulaValue;},dependedValueChange:$.noop,setEditable:function(a){this.editable=a;},setEnable:function(b){this.enable=b;var c=this.getEl(),a=this.getOuterEl();if(this.enable){c.removeAttr("readonly");a.removeClass("ui-readonly");}else{c.attr("readonly","readonly");a.addClass("ui-readonly");}},setFocusManager:function(a){this.focusManager=a;},setTabIndex:function(a){this.tabIndex=a;},getTabIndex:function(){return this.tabIndex;},isEditable:function(){return this.editable;},isEnable:function(){return this.enable;},setVisible:function(e){this.visible=e;var a=this.getOuterEl();if(this.getMetaObj().buddyKey){var c=YIUI.FormStack.getForm(this.ofFormID);var d=c.getComponent(this.getMetaObj().buddyKey);if(d){if(d.rendered){d.setVisible(e);}else{d.getMetaObj().visible=e;}}}if(this.visible){a.removeClass("ui-hidden");}else{a.addClass("ui-hidden");}var b=this.ownerCt;if(b){b.reduceVisible(e,this);}},isPanel:function(){return this.isPanel;},isVisible:function(){return this.visible;},setTip:function(a){if(this.getMetaObj().tip){a=this.getMetaObj().tip;}this.el.attr("title",a);},getEl:function(){return this.el;},getOuterEl:function(){return this.getEl();},needClean:function(){return true;},render:function(a){this.doRender(a);if(this.hasLayout){var e,c,d=this.container.width(),b=this.container.height();if(this.width==-1){e=$.getReal("100%",d);}else{e=$.getReal(this.width,d);}if(this.height==-1){c=$.getReal("100%",b);}else{c=$.getReal(this.height,b);}this.doLayout(e,c);}},doRender:function(a){if(!this.rendered&&this.beforeRender()!==false){this.rendered=true;this.container=a?$(a):(this.container?$(this.container):$.getBody());this.onRender(this.container);this.onRenderChildren();this.afterRender();this.install();}},beforeRender:$.noop,setError:function(b,d){this.errorInfo={error:b,msg:d};var c=this.getEl(),a=this.el;if(this.errorInfo.error){a.addClass("ui-error");a.attr("title",d);$('<span class="error-icon" />').appendTo(a);}else{a.removeClass("ui-error");a.attr("title","");$(".error-icon",a).remove();}},onRender:function(a){var b=this.el;if(b&&(!a||a.length==0)){this.container=a=$(b).parent();}if(!b&&this.autoEl){if($.isString(this.autoEl)){b=$(this.autoEl);}}if(b){if(!b.attr("id")){b.attr("id",this.getId());}this.el=$(b);if(this.el.parents("body")[0]!=$.getBody()[0]){a.append(this.el);}}if(this.errorInfo){this.setError(this.errorInfo.error,this.errorInfo.msg);}this.setColumnKey(this.getMetaObj().columnKey);this.setTableKey(this.getMetaObj().tableKey);if(this.getMetaObj().defaultFormulaValue){this.setDefaultFormulaValue(this.getMetaObj().defaultFormulaValue);}this.setKey(this.getMetaObj().key);this.getMetaObj().buddy&&this.setBuddy(this.getMetaObj().buddy);},setBuddy:function(a){this.buddy=a;},isBuddy:function(){return this.buddy;},onRenderChildren:$.noop,doLayout:$.noop,setKey:function(a){this.key=a;},setBackColor:function(a){this.backColor=a;this.getEl().css({"background-image":"none","background-color":a});},setForeColor:function(a){this.foreColor=a;this.getEl().css("color",a);},setStyle:function(a){if(!a.font){return;}a=a.font;var b={};a.name&&(b["font-family"]=a.name);a.size&&(b["font-size"]=a.size);a.bold&&(b["font-weight"]="bold");a.italic&&(b["font-style"]="italic");this.setFormatStyle(b);},setFormatStyle:function(a){this.getEl().css(a);},setRequired:function(a){if(a){this.getOuterEl().addClass("ui-required");}else{this.getOuterEl().removeClass("ui-required");}},isRequired:function(){return this.getMetaObj().required&&this.isNull();},setCssClass:function(a){this.el.addClass(a);},getMetaObj:function(){return this.metaObj;},afterRender:function(){var a=this.getMetaObj();a.required&&this.setRequired(this.isNull());(a.enable!=undefined)&&this.setEnable(a.enable);(a.editable!=undefined)&&this.setEditable(a.editable);(a.visible!=undefined)&&this.setVisible(a.visible);a.backColor&&this.setBackColor(a.backColor);a.foreColor&&this.setForeColor(a.foreColor);this.format&&this.setStyle(this.format);this.setTip(a.tip);a.cssClass&&this.setCssClass(a.cssClass);a.padding&&this.setPadding(a.padding);a.leftPadding&&this.setLeftPadding(a.leftPadding);a.rightPadding&&this.setRightPadding(a.rightPadding);a.topPadding&&this.setTopPadding(a.topPadding);a.bottomPadding&&this.setBottomPadding(a.bottomPadding);this.setLeft(a.left);this.setTop(a.top);a.borderColor&&this.setBorderColor(a.borderColor);a.borderRadius&&this.setBorderRadius(a.borderRadius);a.vAlign&&this.setVAlign(a.vAlign);a.hAlign&&this.setHAlign(a.hAlign);},setBox:function(){var d=this.ownerCt,c,a;if(d){if((d.type==YIUI.CONTROLTYPE.TABPANEL&&d.items.length>=1)||(d.tagName=="tabcontainer"&&d.items.length>=1)||d.items.length==1){if(this.width==-1){this.width="100%";}if(this.height==-1){this.height="100%";}}}if(d){c=d.getValidWidth();a=d.getValidHeight();this.setWidth($.getReal(this.width,c));this.setHeight($.getReal(this.height,a));}else{var b=this.el.parent();c=b.width();a=b.height();this.setWidth(this.width);this.setHeight(this.height);}},focus:function(){this.el.focus();},needTip:function(){return true;},install:function(){var a=this;},addListener:function(a,d,c){if($.isObject(a)){var b=a,g;for(var h in b){g=b[h];this.addListener(h,g.fn||g,g.scope);}}else{var f=this.events[a]=this.events[a]||new YIUI.Event(a,this);f.addListener(d,c);}},fireEvent:function(b){var c=this.events[b];if(c){var a=$.makeArray(arguments);a.shift();c.fire.apply(c,a);}},bind:function(a,b,d,c){c=c||this;var e=a?$(a,this.el):this.el;e.bind(b,function(f){d?d.call(c,f):c.fireEvent(b,f);});},destroy:function(){if(this.isDestroyed){return;}if(this.beforeDestroy()!==false){if(this.rendered){this.el.destroy();delete this.el;delete this.listeners;}this.afterDestroy();this.isDestroyed=true;}},beforeDestroy:$.noop,getNoTabOrderComps:$.noop,afterDestroy:function(){for(var a in this){if(this.hasOwnProperty(a)){delete this[a];}}},diff:function(a,b){this.callAttrMethod(a,b);},callAttrMethod:function(a,d){var b=[];var c=this;$.each(a,function(e,f){var g=c["set"+$.capitalizeFirst(e)];if(g){g.call(c,f);}else{if(d){d.call(c,e,f);}else{}}});},initDefaultValue:function(a){this.el=a.el;this.key=a.key;this.type=a.el.attr("xtype");this.container=a.container;this.ofFormID=a.formID;this.el.attr("id",this.id);}});YIUI.reg("component",YIUI.Component);YIUI.Event=function(b,a){this.name=b;this.owner=a;this.listeners=[];};YIUI.Event.prototype={addListener:function(b,a){var c={fn:b,scope:a||this.owner};this.listeners.push(c);},removeListener:function(c,b){var a=this.indexOfListener(c,b);if(a!=-1){this.listeners.splice(a,1);return true;}return false;},indexOfListener:function(d,c){var a=this.owner,b=-1;$.each(this.listeners,function(e){if(this.fn==d&&(this.scope==c||this.scope==a)){b=e;return false;}});return b;},fire:function(){var b=$.makeArray(arguments),a=this.owner;$.each(this.listeners,function(c){if(this.fn.apply(this.scope||window,b)===false){return false;}});}};var ConditionParas=ConditionParas||{};(function(){ConditionParas=function(){var a={condParas:[],condFomKey:"",setCondFormKey:function(b){this.condFomKey=b;},getCondFormKey:function(){return this.condFomKey;},add:function(b){this.condParas.push(b);},get:function(b){return this.condParas[b];},size:function(){return this.condParas.length;},getCondParas:function(){return{condParas_items:this.condParas};},clear:function(){this.condParas.length=0;}};return a;};ConditionItem=function(){var a={key:"",type:-1,condSign:-1,group:"",groupHead:false,groupTail:false,targetTableKey:"",tableKey:"",columnKey:"",value:"",setKey:function(b){this.key=b;},getKey:function(){return this.key;},setType:function(b){this.type=b;},getType:function(){return this.type;},setCondSign:function(b){this.condSign=b;},getCondSign:function(){return this.condSign;},setGroup:function(b){this.group=b;},getGroup:function(){return this.group;},setGroupHead:function(b){this.groupHead=b;},isGroupHead:function(){return this.groupHead;},setGroupTail:function(b){this.groupTail=b;},isGroupTail:function(){return this.groupTail;},setTargetTableKey:function(b){this.targetTableKey=b;},getTargetTableKey:function(){return this.targetTableKey;},setTableKey:function(b){this.tableKey=b;},getTableKey:function(){return this.tableKey;},setColumnKey:function(b){this.columnKey=b;},getColumnKey:function(){return this.columnKey;},setValue:function(b){this.value=b;},getValue:function(){return this.value;}};return a;};})();YIUI.Control=YIUI.extend(YIUI.Component,{value:"",backupValue:"",text:"",checkRule:null,trigger:null,handler:YIUI.Handler,behavior:YIUI.BaseBehavior,listeners:{click:function(){this.handler&&this.handler.doOnClick(this);},change:function(){var a=this.getValue();this.handler&&this.handler.doValueChanged(this,a,true,true);}},isNull:function(){return $.isEmptyObject(this.value)?true:false;},commitValue:function(){if(this.changing){if(this.handler){this.handler.doValueChanged(this,this.getValue(),true,true);}}this.changing=false;},rollbackValue:function(){this.changing=false;this.setValue(this.backupValue,false,false,true,false);},setValue:function(f,c,g,e,a){if(!this.behavior){return false;}this.backupValue=this.value;var d=this;var j={oldVal:this.value,newVal:f};j=this.getCheckOpts(j);var h=function(k){d.checkEnd(k);};var b=this.behavior.checkAndSet(j,h);if(b){this.doChanged(c,g,e,a);}return b;},getCheckOpts:function(a){a=$.extend((a||{}),this.getMetaObj());return a;},checkEnd:function(a){this.value=a;this.caption=a;},doChanged:function(d,c,b,a){if(!b&&this.handler){if(a){if(this.handler.validated(this,this.getValue())){this.handler.doValueChanged(this,this.getValue(),d,c);}else{if(this.handler.hasChanging(this)){this.changing=true;this.handler.changing(this,this.getValue());}else{this.rollbackValue();}}}else{this.handler.doValueChanged(this,this.getValue(),d,c);}}this.setTip(null);},getValue:function(){return this.value;},setText:function(a){this.setValue(a);},getText:function(){return this.getValue();},setRequired:function(a){this.base(a);if(a){this.getEl().placeholder("-必须填写-");var b=this;this.bind(null,"keyup",function(){if(b.isNull()){this.getOuterEl().addClass("ui-required");}else{this.getOuterEl().removeClass("ui-required");}});this.bind(null,"blur",function(){if(b.isNull()){this.getOuterEl().addClass("ui-required");}else{this.getOuterEl().removeClass("ui-required");}});}}});YIUI.reg("control",YIUI.Control);YIUI.Control.Toolbar=YIUI.extend(YIUI.Control,{handler:YIUI.ToolBarHandler,height:36,setEnable:function(a){this.base(true);},renderMenu:function(){var h=this.ul;if(typeof h!="undefined"){h.attr("id",this.id+"_toolbar").addClass("tbr-ul");var f=h.children("li").addClass("tbr-item");var k=f.children("a").addClass("tbr-btn");k.each(function(){if($(this).attr("icon")){$("<span class='icon'></span>").css("background-image","url(Resource/"+$(this).attr("icon")+")").appendTo($(this));}});var c=$("ul",f).addClass("tbr-vw").attr("tabindex","0");$("li",c).addClass("dp-item").attr("tabindex","-1");}for(var e=0,g=this.ul.children().length;e<g;e++){var f=this.ul.children().eq(e);var l=this.items[f[0].index];f[0].item=l;if(l.items){for(var d=0,b=$("ul",f).children().length;d<b;d++){var a=$("ul",f).children().eq(d);a[0].item=l.items[a[0].index];}}}},onSetWidth:function(a){this.base(a);this.ul.width(a);$("li",this.ul).removeClass("hide");var d=this.ul.children("[style='display: block;']"),c;if(d.length>0&&d.last().position().top>d.first().position().top){this._dropBtn.addClass("show");var f=this.dropView.empty();var e=$("<ul></ul>").appendTo(f);e.addClass("tbr-ul");f.css("top",(this.el.offset().top+this.el.outerHeight())+"px");f.css("z-index",$.getZindex(this._dropBtn)+1);for(var h=0,l=d.length;h<l;h++){c=d.eq(h);if(c.position().top>d.first().position().top){var k=c.clone();c.addClass("hide");e.append(k);k[0].item=c[0];var m=c.find("li.dp-item");if(m.length>0){for(var g=0,b=m.length;g<b;g++){k.find("li.dp-item")[g].item=m[g];}}}}}else{this._dropBtn.removeClass("show");this.dropView&&this.dropView.children().remove();}},onSetHeight:$.noop,diff:function(a){this.items=a["items"];this.repaint();},initDefaultValue:function(e){this.base(e);this.ul=e.el.children("ul");var d=this.el.find("li"),b,g,c=[];for(var f=0,a=d.length;f<a;f++){b=d.eq(f);g={key:b.attr("key"),text:b.children("a").text().trim()};c.push(g);}this.items=c;},onRender:function(a){this.base(a);this.el.addClass("ui-tbr");this.ul=this.renderItems(this.el,this.items);this._dropBtn=$("<span class='dp-btn'></span>").appendTo(this.el);this.dropView=$("<div class='tbr-dpvw'></div>").appendTo($(document.body));this.renderMenu();},repaint:function(){this.ul.remove();this.ul=this.renderItems(this.el,this.items);this.renderMenu();},renderItems:function(f,e){var d=f.children("ul");if(d.length==0){d=$("<ul></ul>").appendTo(f);}var j=this;if(e&&e.length>0){var h,g,b;for(var a=0,c=e.length;a<c;a++){h=e[a];g=$("<li></li>").appendTo(d);g.css({display:(h.visible?"block":"none")});g.key=h.key;g[0].index=a;b=$("<a></a>").appendTo(g);if(h.icon){b.attr("icon",h.icon);b.addClass("pri-icon");}$("<span class='txt'/>").html(h.caption).appendTo(b);if(!h.enable||!j.enable){g.addClass("ui-readonly");}if($.isArray(h.items)){if(h.style.toLowerCase()=="splitbutton"){g.addClass("sp-btn");b.addClass("btn-left");$("<a><span class='arrow'></span></a>").addClass("btn-right").appendTo(g);}else{if(h.style.toLowerCase()=="dropdownbutton"){g.addClass("dpd-btn");$("<span class='arrow'></span>").appendTo(b);}}this.renderItems(g,h.items);}}}return d;},setItemVisible:function(e,f){var c=$("li",this.el);for(var d=0,b,a=c.length;d<a;d++){b=c[d];if(b.item.key==e){$(b).css({display:(f?"block":"none")});break;}}},setItemEnable:function(f,d){var c=$("li",this.el);for(var e=0,b,a=c.length;e<a;e++){b=c[e];if(b.item.key==f){d?$(b).removeClass("ui-readonly"):$(b).addClass("ui-readonly");break;}}},beforeDestroy:function(){this.dropView.remove();},needTip:function(){return false;},install:function(){var a=this;a.el.delegate("li","click",function(b){var c=$(this);if(c.hasClass("ui-readonly")){return;}if(c.hasClass("dpd-btn")){c.toggleClass("show");}else{if(c.hasClass("sp-btn")&&($(b.target).hasClass("btn-right")||$(b.target).hasClass("arrow"))){c.toggleClass("show");}else{a.item=this.item;a.handler.doOnClick(a);b.stopPropagation();}}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest($("ul",c)).length==0)&&(d.closest(c).length==0)){c.removeClass("show");}});});a.dropView.delegate("li","click",function(b){var c=$(this);if(c.hasClass("ui-readonly")){return;}if(c.hasClass("dpd-btn")){c.toggleClass("show");}else{if(c.hasClass("sp-btn")&&($(b.target).hasClass("btn-right")||$(b.target).hasClass("arrow"))){c.toggleClass("show");}else{a.dropView.removeClass("show");a.handler.doOnClick(a);b.stopPropagation();}}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest($("ul",a.dropView)).length==0)&&(d.closest(a.dropView).length==0)){a.dropView&&a.dropView.removeClass("show");}});});this._dropBtn.click(function(){var b=a.dropView;b.css("right",($(window).width()-a.el.offset().left-a.el.outerWidth())+"px");b.css("top",(a.el.offset().top+a.el.outerHeight())+"px");b.width($(this).outerWidth()+$(this).prev(".btn-left").outerWidth());b.toggleClass("show");$(document).on("mousedown",function(d){var c=$(d.target);if((c.closest($("ul",b)).length==0)&&(c.closest(b).length==0)&&(c.closest(a._dropBtn).length==0)){b&&b.removeClass("show");}});});this.el.find("a.tbr-btn").mouseover(function(){!$(this.parentElement).hasClass("ui-readonly")&&$(this).addClass("hover");});this.el.find("a.tbr-btn").mouseleave(function(){!$(this.parentElement).hasClass("ui-readonly")&&$(this).removeClass("hover");});}});YIUI.reg("toolbar",YIUI.Control.Toolbar);(function(c){var b=1;function a(){return"treemenubar_node_"+b++;}YIUI.Component.TreeMenuBar=YIUI.extend(YIUI.Component,{nodes:null,theme:"Orange",onRender:function(h){this.base(h);this.el.addClass("treemenubar");if(this.nodes){var f=this.nodes,l,e,k;for(var g=0,d=f.length;g<d;g++){l=f[g];l.id=l.id||a();if(!e){e=l;}if(l.pId!=e.id){e=l;var j=c('<ul class="group"><li>'+l.name+"</li><ul></ul></ul>").appendTo(this.el);k=c(j.children()[1]);}else{k.append(c("<li>"+l.name+"</li>"));}}this.el.treemenubar({header:"> ul > li",collapsible:true,heightStyle:"content"});}}});YIUI.reg("treemenubar",YIUI.Component.TreeMenuBar);})(jQuery);YIUI.DataBinding=YIUI.extend({tableKey:"",columnKey:"",init:function(a,b){this.tableKey=a;this.columnKey=b;},setTableKey:function(a){this.tableKey=a;},getTableKey:function(){return this.tableKey;},setColumnKey:function(a){this.columnKey=a;},getColumnKey:function(){return this.columnKey;}});YIUI.Control.Button=YIUI.extend(YIUI.Control,{autoEl:"<button></button>",handler:YIUI.ButtonHandler,behavior:YIUI.ButtonBehavior,icon:null,setIcon:function(a){this.icon=a;this.button.setIcon(a);},needClean:function(){return false;},setTip:function(a){var a=this.value;this.base(a);},setValue:function(b,d,a){var c=this.base(b,d,a);this.button.getTextButton().html(b);return c;},setEnable:function(a){this.enable=a;this.button.setEnable(a);},setFormatStyle:function(a){this.cssStyle=a;this.button.getTextButton().css(a);},onSetWidth:function(a){this.button.setWidth(a);},onSetHeight:function(a){this.button.setHeight(a);},onRender:function(a){this.base(a);var b=this;this.button=new YIUI.Yes_Button({el:b.el});this.el.addClass("ui-btn");this.button.getTextButton().html(this.value);this.getMetaObj().icon&&this.setIcon(this.getMetaObj().icon);},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());if(a.clickContent){this.clickContent=a.clickContent;}var b=this;this.button=new YIUI.Yes_Button({el:b.el,isPortal:true});this.install();},install:function(){var a=this;a.el.click(function(b){if(a.enable){a.handler.doOnClick(a);}});a.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("button",YIUI.Control.Button);YIUI.Control.RichEditor=YIUI.extend(YIUI.Control,{autoEl:"<textarea></textarea>",editor:null,shadow:null,_input:null,value:null,required:false,handler:YIUI.RichEditorHandler,behavior:YIUI.RichEditorBehavior,checkEnd:function(a){this.value=a;if(this.getEl()){this._input.html(a);}},getValue:function(){var a=this._input.html();return a;},setEnable:function(a){this.base(a);if(a){this.shadow.hide();}else{this.shadow.show();}},setVisible:function(a){this.base(a);if(!a){this.editor.$editorContainer.css("display","none");}else{this.editor.$editorContainer.css("display","block");}},onSetHeight:function(a){this.getOuterEl().css("height",a);var b=this.editor.$btnContainer.height();this.editor.$txtContainer.css("height",a-b-3);this.editor.$txt.css("position","relative");this.editor.$txt.css("min-height",a-b-3);this.shadow.css("height",a);},onSetWidth:function(f){var b=new Array();var c=$(".wangEditor-btn-container-group");for(var e=0;e<c.length;e++){b.push(c[e].offsetWidth);}b.sort(function(k,j){return k-j;});var d=b[b.length-1];if(f<d){var h=parseInt(this.getOuterEl().css("margin-left"))||32;var g=d+h;this.base(g);this.editor.width=g;this.shadow.css("width",g);}else{this.base(f);this.editor.width=f;this.shadow.css("width",f);}var a=this.editor.$btnContainer.height();this.editor.$txtContainer.css("height",this.shadow.height()-a-3);this.shadow.css("margin-top",this.getOuterEl().css("margin-top"));this.shadow.css("margin-left",this.getOuterEl().css("margin-left"));},onRender:function(a){this.base(a);this.editor=this.el.wangEditor();this.el=this.editor.$editorContainer;this.shadow=$("<div class='ui-redt sd'></div>").appendTo(this.container);this.shadow.parent().css("position","relative");this._input=this.editor.$txt;if(this.value){this._input.html(this.value);}},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){this.base();var a=this;this.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108||c===9){a.el.removeAttr("tabIndex");a.el.blur();a.focusManager.requestNextFocus(a);b.preventDefault();}});a._input.bind("blur",function(){a.finishInput();});},finishInput:function(){var a=this,b=this._input.html();if(b!=a.value){a.setValue(b,true,true);a.valueChange(b);if(a.getMetaObj().required){var c=(b=="");a.setRequired(c);}}},valueChange:function(a){this.setValue(a,true,true);},getOuterEl:function(){return this.el;}});YIUI.reg("richeditor",YIUI.Control.RichEditor);YIUI.Control.ButtonGroup=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",items:[],buttonType:"radio",onRender:function(f){this.base(f);var c=this.getEl(),g=this.items,b=this.getId(),k,a,e;for(var d=0;d<g.length;d++){e=g[d];k=b+d;var j=$("<input />").attr("type",this.buttonType).attr("name",b).attr("id",k).val(e.value).appendTo(c);var h=$("<label></label>").attr("for",k).html(e.text).appendTo(c);}c.buttonset({type:this.buttonType});},onSetWidth:function(a){var b=a/this.items.length-$("label",this.el).cssNum("margin-right");this.el.css("width",a+"px");$("label",this.el).css("width",b+"px");},onSetHeight:function(a){var b=$("label span",this.el);b.css("line-height",(a-b.cssNum("padding-top")-b.cssNum("padding-bottom"))+"px");}});YIUI.reg("buttongroup",YIUI.Control.ButtonGroup);YIUI.Control.DropdownButton=YIUI.extend(YIUI.Control,{autoEl:'<div class="ui-dropbtn btn-group"></div>',handler:YIUI.DropdownButtonHandler,icon:"",caption:"",dropdownItems:[],setTip:function(a){var a=this.caption;this.base(a);},onRender:function(f){this.base(f);var c=this.getEl(),d=this.dropdownItems,k=this.caption,g=this.button=$("<a/>").attr("class","btn dp-tgl").attr("data-toggle","dropdown").appendTo(c);this.getMetaObj().icon&&this.setIcon(this.getMetaObj().icon);$("<label>").text(k).appendTo(g);$('<span class="arrow"/>').appendTo(g);if(d.length>0){var b=this._dropView=$('<div class="dpbtn-vw"/>').attr("id",this.id+"_dropdown").appendTo($(document.body));var j=$("<ul/>").appendTo(b);for(var e=0;e<d.length;e++){var h=$("<li></li>").appendTo(j);if(d[e].separator){h.attr("role","separator").addClass("sep");}else{$("<a>"+d[e].text+"</a>").appendTo(h);h.attr("key",d[e].key);}}}},setIcon:function(a){this.icon=a;if($("span.icon",this.el).length==0){$('<span class="icon"/>').css("background-image","url(Resource/"+a+")").appendTo(this.button);}else{$("span.icon",this.el).css("background-image","url(Resource/"+a+")");}},setEditable:function(b){this.editable=b;var c=$(".dp-tgl",this.el),a=this.el;if(this.editable){c.removeAttr("disabled");a.removeClass("ui-readonly");}else{c.attr("disabled","disabled");a.addClass("ui-readonly");}},setBackColor:function(a){this.backColor=a;this.button.css({"background-image":"none","background-color":a});},setForeColor:function(a){this.foreColor=a;this.button.css("color",a);},setFormatStyle:function(a){$("label",this.button).css(a);},onSetWidth:function(a){this.button.css("width",a);},onSetHeight:function(a){this.button.css({"height":a,"line-height":a+"px"});$("label",this.el).height(a);$("span.arrow",this.el).css("margin-top",(a-4)/2+"px");},setDisabled:function(b){this.base(b);var a=this.getEl().children();$.each(a,function(){if(b){$(this).attr("disabled","disabled");}else{$(this).removeAttr("disabled");}});},hideDropdownList:function(){this._dropView&&this._dropView.hide();this._hasShow=false;this.el.removeClass("focus");},setDropViewTop:function(){var d=this.el;var b=this.el.offset();var a=$(window).height()-b.top-d.outerHeight();var c=b.top+d.outerHeight();if(a<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");c="auto";a=$(window).height()-b.top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");a="auto";}if(c!="auto"){this._dropView.css("top",c+"px");this._dropView.css("bottom","auto");}if(a!="auto"){this._dropView.css("bottom",a+"px");this._dropView.css("top","auto");}this._dropView.css("width",d.outerWidth()+"px");},setDropViewLeft:function(){var d=this.el;var b=this.el.offset();var a=$(window).width()-b.left;var c=$(window).width()-this._dropView.outerWidth();if(a<this._dropView.outerWidth()){c="auto";a=$(window).width()-b.left-d.outerWidth();}else{c=b.left;a="auto";}if(c!="auto"){this._dropView.css("left",c+"px");this._dropView.css("right","auto");}if(a!="auto"){this._dropView.css("right",a+"px");this._dropView.css("left","auto");}},initDefaultValue:function(a){this.base(a);this._dropView=$(".dp-vw",this.el).attr("id",this.el[0].id+"_dropdown");$("span.arrow",this.el).css({"position":"absolute","margin-top":(this.el.outerHeight()-4)/2+"px","float":"right","right":"10px"});this.button.css({"line-height":this.el.outerHeight()+"px","height":this.el.outerHeight()+"px"});$("label",this.el).css({"width":this.el.width()-22,"height":this.el.height(),"float":"left"});},beforeDestroy:function(){this._dropView&&this._dropView.remove();},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){var b=this;this.el.keydown(function(c){var d=c.keyCode||c.charCode;if(d===9||d===13||d===108){b.el.removeAttr("tabIndex");b.el.blur();b.focusManager.requestNextFocus(b);c.preventDefault();}});b.el.click(function(c){if(!b.enable){return;}b.el.addClass("focus");if(b._hasShow){b.hideDropdownList();b._hasShow=false;return;}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest(b._dropView).length==0)&&(d.closest(b.button).length==0)){b.hideDropdownList();$(document).off("mousedown");}});if(!b._dropView){return;}b.setDropViewTop();b.setDropViewLeft();b._dropView.slideDown("fast");if(b._dropView[0].scrollWidth>b._dropView[0].clientWidth){b._dropView.children("ul").width(b._dropView[0].scrollWidth);}b._dropView.css({width:b.el.width()});b._hasShow=true;c.stopPropagation();});$("a",this.el).blur(function(){b.hideDropdownList();});if(!this.disabled){var a=$("#"+this.id+"_dropdown");$("li",a).bind("click",function(){b.handler.doOnClick(b,$(this).attr("key"));b.hideDropdownList();});}}});YIUI.reg("dropdownbutton",YIUI.Control.DropdownButton);YIUI.Control.SplitButton=YIUI.extend(YIUI.Control,{autoEl:'<div class="ui-splbtn btn-group"></div>',handler:YIUI.SplitButtonHandler,behavior:YIUI.SplitButtonBehavior,_hasShow:false,icon:"",caption:"",dropdownItems:[],setTip:function(a){var a=this.caption;this.base(a);},onRender:function(g){this.base(g);var b=this.getEl(),d=this.dropdownItems,l=this.caption,c=this.buttonLeft=$("<button/>").attr("class","btn btn-left").appendTo(b),f=this.buttonRight=$("<button/>").attr("class","btn dp-tgl").attr("data-toggle","dropdown").appendTo(b),h=$('<span class="arrow"/>').appendTo(f);this.icon&&this.setIcon(this.icon);$("<label/>").text(l).appendTo(c);if(d.length>0){var a=this._dropView=$('<div class="sp-vw"/>').attr("id",this.id+"_dropdown").appendTo($(document.body));var k=$("<ul/>").appendTo(a);for(var e=0;e<d.length;e++){var j=$("<li></li>").appendTo(k);if(d[e].separator){j.attr("role","separator").addClass("sep");}else{$("<a>"+d[e].text+"</a>").appendTo(j);j.attr("key",d[e].key);}}}},setIcon:function(a){this.icon=a;if($("span.icon",this.el).length==0){$('<span class="icon"/>').css("background-image","url(Resource/"+a+")").appendTo(this.buttonLeft);}else{$("span.icon",this.el).css("background-image","url(Resource/"+a+")");}},setEnable:function(b){this.enable=b;var c=this.buttonLeft,a=this.el;if(this.enable){c.prev().removeAttr("disabled");a.removeClass("ui-readonly");}else{c.prev().attr("disabled","disabled");a.addClass("ui-readonly");}},setFormatStyle:function(a){$("label",this.buttonLeft).css(a);},onSetWidth:function(a){this.el.css("width",a);this.buttonLeft.css("width",a-this.buttonRight.outerWidth());},onSetHeight:function(a){this.el.css("height",a);this.buttonLeft.css("height",a);this.buttonRight.css("height",a);},setDisabled:function(b){this.base(b);var a=this.getEl().children();$.each(a,function(){if(b){$(this).attr("disabled","disabled");}else{$(this).removeAttr("disabled");}});},hideDropdownList:function(){this._dropView&&this._dropView.hide();this._hasShow=false;this.el.removeClass("focus");},setDropViewTop:function(){var d=this.el;var b=this.el.offset();var a=$(window).height()-b.top-d.outerHeight();var c=b.top+d.outerHeight();if(a<this._dropView.outerHeight()){this._dropView.addClass("toplst");this.el.addClass("toplst");c="auto";a=$(window).height()-b.top;}else{this._dropView.removeClass("toplst");this.el.removeClass("toplst");a="auto";}if(c!="auto"){this._dropView.css("top",c+"px");this._dropView.css("bottom","auto");}if(a!="auto"){this._dropView.css("bottom",a+"px");this._dropView.css("top","auto");}},setDropViewLeft:function(){var d=this.el;var b=this.el.offset();var a=$(window).width()-b.left;var c=$(window).width()-this._dropView.outerWidth();if(a<this._dropView.outerWidth()){c="auto";a=$(window).width()-b.left-d.outerWidth();}else{c=b.left;a="auto";}if(c!="auto"){this._dropView.css("left",c+"px");this._dropView.css("right","auto");}if(a!="auto"){this._dropView.css("right",a+"px");this._dropView.css("left","auto");}},afterRender:function(){this.base();if(this.format){if(this.format.foreColor){this.buttonLeft.css("color",this.format.foreColor);this.buttonRight.css("color",this.format.foreColor);}if(this.format.backColor){this.el.css("background-color","rgba(0, 0, 0, 0)");this.buttonLeft.css("background-color",this.format.backColor);this.buttonRight.css("background-color",this.format.backColor);}}},initDefaultValue:function(a){this.base(a);this.dropdownItems=a.dropdownitems;this._dropView=$(".sp-vw",this.el).attr("id",this.el[0].id+"_dropdown");$("a",this.el).css("line-height",$("a",this.el).height()+"px");this.buttonLeft=$(".btn-left",this.el);this.buttonRight=$(".btn-right",this.el);this.buttonLeft.css({"width":(this.el.outerWidth()-this.buttonRight.outerWidth()),"padding":0,"height":this.el.outerHeight()});this.buttonRight.css("height",this.el.outerHeight());$("label",this.buttonLeft).css("width",this.buttonLeft.width());},beforeDestroy:function(){this._dropView&&this._dropView.remove();},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){var b=this;this.el.keydown(function(c){var d=c.keyCode||c.charCode;if(d===9||d===13||d===108){b.el.removeAttr("tabIndex");b.el.blur();b.focusManager.requestNextFocus(b);c.preventDefault();}});b.buttonRight.click(function(c){if(!b.enable){return;}b.el.addClass("focus");if(b._hasShow){b.hideDropdownList();b._hasShow=false;return;}$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest(b._dropView).length==0)&&(d.closest(b.buttonLeft).length==0)&&(d.closest(b.buttonRight).length==0)){b.hideDropdownList();$(document).off("mousedown");}});if(!b._dropView){return;}b.setDropViewTop();b.setDropViewLeft();b._dropView.css("z-index",$.getZindex(b.el)+1);b._dropView.slideDown("fast");b._dropView.width(b.el.width());if(b._dropView[0].scrollWidth>b._dropView[0].clientWidth){b._dropView.children("ul").width(b._dropView[0].scrollWidth);}b._hasShow=true;c.stopPropagation();});if(!this.disabled){var b=this;this.buttonLeft.bind("click",function(){b.handler.doOnClick(b);if(!b.enable){return;}b.el.addClass("focus");});this.buttonLeft.bind("blur",function(){b.el.removeClass("focus");});var a=$("#"+this.id+"_dropdown");$("li",a).bind("click",function(){b.handler.doOnClick(b,$(this).attr("key"));b.hideDropdownList();});}}});YIUI.reg("splitbutton",YIUI.Control.SplitButton);YIUI.Control.Calendar=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",events:new Array(),slotMinutes:30,setValue:function(b,d,a){var c=this.base(b,d,a);this.events=b;return c;},setHeight:function(a){this.base(a);this.el.fullCalendar("option","height",a);this.el.fullCalendar("render");},onRender:function(b){this.base(b);var a=this;this.el.fullCalendar({theme:true,defaultView:"month",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},titleFormat:{month:"yyyy年MM月",week:"yyyy年MM月dd-{dd}日",day:"yyyy年MM月dd日-dddd"},timeFormat:{agendaDay:"HH:mm-{HH:mm}",agendaWeek:"HH:mm-\n{HH:mm}",month:"HH:mm"},weekMode:"liquid",weekends:true,weekNumbers:false,weekNumberTitle:"周",buttonText:{month:"月",agendaWeek:"周",agendaDay:"日",today:"今天"},monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["周日","周一","周二","周三","周四","周五","周六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],editable:true,slotMinutes:this.slotMinutes,allDayText:"全天",axisFormat:"HH"+"点",minTime:0,maxTime:24,slotEventOverlap:false,events:this.events,eventClick:function(f,e,d){var c=f.allDay?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";a.modifyEventDialog(f).dialog("open");},eventMouseover:function(e,d,c){},eventMouseout:function(e,d,c){},selectable:true,selectHelper:true,select:function(d,h,g,f,e){var c=g?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";a.editEventDialog("add",$.fullCalendar.formatDate(d,c),$.fullCalendar.formatDate(h,c),g).dialog("open");}});},editEventDialog:function(h,e,l,b,q,d){var n=this;e=(typeof e=="undefined")?"":e;l=(typeof l=="undefined")?"":l;b=(typeof b=="undefined")?true:b;var k=$("<div id='editEventDialog' style='display: none'></div>");$.datepicker.setDefaults($.datepicker.regional["zh-CN"]);$('<p style="margin: 0;padding:0">日程内容：</p>').appendTo(k).append($('<label id="contentCheck" style="color: red;display: none"></label>'));var g=$('<textarea id="event" style="width:100%;height: 50%" placeholder="记录你将要做的一件事...">'+"</textarea>").appendTo(k);g.focus(function(){$("#contentCheck").hide();});if(typeof q!="undefined"){g.val(q);}var c=$("<input type='text'>").appendTo(k);c.wrap("<p style='margin: 0;padding: 0'>开始时间：</p>");var r=$("<input type='text'>").appendTo(k);r.wrap("<p id='endDate' style='margin: 0;padding: 0;display: none'>结束时间：</p>");r.datetimepicker({showSecond:false,stepMinute:n.slotMinutes,closeText:"选择",currentText:"当前"});var o=$('<input type="checkbox" value="1" id="isallday"> ').appendTo(k);var f=function(){r[0].parentElement.style.display=b?"none":"block";if(!b){o.removeAttr("checked");c.val("");r.val("");c.datepicker("destroy");c.datetimepicker({showSecond:false,stepMinute:n.slotMinutes,closeText:"选择",currentText:"当前"});}else{o.attr("checked","checked");c.val("");r.val("");c.datetimepicker("destroy");c.datepicker();}};f();c.val(e);r.val(l);o.click(function(){b=!b;f();});o.wrap("<label></label>").after("全天");var p=function(){if(g.val()==""){$("#contentCheck").html("内容不允许为空!");$("#contentCheck").show();return false;}if(c.val()==""){$("#contentCheck").html("开始时间不允许为空!");$("#contentCheck").show();return false;}return true;};k.dialog({title:(h=="add")?"新建事件":"编辑事件",autoOpen:false,height:"auto",width:"auto",modal:true,buttons:{"新建":function(){if(!p()){return;}var t={title:g.val(),start:c.val(),end:b?"":r.val(),allDay:b};n.events.push(t);k.dialog("close");},"修改":function(){if(!p()){return;}var t=n.getEventByID(d);t.title=g.val();t.start=c.val();t.end=b?"":r.val();t.allDay=b;k.dialog("close");},"取消":function(){k.dialog("close");}},close:function(){k.remove();n.el.fullCalendar("refetchEvents");}});var m=k[0].nextElementSibling;var s=m.firstElementChild;if(h=="add"){$(s.childNodes[1]).hide();}else{var a=$("<button>刪除</button>").button().click(function(){var t=$("<div></div>").dialog({title:"确定删除？",height:"auto",width:"auto",modal:true,buttons:{"确定":function(){var u=n.getEventByID(d);var v=n.events.indexOf(u);n.events.splice(v,1);k.dialog("close");t.dialog("close");},"取消":function(){t.dialog("close");}},close:function(){t.remove();n.el.fullCalendar("refetchEvents");}});});var j=$("<div style='float: left;width: auto;height: auto'></div>").append(a);m.insertBefore(j[0],s);$(s.childNodes[0]).hide();}return k;},modifyEventDialog:function(b){var a=b.allDay?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";return this.editEventDialog("modify",$.fullCalendar.formatDate(b.start,a),$.fullCalendar.formatDate(b.end,a),b.allDay,b.title,b._id);},getEventByID:function(c){for(var a=0;a<this.events.length;a++){var b=this.events[a];if(b._id==c){return b;}}return null;}});YIUI.reg("calendar",YIUI.Control.Calendar);YIUI.Control.CheckBox=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.CheckBoxHandler,behavior:YIUI.CheckBoxBehavior,checked:false,text:"",setText:function(a){this.text=a;this.checkbox.setText(a);},getText:function(){return this.checkbox;},onSetHeight:function(a){this.base(a);this.checkbox.setHeight(a);},onSetWidth:function(a){this.base(a);this.checkbox.setWidth(a);},setEnable:function(a){this.enable=a;this.checkbox.setEnable(a);},setFormatStyle:function(a){this.cssStyle=a;this.checkbox.getLabel().css(a);},checkEnd:function(a){this.value=a;this.checkbox.setChecked(YIUI.TypeConvertor.toBoolean(this.value));},isNull:function(){return !YIUI.TypeConvertor.toBoolean(this.value);},onRender:function(b){this.base(b);var c=this;this.checkbox=new YIUI.Yes_CheckBox({el:c.el});this.el.addClass("ui-chk");this.checkbox.setChecked(this.getMetaObj().checked);var a=this.text.replace(/ /g,"&nbsp;");this.checkbox.setText(a);},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());if(a.clickContent){this.clickContent=a.clickContent;}var b=this;this.checkbox=new YIUI.Yes_CheckBox({el:b.el,isPortal:true});this.install();},focus:function(){this.checkbox&&this.checkbox.getCheckBox().focus();},install:function(){this.base();var a=this;this.checkbox.getCheckBox().change(function(c){var b=this.checked;a.setValue(b,true,true);});this.checkbox.getCheckBox().keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108){a.checkbox.getCheckBox().click();b.preventDefault();}else{if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}}});}});YIUI.reg("checkbox",YIUI.Control.CheckBox);YIUI.Control.ComboBox=YIUI.extend(YIUI.Control,{needRebuild:true,items:null,multiSelect:false,hasText:false,sourceType:YIUI.COMBOBOX_SOURCETYPE.ITEMS,editable:true,handler:YIUI.ComboBoxHandler,behavior:YIUI.ComboBoxBehavior,init:function(a){this.base(a);this.multiSelect=(a.type==YIUI.CONTROLTYPE.CHECKLISTBOX);},isNull:function(){if(!this.value){return true;}else{return false;}},setTip:function(a){var a=this.text;this.base(a);},setEditable:function(a){if(this.multiSelect){this.editable=false;}else{this.editable=a;}this.yesCombobox.setEditable(this.editable);},setEnable:function(a){this.enable=a;this.yesCombobox.setEnable(a);},getCheckedValue:function(){},dependedValueChange:function(a){this.needRebuild=true;this.setText("");this.setValue(null);},checkEnd:function(a){var b="";if(a){switch(this.getMetaObj().sourceType){case YIUI.COMBOBOX_SOURCETYPE.FORMULA:this.handler.getComboboxItems(this);b=this.getCaption(a);break;case YIUI.COMBOBOX_SOURCETYPE.QUERY:b=a;break;default:b=this.getCaption(a);break;}}this.setText(b);this.value=a;this.yesCombobox.setSelValue(a);this.checkItem(a);},getItems:function(){this.handler.getComboboxItems(this);},setFormatStyle:function(a){this.cssStyle=a;this.yesCombobox.setFormatStyle(a);},onSetWidth:function(a){this.yesCombobox.setWidth(a);},onSetHeight:function(a){this.yesCombobox.setHeight(a);},setText:function(a){this.text=a;this.yesCombobox.setText(a);},getText:function(){return this.text;},setItems:function(a){this.items=a;this.yesCombobox.setItems(a);},checkItem:function(a){this.yesCombobox.checkItem(a);},beforeDestroy:function(){this.yesCombobox.destroy();},getValue:function(){return this.value;},getCaption:function(e){var c="";if(this.multiSelect){var b=e.split(",");for(var d=0,a=b.length;d<a;d++){if(d>0){c+=",";}c+=this.getItemCaption(b[d]);}}else{c=this.getItemCaption(e);}return c;},getItemCaption:function(e){var b="";for(var c=0,a=this.items.length,d;c<a;c++){d=this.items[c];if(d.value==e){b=d.caption;break;}}return b;},focus:function(){$("input",this.el).focus();},install:function(){this.base();var b=this;var c=-1;var a=false;var d=function(){b.$combView&&b.$combView.hide();b.selLi=null;$(".selected",b.$combView).removeClass("selected");if(b.yesCombobox._textBtn.val()==""){b.setValue(null,true,true);}c=-1;};$("input",b.el).bind("keyup",$.debounce(200,function(h){if(b.multiSelect){return;}var f=$(this).val();var g=h.keyCode;if(g==27){d();return;}$(document).on("mousedown",function(k){var j=$(k.target);if(b.selLi&&b.selLi.length>0){b.selLi.mouseup();}else{if(j.closest(b.yesCombobox.$suggestView).length==0&&j.closest(b.yesCombobox._textBtn).length==0){d();$(document).off("mousedown");}}b.selLi=null;});if(g==38||g==40||g==9){return;}if(g==13&&b.selLi){c=-1;b.selLi.mouseup();return;}b.handler.doSuggest(b,f);}));$("input",b.el).bind("keydown",function(j){if(!a&&b.sourceType==YIUI.COMBOBOX_SOURCETYPE.QUERY){a=true;b.handler.getComboboxItems(b);}var n=j.keyCode;var p=b.yesCombobox.$suggestView,f,l=false;if(!p.is(":hidden")||(b.yesCombobox._dropView.is(":hidden")&&(n!=40))){f=p;l=true;}else{f=b.yesCombobox._dropView;}b.$combView=f;var h=$("li",f).length;if(n==38){if(!l&&b.yesCombobox._dropView.is(":hidden")){return;}c--;if(c==-1){c=h-1;}}else{if(n==40){if(!l&&b.yesCombobox._dropView.is(":hidden")){b.yesCombobox._dropBtn.click();var k=$("li.sel",b.yesCombobox._dropView).removeClass("sel");c=k.index();}c++;if(c==h){c=0;}}else{if(n==9||n===13||n===108){b.focusManager.requestNextFocus(b);if(n==9&&!b.yesCombobox._dropView.is(":hidden")){$(document).mousedown();}j.preventDefault();}else{return;}}}if(c==-1){return;}b.selLi&&b.selLi.removeClass("selected").removeClass("sel");var m=f.find("li:eq("+c+")");m.addClass("selected");b.selLi=m;var o=b.yesCombobox._dropView.outerHeight()-b.yesCombobox._dropView[0].clientHeight;var g=m.position().top-b.yesCombobox._dropView.height()+m.height()+o;b.yesCombobox._dropView.scrollTop(g<0?0:g);if(!l){b.yesCombobox._textBtn.val(m.text());}});$("input",b.el).blur(function(){a=false;});},initDefaultValue:function(b){this.base(b);if(b.multiSelect){this.multiSelect=b.multiSelect;}if(b.columnKey){this.columnKey=b.columnKey;}if(b.tableKey){this.tableKey=b.tableKey;}if(b.sourceType){this.sourceType=b.sourceType;}if(b.evalItems){this.evalItems=b.evalItems;}var a=this;this.yesCombobox=new YIUI.Yes_Combobox({el:a.el,isPortal:true,multiSelect:a.multiSelect,items:a.items,value:a.value,isPortal:true,getItems:function(){a.handler.getComboboxItems(a);},hiding:function(){var c=this.getSelValue();a.setValue(c,true,true);}});this._dropView=$(".cmb_vw",this.el).appendTo($(document.body));$(".cmb_vw",this.el).remove();this._textBtn=$("input",this.el);this._dropBtn=$(".arrow",this.el);a._firstClick=false;this._textBtn.css({"width":this.el.outerWidth(),"height":this.el.outerHeight()});this._dropBtn.css({left:this._textBtn.outerWidth()-26,top:(this._textBtn.outerHeight()-16)/2,height:"16px",width:"16px"});if($.browser.isIE){this._textBtn.css("line-height",(this.el.outerHeight()-3));}this.install();},setSourceType:function(a){this.sourceType=a;},onRender:function(b){this.base(b);var a=this;this.yesCombobox=new YIUI.Yes_Combobox({el:a.el,multiSelect:a.multiSelect,items:a.items,value:a.value,getItems:function(){a.handler.getComboboxItems(a);},hiding:function(){var d=this.getSelValue();a.setValue(d,true,true,false,true);}});this.el.addClass("ui-cmb");this.setValue(this.value);this.setText(this.text);if(this.getMetaObj().sourceType){this.setSourceType(this.getMetaObj().sourceType);}this.setItems(this.items);var c=this.getValue();this.checkItem(c);}});YIUI.reg("combobox",YIUI.Control.ComboBox);YIUI.reg("checklistbox",YIUI.Control.ComboBox);YIUI.Control.DatePicker=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.DatePickerHandler,behavior:YIUI.DatePickerBehavior,isOnlyDate:false,formatStr:"yyyy-MM-dd HH:mm:ss",isNoTimeZone:false,regional:"zh-CN",mask:null,calendars:1,setTip:function(a){var a=this.text;this.base(a);},setFormatStr:function(){if(this.getMetaObj().isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}},setEditable:function(a){this.editable=a;this.datePicker.setEditable(a);},setEnable:function(a){this.enable=a;this.datePicker.setEnable(a);},setBackColor:function(a){this.backColor=a;this.datePicker.getInput().css({"background-image":"none","background-color":a});},setForeColor:function(a){this.foreColor=a;this.datePicker.getInput().css("color",a);},setFormatStyle:function(a){this.cssStyle=a;this.datePicker.getInput().css(a);},setText:function(b){if(b&&b.length>0){b=b.replace(/-/g,"/");var a=new Date(b);this.text=a.Format(this.formatStr);this.datePicker.getInput().val(this.text);}else{this.text=b;this.datePicker.getInput().val(this.text);}},getText:function(){var a=this.text||"";if(a!=""&&this.getMetaObj().isOnlyDate){a+=" 00:00:00";}return a;},changeToVal:function(){var a=this.getText();if(this.getText()!=""){a=a.replace(/-/g,"/");return new Date(a);}else{return null;}},onRender:function(a){this.base(a);var c=this;c.formatStr&&this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:c.id,el:c.el,formatStr:c.formatStr,isOnlyDate:c.getMetaObj().isOnlyDate,isNoTimeZone:c.getMetaObj().isNoTimeZone,regional:c.getMetaObj().regional,calendars:c.calendars});this.el.addClass("ui-dp");if(this.text){this.setText(this.text);}if(this.value){var b=new Date(parseInt(this.value));this.setValue(b,false,false);}},afterRender:function(){this.base();if(this.mask){}},onSetWidth:function(a){this.datePicker.setWidth(a);},onSetHeight:function(a){this.datePicker.setHeight(a);},initDefaultValue:function(c){this.base(c);this.formatStr=c.formatstr;this.isOnlyDate=c.isonlydate;this.isNoTimeZone=c.isnotimezone;this.calendars=1;if(this.isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}var d=this;this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:d.id,el:d.el,isPortal:true,formatStr:d.formatStr,isOnlyDate:d.isOnlyDate,isNoTimeZone:d.isNoTimeZone,regional:d.regional,calendars:d.calendars});this.datePicker.setIsNoTimeZone(this.isNoTimeZone);this.datePicker.setOnlyDate(this.isOnlyDate);this.datePicker.setRegional(this.regional);this.datePicker.setCalendars(this.calendars);this.datePicker.initDatePicker(this.id);var a=this.datePicker.getInput(),b=this.datePicker.getBtn();b.css({left:this._dateInput.outerWidth()-26+"px",top:(this._dateInput.outerHeight()-16)/2+"px",height:"16px",width:"16px"});if($.browser.isIE){a.css("line-height",(this.el.outerHeight()-3)+"px");}if(this.value){if(this.isOnlyDate){this.value=this.value.substring(0,this.value.indexOf(" "));}this.setValue(this.value);}if(this.text){this.setText(this.text);}},beforeDestroy:function(){this.datePicker.getDropView().remove();},focus:function(){this.datePicker&&this.datePicker.getInput().focus();},checkEnd:function(a){this.value=a;this.caption=a;var b="";if(this.value){b=this.value.Format(this.formatStr);}this.setText(b);},install:function(){this.base();var a=this;this.datePicker.getInput().bind("click",function(b){this.select();}).on("blur",function(b){var c=b.target.value;if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getDropView().blur(function(b){var c=a.datePicker.getInput().val();if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getInput().keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("datepicker",YIUI.Control.DatePicker);YIUI.Control.DICT_CKBOXTYPE_NORMAL_SELECT=YIUI.TREEPANEL_CKBOXTYPE_NORMAL_SELECT;YIUI.Control.DICT_CKBOXTYPE_SINGLE_SELECT=YIUI.TREEPANEL_CKBOXTYPE_SINGLE_SELECT;YIUI.Control.Dict=YIUI.extend(YIUI.Control,{value:null,handler:YIUI.DictHandler,behavior:YIUI.DictBehavior,stateMask:YIUI.DictStateMask.Enable,needRebuild:true,init:function(a){this.base(a);},setEditable:function(a){this.editable=a;this.yesDict.setEditable(this.editable);},setEnable:function(a){this.enable=a;this.yesDict.setEnable(a);},setBackColor:function(a){this.yesDict.setBackColor(a);},setForeColor:function(a){this.yesDict.setForeColor(a);},setFormatStyle:function(a){this.yesDict.setFormatStyle(a);},setMultiSelect:function(a){this.multiSelect=a;this.yesDict.setMultiSelect(a);},beforeDestroy:function(){this.yesDict.destroy();},isNull:function(){var c=this.value;if($.isEmptyObject(c)){return true;}if(c instanceof YIUI.ItemData){return c.oid==0;}else{if($.isArray(c)){for(var b=0,a=c.length;b<a;b++){if(c[b].oid>0){return false;}}return true;}}return false;},getCheckOpts:function(a){var c=this.base(a);var b=YIUI.FormStack.getForm(this.ofFormID);var a={dictCaption:b.dictCaption,itemKey:this.itemKey};c=$.extend(c,a);return c;},setTip:function(a){var a=this.text;this.base(a);},checkEnd:function(c){this.value=c;this.yesDict.setValue(c);var e="";if(c!=null){if(this.multiSelect){for(var b=0,a=c.length;b<a;b++){var d=c[b];if(b>0){e+=",";}e+=d.caption;}}else{e=c.caption;}}this.setText(e);},getValue:function(){return this.value;},onSetWidth:function(a){this.yesDict.setWidth(a);},onSetHeight:function(a){this.yesDict.setHeight(a);},getDictTree:function(){return this.yesDict.dictTree;},isChanged:function(d){this.value;var e=false;if(!this.value&&d){e=true;}else{if(this.value){if(this.multiSelect){if(this.value.length!=d.length){e=true;}else{for(var c=0,a=d.length;c<a;c++){var b=this.value.indexOf(d[c]);if(b<0){e=true;break;}}}}else{e=!(this.value.oid==d.oid);}}}return e;},onRender:function(f){this.base(f);var h=this;var d=h.ofFormID;var b=YIUI.FormStack.getForm(d);this.yesDict=new YIUI.Yes_Dict({id:h.id,el:h.el,secondaryType:h.secondaryType,dataSource:h.dataSource,independent:h.getMetaObj().independent,multiSelect:h.getMetaObj().multiSelect,getItemKey:function(){return h.itemKey;},hiding:function(){var l=this.getSelValue();var m=h.isChanged(l);if(m){h.setValue(l,true,true,false,true);}},getDictChildren:function(l){var m=function(o){if(o){var r=l.attr("id");var s=h.getDictTree().formatAsyncData(o);for(var p=0,n=o.length;p<n;p++){if(h.type==YIUI.CONTROLTYPE.COMPDICT){var q=r+"_"+o[p].OID;o[p].id=q;}}h.getDictTree().buildTreenode(s,r,parseInt(l.attr("level"))+1);l.attr("isLoaded",true);}};YIUI.DictService.getDictChildren(h.itemKey,h.getDictTree().getNodeValue(l),h.getDictTree().dictFilter,h.stateMask,m);},checkDict:function(){h.checkDict(h);this.setSelValue(h.value);},doLostFocus:function(m,l){if(h.autoSel){h.$dictView.hide();h.isDictView=false;return;}if(!h.multiSelect&&(!$.isEmptyObject(m)||l)){if((h.hasSuggest&&!h.isSuggest)||h.hasSuggest==false){h.$dictView.hide();}h.handler.autoComplete(h,m);}else{h.setValue(null,true,true,false,true);h.setText("");}},valueChange:function(l){h.handler.doLostFocus(h,l);},beforeExpand:function(l,m){var n=function(o){if(o){$.each(o,function(p){var q=this.itemKey+"_"+this.oid;l.indeterminatedNodes[q]=this;});}};YIUI.DictService.getAllParentID(h.itemKey,h.getValue(),n);}});this.el.addClass("ui-dict");if(this.value){if(this.getMetaObj().multiSelect){var j=[];for(var e=0,g=this.value.length;e<g;e++){var c=this.value[e];var k=new YIUI.ItemData(c);j.push(k);}this.value=j;}else{var a=this.value;a.caption=this.text;var k=new YIUI.ItemData(a);this.value=k;}}this.setValue(this.value);this.setMultiSelect(this.getMetaObj().multiSelect);this.setDynamic(this.getMetaObj().isDynamic);this.setStateMask(this.getMetaObj().stateMask);this.setText(this.text);},setStateMask:function(a){this.stateMask=a;},setDynamic:function(a){this.isDynamic=a;},focus:function(){$("input",this.el).focus();},install:function(){this.base();var a=this;var b=-1;var c=function(){a.$dictView&&a.$dictView.hide();a.selLi=null;$(".selected",a.$dictView).removeClass("selected");a.setText(a.text);b=-1;};$("input",a.el).bind("keyup",function(g){if(a.multiselect){return;}var f=g.keyCode;if(f==13){if(a.selLi){$(".b-txt",a.selLi).click();}else{$(this).blur();}return;}var d=$(this).val();$(document).on("mousedown",function(j){var h=$(j.target);if(h.closest(a.yesDict.$suggestView).length==0){if(a.selLi&&a.selLi.length>0){a.selLi.click();}a.isSuggest=false;$(document).off("mousedown");a.yesDict.$suggestView.hide();}else{a.isSuggest=true;}a.selLi=null;b=-1;});if(f==38||f==40||f==9){return;}if(f==13&&a.selLi){b=-1;a.selLi.click();return;}a.yesDict._dropView.hide();a.handler.doSuggest(a,d);});$("input",a.el).bind("keydown",function(h){var n=h.keyCode;var p=a.yesDict.$suggestView,m,k=false;if(!p.is(":hidden")||(a.yesDict._dropView.is(":hidden")&&(n!=40))){m=p;k=true;}else{m=a.yesDict._dropView;}a.$dictView=m;var f=$("li[level != '-1']",m).length;if(n==38){if(!k&&a.yesDict._dropView.is(":hidden")){return;}b--;if(b==-1){b=f-1;}}else{if(n==40){if(!k&&a.yesDict._dropView.is(":hidden")){a.isDictView=true;a.yesDict._dropBtn.click();var g=$("li .dt-wholerow.sel",a.yesDict._dropView);g.removeClass("sel");var j=g.parents("li").eq(0);b=j.index();}b++;if(b==f){b=0;}}else{if(n==9||n===13||n===108){a.focusManager.requestNextFocus(a);if(n==9&&!a.yesDict._dropView.is(":hidden")){$(document).mousedown();}h.preventDefault();}else{return;}}}if(b==-1){return;}if(a.selLi){a.selLi.removeClass("selected").removeClass("sel");$(".dt-wholerow",a.selLi).removeClass("sel");}var l=m.find("li[level != '-1']:eq("+b+")");l.addClass("selected");a.selLi=l;a.autoSel=true;$(".dt-wholerow",l).eq(0).addClass("sel");var o=a.yesDict._dropView.outerHeight()-a.yesDict._dropView[0].clientHeight;var d=l.position().top-a.yesDict._dropView.height()+l.height()+o;a.yesDict._dropView.scrollTop(d<0?0:d);if(!k){a.yesDict._textBtn.val($(".b-txt",l).eq(0).text());}});$("input",a.el).bind("blur",function(d){b=-1;});},setText:function(a){this.text=a;this.yesDict.setText(a);},getText:function(){return this.yesDict.getText();},dependedValueChange:function(b){if(this.getMetaObj().isDynamic){if(this.refKey&&this.refKey==b){this.needRebuild=true;}}if(!this.needRebuild){if(this.root&&this.root.length>0){if(this.root==b){this.needRebuild=true;}}}if(!this.needRebuild){var a=this.getDictTree().dictFilter;if(a){if(a.dependency&&a.dependency.toLowerCase().indexOf(b.toLowerCase())>=0){this.needRebuild=true;}}else{var d=this.ofFormID;var c=YIUI.FormStack.getForm(d);a=this.handler.getFilter(c,this.key,this.itemFilters,this.itemKey);if(a){this.needRebuild=true;}}}if(this.needRebuild){this.setText("");this.setValue(null,true,true,false,true);}},setSecondaryType:function(a){this.yesDict.setSecondaryType(a);},checkDict:function(){this.handler.checkDict(this);}});YIUI.reg("dict",YIUI.Control.Dict);YIUI.reg("compdict",YIUI.Control.Dict);YIUI.reg("dynamicdict",YIUI.Control.Dict);(function(){YIUI.ItemData=function(a){this.oid=a.oid||0;this.itemKey=a.itemKey||"";this.caption=a.caption||"";};Lang.impl(YIUI.ItemData,{getOID:function(){return this.oid;},getItemKey:function(){return this.itemKey;},getCaption:function(){return this.caption;},equals:function(a){if(a==null){return false;}return this.toString()==a.toString();},toString:function(){return this.itemKey+"_"+this.oid;},toJSON:function(){var a={oid:this.oid,itemKey:this.itemKey,caption:this.caption};return a;},fromJSON:function(a){if(a.oid){this.oid=a.oid;}if(a.itemKey){this.itemKey=a.itemKey;}if(a.caption){this.caption=a.caption;}}});})();YIUI.DictTree=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",independent:true,showCheckBox:false,checkedNodes:{},indeterminatedNodes:null,_pMap:{},url:null,params:{},rootNode:null,init:function(b){this.base(b);var a=this;a.results=[];a.callback=$.extend({beforeExpand:$.noop,onSelected:$.noop,onChecked:$.noop},b.callback);a.clickEvent={};this.rootNode=null;this.indeterminatedNodes=null;},buildTreenode:function(a,b,c){if(!a){return;}if(!a.length){a=$(a);}this.addNodes(a,b,c);},addNodes:function(n,d,c){var l=$("#"+d,this.el);if(n.length<=0){l.children("span:first").removeClass("tree-collapse");return;}var o,k,a,r;this._pMap[d]||(this._pMap[d]=[]);for(var p=0,q=n.length;p<q;p++){o=n[p];k=o.id;a=o.oid;r=o.itemKey;this._pMap[d].push(k);var f=$("<li id='"+k+"' class='dictTree tree-node' oid = '"+a+"'parentid='"+d+"' itemKey='"+r+"'></li>");f.attr("level",c).css("padding-left",15);var m=l.children("ul");if(m.length==0){m=$("<ul class='tree-ul'></ul>").appendTo(l);}f.appendTo(m);var h=$("<a class='tree-anchor'></a>");var g,j,b;if(o.isParent){if(o.open){f.addClass("selected");j=$("<span class='dictTree-icon tree-expand'/>").appendTo(f);_explore=$("<span class='tree-explore tree-explore-expand'/>").appendTo(h);}else{j=$("<span class='dictTree-icon tree-collapse'/>").appendTo(f);_explore=$("<span class='tree-explore tree-explore-collapse'/>").appendTo(h);}}else{j=$("<span class='dictTree-icon'/>").appendTo(f);_explore=$("<span class='tree-explore'/>").appendTo(h);}switch(o.stateMask){case YIUI.DictStateMask.Enable:j.addClass("enable");break;case YIUI.DictStateMask.Disable:j.addClass("disable");break;case YIUI.DictStateMask.Discard:j.addClass("discard");break;}if(this.showCheckBox){b=$("<span class='tree-checkbox' />");j.after(b);}h.appendTo(f);var u=$("<span class='treenode-name'>"+o.name+"</span>").appendTo(h);l.attr("isLoaded",true);}if(this.showCheckBox){for(var p=0,q=n.length;p<q;p++){o=n[p];k=o.id;var e=0;if(k in this.checkedNodes){e=1;}else{if(!this.independent&&k in this.indeterminatedNodes){e=2;}}if(e==0&&!this.independent&&l){var t=l.children(".tree-checkbox").attr("checkstate")||0;if(t==1){e=1;}}var s=$("#"+k,this.el);s.children(".tree-checkbox").attr("checkstate",e).addClass("checkstate"+e);}}},checkTreeNode:function(d,a){var e,g,f,h;var j=this;function c(l,q){var p=l.children(".tree-checkbox");p.removeClass("checkstate"+p.attr("checkstate"));p.attr("checkstate",q).addClass("checkstate"+q);if(q!=2){var m=l.attr("id");j._pMap[m]||(j._pMap[m]=[]);for(var n=0;n<j._pMap[m].length;n++){var k=j._pMap[m][n];var o=$("#"+k,j.el);c(o,q);}}}function b(t,k){var q=t.attr("parentid");if(!q){return;}var s=$("#"+q,j.el);var p=s.children(".tree-checkbox");p.removeClass("checkstate"+p.attr("checkstate"));if(k==2){p.attr("checkstate",2).addClass("checkstate"+2);b(s,2);}else{j._pMap[q]||(j._pMap[q]=[]);var l=false;for(var o=0;o<j._pMap[q].length;o++){var r=j._pMap[q][o];var n=$("#"+r,j.el);var m=n.children(".tree-checkbox").attr("checkstate")||0;if(m!=k){l=true;break;}}if(l){k=2;}p.attr("checkstate",k).addClass("checkstate"+k);b(s,k);}if(k==1){j.checkedNodes[q]=j.getNodeValue(s);}else{delete j.checkedNodes[q];}}if(!this.independent){c(d,a);b(d,a);}else{d.children(".tree-checkbox").attr("checkstate",a).addClass("checkstate"+a);}},setCheckedNodes:function(c){if(this.showCheckBox){var b=this;this.clearCheckedNodes();this.checkedNodes=c;this.indeterminatedNodes=null;if(this.rootNode){var a=this.rootNode.attr("id");if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".tree-checkbox").attr("checkstate",2).addClass("checkstate"+2);}else{if(a in this.checkedNodes){this.rootNode.children(".tree-checkbox").attr("checkstate",1).addClass("checkstate"+1);}}}}},clearCheckedNodes:function(){this.checkedNodes={};this.indeterminatedNodes=null;$("[checkstate=1],[checkstate=2]").removeClass("checkstate1").removeClass("checkstate2").attr("checkstate",0).addClass("checkstate0");},createRootNode:function(d,a){var c=$("<li id='"+a+"'class='dictTree tree-node' oid = '"+d.oid+"' itemKey='"+d.itemKey+"'></li>");c.attr("level",-1);c.appendTo(this.el);var b=$("<a class='tree-anchor'></a>");c.addClass("selected");b.addClass("curSelectedNode");$("<span class='dictTree-icon tree-expand'/>").appendTo(c);if(this.showCheckBox){$("<span class='tree-checkbox' />").addClass("checkstate0").appendTo(c);}$("<span class='tree-explore tree-explore-expand'/>").appendTo(b);$("<span class='treenode-name'>"+d.name+"</span>").appendTo(b);b.appendTo(c);$("<ul class='tree-ul'></ul>").appendTo(c);this.rootNode=$("#"+a,this.el);if(this.showCheckBox){if(!jQuery.isEmptyObject(this.checkedNodes)&&!this.independent){this.rootNode.children(".tree-checkbox").attr("checkstate",2).addClass("checkstate"+2);}else{if(a in this.checkedNodes){this.rootNode.children(".tree-checkbox").attr("checkstate",1).addClass("checkstate"+1);}}}},onRender:function(a){this.base(a);this.el.addClass("dictTree dictTree-content");var b=this.el.attr("id");this.buildTreenode(this.dataSource,null,0);},collapseNode:function(b){b.children("ul").hide();var a=b.children("span:first");a.removeClass("tree-expand").addClass("tree-collapse");a.next(".tree-explore").removeClass("tree-explore-expand").addClass("tree-explore-collapse");b.children("a").removeClass("curSelectedNode");b.removeClass("selected");},expandNode:function(c){if(!c){c=this.rootNode;}var a=this;if(!c.attr("isLoaded")){this.callback.beforeExpand(this,c);YIUI.Service.getDictChildren(this,c);}c.children("ul").show();var b=c.children("span:first");if(b.hasClass("tree-collapse")){b.removeClass("tree-collapse").addClass("tree-expand");b.next(".tree-explore").removeClass("tree-explore-collapse").addClass("tree-explore-expand");c.children("a").addClass("curSelectedNode");c.addClass("selected");}},checkboxClick:function(a){var c=a.children(".tree-checkbox").attr("checkstate")==0?1:0;this.checkTreeNode(a,c);this.callback.onChecked(this,a);var b=a.attr("id");if(c==1){this.checkedNodes[b]=this.getNodeValue(a);}else{delete this.checkedNodes[b];}},selectNode:function(a){if(this.selectedNodeId){$("#"+this.selectedNodeId).removeClass("clicked");}this.selectedNodeId=a.attr("id");a.addClass("clicked");this.callback.onSelected(this,a);},getNodeValue:function(a){},install:function(){var a=this;if(!this.showCheckBox){a.el.bind("click",function(d){var b=$(d.target);var c=b.parents("li:first");if(b.hasClass("tree-collapse")){a.expandNode(c);return;}if(b.hasClass("tree-expand")){a.collapseNode(c);return;}if(b.hasClass("tree-checkbox")){a.checkboxClick(c);return;}if(b.hasClass("treenode-name")){a.selectNode(c);return;}});}},getCheckedValues:function(){if(this.showCheckBox){var b=this;var a=[];$.each(b.checkedNodes,function(g,h){var d=$("#"+g,b.el);if(!this.independent){var f=d.attr("parentid");var c=$("#"+f,b.el);if(c){var e=c.children(".tree-checkbox").attr("checkstate")||0;if(e==1){}else{a.push(h);}}else{a.push(h);}}else{a.push(h);}});return a;}},formatAsyncData:function(a){return a;},afterRender:function(){this.base();},reset:function(){if(this.rootNode){this._pMap={};this.collapseNode(this.rootNode);this.rootNode.children(".tree-ul").children().remove();this.rootNode.removeAttr("isLoaded");this.indeterminatedNodes=null;}}});YIUI.reg("dicttree",YIUI.DictTree);(function(){var b=0;function a(){return"n-"+(++b);}YIUI.Control.DictView=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",selectId:null,dataUrl:null,data:null,_datas:{},root:null,colModel:null,enableColumnResize:true,defaultWidth:100,_$table:null,selectionModel:1,pageSize:this.pageRowCount,pageIndicatorCount:3,handler:YIUI.DictViewHandler,init:function(d){this.base(d);this.dataUrl="";var c=this;c.pageSize=c.pageRowCount;c.loadedNodes={};this.option={theme:"default",expandLevel:2,expandable:true,levelMinus:true,beforeExpand:function(e){var f=$(e).attr("id");if(!c.loadedNodes[f]){c.handler.doExpand(c,$(e));c.loadedNodes[f]=true;if(!$(e).is(":hidden")){$(e).click();if(!c._selectItem){return;}var f=c._selectItem.itemKey+"_"+c._selectItem.oid;if(f==e.attr("id")){c._selectItem.isExpandNode=true;}}}},onSelect:function(e,f){if(f){$("#"+c.selectId,e).removeClass("sel-row");f.addClass("sel-row");var h=f.index();var g=f.attr("id");if(g){if(c.hasClick){c.selectId=g;c.handler.doOnRowClick(c,f);}else{if(c.hasRowChanged){if(c.selectId!=g){c.selectId=g;c.handler.doOnFocusRowChange(c,f);}}}}}},doubleClick:c.hasDblClick?function(e,f){c.handler.doOnDblClick(c,f);}:null};this.data=d.data.addedNodes;if(this.data==undefined){this.data={};}},setEnable:function(c){this.base(c);this._$table.setEnable(c);},onSetHeight:function(c){this.el.css("height",c);var e=$(".paginationjs-pages",this.el).is(":hidden")?0:$(".paginationjs-pages",this.el).height();var d=c-e-this.$fuzzybar.height();this._pagination.content.css("height",d);$(".ui-resizer",this.el).css({"top":this.$fuzzybar.height(),"height":this._$table.height()});},onSetWidth:function(e){this.el.css("width",e);this._$fuzzyText.css("width",e-this._$fuzzyBtn.outerWidth());var c=$("th",this.el),d;this._pagination.content.css("width",e);this.el.hide();this._$table.css("width",this._pagination.content.width());this.el.show();},onRender:function(f){this.base(f);this.el.addClass("ui-dv");if($.browser.isIE){this.el.attr("onselectstart","return false");}var h=this.$fuzzybar=$('<div id="'+this.id+'-fuzzy" class="fuzzy"/>');this._$fuzzyText=$('<input id="'+this.id+'_textbtn" type="text" style="height: 30px;"/>').addClass("txt").appendTo(h);this._$fuzzyBtn=$('<button id="'+this.id+'_dropbtn" style="height: 30px; width: 30px;"></button>').appendTo(h);if(!this.isHiddenFuzzyBar){h.appendTo(this.el);}var n=this;n._pagination=n.el.pagination({pageSize:n.pageSize,totalNumber:n.totalRowCount,showPages:true,showPageDetail:false,showFirstButton:false,showLastButton:false,pageIndicatorCount:this.pageIndicatorCount});this._$table=$('<table cellpadding="0" cellspacing="0" unselectable="on"></table>').appendTo(n._pagination.content);var j=$("<tr ></tr>").appendTo(this._$table),l=this.colModel,d,e,g,c,m;for(e=0,g=l.length;e<l.length;e++){d=l[e];c=Math.round(100/g);m=$('<th ><span class="title">'+d.caption+"</span></th>").css("width",c+"%").appendTo(j);if(e<g-1){$("<span class='dv-handler'></span>").appendTo($("span",m));}}j.appendTo(this._$table);if(this.root){var k=this.createRow(this.root);k.addClass("comp_Level1").attr("comp_Level",1);n.loadedNodes[k.attr("id")]=true;k.addClass("root");this._$table.append(k);k.hide();}this._$table=this._$table.treetable(this.option);if(this.totalRowCount<=this.pageSize){this._pagination.hidePagination();}this.addNodes(this.data);},install:function(){this.enableColumnResize&&this.addColumnResize();var c=this;c._pagination.pageChanges=function(e){c.handler.doGoToPage(c,e);};this._$fuzzyBtn.click(function(f){var g=c._$fuzzyText.val();c.handler.doDictViewSearch(c,g);});var d=this;$(".dv-handler",this.el).bind("mousedown",function(l){if(!d.enable){return false;}var p=$(".ui-resizer",d.el);var g=$(this).position().left+$(this).width();p.css("left",g);p.addClass("clicked");var m,n,k;l.preventDefault();var h=l.clientX;m=$(this).parents("th");n=m.width();var f,o,j;$(document).on("mousemove.rc",function(q){f=q.clientX-h;p.css("left",g+f);});return $(document).one("mouseup",function(){$(document).off("mousemove.rc");d.el.hide();o=n+f;m.width(o);m.next().css("width","100%");p.removeClass("clicked");d.el.show();});});},createRow:function(o){delete this.loadedNodes[o.id];var f=$('<tr id="'+o.id+'"></tr>'),h=this.colModel;if(o.OID!=undefined){f.attr("oid",o.OID);}if(o.pid!=undefined){f.attr("pid",o.pid);}if(o.itemKey!=undefined){f.attr("itemKey",o.itemKey);}if(this.dictType==YIUI.SECONDARYTYPE.COMPDICT){var p=o.path;if(!p){p=o.id;}f.attr("path",p);var m=$("[id="+o.pid+"]",this.el);var n=parseInt(m.attr("comp_Level"));var g=m.attr("itemKey");var c=o.itemKey;if(c!=g){n+=1;}f.attr("comp_Level",n);var l="comp_Level"+n;f.addClass(l);}if(!this.isChainDict()){if(o.NodeType==1){f.attr("haschild",true);}}if(o.previd!=undefined){f.attr("previd",o.previd);}if(o.Enable!=undefined){f.attr("enable",o.Enable);switch(o.Enable){case -1:f.addClass("invalid");break;case 0:f.addClass("disabled");break;case 1:break;}}var k;if(this.dictType==YIUI.SECONDARYTYPE.COMPDICT){k=o["Code"]+" "+o["Name"];$("<td>"+k+"</td>").appendTo(f);}else{for(var d=0,e=h.length;d<e;d++){k=o[h[d].key];if(!k){k="";}$("<td>"+k+"</td>").appendTo(f);}}return f;},createRowsHtml:function(f){var e="";for(var d=0,c=f.length;d<c;d++){e+=this.createRow(f[d])[0].outerHTML;}return e;},initDefaultValue:function(c){this.base(c);this._$table=$("table",this.el);},setTotalRowCount:function(c){this.totalRowCount=c==undefined?this.totalRowCount:c;this._pagination.setTotalRowCount(this.totalRowCount,this.isResetPageNum);this.isResetPageNum=false;},diff:function(c){var d=this;d.setTotalRowCount(c.totalRowCount);this.base(c,function(g,j){if(g=="data"){if(j.deletedNodes){this.deleteNodes(j.deletedNodes);for(var h=0,f=j.deletedNodes.length;h<f;h++){this.loadedNodes[j.deletedNodes[h]]=false;}}if(j.addedNodes){this.addNodes(j.addedNodes);}if(j.updatedNodes){for(var h=0,f=j.updatedNodes.length;h<f;h++){this.refreshNode(j.updatedNodes[h]);}}}});if(c.focusedNode){var e=$("#"+c.focusedNode,this._$table);if(e){if(this.selectId){$("#"+this.selectId,this._$table).removeClass("sel-row");}e.addClass("sel-row");this.selectId=c.focusedNode;}}},focusNode:function(d){var c=$("#"+d,this._$table);if(c){if(this.selectId){$("#"+this.selectId,this._$table).removeClass("sel-row");}c.addClass("sel-row");this.selectId=d;if(this.hasClick){this.handler.doOnRowClick(this,c);}else{if(this.hasRowChanged){this.handler.doOnFocusRowChange(this,c);}}}},deleteNodes:function(c){if(c==undefined){return;}this._$table.removeNodes(c);},addNodes:function(c){if(c==undefined){return;}var d=this.createRowsHtml(c);this._$table.addChilds(d);},syncHandleWidths:function(){var d=this;var c=$(".resizer-ctnr",this.el);c.width(d._$table.width());c.find(".resizer").each(function(e,f){return $(f).css({left:$(f).data("th").outerWidth()+($(f).data("th").offset().left-c.offset().left),height:d._$table.height()});});},addColumnResize:function(){var e=this.colModel,h=this.el.find("tr:first-child"),d=h.children(),g=0;var c=$('<div class="resizer-ctnr">');var j=this;var f=$("<div class='ui-resizer' />");this._$table.before(f);},find:function(d){var c=$("#"+d,this._$table);return c.length>0;},getNode:function(d){var c=$("#"+d,this._$table);return c;},expandNode:function(e,d){var c=$("#"+e,this._$table);if(d){this._$table.removeChildren(e);delete this.loadedNodes[e];}this._$table.expand(c);},getSelectedValue:function(c){var d=null;if(this._selectItem){c=c.charAt(0).toLowerCase()+c.slice(1);if(c=="nodeType"){d=this._selectItem.isExpandNode?1:0;}else{if(c.toLowerCase()=="oid"){d=this._selectItem["oid"];}else{d=this._selectItem[c];}}}return d;},getNodeValue:function(d){if(d.length>0){var h=d.attr("id");var e=h.lastIndexOf("_");var g=d.attr("itemkey");var f=d.attr("oid");var c={};c.oid=f||0;c.itemKey=g||this.itemKey;return c;}},removeNode:function(c){this._$table.removeNode(c,true);delete this.loadedNodes[c];},isChainDict:function(){return !this.isHiddenFuzzyBar;},addNodeByItem:function(c,e){if(e==undefined){return;}var d=this.createRowByItem(c,e);this._$table.addChilds(d);},createRowByItem:function(d,f){var k=f.itemKey+"_"+f.oid;delete this.loadedNodes[k];var h=$('<tr id="'+k+'"></tr>');if(d){h.attr("pid",d.attr("id"));}else{h.attr("pid",this.root.id);}if(!this.isChainDict()){if(f.nodeType==1){h.attr("haschild",true);}}if(f.oid!=undefined){h.attr("oid",f.oid);}if(f.itemKey!=undefined){h.attr("itemKey",f.itemKey);}if(f.enable!=undefined){h.attr("enable",f.enable);switch(f.enable){case -1:h.addClass("invalid");break;case 0:h.addClass("disabled");break;case 1:break;}}var g;for(var e=0,c=this.colModel.length;e<c;e++){g=f.getValue(this.colModel[e].key);if(!g){g="";}$("<td>"+g+"</td>").appendTo(h);}return h;},refreshNode:function(c){this.handler.refreshNode(this,c);},getQueryValue:function(){return this._$fuzzyText.val();},clearSelection:function(){if(this.selectId){$("#"+this.selectId,this._$table).removeClass("sel-row");this.selectId=null;}},dependedValueChange:function(f){var e=this.handler.getDictFilter(this);var c=function(h,g){if(g==null){return false;}if(h.itemKey!=g.itemKey){return false;}if(h.formKey!=g.formKey){return false;}if(h.fieldKey!=g.fieldKey){return false;}if(h.filterIndex!=g.filterIndex){return false;}if(h.values.toString()!=g.values.toString()){return false;}if(h.dependency!=g.dependency){return false;}return true;};var d=false;if(e!=null&&!c(e,this.dictFilter)){this.dictFilter=e;d=true;}else{if(e!=null){if(this.dictFilter.dependency&&this.dictFilter.dependency.toLowerCase().indexOf(f.toLowerCase())>=0){d=true;}}else{if(this.dictFilter!=null){this.dictFilter=null;d=true;}}}if(!d){return;}if(this.isChainDict()){this.doGoToPage(dictView,0,true);}else{this.expandNode(this.root.id,true);}}});YIUI.reg("dictview",YIUI.Control.DictView);})();(function(){YIUI.DictQuery=function(c){c=$.extend(true,{startRow:0,maxRows:5,pageIndicatorCount:3,fuzzyValue:"",columns:[{key:"Name",caption:"名称",visible:true,enable:true},{key:"Code",caption:"代码",visible:true,enable:true}]},c);var e=$("<div></div>").attr("id","dict_dialog").addClass("dtquery");var b=YIUI.DictService.getQueryData(c.itemKey,0,c.maxRows,c.pageIndicatorCount,c.fuzzyValue,c.stateMask,c.dictFilter,c.rootValue);var d=new YIUI.Control.TextEditor({metaObj:{x:0,y:0,top:"5px",visible:true},listeners:{change:$.noop},install:$.noop,value:c.fuzzyValue});var f=new YIUI.Control.Button({metaObj:{x:1,y:0,top:"5px",visible:true},listeners:{click:$.noop},value:"查询"});var a=new YIUI.Control.ListView({metaObj:{x:0,y:1,colspan:2,pageRowCount:c.maxRows,visible:true},data:b.data,showPageDetail:false,showFirstButton:false,showLastButton:false,totalRowCount:b.totalRowCount,pageIndicatorCount:c.pageIndicatorCount,columnInfo:c.columns});if(c.displayCols){a.columnInfo=c.displayCols;}a.addDataRow=function(n){var j=$(".tbl-body tbody",a.$table);var l=$("tr.first",j).length==0?false:true;if(a.$table&&n!==undefined){var j=$(".lv-tb .lv-body tbody",this.el);$("tr.space",j).remove();if($("tr.data",j).length==0||$("label.empty",j).length==0){$("label.empty",j).remove();}var k,m,o;$.each(n,function(q,r){k=$("<tr></tr>").addClass("data");if(!l&&q==0){k.addClass("first");}var p=j.children().length+1;if(p%2==0){k.addClass("even");}$.each(a.columnInfo,function(s,u){o=$("<td></td>");if(s==0){var t=$("<span/>").addClass("dict_icon").appendTo(o);if(r.NodeType==0){t.addClass("p_node");}}m=r[u.key];o.append(m);if(u.visible){k.append(o);}});k.data("caption",r["caption"]);k.data("itemKey",r["itemKey"]);k.data("oid",r["oid"]);j.append(k);});}};a.addEmptyRow=function(){var n=$(".lv-tb .lv-body",this.el);var j=$(".tbl-body",n);$("tr.space",j).remove();if($("tr.data",j).first().length==0){var v=$("tbody label.empty",j);if(v.length==0){v=$("<label class='empty'>表中无内容</label>");$("tbody",j).append(v);}var l=$("tr.first",j).width();var w=(n.height()-v.height())/2;v.width(l).css("top",w+"px");return;}var x=$("tr.data",j).first().outerHeight();var k=$(".tbl-body",n).outerHeight();if(!k){var u=$("tr.data",j).length;k=0;for(var o=0;o<u;o++){k+=$("tr.data",j).eq(o).outerHeight();}}var r=((n[0].clientHeight||n.height())-k);var t=Math.ceil(r/x);var m=r-(t-1)*x;if(t<=0){return;}for(var o=0;o<t;o++){var q=$("<tr></tr>").addClass("space").appendTo(j);var s=q.index()+1;if(s%2==0){q.addClass("even");}$.each(this.columnInfo,function(y,z){var A=$("<td></td>");if(z.visible){q.append(A);}});if(o==t-1){q.addClass("last");$("td",q).height(m);var p=n.height()-j.height();if(p>0&&p<x){$("td",q).height(m+p);}}else{q.outerHeight(x);}}};a.createColumnHead=function(){var m=$(".tbl-head thead",this.$table);var k=$(".tbl-body tbody",this.$table);if(this.columnInfo&&this.columnInfo.length>0){var o=$("<tr></tr>"),n;var q=$('<tr class="first"></tr>'),p;for(var l=0,j=this.columnInfo.length;l<j;l++){this.columnInfo[l].width=Math.round((1/j)*100)+"%";n=$("<th><label>"+this.columnInfo[l].caption+"</label></th>").attr("colIndex",l);n.css("width",$.getReal(this.columnInfo[l].width,this.calcRealValues(this.columnInfo,this.$table.width())));$("label",n).css("width",n.width()).css("overflow","hidden").css("text-overflow","ellipsis").css("display","block");p=$("<td></td>").attr("colIndex",l);p.css("width",$.getReal(this.columnInfo[l].width,this.calcRealValues(this.columnInfo,this.$table.width())));p.css("height","0px");if(this.columnInfo[l].visible!=false){o.append(n);q.append(p);}}}m.append(o);k.append(q);};a.onSetWidth=function(l){this.el.css("width",l);this._pagination.content.css("width",l);var p=$("th",this.$table),j=$("tr.first td",this.$table),s,k,m,r;var q=0;for(var n=0,o=this.columnInfo.length;n<o;n++){s=$("[colindex="+n+"]",this.$table);k=j.eq(s.index());if(!this.columnInfo[n].visible){continue;}m=$.getReal(this.columnInfo[n].width,this.calcRealValues(this.columnInfo,this.$table.width()));s.css("width",m);k.css("width",s.width());k.outerWidth(s.outerWidth());$("label",s).css("width",m);q+=m;}this.syncHandleWidths();};var h=new YIUI.Panel.GridLayoutPanel({metaObj:{rowGap:5,columnGap:5,leftPadding:5,topPadding:5,bottomPadding:5},widths:["99%",80],minWidths:[-1,-1],heights:[30,"100%"],items:[d,f,a]});e.modalDialog(null,{title:"提示框",showClose:false,width:"500px",height:"345px"});h.render(e.dialogContent());$(".dialog-close",e).click(function(){c.callback();c.textInput.focus();});f.el.unbind();$("input",d.el).unbind();f.el.click(function(j){g(d.getValue(),0,true);});d.el.keypress(function(j){if(j.keyCode==13){f.el.click();$("input",d.el).blur();}});a.el.addClass("ui-dictquery");a._pagination.pageChanges=function(j){g(d.getValue(),j*c.maxRows);};var g=function(m,j,l){var k=YIUI.DictService.getQueryData(c.itemKey,j,c.maxRows,c.pageIndicatorCount,m,c.stateMask,c.dictFilter,c.rootValue);if(j==0&&k.totalRowCount<c.maxRows){a._pagination.hidePagination();}else{if(k.totalRowCount){a._pagination.setTotalRowCount(k.totalRowCount+j,l||false);}}a.data=k.data;a.clearDataRow();a.addDataRow(a.data);a.addEmptyRow();};a.$table.undelegate();a.$table.delegate("tr","dblclick",this.doubleClick==null?function(o){if(!a.enable||$(this).attr("enable")=="false"){return;}var m=$(o.target).index();var q=$(o.target).parent().index();var k=$(this).data("caption"),p=$(this).data("itemKey"),n=$(this).data("oid"),l={};l.oid=n||0;l.itemKey=p;l.caption=k;var j=new YIUI.ItemData(l);c.callback(j);e.close();c.textInput.focus();o.stopPropagation();}:this.doubleClick);};})();YIUI.Control.Hyperlink=YIUI.extend(YIUI.Control,{autoEl:'<a class="ui-hlk"></a>',handler:YIUI.HyperLinkHandler,behavior:YIUI.HyperLinkBehavior,target:"_self",targetType:"Current",setText:function(a){this.hyperlink.setText(a);},needClean:function(){return false;},onRender:function(a){this.base(a);var b=this;this.hyperlink=new YIUI.Yes_HyperLink({el:b.el,url:b.getMetaObj().url,targetType:b.getMetaObj().targetType});this.setValue(this.value);if(this.text){this.hyperlink.setText(this.text);}else{this.hyperlink.setText(this.caption);}},setTip:function(a){var a=this.text||this.caption;this.base(a);},setURL:function(a){this.url=a;this.hyperlink.setURL(this.url);},setTarget:function(){this.targetType=targetType;this.hyperlink.setTarget(this.targetType);},onSetHeight:function(a){this.base(a);this.hyperlink.setHeight(a);},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){var a=this;if(this.hyperlink.getText()!=""){this.el.click(function(){if(!a.enable){return;}a.handler.doOnClick(a);});}this.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.el.removeAttr("tabIndex");a.el.blur();a.focusManager.requestNextFocus(a);b.preventDefault();}});},initDefaultValue:function(a){this.base(a);var b=this;this.hyperlink=new YIUI.Yes_HyperLink({el:b.el,isPortal:true});this.install();},setEnable:function(a){this.base(a);this.hyperlink.setEnable(a);},checkEnd:function(a){this.text=a;this.hyperlink.setText(this.text);}});YIUI.reg("hyperlink",YIUI.Control.Hyperlink);YIUI.Control.ImageList=YIUI.extend(YIUI.Control,{autoEl:"<img>",items:null,defaultValue:null,setValue:function(a){this.base(a);if(this.items){this.el.attr("src",this.items[a]);}},onRender:function(a){this.base(a);if(this.items){if(this.defaultValue){this.el.attr("src",this.items[this.defaultValue]);}else{this.el.attr("src",this.items[0]);}}}});YIUI.reg("imagelist",YIUI.Control.ImageList);YIUI.Control.Label=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",icon:null,onSetWidth:function(a){this.yesLabel.setWidth(a);},onSetHeight:function(a){this.yesLabel.setHeight(a);},setFormatStyle:function(a){this.yesLabel.setCssStyle(a);},setIcon:function(a){this.yesLabel.setIcon(a);},needClean:function(){return false;},setTip:function(a){var a=this.value;this.base(a);},setValue:function(b,d,a){var c=this.base(b,d,a);this.yesLabel.setValue(this.value);return c;},onRender:function(a){this.base(a);var b=this;b.value=b.value||b.caption;this.yesLabel=new YIUI.Yes_Label({el:b.el,icon:b.getMetaObj().icon,caption:b.value});if(this.buddy){this.el.addClass("ui-innerlbl");}else{this.el.addClass("ui-lbl");}}});YIUI.reg("label",YIUI.Control.Label);YIUI.Control.ListView=YIUI.extend(YIUI.Control,{handler:YIUI.ListViewHandler,behavior:YIUI.ListViewBehavior,$table:null,height:"100%",$handleContainer:null,getFieldArray:function(b,a){var e=this.columnInfo;var j="";for(var h=0,k=e.length;h<k;h++){var f=e[h];if(f.columnKey==a){j=f.key;break;}}var l=b.getDocument(),d=new Array(),c;c=l.getByKey(this.getMetaObj().tableKey);var g=this.data,m=this.columnInfo;for(var h=0,k=g.length;h<k;h++){if(!this.isActiveRowSelect(h)){continue;}d.push(this.getValByKey(h,j));}return d;},isActiveRowSelect:function(b){if(this.hasSelectField){var a=this.selectFieldIndex;return this.getValue(b,a);}return true;},onRender:function(e){this.base(e);this.el.addClass("ui-lv");if($.browser.isIE){this.el.attr("onselectstart","return false");}var p=this;var k=p.getMetaObj().pageRowCount;var h=p.getMetaObj().loadType;p._pagination=p.el.pagination({pageSize:k,totalNumber:p.totalRowCount,showPages:true,showPageDetail:p.showPageDetail||false,showFirstButton:p.showFirstButton,showLastButton:p.showLastButton,pageNumber:p.pageNumber||1,pageIndicatorCount:p.pageIndicatorCount||5});var g=$("<tbody></tbody>");var n=$("<thead></thead>");var j=$('<div class="lv-div"></div>').appendTo(p._pagination.content);this.$table=$('<table class="lv-tb"></table>').appendTo(j);var m=$('<tr class="head"></tr>').appendTo(this.$table);var l=$("<td></td>").attr("colspan",this.columnInfo.length+1).appendTo(m);var o=$('<div class="lv-head"></div>').appendTo(l);var f=$('<table class="tbl-head"></table>').append(n).appendTo(o);var b=$('<tr class="body"></tr>').appendTo(this.$table);var a=$("<td></td>").attr("colspan",this.columnInfo.length+1).appendTo(b);var c=$('<div class="lv-body"></div>').appendTo(a);var d=$('<table class="tbl-body"></table>').append(g).appendTo(c);this.createColumnHead();if(this.totalRowCount<=this.getMetaObj().pageRowCount){this._pagination.hidePagination();}this._createHandles();this.syncHandleWidths();this.addDataRow(this.data);},setColStyle:function(a,c){var d={};c.backColor&&(d["background-color"]=c.backColor);c.foreColor&&(d["color"]=c.foreColor);var b=c.font;if(b){b.name&&(d["font-family"]=b.name);b.size&&(d["font-size"]=b.size);b.bold&&(d["font-weight"]="bold");b.italic&&(d["font-style"]="italic");}a.css(d);},addEmptyRow:function(){var f=$(".lv-tb .lv-body",this.el);var a=$(".tbl-body",f);$("tr.space",a).remove();if($("tr.data",a).first().length==0){var q=$("tbody label.empty",a);if(q.length==0){q=$("<label class='empty'>表中无内容</label>");$("tbody",a).append(q);}var c=$("tr.first",a).width();var r=(f.height()-q.height())/2;q.width(c).css("top",r+"px");return;}var s=$("tr.data",a).first().outerHeight();var b=$(".tbl-body",f).outerHeight();if(!b){var o=$("tr.data",a).length;b=0;for(var g=0;g<o;g++){b+=$("tr.data",a).eq(g).outerHeight();}}var d=(f[0].clientHeight||f.height());var l=(d-b);var n=Math.ceil(l/s);var e=l-(n-1)*s;if(n<=0){return;}for(var g=0;g<n;g++){var k=$("<tr></tr>").addClass("space").appendTo(a);var m=k.index()+1;if(m%2==0){k.addClass("even");}$("<td></td>").addClass("seq").appendTo(k);var p=this;$.each(this.columnInfo,function(h,t){var u=$("<td></td>");if(t.visible){k.append(u);}if(t.format){p.setColStyle(u,t.format);}});$("<td class='space'></td>").appendTo(k);if(g==n-1){k.addClass("last");$("td",k).height(e);var j=d-a.height();if(j>0&&j<s){$("td",k).height(e+j);}}else{k.outerHeight(s);}}},onSetHeight:function(b){this.el.css("height",b);var e=$(".paginationjs-pages",this.el).is(":hidden")?0:$(".paginationjs-pages",this.el).outerHeight();var d=b-e;this._pagination.content.css("height",d);var g=$(".lv-tb .head",this.el).outerHeight();var c=d-g;var a=$(".lv-tb .lv-head",this.el);var f=$(".lv-tb .lv-body",this.el);f.outerHeight(c-2);$(".space",a).css("width","100%");this.addEmptyRow();this.syncHandleWidths();},onSetWidth:function(c){this.el.css("width",c);this._pagination.content.css("width",c);var g=$("th",this.$table),a=$("tr.first td",this.$table),k,b,d,j;$("th.space",this.$table).css("width","100%");var h=0;for(var e=0,f=this.columnInfo.length;e<f;e++){k=$("[colindex="+e+"]",this.$table);b=a.eq(k.index());if(!this.columnInfo[e].visible){continue;}d=$.getReal(this.columnInfo[e].width,this.calcRealValues(this.columnInfo,this.el.width()));k.css("width",d);b.css("width",k.width());b.outerWidth(k.outerWidth());$("label",k).css("width",d);h+=d;}this.syncHandleWidths();},createColumnHead:function(){var c=$(".tbl-head thead",this.$table);var a=$(".tbl-body tbody",this.$table);if(this.columnInfo&&this.columnInfo.length>0){var e=$("<tr></tr>"),d;var g=$('<tr class="first"></tr>'),f;for(var b=0;b<this.columnInfo.length;b++){if(b==0){d=$("<th><label>序</label></th>").addClass("seq");$("label",d).css("width","100%").css("overflow","hidden").css("text-overflow","ellipsis").css("display","block");e.append(d);f=$("<td></td>").addClass("seq");f.css("height","0px");g.append(f);}d=$("<th><label>"+this.columnInfo[b].caption+"</label></th>").attr("colIndex",b);d.css("width",$.getReal(this.columnInfo[b].width,this.calcRealValues(this.columnInfo,this.el.width())));$("label",d).css("width",d.width()).css("overflow","hidden").css("text-overflow","ellipsis").css("display","block");f=$("<td></td>").attr("colIndex",b);f.css("width",$.getReal(this.columnInfo[b].width,this.calcRealValues(this.columnInfo,this.el.width())));f.css("height","0px");if(this.columnInfo[b].visible){e.append(d);g.append(f);}}$("<th class='space'></th>").appendTo(e);$("<td class='space'></td>").css("height","0px").appendTo(g);}c.append(e);a.append(g);},setColumnCaption:function(d,b){var c=this.findIndex(d);var a=$("thead th[colIndex='"+c+"'] label",this.$table);a.text(b);},setColumnEnable:function(b,e){var h=this.findIndex(b);var j=$("thead th[colIndex='"+h+"']",this.$table);var d=j.index();if(d>-1){for(var c=0,g=this.data.length;c<g;c++){var f=$(".tbl-body tr",this.$table).eq(c);var a=$("td",f).eq(d);var k=a.children();this.setEnableByEl(k,e);}}},setEnableByEl:function(b,a){if(a){$(b,this.el).removeAttr("disabled");$(b,this.el).removeClass("disabled");}else{$(b,this.el).attr("disabled","disabled");$(b,this.el).addClass("disabled");}},setColumnVisible:function(b,c){var h=this.findIndex(b);var j=$("thead th[colIndex='"+h+"']",this.$table);c?j.show():j.hide();var e=j.index();if(e>-1){for(var d=0,g=this.data.length;d<g;d++){var f=$(".tbl-body tr",this.$table).eq(d);var a=$("td",f).eq(e);c?a.show():a.hide();}}},calcRealValues:function(f,d){var g=0,e,c;for(var b=0,a=f.length;b<a;b++){e=f[b].width;if($.isNumeric(e)&&e>0){g+=parseInt(e);}}c=d-g;return c<0?10:c;},addDataRow:function(f){if(f&&this.$table){var a=$(".tbl-body tbody",this.$table);$("tr.space",a).remove();if($("tr.data",a).length==0){$("label.empty",a).remove();}var d,e,g;var b=this;var c=$("tr.first",a).length==0?false:true;$.each(f,function(j,k){d=$("<tr></tr>").addClass("data");g=$("<td></td>").addClass("seq");if(!c&&j==0){d.addClass("first");}var h=a.children().length+1;if(h%2==0){d.addClass("even");}d.append(g.html(a.children().length));$.each(b.columnInfo,function(q,o){g=$("<td></td>");g.css("width",$.getReal(o.width,b.calcRealValues(b.columnInfo,b.el.width())));var t=k[o.key];e=(t&&t.value!=="")?t.caption:"";switch(o.columnType){case YIUI.CONTROLTYPE.TEXTEDITOR:e=YIUI.TextFormat.format(e,this);g.text(e);break;case YIUI.CONTROLTYPE.CHECKBOX:var r=$('<span class="chk"/>');r.attr("isChecked",e=="1"?"true":"false");r.addClass(e=="1"?"checked":"");r.attr("enable",o.enable);r.data("key",o.key);g.append(r);b.setEnableByEl(r,o.enable);o.el=r;break;case YIUI.CONTROLTYPE.BUTTON:var s=$("<button></button>");s.addClass("btn");var p=$("<span class='imginfo' style='display: inline-block;height: 16px;width: 16px;vertical-align: middle;'></span>");var n=$("<span style='width:165px;font-weight: normal;overflow: hidden;max-width: 100%;text-overflow: ellipsis;vertical-align: middle;'>"+e+"</span>");p.css("background","url('Resource/"+this.icon+"')");s.attr("enable",o.enable);s.data("key",o.key);s.append(p);n.appendTo(s);g.append(s);b.setEnableByEl(s,o.enable);o.el=s;break;case YIUI.CONTROLTYPE.HYPERLINK:var m=$("<a>"+e+"</a>");m.addClass("hlk");m.attr({href:"javascript:void(0);",target:"_self"});m.attr("enable",o.enable);m.data("key",o.key);g.append(m);b.setEnableByEl(m,o.enable);o.el=m;break;case YIUI.CONTROLTYPE.DATEPICKER:var l=o.isOnlyDate;if(l){e=e.split(" ")[0];}g.text(e);break;default:g.html(e);break;}if(o.visible){d.append(g);}if(o.format){b.setColStyle(g,o.format);}});$("<td class='space'></td>").appendTo(d);a.append(d);});}},clearDataRow:function(){if(this.$table){var a=$(".tbl-body tbody",this.$table);$("tr",a).not(".first").remove();}},clearAllRows:function(){this.data=[];this.clearDataRow();},diff:function(b){var a=this;a.totalRowCount=b.totalRowCount||a.totalRowCount;if(b.totalRowCount==undefined){a.totalRowCount=a.totalRowCount;}else{a.totalRowCount=b.totalRowCount;}var d=b.columnInfo;var c=$(".lv-tb .lv-body",this.el);var e=c.outerHeight();if(a.totalRowCount<a.getMetaObj().pageRowCount){if(!$(".paginationjs-pages",this.el).is(":hidden")){e+=$(".paginationjs-pages",this.el).outerHeight();a._pagination.hidePagination();}}else{if(a.totalRowCount){a._pagination.setTotalRowCount(a.totalRowCount,true);if($(".paginationjs-pages",this.el).is(":hidden")){e-=$(".paginationjs-pages",this.el).outerHeight();}}}c.css("height",e+"px");if(b.data){a.data=b.data;a.clearDataRow();a.addDataRow(a.data);}else{if(d){$("thead",a.$table).empty();a.clearDataRow();a.columnInfo=d;a.createColumnHead();a._createHandles();a.syncHandleWidths();a.addDataRow(a.data);}}this.addEmptyRow();},initDefaultValue:function(k){this.$table=$("table",this.el);this._createHandles();this.syncHandleWidths();this.totalRowCount=k.totalrowcount;this.pageRowCount=k.pagerowcount;if(k.columnkey){this.columnKey=k.columnkey;}if(k.tablekey){this.tableKey=k.tablekey;}this._pagination=this.el.pagination({pageSize:this.pageRowCount,totalNumber:this.totalRowCount,showPages:true,pageIndicatorCount:5});this.$table.appendTo(this._pagination.content);this._pagination.content.css("width",this.el.width());var g=$("th",this.$table),j,a,h,c=[],b;for(var d=0,e=g.length;d<e;d++){j=g.eq(d);b={};b.key=j.attr("key");b.enable=j.attr("enable");b.visible=j.attr("visible");b.columnType=j.attr("columnType");c.push(b);}this.columnInfo=c;var f=this.el.height()-$(".paginationjs-pages",this.el).height();this._pagination.content.css("height",f);},reload:function(){var a=YIUI.FormStack.getForm(this.ofFormID);var b=YIUI.ShowListView(a,this);b.load(this);},repaint:function(){this.clearDataRow();this.addDataRow(this.data);this.addEmptyRow();},needTip:function(){return false;},install:function(){var b=this;b._pagination.pageChanges=function(d){b.handler.doGoToPage(b,d);b.addEmptyRow();};if(this.hasDblClick){b.$table.delegate(".tbl-body tr.data","dblclick",function(d){if(!b.enable||$(this).attr("enable")=="false"){return;}var e=$(d.target).parents("tr").index()-1;b.handler.doOnRowDblClick(b,e);});}b.$table.delegate(".tbl-body tr","click",function(e){if(!$(this).hasClass("data")){if(b._selectedRow){b._selectedRow.removeClass("clicked");b._selectedRow=null;}return;}var d=true;var g=$(e.target).parents("tr").index()-1;var f;if(b._selectedRow){f=b._selectedRow.index()-1;d=(f!=g);b._selectedRow.removeClass("clicked");}$(this).addClass("clicked");b._selectedRow=$(this);if(b.hasClick){b.handler.doOnRowClick(b,g);}else{if(d&&b.hasRowChanged){b.handler.doOnFocusRowChange(b,f,g);}}});b.$table.delegate(".chk","click",function(f){if(!b.enable||$(this).attr("enable")=="false"){return;}if($(this).attr("isChecked")&&$(this).attr("isChecked")=="true"){$(this).attr("isChecked","false");$(this).removeClass("checked");}else{$(this).attr("isChecked","true");$(this).addClass("checked");}var e=$(f.target).parent("td").index();var d=$("thead th",b.$table).eq(e).attr("colIndex");var h=$(f.target).parents("tr").index()-1;var g=$(this).attr("isChecked")=="true"?true:false;b.handler.doCellValueChanged(b,h,d,g);f.stopPropagation();});b.$table.delegate(".btn","click",function(e){if(!b.enable||$(this).attr("enable")=="false"){return;}var d=$(this).data("key");var f=$(e.target).parents("tr").index()-1;b.handler.doOnCellClick(b,f,d);e.stopPropagation();});b.$table.delegate(".hlk","click",function(e){if(!b.enable||$(this).attr("enable")=="false"){return;}var f=$(e.target).parents("tr").index()-1;var d=$(this).data("key");b.handler.doOnCellClick(b,f,d);e.stopPropagation();});var c=$(".lv-tb .lv-body",this.el);var a=$(".lv-tb .lv-head",this.el);c.scroll(function(){var e=c.scrollLeft();a.scrollLeft(e);if(c[0].clientWidth!=c[0].scrollWidth){var d=c.width()-c[0].clientWidth;$(".space",a).outerWidth(d);}b.syncHandleWidths();});},_createHandles:function(){var a=this;this.$handleContainer=$("<div class='rc-handle-cntr'/>");this.$table.before(this.$handleContainer);this.$table.find("tr th").each(function(b,c){var d;d=$("<div class='rc-handle' />");d.data("th",$(c));d.bind("mousedown",a,function(m){var f,o,p,l=m.data;m.preventDefault();f=$(m.currentTarget);o=f.data("th");p=o.width();var n=$(m.target);n.addClass("clicked");n.data("startPos",n.position().left);var j=m.clientX;var g,q,k;var r=o.parents("table").eq(0);var h=$(".lv-tb .lv-body",l.el);var s=(h[0].clientHeight||h.height());$(document).on("mousemove.rc",function(t){g=t.clientX-j;n.css("left",n.data("startPos")+g);q=p+g;k=r.width()+g;if(q<10){q=10;k+=10-q;}});return $(document).one("mouseup",function(v){$(document).off("mousemove.rc");o.outerWidth(q);$("label",o).width(q);var u=o.index();var w=$(".lv-tb .lv-body tr.first td",l.el).eq(u);w.css("width",q);n.removeClass("clicked");var t=(h[0].clientHeight||h.height());if(s!=t){l.addEmptyRow();}return l.syncHandleWidths();});});return d.appendTo(a.$handleContainer);});},syncHandleWidths:function(){var a=this;this.$handleContainer.width(this.$table.width());this.$handleContainer.find(".rc-handle").each(function(b,c){return $(c).css({left:$(c).data("th").outerWidth()+($(c).data("th").offset().left-a.$handleContainer.offset().left),height:a.$table.height()});});},getFocusRowIndex:function(){var a=-1;if(this._selectedRow){a=this._selectedRow.index()-1;}return a;},findIndex:function(c){var e=this.columnInfo,b=-1;for(var d=0,a=e.length;d<a;d++){if(e[d].key==c){b=d;break;}}return b;},setValByKey:function(f,b,d,e,c){var a=this.findIndex(b);this.setValByIndex(f,a,d,e,c);},setValByIndex:function(rowIndex,colIndex,value,commit,fireEvent){var $tdIndex=$(".tbl-head thead th[colIndex='"+colIndex+"']",this.$table).index();if($tdIndex>-1){var $td=$(".tbl-body tbody tr.data",this.$table).eq(rowIndex).children("td").eq($tdIndex);var column=this.columnInfo[colIndex];switch(column.columnType){case YIUI.CONTROLTYPE.CHECKBOX:var $chk=$td.children();var isChecked=$chk.attr("isChecked")=="true"?true:false;var chkVal=value==true?true:false;if(chkVal==isChecked){break;}if(value){$chk.attr("isChecked","false");$chk.removeClass("checked");}else{$chk.attr("isChecked","true");$chk.addClass("checked");}break;case YIUI.CONTROLTYPE.BUTTON:$td.children("button").html(value);break;case YIUI.CONTROLTYPE.HYPERLINK:$td.children("a").html(value);break;default:$td.html(value);}if(column.valueChanged){var form=YIUI.FormStack.getForm(this.ofFormID);form.eval(column.valueChanged,{form:form},null);}}},getValue:function(c,a){var b=this.columnInfo[a].key;return this.getValByKey(c,b);},getValByKey:function(b,a){return this.data[b][a].value;},getRowCount:function(){return this.data.length;},deleteRow:function(g){this.data.splice(g,1);var b=$(".tbl-body tbody",this.$table);$("tr.data",b).eq(g).remove();var a=this.data.length;for(var d=g;d<a+1;d++){var e=$("tr.data",b).eq(g);var c=g+1;var f=$(".seq",e).html(c);if(c%2==0){e.addClass("even");}else{e.removeClass("even");}}$("tr.space",b).remove();this.addEmptyRow();},addNewRow:function(b){this.data.push(b);var a=[];a.push(b);this.addDataRow(a);this.addEmptyRow();}});YIUI.reg("listview",YIUI.Control.ListView);(function(a){YIUI.Control.NumberEditor=YIUI.extend(YIUI.Control,{handler:YIUI.NumberEditorHandler,behavior:YIUI.NumberEditorBehavior,decPrecision:16,showZero:false,init:function(c){this.base(c);var b="";for(var d=0;d<this.getMetaObj().decPrecision-this.getMetaObj().decScale;d++){b+="9";}if(this.getMetaObj().decScale>0){b+=".";for(var d=0;d<this.getMetaObj().decScale;d++){b+="9";}}this.settings={aNum:"0123456789",aSep:this.getMetaObj().sep,dGroup:this.getMetaObj().groupingSize,aDec:this.getMetaObj().decSep,aSign:"",pSign:"s",vMax:b,vMin:"-"+b,mDec:this.getMetaObj().decScale,mRound:this.getMetaObj().roundingMode,altDec:null};},isNull:function(){var b=this.value.toString();if(b){b=parseFloat(b);return b==0?true:false;}else{return true;}},getValue:function(){return this.yesNumEd.getValue();},getCheckOpts:function(b){var c=this.base(b);var b={decScale:this.getMetaObj().decScale,roundingMode:this.roundingMode};c=a.extend(c,b);return c;},checkEnd:function(b){this.value=b;this.caption=b;this.yesNumEd.setValue(b);},setEnable:function(b){this.enable=b;this.yesNumEd.setEnable(b);},setBackColor:function(b){this.yesNumEd.setBackColor(b);},setForeColor:function(b){this.yesNumEd.setForeColor(b);},setFormatStyle:function(b){this.yesNumEd.setFormatStyle(b);},onSetHeight:function(b){this.yesNumEd.setHeight(b);},onSetWidth:function(b){this.yesNumEd.setWidth(b);},setPromptText:function(b){this.yesNumEd.setPromptText(b);},getText:function(){var b=this.base();return b.toString();},setTip:function(b){var b=this.text;this.base(b);},onRender:function(c){this.base(c);this.el.addClass("ui-numed");var d=this;var b=this.getMetaObj();this.yesNumEd=new YIUI.Yes_NumberEditor({el:d.el,value:d.value,settings:d.settings,required:d.required,showZero:b.showZero,selectOnFocus:b.selectOnFocus,valueChange:function(e){d.setValue(e,true,true);}});this.setValue(this.value,false,false);b.promptText&&this.setPromptText(b.promptText);b.showZero&&this.setShowZero(b.showZero);},setShowZero:function(b){this.showZero=b;},isShowZero:function(){return this.showZero;},initDefaultValue:function(c){this.base(c);this._input=a("input",c.el);if(!c.selectOnFocus){this.selectOnFocus=c.selectOnFocus;}if(c.error){this.setError(c.error);}if(c.decPrecision!=undefined&&c.decPrecision!=16){this.decPrecision=c.decPrecision;}if(c.decScale!=undefined&&c.decScale!=2){this.decScale=c.decScale;}if(c.groupingSize!=undefined&&c.groupingSize!=3){this.groupingSize=c.groupingSize;}if(!c.useSep){this.useSep=c.useSep;}if(c.sep){this.sep=c.sep;}if(c.decSep){this.decSep=c.decSep;}if(c.roundingMode!=undefined&&c.roundingMode!=0){this.roundingMode=c.roundingMode;}if(c.columnKey){this.columnKey=c.columnKey;}if(c.tableKey){this.tableKey=c.tableKey;}var b="";for(var d=0;d<this.decPrecision-this.decScale;d++){b+="9";}if(this.decScale>0){b+=".";for(var d=0;d<this.decScale;d++){b+="9";}}this.settings={aNum:"0123456789",aSep:this.useSep?this.sep:"",dGroup:this.groupingSize,aDec:this.decSep,aSign:"",pSign:"s",vMax:b,vMin:"-"+b,mDec:this.decScale,mRound:this.roundingMode};a.extend(this,c);var e=this;this.yesNumEd=new YIUI.Yes_NumberEditor({el:e.el,isPortal:true,settings:e.settings,required:e.required,selectOnFocus:this.selectOnFocus,valueChange:function(f){e.setValue(f,true,true);}});this.install();},focus:function(){this.yesNumEd&&this.yesNumEd.getInput().focus();},install:function(){var b=this;this.yesNumEd.getInput().keydown(function(c){var d=c.keyCode||c.charCode;if(d===13||d===108||d===9){b.focusManager.requestNextFocus(b);c.preventDefault();}});}});YIUI.reg("numbereditor",YIUI.Control.NumberEditor);}(jQuery));YIUI.Control.Image=YIUI.extend(YIUI.Control,{sourceType:YIUI.IMAGE_SOURCETYPE.DATA,image:"",maxSize:-1,imageCut:false,stretch:false,handler:YIUI.ImageHandler,behavior:YIUI.ImageBehavior,setValue:function(d,f,b){this._image.setValue(d);this.base(d,f,b);if(this.getMetaObj().sourceType==YIUI.IMAGE_SOURCETYPE.DATA&&d&&d.length>0){var c=YIUI.FormStack.getForm(this.ofFormID);var e=c.formKey;var a=Svr.SvrMgr.AttachURL+"?path="+BASE64.encoder(d)+"&formKey="+e+"&service=DownloadImage&mode=1&r="+Math.random();this._image.getImage().attr("src",a);this.el.attr("formKey",e);}},getValue:function(){return this._image.value;},setSourceType:function(a){this.sourceType=a;this._image.setSourceType(a);},onSetHeight:function(a){this.base(a);this._image.setHeight(a);},onSetWidth:function(a){this.base(a);this._image.setWidth(a);},setImage:function(a){this._image.setImagePath(a);},setImageCut:function(a){this._image.setImageCut(a);},setEnable:function(a){this._image.setEnable(a);},onRender:function(a){this.base(a);var c=this;var b=new Array("gif","jpg","jpeg","png","bmp");this._image=new YIUI.Yes_Image({el:c.el,sourceType:c.getMetaObj().sourceType,stretch:c.getMetaObj().stretch,maxSize:c.getMetaObj().maxSize,imageCut:c.getMetaObj().imageCut,uploadImg:function(h,e){var d=c;var f=YIUI.FormStack.getForm(d.ofFormID);var g=function(j){var k=$.checkFile(j,c.getMetaObj().maxSize,b);if(!k||f.OID==null||f.OID==-1){return;}e=$.extend({service:"UploadImage",controlKey:d.key,formKey:f.formKey,operatorID:$.cookie("userID"),fileID:-1,oid:f.OID,mode:1},e);$.ajaxFileUpload({url:Svr.SvrMgr.AttachURL,secureuri:false,fileElement:j,data:e,type:"post",success:function(m,l,n){n.attr("accept","image/*");m=JSON.parse(m);d.setValue(m.data.replace(/\\/g,"/"),true,true);},error:function(m,l,n){alert(n);}});};g(h);},change:function(){c.setValue("",true,true);}});this.el.addClass("ui-img");this._image.getImage().attr("alt",this.caption);if(this.value){this.setValue(this.value,true,true);}if(this.image){this.setImage(this.image);}if(!this.value&&!this.image){this._image.getImage().attr("src",YIUI.Image.EmptyImg);}},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());this._image.getImage().css("height",this.el.innerHeight());},downPicture:function(){alert(123);},focus:function(){this.el.attr("tabIndex",this.getTabIndex());this.el.focus();},install:function(){$(this.el).unbind("click");var a=this;$("img",a.el).click(function(b){if(a._image.enable){if(a.getMetaObj().sourceType==YIUI.IMAGE_SOURCETYPE.DATA&&a.getValue()==undefined){return;}a.handler.doOnClick(a);}});this.el.keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.el.removeAttr("tabIndex");a.el.blur();a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("image",YIUI.Control.Image);YIUI.Control.RadioButton=YIUI.extend(YIUI.Control,{autoEl:'<div class="ui-rdo">',handler:YIUI.RadioButtonHandler,behavior:YIUI.RadioButtonBehavior,checked:false,groupKey:"",metaValue:"",listeners:{change:function(){var a=this;if(!this.getMetaObj().isGroupHead){var b=YIUI.FormStack.getForm(this.ofFormID);a=b.getComponent(this.groupHeadKey);}var c=a.getValue();if(typeof c=="object"&&c!=null){c=$.toJSON(c);}this.handler.doValueChanged(a,c,true,true);}},checkEnd:function(d){this.value=d;if($.isDefined(d)&&d){var e=$("[name="+this.ofFormID+"_"+this.getMetaObj().groupKey+"]");for(var c=0,a=e.length;c<a;c++){var b=e.eq(c);if(b.val()==d){b.prop("checked",true);$(this._groKey).data(this._groKey,d);}}}},getValue:function(){var a=$(this._groKey).data(this._groKey);return a;},setText:function(a){$("label",this.el).html(a);},getText:function(){return $("label",this.el).html();},setEnable:function(b){this.enable=b;var c=$("input",this.el),a=this.el;if(this.enable){c.removeAttr("disabled");a.removeClass("ui-readonly");}else{c.attr("disabled","disabled");a.addClass("ui-readonly");}},onSetHeight:function(a){this.base(a);$("label",this.el).css({height:a+"px",lineHeight:a+"px"});var b=$("input",this.el);b.css("margin-top",(a-b.height())/2);},onSetWidth:function(a){this.base(a);$("label",this.el).css("width",a-$("input",this.el).outerWidth());},setFormatStyle:function(a){$("label",this.el).css(a);},onRender:function(c){this.base(c);var b=$('<input id="radio_'+this.id+'" type="radio" value="'+this.getMetaObj().metaValue+'" name="'+this.ofFormID+"_"+this.getMetaObj().groupKey+'">').appendTo(this.el);b.prop("checked",(this.checked||false));this._groKey="ui_"+this.getMetaObj().groupKey+"_"+this.ofFormID;var a=this.text.replace(/ /g,"&nbsp;");$('<label id=label_"'+this.id+' for="radio_'+this.id+'">'+a+"</label>").appendTo(this.el);if(this.getMetaObj().isGroupHead){var d=this._groKey;$("<"+d+"/>").appendTo(this.el);}$(this._groKey).data(this._groKey,this.value);},focus:function(){$("input",this.el).focus();},install:function(){this.base();var a=this;this.el.children("input").click(function(c){var b=$(a._groKey).data(a._groKey);$(a._groKey).data(a._groKey,this.value);if(b!=this.value){a.fireEvent("change",c);}});$("input",this.el).keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108||c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("radiobutton",YIUI.Control.RadioButton);YIUI.Control.TextEditor=YIUI.extend(YIUI.Control,{autoEl:"<span></span>",handler:YIUI.TextEditorHandler,behavior:YIUI.TextEditorBehavior,maxLength:Number.MAX_VALUE,textCase:YIUI.TEXTEDITOR_CASE.DEFAULT,invalidChars:null,promptText:null,trim:true,selectOnFocus:true,mask:null,icon:null,embedText:null,preIcon:null,holdFocus:false,getCheckOpts:function(a){var b=this.base(a);var a={trim:this.getMetaObj().trim,textCase:this.getMetaObj().textCase,maxLength:this.getMetaObj().maxLength,invalidChars:this.getMetaObj().invalidChars};b=$.extend(b,a);return b;},checkEnd:function(a){this.value=a;this.yesText.setValue(a);this.caption=a;$("input",this.yesText.el).val(a);},getValue:function(){return this.yesText.getValue();},setEnable:function(a){this.enable=a;this.yesText.setEnable(a);},setBackColor:function(a){this.yesText.setBackColor(a);},setForeColor:function(a){this.yesText.setForeColor(a);},setFormatStyle:function(a){this.yesText.setFormatStyle(a);},onSetHeight:function(a){this.yesText.setHeight(a);},onSetWidth:function(a){this.yesText.setWidth(a);},getOuterEl:function(){return this.el;},diff:function(a){this.base(a);},setTip:function(a){var a=this.value;this.base(a);},onRender:function(b){this.base(b);var c=this;var a=this.getMetaObj();this.yesText=new YIUI.Yes_TextEditor({el:c.el,value:c.value,required:a.required,textCase:a.textCase,inputType:c.inputType,trim:a.trim,maxLength:a.maxLength,promptText:a.promptText,selectOnFocus:a.selectOnFocus,invalidChars:a.invalidChars,embedText:a.embedText,icon:a.icon,preIcon:a.preIcon,valueChange:function(d){c.setValue(d,true,true);}});this.el.addClass("ui-txted");a.holdFocus&&this.setHoldFocus(a.holdFocus);},setHoldFocus:function(a){this.holdFocus=a;},afterRender:function(){this.base();},initDefaultValue:function(options){this.base(options);this._input=$("input",options.el);$.extend(this,options);this.invalidChars=options.invalidChars.toString();var $this=this;this.yesText=new YIUI.Yes_TextEditor({el:$this.el,isPortal:true,value:$this.value,required:$this.required,textCase:$this.textCase,inputType:$this.inputType,maxLength:$this.maxLength,promptText:$this.promptText,selectOnFocus:$this.selectOnFocus,invalidChars:$this.invalidChars,embedText:$this.embedText,icon:$this.icon,preIcon:$this.preIcon,valueChange:function(newValue){$this.setValue(newValue,true,true);}});var height=this.el.height();$(".input-embed",this.el).css("height",height+"px");$(".input-embed",this.el).css("line-height",height+"px");if($.browser.isIE){this._input.css("line-height",(height-2)+"px");}$(".input-preIcon",this.el).css("top",(this.el.height()-16)/2+"px");$(".input-preIcon",this.el).css("left","10px");this._input.attr("value")&&this.setValue(eval(this._input.attr("value")))&&this.fireEvent("change",null);},focus:function(){this.yesText&&this.yesText.getInput().focus();},install:function(){this.base();var a=this;this.yesText.getInput().keydown(function(b){var c=b.keyCode||b.charCode;if(c===13||c===108){a.handler.doEnterPress&&a.handler.doEnterPress(a);if(a.holdFocus){a.yesText.getInput().focus();}else{a.focusManager.requestNextFocus(a);b.preventDefault();}}else{if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}}});}});YIUI.reg("texteditor",YIUI.Control.TextEditor);YIUI.reg("maskeditor",YIUI.Control.TextEditor);YIUI.Control.TextArea=YIUI.extend(YIUI.Control,{autoEl:"<span/>",handler:YIUI.TextAreaHandler,behavior:YIUI.TextAreaBehavior,_input:"",maxLength:Number.MAX_VALUE,checkEnd:function(a){this.value=a;if(this.el){this._input.val(a);}},setTip:function(a){var a=this._input.val();this.base(a);},getValue:function(){return this._input.val();},setEnable:function(b){this.enable=b;var c=this._input,a=this.getOuterEl();if(this.enable){c.removeAttr("readonly");a.removeClass("ui-readonly");}else{c.attr("readonly","readonly");a.addClass("ui-readonly");}},onSetHeight:function(a){this.el.css("height",a+"px");this._input.css("height",a+"px");},onSetWidth:function(a){this.el.css("width",a+"px");this._input.css("width",a+"px");},getOuterEl:function(){return this.el;},diff:function(a){this.base(a);},setMaxLength:function(a){if($.isNumeric(a)&&a>0){this.maxLength=a;if(a!=Number.MAX_VALUE){this._input.attr("maxLength",a);}}},setFormatStyle:function(a){this._input.css(a);},onRender:function(b){this.base(b);var a=this.el;a.addClass("ui-txta");this._input=$("<textarea/>").val(this.value).appendTo(a);this.setValue(this.value);this.setMaxLength(this.getMetaObj().maxLength);},afterRender:function(){this.base();if(this.mask){this._input.mask(this.mask);}},initDefaultValue:function(b){this.base(b);this._input=$("input",b.el);if(!b.selectonfocus){this.selectOnFocus=b.selectonfocus;}if(b.error){this.setError(b.error);}var a=this.el.height();if($.browser.isIE){this._input.css("line-height",(a-2)+"px");}},focus:function(){this._input.focus();},install:function(){this.base();var a=this;a._input.on("click",function(b){if(a.needSelectAll){a.selectOnFocus&&this.select();a.needSelectAll=false;}}).on("focusin",function(b){if(a.selectOnFocus){a.needSelectAll=true;}}).on("blur",function(b){var c=b.target.value;if(c!=a.value){a.setValue(c,true,true);}}).on("keypress",function(b){if($(this).val().length>=a.maxLength){b.preventDefault();return true;}}).keydown(function(b){var c=b.keyCode||b.charCode;if(c===9){a.focusManager.requestNextFocus(a);b.preventDefault();}});if($.browser.isIE){a._input.on("propertychange",function(b){if(this.value.length>a.maxLength){this.value=this.value.substring(0,a.maxLength);}});}}});YIUI.reg("textarea",YIUI.Control.TextArea);YIUI.Control.TextButton=YIUI.extend(YIUI.Control.TextEditor,{onRender:function(a){this.base(a);this.el.addClass("ui-txtbtn");this._btn=$("<button class='btn'>...</button>").css("width","30px").appendTo(this.el);this._btn.css({verticalAlign:"top",padding:"0"});},onSetHeight:function(a){this.base(a);this._btn.css({height:a+"px"});},onSetWidth:function(d){this.base(d);var a=this._btn.outerWidth();$("input",this.el).css({width:(d-a)+"px"});var b=$("span.clear",this.el),c=b[0].style.right;b.css({right:(c+a)+"px"});},setEnable:function(a){this.base(a);this.enable=a;this.install();},setTip:function(a){var a=$("input",this.el).val();this.base(a);},install:function(){this.base();var a=this;this._btn.mousedown(function(b){a.enable&&$(this).addClass("hover");}).mouseup(function(b){a.enable&&$(this).removeClass("hover");});$(this._btn).unbind("click");if(this.enable){this.bind(this._btn,"click");}}});YIUI.reg("textbutton",YIUI.Control.TextButton);YIUI.Control.StatusBar=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",onRender:function(a){this.base(a);}});YIUI.reg("statusbar",YIUI.Control.StatusBar);(function(){var b=0;function a(){return"n-"+(++b);}YIUI.Control.TreeView=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",selectId:null,dataUrl:null,data:null,root:null,colModel:null,enableColumnResize:true,defaultWidth:100,_$table:null,selectionModel:1,init:function(c){this.base(c);this.dataUrl="";var d=this;d.loadedNodes={};this.option={theme:"default",expandLevel:2,beforeExpand:function(e,f){if(!d.loadedNodes[f]){YIUI.EventHandler.doExpand(d,f||0);d.loadedNodes[f]=true;}},onSelect:function(e,h){$("#"+d.selectId,e).removeClass("trchekedstyle");var f=$("#"+h,e);f.addClass("trchekedstyle");var g=f.index();YIUI.EventHandler.doOnClick(d,h||0);d.selectId=h;}};this.data=c.data.addedNodes;if(this.data==undefined){this.data={};}},onRender:function(h){this.base(h);this.el.addClass("treeview");this._$table=$('<table cellpadding="0" cellspacing="0"></table>').appendTo(this.el);var k=$("<tr ></tr>").appendTo(this._$table),l=this.colModel,d,f,j,c;for(f=0,j=l.length;f<l.length;f++){d=l[f];c=d.width||this.defaultWidth;$("<col></col>").attr("width",c).prependTo(this._$table);$("<th>"+d.caption+"</th>").appendTo(k);}if(this.root){var e=this.createRow(this.root);e.attr("isLastOne",true);this._$table.append(e);}this._$table.treeTable(this.option);var g=this.createRowsHtml(this.data);this._$table.addChilds(g);},createRow:function(h){var g=$('<tr id="'+h.id+'"></tr>'),e=this.colModel;if(h.pid!=undefined){g.attr("pId",h.pid);}if(h.expand!=undefined&&h.expand){g.attr("hasChild",true);}if(h.previd!=undefined){g.attr("prevId",h.previd);}if(h.islast!=undefined&&h.islast){g.attr("isLastOne",true);}var f;for(var d=0,c=e.length;d<c;d++){f=h[e[d].key];if(!f){f="";}$("<td>"+f+"</td>").appendTo(g);}return g;},createRowsHtml:function(f){var e="";for(var d=0,c=f.length;d<c;d++){e+=this.createRow(f[d])[0].outerHTML;}return e;},initDefaultValue:function(c){this.base(c);this._$table=$("table",this.el);},install:function(){this.base();this.enableColumnResize&&this.addColumnResize();},diff:function(c){var d=this;this.base(c,function(e,f){if(e=="data"){if(f.deletedNodes){this.deleteNodes(f.deletedNodes);}if(f.addedNodes){this.addNodes(f.addedNodes);}if(f.focusedNode){d.focusNode(f.focusedNode);}}});},focusNode:function(d){var c=$("#"+d,this._$table);if(c){$("#"+this.selectId,this._$table).removeClass("trchekedstyle");c.addClass("trchekedstyle");this.selectId=d;}},deleteNodes:function(c){if(c==undefined){return;}this._$table.deleteChilds(c);},addNodes:function(c){if(c==undefined){return;}var d=this.createRowsHtml(c);this._$table.addChilds(d);},addColumnResize:function(){var e=this.colModel,h=this.el.find("tr:first-child"),d=h.children(),g=0;var c=$('<div class="treeview-resizer-container">');this._$table.before(c);var j=this;function f(k){c.width(j._$table.width());c.find(".treeview-resizer").each(function(l,m){return $(m).css({left:$(m).data("th").outerWidth()+($(m).data("th").offset().left-c.offset().left),height:j._$table.height()});});}this._$table.find("tr th").each(function(k,l){var m;m=$("<div class='treeview-resizer' />");m.data("th",$(l));m.bind("mousedown",function(r){var q,o,s,n;r.preventDefault();var p=r.pageX;q=$(r.currentTarget);o=q.data("th");s=o.width();n=j._$table.width();$(document).on("mousemove.rc",function(u){var v,t;v=u.pageX-p;t=s+v;o.width(t);j._$table.width(n+v);return f(t);});return $(document).one("mouseup",function(){$(document).off("mousemove.rc");});});return m.appendTo(c);});f();}});YIUI.reg("treeview",YIUI.Control.TreeView);})();YIUI.Control.PasswordEditor=YIUI.extend(YIUI.Control.TextEditor,{inputType:"password",handler:YIUI.PasswordEditorHandler,initDefaultValue:function(a){this.el=a.el;this._input=$("input",a.el);if(a.preicon){this.setPreIcon(a.preicon);}if(a.embedtext){this.setEmbedText(a.embedtext);}if(!a.selectonfocus){this.selectOnFocus=a.selectonfocus;}if(a.error){this.setError(a.error);}}});YIUI.reg("passwordeditor",YIUI.Control.PasswordEditor);YIUI.Tree=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",menuType:YIUI.TREEMENU_TYPE.GROUPTREE,_data:[],rootEntry:[],rootNode:null,independent:true,selectedNodeId:null,isAsyncNodes:true,_isOpen:false,_openedItem:null,container:null,handler:YIUI.TreeHandler,initDataSource:function(d){if(d){this.isAsyncNodes=false;if(!d.length){d=$(d);}var c;for(var b=0,a=d.length;b<a;b++){c=d[b];if(!c.id){c.id=c.key+b;}if(c.children){c.isParent=true;this.initDataSource(c.children);}}}},init:function(b){this.base(b);var a=this;this.menuType=this.rootEntry.style||YIUI.TREEMENU_TYPE.GROUPTREE;a.initDataSource(this.rootEntry);a._data=[];a.callback=$.extend({beforeExpand:$.noop,onSelect:function(e,d,c){if(c.children){if(a.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$("#"+c.id+" span.treemenu-icon").click();}else{if(a.menuType==YIUI.TREEMENU_TYPE.TREE){if($("#"+c.id).attr("open")){a.clickEvent.collapse(e,a,null);$("#"+c.id).attr("open",false);$(this).removeClass("curSelectedNode");$(this).parent().removeClass("selected");}else{a.clickEvent.expandNode(e,a,null);$("#"+c.id).attr("open",true);$(this).addClass("curSelectedNode");$(this).parent().addClass("selected");}}}}else{a.handler.doTreeClick(c,container);}}},b.callback);a.clickEvent={expandNode:function(g,d,f){var h=g.attr("id");var e=d.getTreeNode(h);d.callback.beforeExpand(e);var c=e.id+"-"+d.el.attr("id");if(!e.isLoaded){e.isLoaded=true;}if(g.parent().hasClass("top-level")){if(d._openedItem&&g.attr("id")!=d._openedItem.attr("id")){d._openedItem.removeClass("open").addClass("close");d._openedItem.next().hide();d._openedItem.removeClass("curSelectedNode");d._openedItem.parent().removeClass("selected");if(d.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$(".tree-expand",d._openedItem).removeClass("tree-expand").addClass("tree-collapse");$(".tree-explore",d._openedItem).removeClass("tree-explore-expand").addClass("tree-explore-collapse");}else{$(".tree.expand",d._openedItem).removeClass("expand").addClass("collapse");}}d._openedItem=g;}g.next().show();g.removeClass("close").addClass("open");g.addClass("curSelectedNode");g.parent().addClass("selected");if(d.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$(".tree-collapse",g).removeClass("tree-collapse").addClass("tree-expand");$(".tree-explore",g).removeClass("tree-explore-collapse").addClass("tree-explore-expand");}else{$(".tree.collapse",g).removeClass("collapse").addClass("expand");}},collapse:function(e,c,d){e.removeClass("open").addClass("close");e.next().hide();e.removeClass("curSelectedNode");e.parent().removeClass("selected");if(c.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$(".tree-expand",e).removeClass("tree-expand").addClass("tree-collapse");$(".tree-explore",e).removeClass("tree-explore-expand").addClass("tree-explore-collapse");}else{$(".tree.expand",e).removeClass("expand").addClass("collapse");}},selectNode:function(f,c,e){var g=f.attr("id");var d=c.el.attr("id");if(c.selectedNodeId){$("#"+c.selectedNodeId).removeClass("clicked");$("#"+c.selectedNodeId).prev().removeClass("tree-wholerow-clicked");$("#"+c.selectedNodeId).parent().removeClass("clicked");}c.selectedNodeId=g;$("#"+g).addClass("clicked");$("#"+g).prev().addClass("tree-wholerow-clicked");$("#"+g).parent().addClass("clicked");c.callback.onSelect(f,$("#"+d),c.getTreeNode(g));}};},dataSourceCopy:function(a){if(a){if(!a.length){a=$(a);}for(var h=0,k=a.length;h<k;h++){var f=a[h];var m=f.parent;var l=new Object();l.name=f.name;l.id=f.id;l.itemKey=f.itemKey;l.layerItemKey=f.layerItemKey;if(f.isLoaded){l.isLoaded=f.isLoaded;}else{l.isLoaded=false;}if(f.children&&f.children.length>0){l.open=f.open;var e=[];for(var g=0,c=f.children.length;g<c;g++){var b=f.children[g];e.push(b.id);this.dataSourceCopy($(b));}l.children=e;}else{l.key=f.key;l.formKey=f.formKey;}if(f.parent){l.parentId=f.parent.id;}this._data.push(l);}}},changeDataType:function(e){var d=[];var b=$.grep(e,function(g,f){return typeof(g.parentId)=="undefined"?g:null;});for(var a=0;a<b.length;a++){var c=$.extend(true,{},b[a]);d.push(c);this.changeData(c);}this.rootEntry=d;},changeData:function(d){if(d.children){for(var b=0,a=d.children.length;b<a;b++){var c=$.extend(true,{},this.getTreeNode(d.children[b]));d.children.splice(b,1,c);if(c.children){this.changeData(d.children[b]);}}}},buildTreenode:function(a,b){if(!a){return;}if(!a.length){if(!b){a=a.children;}}this.addChilds(a,b,0);},addChilds:function(c,h,b){if(c.length<=0){if(h){$("#"+h,this.el).next().remove();$("#"+h,this.el).children().first().removeClass("tree-collapse");}return;}var e,a;if(h){var j=this.getTreeNode(h);j.children=[];}for(var f=0,m=c.length;f<m;f++){e=c[f];a=e.id;e.parentId=h;var k=$("<li class='treemenu tree-node' level='"+b+"'></li>");if(!e.parentId){k.addClass("top-level");}if(h){j.children.push(a);k.appendTo($("#"+h,this.el).next());var g=$("#"+h,this.el).next().children().length;}else{k.appendTo(this.el);}var n=$("<a id='"+a+"' class='tree-anchor'></a>").appendTo(k),d,l,o;if(e.isParent){k.addClass("isParent");o=$("<span class='tree'></span>");d=$("<ul class='tree-ul'></ul>");l=$("<span class='treemenu-icon'/>");if(e.open&&!this._isOpen&&!e.parentId){k.addClass("selected");n.addClass("curSelectedNode open").attr("open",true);l.addClass("tree-expand");this._isOpen=true;this._openedItem=n;o.addClass("expand");}else{n.attr("open",false).addClass("close");d.css("display","none");l.addClass("tree-collapse");o.addClass("collapse");}d.appendTo(k);_explore=$("<span class='tree-explore'/>");if(this.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){l.appendTo(n);_explore.appendTo(n);if(e.icon){_explore.css("background-image","url(Resource/"+e.icon+")");}}else{o.appendTo(n);}}$("<span class='treenode-name'>"+e.name+"</span>").appendTo(n);if(this.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){if(b>0){n.css("padding-left",(b-1)*20+50);}}else{n.css("padding-left",b*20);}if(e.children){this.addChilds(e.children,e.id,b+1);}else{n.addClass("noExpand");}}},removeChilds:function(a){$("#"+a).parent().remove();this.removeNode(a);},removeNode:function(f){for(var c=0,a=this._data.length;c<a;c++){var g=this._data[c];if(g.id==f){if(g.parentId){var d=this.getTreeNode(g.parentId);d.children=$.map(d.children,function(j,h){return j!=g.id?j:null;});}else{if(g.children){this._data.splice(c,1);for(var b=0,e=g.children.length;b<e;b++){this.removeNode(g.children[b]);}break;}else{this._data.splice(c,1);break;}}}}},onRender:function(a){this.base(a);this.el.addClass("treemenu treemenu-content");var b=this.el.attr("id");this.dataSourceCopy(this.rootEntry);this.buildTreenode(this.rootEntry,null);switch(this.menuType){case YIUI.TREEMENU_TYPE.TREE:break;case YIUI.TREEMENU_TYPE.GROUPTREE:this.el.addClass("treemenu-grouptree");break;}},install:function(){var a=this;$("a",a.el).bind("click",function(b){if($(this).hasClass("open")){a.clickEvent.collapse($(this),a,null);return;}if($(this).hasClass("close")){a.clickEvent.expandNode($(this),a,null);return;}if($(this).hasClass("noExpand")){a.clickEvent.selectNode($(this),a,null);return;}});},getTreeNode:function(c){for(var b=0,a=this._data.length;b<a;b++){if(this._data[b].id==c){return this._data[b];}}},setRootNode:function(a){this.rootNode=a;},getRootNode:function(){return this.rootNode;}});YIUI.reg("tree",YIUI.Tree);YIUI.Control.Attachment=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.AttachmentHandler,_operatorID:null,maxSize:1024,width:1500,onRender:function(e){this.base(e);this._operatorID=$.cookie("userID");this.el.addClass("ui-att");var k=$("<thead></thead>");var f=$("<tbody></tbody>");this.$att_tbl=$('<table class="att-tbl"></table>').appendTo(this.el);var j=$('<tr class="tr-head"></tr>').appendTo(this.$att_tbl);var h=$('<td class="out"></td>').appendTo(j);var n=$('<div class="head"></div>').appendTo(h);var g=$('<table class="tbl-head"></table>').append(k).appendTo(n);var c=$('<tr class="tr-body"></tr>').appendTo(this.$att_tbl);var b=$('<td class="out"></td>').appendTo(c);var d=$("<div class='body'></div>").appendTo(b);this.$table=$('<table border="1" class="tbl-body"></table>').append(f).appendTo(d);$("<span class='space'></span>").appendTo(d);var m=$('<tr class="tr-foot"></tr>').appendTo(this.$att_tbl);var l=$('<td class="out"></td>').appendTo(m);var a=$('<div class="foot"></div>').appendTo(l);$('<table border="1" class="tbl-foot"></table>').appendTo(a);this.createColumns();this.loadAttachment();},onSetHeight:function(a){this.base(a);var b=a-$(".tbl-head",this.el).outerHeight()-$(".tbl-foot",this.el).outerHeight();$(".body",this.el).height(b);this.addEmptyRow();$(".ui-resizer",this.el).height($(".tbl-head",this.el).outerHeight()+$(".body",this.el)[0].clientHeight);},onSetWidth:function(b){this.base(b);var a=b-this.getPlaceholderWidth();var c=this.placeW=$.getReal("100%",a);if(c>0){$(".tbl-head td.empty",this.el).outerWidth("100%");$(".body tr.first td.empty",this.el).outerWidth("100%");}this.fileBtn.css("left",b/2);},getPlaceholderWidth:function(){var d=$(".tbl-head td",this.el),e,c=0;for(var b=0,a=d.length;b<a-1;b++){e=d.eq(b);c+=e.outerWidth();}return c;},setEnable:function(b){this.enable=b;var c=this.getEl(),a=this.getOuterEl();if(this.enable){a.removeClass("ui-readonly");$(".btn",c).removeAttr("disabled");$(".fup",c).removeAttr("disabled");}else{a.addClass("ui-readonly");$(".btn",c).attr("disabled","disabled");$(".fup",c).attr("disabled","disabled");}},createColumns:function(){var b=$("<div class='ui-resizer' />").prependTo(this.el);var e=$(".tbl-head",this.el).children("thead");var d=$("<tr></tr>"),h;$('<td><label>附件名称</label><span class="att-handler"></span></td>').appendTo(d);$('<td><label>上传时间</label><span class="att-handler"></span></td>').appendTo(d);$('<td><label>上传人</label><span class="att-handler"></span></td>').appendTo(d);$('<td><label>附件路径</label><span class="att-handler"></span></td>').appendTo(d);$("<td><label></label></td>").appendTo(d);if(this.getMetaObj().preview){d.addClass("hasView");$('<td class="opt_left"><label>操</label></td>').appendTo(d);$('<td class="opt_right"><label>作</label></td>').appendTo(d);}else{$("<td><label>操作</label></td>").appendTo(d);}$("<td><label></label></td>").appendTo(d);$('<td class="empty"><span/></td>').appendTo(d);e.append(d);var f=$(".tbl-foot",this.el);var a=$("<input class='btn fileBtn' type='button' value='上传'>");var j=this.fileBtn=$("<input type='file' name='file' data-url='upload' class='fup'>").data("fileID",-1);$('<td colspan="7"></td>').append(a).append(j).appendTo($("<tr></tr>")).appendTo(f);var c=this.$table.children("tbody");var g=$('<tr class="first"></tr>');$('<td class="name"></td>').appendTo(g);$('<td class="time"></td>').appendTo(g);$('<td class="operator"></td>').appendTo(g);$('<td class="path"></td>').appendTo(g);$('<td class="download"></td>').appendTo(g);$('<td class="delete"></td>').appendTo(g);$('<td class="upload"></td>').appendTo(g);if(this.getMetaObj().preview){g.addClass("hasView");$('<td class="view"></td>').appendTo(g);}$('<td class="empty"></td>').appendTo(g);c.append(g);},loadAttachment:function(){this.$table.children("tbody tr").not(".first").remove();var b=YIUI.FormStack.getForm(this.ofFormID);var a;var c=function(d){a=d.items;};Svr.Request.getSyncData(Svr.SvrMgr.AttachURL,{service:"LoadAllAttachment",oid:b.OID,formKey:b.formKey,controlKey:this.key},c);this.addAttachment(a);},addAttachment:function(g){var b=this.$table.children("tbody");var e,a,h,j=this;if(g&&g.length>0){var c=$("tr.first",b);for(var d=0,f=g.length;d<f;d++){h=g[d];e=$("<tr></tr>");$("<td>"+h.name+"</td>").appendTo(e);$("<td>"+h.time+"</td>").appendTo(e);$("<td>"+h.uploadName+"</td>").appendTo(e);$("<td>"+h.path+"</td>").appendTo(e);$("<td></td>").appendTo(e).append($("<input class='download' type='button' value='下载'>").data("fileID",h.id));$("<td></td>").appendTo(e).append($("<input class='btn del' type='button' value='删除'>").data("fileID",h.id));$("<td></td>").appendTo(e).append($("<input class='btn upd' type='button' value='上传'>")).append($("<input type='file' name='file' data-url='upload' class='btn upd fup'>").data("fileID",h.id));if(this.getMetaObj().preview){e.addClass("hasView");$("<td></td>").appendTo(e).append($("<input class='view' type='button' value='预览'>").data("fileID",h.id));}$("<td></td>").addClass("empty").appendTo(e);b.append(e);}}},addEmptyRow:function(){var g=$(".body",this.el);var a=$(".head",this.el);var b=g.children("span");if(!this.items||this.items.length==0){var f=$("label.empty",b).remove();if($("tr",g).not(".first").length==0){f=$("<label class='empty'>表中无内容</label>");b.append(f);var e=$(".head tr",this.el).width();var h=(g.height()-f.height())/2;f.width(e).css({"top":h+"px","padding-left":b.width()/2+"px"});}}var c=$(".body span.space",this.el);c.outerHeight(g[0].clientHeight-g.outerHeight());if(g[0].clientWidth!=g[0].scrollWidth){var d=g.width()-g[0].clientWidth;if($("td.empty",a).width()<d){$("td.empty",a).outerWidth(d);$("tr.first td.empty",g).outerWidth(0);}}else{$("td.empty",a).outerWidth("100%");$("tr.first td.empty",g).outerWidth("100%");}},uploadFile:function(e,a){var b=this;var c=YIUI.FormStack.getForm(b.ofFormID);var d=function(f){var g=$.checkFile(f,b.getMetaObj().maxSize);if(!g){return;}$.ajaxFileUpload({url:Svr.SvrMgr.AttachURL,secureuri:false,fileElement:f,data:{service:"UploadAttachment",formKey:c.formKey,controlKey:b.key,operatorID:b._operatorID,fileID:a,oid:c.OID,mode:1},type:"post",success:function(l,h,m){m.data("fileID",a);l=JSON.parse(l);var j=[];j.push(l);if(a!=-1){var k=m.parents("tr").eq(0).children();k.eq(0).text(l.name);k.eq(1).text(l.time);k.eq(2).text(l.uploadName);k.eq(3).text(l.path);}else{b.addAttachment(j);b.addEmptyRow();}},error:function(j,h,k){alert(k);}});};if(c.OID){d(e);}else{alert("新增状态无法进行上传操作！");}},focus:function(){$(".btn.fileBtn",this.el).focus();},install:function(){var b=this;b.$table.delegate(".download","click",function(f){var g=$(f.target);var d=g.data("fileID");var e=YIUI.FormStack.getForm(b.ofFormID);location.href=Svr.SvrMgr.AttachURL+"?fileID="+d+"&formKey="+e.formKey+"&controlKey="+b.key+"&mode=1&service=DownloadAttachment";});b.el.delegate(".tbl-body .upd, .tbl-foot .fileBtn","click",function(d){var e=$(d.target);e.next().click();});b.$table.delegate(".del","click",function(f){var g=$(f.target);var d=g.data("fileID");var e=YIUI.FormStack.getForm(b.ofFormID);b.handler.doDeleteAttachement(b,d,e.formKey,b.key);$(this).parents("tr").eq(0).remove();b.addEmptyRow();});b.el.delegate(".fup","change",function(d){b.uploadFile($(this),$(this).data("fileID"));});b.el.delegate(".btn.fileBtn","keydown",function(d){var e=d.keyCode||d.charCode;if(e===13||e===108){$(".fup",b.el).click();d.preventDefault();}else{if(e===9){b.focusManager.requestNextFocus(b);d.preventDefault();}}});b.el.delegate(".view","click",function(f){var e=$(this).parents("tr:eq(0)");var d=$("td:eq(0)",e).text();var g=$("td:eq(3)",e).text();b.handler.preview(g,d,b);});var c=$(".body",this.el);var a=$(".head",this.el);c.scroll(function(){var e=c.scrollLeft();a.scrollLeft(e);if(c[0].clientWidth!=c[0].scrollWidth){var d=c.width()-c[0].clientWidth;$("td.empty",a).outerWidth(d);}});$(".att-handler",this.el).bind("mousedown",function(k){if(!b.enable){return false;}var o=$(".ui-resizer",b.el);var f=$(this).parent().position().left+$(this).parent().outerWidth();o.css("left",f);o.addClass("clicked");var l,m,j;k.preventDefault();var g=k.clientX;l=$(this).parents("td").eq(0);m=l.width();var d,n,h;$(document).on("mousemove.rc",function(p){d=p.clientX-g;o.css("left",f+d);});return $(document).one("mouseup",function(){$(document).off("mousemove.rc");n=m+d;if(n<10){n=10;}l.width(n);$("label",l).width(n);var e=$(".tbl-body tr.first td",c).eq(l.index());e.width(n);o.removeClass("clicked");b.addEmptyRow();});});}});YIUI.reg("attachment",YIUI.Control.Attachment);YIUI.Control.Separator=YIUI.extend(YIUI.Control,{autoEl:'<hr size="1"></hr>',onSetHeight:function(a){},onRender:function(a){this.base(a);this.el.addClass("ui-sep");this.el.attr("color","#dadada");}});YIUI.reg("separator",YIUI.Control.Separator);YIUI.Control.Chart=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",title:null,grouped:true,barWidth:0.5,yMin:0,xMin:null,fillColor:"#FFFFFF",series:null,categories:null,height:500,width:500,fistStraw:true,yScale:[],xScale:[],init:function(n){this.base(n);var a=[];if(this.dataModel){this.series=this.dataModel.series;this.categories=this.dataModel.categories;}switch(this.getMetaObj().chartType){case 1:this.horizontal=false;this.bars=true;this.stacked=true;this.grouped=false;this.track=false;break;case 2:this.horizontal=true;this.bars=true;this.track=true;break;case 3:this.horizontal=true;this.bars=true;this.stacked=true;this.grouped=false;this.track=false;break;case 4:this.fill=true;this.showPoint=true;this.showLine=true;break;case 5:this.fill=false;this.showPoint=true;this.showLine=true;break;case 6:this.showPoint=true;break;case 7:this.pie=true;break;case 0:default:this.horizontal=false;this.bars=true;this.track=true;break;}if($.isNumeric(this.categories[0])){for(var h=0,l=this.series.length;h<l;h++){var g=[];var b=[];for(var d=0,c=this.categories.length;d<c;d++){if(this.horizontal){g.push([this.series[h].data[d],parseInt(this.categories[d])]);b.push(this.series[h].data[d]);}else{g.push([parseInt(this.categories[d]),this.series[h].data[d]]);b.push(this.series[h].data[d]);}}g.sort(function(o,j){return o[0]-j[0];});var k={data:g,label:this.series[h].name,lines:{fill:this.fill,show:this.showLine},points:{show:this.showPoint,fillColor:this.fillColor}};a.push(k);}if(this.horizontal){for(var h=0,l=a[0].data.length;h<l;h++){this.yScale.push(parseInt(a[0].data[h][1]));}this.xScale=null;}else{for(var h=0,l=a[0].data.length;h<l;h++){this.xScale.push(parseInt(a[0].data[h][0]));}this.yScale=null;}}else{for(var h=0,l=this.series.length;h<l;h++){var g=[];for(var d=0,c=this.series[h].data.length;d<c;d++){if(this.horizontal){g.push([this.series[h].data[d],d+1]);}else{g.push([d+1,this.series[h].data[d]]);}}var k={data:g,label:this.series[h].name,lines:{fill:this.fill,show:this.showLine},points:{show:this.showPoint,fillColor:this.fillColor}};a.push(k);}if(this.horizontal){for(var h=0;h<this.categories.length;h++){this.yScale.push([h+1,this.categories[h]]);}this.xScale=null;}else{for(var h=0;h<this.categories.length;h++){this.xScale.push([h+1,this.categories[h]]);}this.yScale=null;}}this.xyData=a;this.maxData=b;this.yMax=Math.max.apply(null,this.maxData)+50;if(this.pie){var m=[];for(var d=0,c=this.categories.length;d<c;d++){var f=this.series[0].data[d];var e={data:[[0,f]],label:this.categories[d]};m.push(e);}this.pieData=m;}},onSetWidth:function(a){if(a>20){this.el.css("width",a-20);this.el.css("margin-right",20);this._hasSetWidth=true;this.reSetDraw(this._hasSetWidth,this._hasSetHeight);}},onSetHeight:function(a){if(a>30){this.el.css("height",a-30);this._hasSetHeight=true;this.reSetDraw(this._hasSetWidth,this._hasSetHeight);}},reSetDraw:function(a,b){if(a&&b){this.setDraw();}},setDraw:function(){if(this.horizontal){this.yMin=null;this.xMin=0;}if(this.pie){Flotr.draw(this.el[0],this.pieData,{HtmlText:false,grid:{outlineWidth:0,verticalLines:false,horizontalLines:false},xaxis:{title:this.categoryAxisTitle,showLabels:false},yaxis:{title:this.seriesAxisTitle,showLabels:false},pie:{show:true,fillOpacity:1,explode:10},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.bars){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,min:this.xMin,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,min:this.yMin,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},bars:{show:this.bars,stacked:this.stacked,horizontal:this.horizontal,barWidth:this.barWidth,grouped:this.grouped,fillOpacity:1},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.fill){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.points){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,min:this.xMin,max:this.xMax,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,min:this.yMin,min:this.yMax,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}else{if(this.showPoint){Flotr.draw(this.el[0],this.xyData,{xaxis:{title:this.categoryAxisTitle,ticks:this.xScale},yaxis:{title:this.seriesAxisTitle,tickDecimals:0,ticks:this.yScale},legend:{position:"bottom"},grid:{color:"#aaa"},mouse:{track:false,relative:false,trackDecimals:0},title:this.title});}}}}}if(this.fistStraw){this.height=-1;this.width=-1;this.fistStraw=false;}},setSeriesAxisTitle:function(a){this.seriesAxisTitle=a;},setCategoryAxisTitle:function(a){this.categoryAxisTitle=a;},setTitle:function(a){this.title=a;},afterRender:function(b){this.base(b);var a=this.getMetaObj();a.seriesAxisTitle&&this.setSeriesAxisTitle();a.categoryAxisTitle&&this.setCategoryAxisTitle();a.title&&this.setTitle();this.setDraw();}});YIUI.reg("chart",YIUI.Control.Chart);YIUI.Control.BPMGraph=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",paper:null,nodes:null,mX:null,mY:null,transitions:null,swims:null,elements:{},nodeElements:{},circle_R:20,isSourceTop:false,isSourceLeft:false,transPath:null,init:function(a){this.base(a);},isTransPathLine:function(e){if(this.transPath){var c,d=this.nodeElements[e.source],a=this.nodeElements[e.target];for(var b=0;b<this.transPath["steps"].length;b++){c=this.transPath["steps"][b];if(c.source==d.id&&c.target==a.id){return true;}}}return false;},isLastNodeInPath:function(b){if(this.transPath){var a=this.transPath["steps"][this.transPath["steps"].length-1];if(a&&b.id==a.target){return true;}}return false;},isIE:function(){return $.browser.isIE;},textFormat:function(a){a.attr("font-style","normal");a.attr("font-weight","normal");a.attr("font-size","12px");},onSetHeight:function(a){this.base(a);if(this.hasWidth&&this.paper==null){this.createGraph();}this.hasHeight=true;},onSetWidth:function(a){this.base(a);this.el.css("overflow","auto");if(this.hasHeight&&this.paper==null){this.createGraph();}this.hasWidth=true;},onRender:function(a){this.base(a);},createGraph:function(){if(!this.paper){this.paper=Raphael(this.id);}if(this.nodes&&this.transitions){var h=this.nodes[0];var g=h.x,b=h.x,d=h.y,a=h.y;for(var j=1,k=this.nodes.length;j<k;j++){var e=this.nodes[j];if(e.x<g){g=e.x;}if(e.x+e.width>b){b=e.x+e.width;}if(e.y<d){d=e.y;}if(e.y+e.height>a){a=e.y+e.height;}}this.mX=(b-g)/2-this.el.width()/2+50;this.mY=d-20;this.paper.setSize(b+Math.abs(this.mX)+40,a+40);for(var j in this.nodes){var e=this.nodes[j];var c=this.createNode(e);this.elements[e.key]=c;this.nodeElements[e.key]=e;}for(var j in this.transitions){var m=this.transitions[j];var f=this.nodes[m.source];this.createLine(m);}}if(this.swims){for(var j in this.swims){var l=this.swims[j];this.createSwim(l);}}this.hasWidth=false;this.hasHeight=false;},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length);},createSwim:function(c){var d=c.direction;if(d!=undefined){if(d=="Vertical"){var b=this.paper.rect(c.x,c.y,c.width,c.height,0);b.toBack();b.attr("stroke","gray");var a=this.paper.path("M"+c.x+" "+(c.y+2*this.circle_R)+"L"+(c.x+c.width)+" "+(c.y+2*this.circle_R));a.toBack();a.attr("stroke","gray");var e=this.paper.text(c.x+c.width/2,c.y+this.circle_R,c.caption);if(this.isIE()){this.textFormat(e);}e.attr("font-size","25px");if(this.isIE()){this.textFormat(e);}}else{var b=this.paper.rect(c.x,c.y,c.height,c.width,0);b.toBack();b.attr("stroke","gray");var a=this.paper.path("M"+(c.x+2*this.circle_R)+" "+c.y+"L"+(c.x+2*this.circle_R)+" "+(c.y+c.width));a.toBack();a.attr("stroke","gray");var e=this.paper.text(c.x+this.circle_R,(c.y+c.width/2),c.caption);e.attr("font-size","20px");if(this.isIE()){this.textFormat(e);}}}},createLine:function(b){var a=b.lineStyle;switch(a){case BPMLineType.STEAIGHT_LINE:return this.createSteaightLine(b);case BPMLineType.CHAMFER_CURVE_H_ONE:return this.chamferCurveHOne(b);case BPMLineType.CHAMFER_CURVE_V_ONE:return this.chamferCurveVOne(b);case BPMLineType.CHAMFER_CURVE_H_TWO:return this.chamferCurveHTwo(b);case BPMLineType.CHAMFER_CURVE_V_TWO:return this.chamferCurveVTwo(b);case BPMLineType.FILLET_CURVE_H_ONE:return this.filletCurveHOne(b);case BPMLineType.FILLET_CURVE_V_ONE:return this.filletCurveVOne(b);case BPMLineType.FILLET_CURVE_H_TWO:return this.filletCurveHTwo(b);case BPMLineType.FILLET_CURVE_V_TWO:return this.filletCurveVTwo(b);case BPMLineType.OBKIQUE_CURVE_H_TWO:return this.obkiqueCurveHTwo(b);case BPMLineType.OBKIQUE_CURVE_V_TWO:return this.obkiqueCurveVTwo(b);default:return null;}},obkiqueCurveVTwoBase:function(g,c,e,d,f){var b=this.paper.path("M"+(g.x-this.mX)+" "+(g.y-this.mY)+"L"+(g.x-this.mX)+" "+(e-this.mY));b.attr({"stroke-width":"2"});var k=this.paper.path("M"+(g.x-this.mX)+" "+(e-this.mY)+"L"+(c.x-this.mX)+" "+(d-this.mY));k.attr({"stroke-width":"2"});var j=this.paper.path("M"+(c.x-this.mX)+" "+(d-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));j.attr({"stroke-width":"2"});j.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(f)){b.attr({"stroke":"red"});j.attr({"stroke":"red"});k.attr({"stroke":"red"});}switch(f.tagName){case"association":b.attr({"stroke-dasharray":"- "});k.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});break;case"exception-flow":var h=b.getPointAtLength(8.5);var a=this.paper.image("Resource/bpmgraph/ExceptionFlow-icon.png",(h.x-8.5-this.mX),(h.y-8.5-this.mY),17,17);break;}},obkiqueCurveVTwo:function(e){var a=this.stNode(e);this.brokenLine(a.sourceNode,a.targetNode);var c=this.isSourceTop?this.getBottom(a.sourceNode):this.getTop(a.sourceNode);var f=this.isSourceTop?this.getTop(a.targetNode):this.getBottom(a.targetNode);if(c!=null&&f!=null){var d=c.y+(f.y-c.y)/3;var b=c.y+(f.y-c.y)/3*2;this.obkiqueCurveVTwoBase(c,f,d,b,e);}},obkiqueCurveHTwoBase:function(f,c,g,e,d){var b=this.paper.path("M"+(f.x-this.mX)+" "+(f.y-this.mY)+"L"+(g-this.mX)+" "+(f.y-this.mY));b.attr({"stroke-width":"2"});var k=this.paper.path("M"+(g-this.mX)+" "+(f.y-this.mY)+"L"+(e-this.mX)+" "+(c.y-this.mY));k.attr({"stroke-width":"2"});var j=this.paper.path("M"+(e-this.mX)+" "+(c.y-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));j.attr({"stroke-width":"2"});j.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(d)){b.attr({"stroke":"red"});j.attr({"stroke":"red"});k.attr({"stroke":"red"});}switch(d.tagName){case"association":b.attr({"stroke-dasharray":"- "});k.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});break;case"exception-flow":var h=b.getPointAtLength(8.5);var a=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(h.x-8.5-this.mX),(h.y-8.5-this.mY),17,17);break;}},obkiqueCurveHTwo:function(e){var a=this.stNode(e);this.brokenLine(a.sourceNode,a.targetNode);var d=this.isSourceLeft?this.getRight(a.sourceNode):this.getLeft(a.sourceNode);var f=this.isSourceLeft?this.getLeft(a.targetNode):this.getRight(a.targetNode);if(d!=null&&f!=null){var c=d.x+(f.x-d.x)/3;var b=d.x+(f.x-d.x)/3*2;this.obkiqueCurveHTwoBase(d,f,c,b,e);}},filletCurveVTwoBase:function(e,c,f,d){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(e.x-this.mX)+" "+(f-this.mY));b.attr({"stroke-width":"2"});var j=this.paper.path("M"+(e.x-this.mX)+" "+(f-this.mY)+"L"+(c.x-this.mX)+" "+(f-this.mY));j.attr({"stroke-width":"2"});var h=this.paper.path("M"+(c.x-this.mX)+" "+(f-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));h.attr({"stroke-width":"2"});h.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(d)){b.attr({"stroke":"red"});h.attr({"stroke":"red"});j.attr({"stroke":"red"});}switch(d.tagName){case"association":b.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});h.attr({"stroke-dasharray":"- "});break;case"exception-flow":var g=b.getPointAtLength(8.5);var a=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(g.x-8.5-this.mX),(g.y-8.5-this.mY),17,17);break;}},filletCurveVTwo:function(d){var a=this.stNode(d);this.brokenLine(a.sourceNode,a.targetNode);var c=this.isSourceTop?this.getBottom(a.sourceNode):this.getTop(a.sourceNode);var e=this.isSourceTop?this.getTop(a.targetNode):this.getBottom(a.targetNode);if(c!=null&&e!=null){var b=(c.y+e.y)/2;this.filletCurveVTwoBase(c,e,b,d);}},filletCurveHTwoBase:function(e,c,f,d){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(f-this.mX)+" "+(e.y-this.mY));b.attr({"stroke-width":"2"});var j=this.paper.path("M"+(f-this.mX)+" "+(e.y-this.mY)+"L"+(f-this.mX)+" "+(c.y-this.mY));j.attr({"stroke-width":"2"});var h=this.paper.path("M"+(f-this.mX)+" "+(c.y-this.mY)+"L"+(c.x-this.mX)+" "+(c.y-this.mY));h.attr({"stroke-width":"2"});h.attr({"arrow-end":"classic-wide-long"});if(this.isTransPathLine(d)){b.attr({"stroke":"red"});h.attr({"stroke":"red"});j.attr({"stroke":"red"});}switch(d.tagName){case"association":b.attr({"stroke-dasharray":"- "});j.attr({"stroke-dasharray":"- "});h.attr({"stroke-dasharray":"- "});break;case"exception-flow":var g=b.getPointAtLength(8.5);var a=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(g.x-8.5-this.mX),(g.y-8.5-this.mY),17,17);break;}},filletCurveHTwo:function(d){var a=this.stNode(d);this.brokenLine(a.sourceNode,a.targetNode);var b=this.isSourceLeft?this.getRight(a.sourceNode):this.getLeft(a.sourceNode);var e=this.isSourceLeft?this.getLeft(a.targetNode):this.getRight(a.targetNode);if(b!=null&&e!=null){var c=(b.x+e.x)/2;this.filletCurveHTwoBase(b,e,c,d);}},filletCurveVOneBase:function(e,g,f){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(g.x-this.mX)+" "+(e.y-this.mY));b.attr({"stroke-width":"2"});var c=this.paper.path("M"+(g.x-this.mX)+" "+(e.y-this.mY)+"L"+(g.x-this.mX)+" "+(g.y-this.mY));c.attr({"arrow-end":"classic-wide-long"});c.attr({"stroke-width":"2"});if(this.isTransPathLine(f)){b.attr({"stroke":"red"});c.attr({"stroke":"red"});}switch(f.tagName){case"association":b.attr({"stroke-dasharray":"- "});c.attr({"stroke-dasharray":"- "});break;case"exception-flow":var a=b.getPointAtLength(8.5);var d=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(a.x-8.5-this.mX),(a.y-8.5-this.mY),17,17);break;}},filletCurveVOne:function(c){var a=this.stNode(c);this.brokenLine(a.sourceNode,a.targetNode);var b=this.isSourceLeft?this.getRight(a.sourceNode):this.getLeft(a.sourceNode);var d=this.isSourceTop?this.getTop(a.targetNode):this.getBottom(a.targetNode);if(b!=null&&d!=null){this.filletCurveVOneBase(b,d,c);}},filletCurveHOneBase:function(e,g,f){var b=this.paper.path("M"+(e.x-this.mX)+" "+(e.y-this.mY)+"L"+(e.x-this.mX)+" "+(g.y-this.mY));b.attr({"stroke-width":"2"});var c=this.paper.path("M"+(e.x-this.mX)+" "+(g.y-this.mY)+"L"+(g.x-this.mX)+" "+(g.y-this.mY));c.attr({"arrow-end":"classic-wide-long"});c.attr({"stroke-width":"2"});if(this.isTransPathLine(f)){b.attr({"stroke":"red"});c.attr({"stroke":"red"});}switch(f.tagName){case"association":b.attr({"stroke-dasharray":"- "});c.attr({"stroke-dasharray":"- "});break;case"exception-flow":var a=b.getPointAtLength(8.5);var d=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(a.x-8.5-this.mX),(a.y-8.5-this.mY),17,17);break;}},filletCurveHOne:function(c){var a=this.stNode(c);this.brokenLine(a.sourceNode,a.targetNode);var b=this.isSourceTop?this.getBottom(a.sourceNode):this.getTop(a.sourceNode);var d=this.isSourceLeft?this.getLeft(a.targetNode):this.getRight(a.targetNode);if(b!=null&&d!=null){this.filletCurveHOneBase(b,d,c);}},chamferCurveVTwoBase:function(l,g,e,c,j,h,m,k){var d=this.paper.path("M"+(l.x-this.mX)+" "+(l.y-this.mY)+"L"+(l.x-this.mX)+" "+(m+(c<0?h:-h)-this.mY));d.attr({"stroke-width":"2"});var q=0;if(c*e<0){q=1;}var a=d.paper.path("M"+(l.x-this.mX)+" "+(m+(c<0?h:-h)-this.mY)+"A"+j+" "+h+" 0 0"+" "+q+" "+(l.x+(e<0?-j:+j)-this.mX)+" "+(m-this.mY));a.attr({"stroke-width":"2"});var r=this.paper.path("M"+(l.x+(e<0?-j:+j)-this.mX)+" "+(m-this.mY)+"L"+(g.x+(e<0?j:-j)-this.mX)+" "+(m-this.mY));r.attr({"stroke-width":"2"});var f=0;if(c*e>0){f=1;}var o=d.paper.path("M"+(g.x+(e<0?j:-j)-this.mX)+" "+(m-this.mY)+"A"+j+" "+h+" 0 0"+" "+f+" "+(g.x-this.mX)+" "+(m+(c<0?-h:h)-this.mY));o.attr({"stroke-width":"2"});var p=this.paper.path("M"+(g.x-this.mX)+" "+(m+(c<0?-h:h)-this.mY)+"L"+(g.x-this.mX)+" "+(g.y-this.mY));p.attr({"arrow-end":"classic-wide-long"});p.attr({"stroke-width":"2"});if(this.isTransPathLine(k)){d.attr({"stroke":"red"});a.attr({"stroke":"red"});r.attr({"stroke":"red"});o.attr({"stroke":"red"});p.attr({"stroke":"red"});}switch(k.tagName){case"association":d.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});r.attr({"stroke-dasharray":"- "});o.attr({"stroke-dasharray":"- "});p.attr({"stroke-dasharray":"- "});break;case"exception-flow":var n=d.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(n.x-8.5-this.mX),(n.y-8.5-this.mY),17,17);break;}},chamferCurveVTwo:function(f){var g=this.stNode(f);this.brokenLine(g.sourceNode,g.targetNode);var j=this.isSourceTop?this.getBottom(g.sourceNode):this.getTop(g.sourceNode);var c=this.isSourceTop?this.getTop(g.targetNode):this.getBottom(g.targetNode);if(j!=null&&c!=null){var a=c.y-j.y;var d=Math.min(Math.abs(a),20);var b=c.x-j.x;var e=Math.min(Math.abs(b),20);var h=(j.y+c.y)/2;this.chamferCurveVTwoBase(j,c,b,a,e,d,h,f);}},chamferCurveHTwoBase:function(l,g,e,c,j,h,o,k){var d=this.paper.path("M"+(l.x-this.mX)+" "+(l.y-this.mY)+"L"+(o+(e<0?j:-j)-this.mX)+" "+(l.y-this.mY));d.attr({"stroke-width":"2"});var q=0;if(c*e>0){q=1;}var a=d.paper.path("M"+(o+(e<0?j:-j)-this.mX)+" "+(l.y-this.mY)+"A"+j+" "+h+" 0 0"+" "+q+" "+(o-this.mX)+" "+(l.y+(c<0?-h:h)-this.mY));a.attr({"stroke-width":"2"});var r=this.paper.path("M"+(o-this.mX)+" "+(l.y+(c<0?-h:h)-this.mY)+"L"+(o-this.mX)+" "+(g.y+(c<0?h:-h)-this.mY));r.attr({"stroke-width":"2"});var f=0;if(c*e<0){f=1;}var n=d.paper.path("M"+(o-this.mX)+" "+(g.y+(c<0?h:-h)-this.mY)+"A"+j+" "+h+" 0 0"+" "+f+" "+(o+(e<0?-j:+j)-this.mX)+" "+(g.y-this.mY));n.attr({"stroke-width":"2"});var p=this.paper.path("M"+(o+(e<0?-j:+j)-this.mX)+" "+(g.y-this.mY)+"L"+g.x+" "+(g.y-this.mY));p.attr({"arrow-end":"classic-wide-long"});p.attr({"stroke-width":"2"});if(this.isTransPathLine(k)){d.attr({"stroke":"red"});a.attr({"stroke":"red"});r.attr({"stroke":"red"});n.attr({"stroke":"red"});p.attr({"stroke":"red"});}switch(k.tagName){case"association":d.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});r.attr({"stroke-dasharray":"- "});n.attr({"stroke-dasharray":"- "});p.attr({"stroke-dasharray":"- "});break;case"exception-flow":var m=d.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(m.x-8.5-this.mX),(m.y-8.5-this.mY),17,17);break;}},chamferCurveHTwo:function(f){var g=this.stNode(f);this.brokenLine(g.sourceNode,g.targetNode);var h=this.isSourceLeft?this.getRight(g.sourceNode):this.getLeft(g.sourceNode);var c=this.isSourceLeft?this.getLeft(g.targetNode):this.getRight(g.targetNode);if(h!=null&&c!=null){var a=c.y-h.y;var d=Math.min(Math.abs(a),20);var b=c.x-h.x;var e=Math.min(Math.abs(b),20);var j=(h.x+c.x)/2;this.chamferCurveHTwoBase(h,c,b,a,e,d,j,f);}},chamferCurveVOneBase:function(k,f,d,c,h,g,j){var e=this.paper.path("M"+(k.x-this.mX)+" "+(k.y-this.mY)+"L"+(f.x-this.mX+(d<0?h:-h))+" "+(k.y-this.mY));e.attr({"stroke-width":"2"});var m=0;if(c*d>0){m=1;}var a=e.paper.path("M"+(f.x+(d<0?h:-h)-this.mX)+" "+(k.y-this.mY)+"A"+h+" "+g+" 0 0"+" "+m+" "+(f.x-this.mX)+" "+(k.y+(c<0?-g:g)-this.mY));a.attr({"stroke-width":"2"});if(m==0){var n=a.paper.path("M"+(f.x-this.mX)+" "+(k.y+(c<0?-g:g)-this.mY)+"L"+(f.x-this.mX)+" "+(f.y-this.mY));n.attr({"arrow-end":"classic-wide-long"});n.attr({"stroke-width":"2"});}else{var n=a.paper.path("M"+(f.x-this.mX)+" "+(k.y+(c<0?-g:g)-this.mY)+"L"+(f.x-this.mX)+" "+(f.y-this.mY));n.attr({"arrow-end":"classic-wide-long"});n.attr({"stroke-width":"2"});}if(this.isTransPathLine(j)){e.attr({"stroke":"red"});a.attr({"stroke":"red"});n.attr({"stroke":"red"});}switch(tagName){case"association":e.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});n.attr({"stroke-dasharray":"- "});break;case"exception-flow":var l=e.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(l.x-8.5-this.mX),(l.y-8.5-this.mY),17,17);break;}},chamferCurveVOne:function(g){var c=this.stNode(g);this.brokenLine(c.sourceNode,c.targetNode);var f=this.isSourceLeft?this.getRight(c.sourceNode):this.getLeft(c.sourceNode);var h=this.isSourceTop?this.getTop(c.targetNode):this.getBottom(c.targetNode);if(f!=null&&h!=null){var a=h.y-f.y;var d=Math.min(Math.abs(a),20);var b=h.x-f.x;var e=Math.min(Math.abs(b),20);this.chamferCurveVOneBase(f,h,b,a,e,d,g);}},chamferCurveHOneBase:function(k,f,d,c,h,g,j){var e=this.paper.path("M"+(k.x-this.mX)+" "+(k.y-this.mY)+"L"+(k.x-this.mX)+" "+(f.y+(c<0?g:-g)-this.mY));e.attr({"stroke-width":"2"});var m=0;if(c*d<0){m=1;}var a=e.paper.path("M"+(k.x-this.mX)+" "+(f.y+(c<0?g:-g)-this.mY)+"A"+h+" "+g+" 0 0"+" "+m+" "+(k.x-this.mX+(d<0?-h:h))+" "+(f.y-this.mY));a.attr({"stroke-width":"2"});var n=a.paper.path("M"+(k.x+h-this.mX)+" "+(f.y-this.mY)+"L"+(f.x-this.mX)+" "+f.y-this.mY);n.attr({"arrow-end":"classic-wide-long"});n.attr({"stroke-width":"2"});if(this.isTransPathLine(j)){e.attr({"stroke":"red"});a.attr({"stroke":"red"});n.attr({"stroke":"red"});}switch(j.tagName){case"association":e.attr({"stroke-dasharray":"- "});a.attr({"stroke-dasharray":"- "});n.attr({"stroke-dasharray":"- "});break;case"exception-flow":var l=e.getPointAtLength(8.5);var b=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(l.x-8.5-this.mX),(l.y-8.5-this.mY),17,17);break;}},chamferCurveHOne:function(g){var c=this.stNode(g);this.brokenLine(c.sourceNode,c.targetNode);var f=this.isSourceTop?this.getBottom(c.sourceNode):this.getTop(c.sourceNode);var h=this.isSourceLeft?this.getLeft(c.targetNode):this.getRight(c.targetNode);if(f!=null&&h!=null){var a=h.y-f.y;var d=Math.min(Math.abs(a),20);var b=h.x-f.x;var e=Math.min(Math.abs(b),20);this.chamferCurveHOneBase(f,h,b,a,e,d,g);}},steaightLineBase:function(d,f,e){var b=this.paper.path("M"+(d.x-this.mX)+" "+(d.y-this.mY)+"L"+(f.x-this.mX)+" "+(f.y-this.mY));b.attr({"arrow-end":"classic-wide-long"});b.attr({"stroke-width":"2"});if(this.isTransPathLine(e)){b.attr({"stroke":"red"});}switch(e.tagName){case"association":b.attr({"stroke-dasharray":"- "});break;case"exception-flow":var a=b.getPointAtLength(8.5);var c=this.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ExceptionFlow-icon.png",(a.x-8.5),(a.y-8.5),17,17);break;}},createSteaightLine:function(e){var a=this.stNode(e);var b=this.elements[a.sourceNodeKey];var c=this.elements[a.targetNodeKey];var d=this.getSourcePoint(b,a.targetNode,a.sourceNode);var f=this.getTargrtPoint(c,a.targetNode,a.sourceNode);if(d!=null&&f!=null){this.steaightLineBase(d,f,e);}},getCenter:function(c){var b=this.elements[c.key].type;var a={};if(b=="circle"){a.x=c.x+this.circle_R;a.y=c.y+this.circle_R;}if(b=="rect"){a.x=c.x+c.width/2;a.y=c.y+c.height/2;}if(b=="set"){a.x=c.x+25;a.y=c.y+25;}return a;},getTop:function(b){var a=this.elements[b.key].type;var c={};if(a=="circle"){c.x=b.x+this.circle_R;c.y=b.y;}if(a=="rect"){c.x=b.x+b.width/2;c.y=b.y;}if(a=="set"){c.x=b.x+25;c.y=b.y;}return c;},getBottom:function(c){var b=this.elements[c.key].type;var a={};if(b=="circle"){a.x=c.x+this.circle_R;a.y=c.y+2*this.circle_R;}if(b=="rect"){a.x=c.x+c.width/2;a.y=c.y+c.height;}if(b=="set"){a.x=c.x+25;a.y=c.y+50;}return a;},getLeft:function(b){var a=this.elements[b.key].type;var c={};if(a=="circle"){c.x=b.x;c.y=b.y+this.circle_R;}if(a=="rect"){c.x=b.x;c.y=b.y+b.height/2;}if(a=="set"){c.x=b.x;c.y=b.y+25;}return c;},getRight:function(c){var b=this.elements[c.key].type;var a={};if(b=="circle"){a.x=c.x+2*this.circle_R;a.y=c.y+this.circle_R;}if(b=="rect"){a.x=c.x+c.width;a.y=c.y+c.height/2;}if(b=="set"){a.x=c.x+50;a.y=c.y+25;}return a;},getSourcePoint:function(a,d,b){if(a.type=="circle"){var c=this.getCircleLineIntersectPoint(b,d);return c;}if(a.type=="rect"){var c=this.getRectLineIntersectPoint(b,d);return c;}if(a.type=="set"){var c=this.getDiamondLineIntersectPoint(b,d);return c;}return null;},getTargrtPoint:function(b,c,a){if(b.type=="circle"){var d=this.getCircleLineIntersectPoint(c,a);return d;}if(b.type=="rect"){var d=this.getRectLineIntersectPoint(c,a);return d;}if(b.type=="set"){var d=this.getDiamondLineIntersectPoint(c,a);return d;}return null;},getCircleLineIntersectPoint:function(b,c){var e=this.getCenter(c).x-b.x-this.circle_R;var d=this.getCenter(c).y-b.y-this.circle_R;var j=(b.x+this.circle_R)-this.getCenter(c).x;var h=(b.y+this.circle_R)-this.getCenter(c).y;var a=Math.pow((j*j+h*h),0.5);if(a<this.circle_R){return;}var g=b.x+this.circle_R+e*this.circle_R/a;var f=b.y+this.circle_R+d*this.circle_R/a;return{x:g,y:f};},getRectLineIntersectPoint:function(f,h){var e={};var n=f.x;e.x=f.x+f.width/2;e.y=f.y+f.height/2;var m={},l={},k={},j={};m.x=f.x;m.y=f.y;l.x=f.x+f.width;l.y=f.y;k.x=f.x+f.width;k.y=f.y+f.height;j.x=f.x;j.y=f.y+f.height;var g=this.getRectIntersectPoint(e,this.getCenter(h),m,l);if(g==null){g=this.getRectIntersectPoint(e,this.getCenter(h),l,k);}if(g==null){g=this.getRectIntersectPoint(e,this.getCenter(h),k,j);}if(g==null){g=this.getRectIntersectPoint(e,this.getCenter(h),j,m);}return g;},getDiamondLineIntersectPoint:function(g,h){var m={};m.x=g.x+25;m.y=g.y+25;var f={},e={},l={},k={};f.x=g.x;f.y=g.y+25;e.x=g.x+25;e.y=g.y+50;l.x=g.x+50;l.y=g.y+25;k.x=g.x+25;k.y=g.y;var j=this.getRectIntersectPoint(m,this.getCenter(h),f,e);if(j==null){j=this.getRectIntersectPoint(m,this.getCenter(h),e,l);}if(j==null){j=this.getRectIntersectPoint(m,this.getCenter(h),l,k);}if(j==null){j=this.getRectIntersectPoint(m,this.getCenter(h),k,f);}return j;},getRectIntersectPoint:function(m,k,g,f){var j=k.x-m.x;var d=k.y-m.y;var h=f.x-g.x;var c=f.y-g.y;var a=j*c-d*h;if(a==0){return null;}var b=((f.x-m.x)*d+(m.y-f.y)*j)/a;if(b>0||b<-1){return null;}var e={};e.x=f.x+h*b;e.y=f.y+c*b;if((e.x-m.x)*(e.x-k.x)>0){return null;}if((e.y-m.y)*(e.y-k.y)>0){return null;}return e;},createNode:function(c){var a=c.nodeType;switch(a){case BPMNodeType.BEGIN:case BPMNodeType.END:case BPMNodeType.JOIN:case BPMNodeType.DECISION:case BPMNodeType.FORK:case BPMNodeType.EXCLUSIVE_FORK:case BPMNodeType.COMPLEX_JOIN:case BPMNodeType.STATE:break;default:var b=this.getShowCaption(c.width,c.caption);if(b.length>0){c.caption=b;}break;}switch(a){case BPMNodeType.BEGIN:return this.createBeginNode(c);case BPMNodeType.END:return this.createEndNode(c);case BPMNodeType.BRANCH_END:return this.createBranchEndNode(c);case BPMNodeType.STATE:return this.createStateNode(c);case BPMNodeType.USER_TASK:return this.createUserTaskNode(c);case BPMNodeType.SERVICE_TASK:return this.createServiceTaskNode(c);case BPMNodeType.MANUAL_TASK:return this.createManualTaskNode(c);case BPMNodeType.AUDIT:return this.createAuditNode(c);case BPMNodeType.FORK:return this.createForkNode(c);case BPMNodeType.JOIN:return this.createJoinNode(c);case BPMNodeType.EXCLUSIVE_FORK:return this.createExclusiveForkNode(c);case BPMNodeType.COMPLEX_JOIN:return this.createComplexJoinNode(c);case BPMNodeType.DECISION:return this.createDecisionNode(c);case BPMNodeType.SUB_PROCESS:return this.createSubProcessNode(c);case BPMNodeType.INLINE:return this.createInlineNode(c);case BPMNodeType.DATAMAP:return this.createDataMapNode(c);case BPMNodeType.COUNTERSIGN:return this.createCounterSignNode(c);case BPMNodeType.STATE_ACTION:return this.createStateActionNode(c);default:return null;}},createBeginNode:function(c){var b=this.paper.circle((c.x-this.mX)+this.circle_R,c.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(c)){b.attr("stroke","red");}b.attr({"stroke-width":"2","fill":"white"});var d=b.paper.text((c.x-this.mX)+this.circle_R,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+d.node.clientHeight/2-this.mY;d.attr({"y":""+a});b.hover(function(f){b.attr({"cursor":"pointer"});},function(){});return b;},createEndNode:function(b){var c=this.paper.circle((b.x-this.mX)+this.circle_R,b.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(b)){c.attr("stroke","red");}c.attr({"stroke-width":"2"});c.attr({"fill":"white"});var e=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R-10);e.attr({"stroke-width":"0"});e.attr({"stroke":null});e.attr({"fill":"black"});var d=c.paper.text(b.x+this.circle_R-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+d.node.clientHeight/2-this.mY;d.attr({"y":""+a});c.hover(function(f){c.attr({"cursor":"pointer"});e.attr({"cursor":"pointer"});},function(){});return c;},createBranchEndNode:function(b){var a=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"5"});a.attr({"fill":"white"});var c=a.paper.text(b.x+this.circle_R-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(c);}a.hover(function(d){a.attr({"cursor":"pointer"});},function(){});return a;},createStateNode:function(b){var c=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R);if(this.isLastNodeInPath(b)){c.attr("stroke","red");}c.attr({"stroke-width":"1"});c.attr({"fill":"white"});var e=this.paper.circle(b.x+this.circle_R-this.mX,b.y+this.circle_R-this.mY,this.circle_R-5);e.attr({"stroke-width":"2"});e.attr({"stroke":"black"});e.attr({"fill":"white"});var d=c.paper.text(b.x+this.circle_R-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+d.node.clientHeight/2-this.mY;d.attr({"y":""+a});c.hover(function(f){c.attr({"cursor":"pointer"});e.attr({"cursor":"pointer"});},function(){});return c;},createUserTaskNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/UserTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}$(a[0]).attr("key",b.key);$(c[0]).attr("key",b.key);$(d[0]).attr("key",b.key);a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createServiceTaskNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ServiceTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createManualTaskNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/ManualTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createAuditNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/Audit-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}$(a[0]).attr("key",b.key);$(c[0]).attr("key",b.key);$(d[0]).attr("key",b.key);a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createDiamond:function(c){var b=this.paper.path("M"+(c.x-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25-this.mX)+" "+(c.y+2*25-this.mY));var a=this.paper.path("M"+(c.x+25-this.mX)+" "+(c.y+2*25-this.mY)+"L"+(c.x+2*25-this.mX)+" "+(c.y+25-this.mY));var f=this.paper.path("M"+(c.x+2*25-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25-this.mX)+" "+(c.y-this.mY));var d=this.paper.path("M"+(c.x+25-this.mX)+" "+(c.y-this.mY)+"L"+(c.x-this.mX)+" "+(c.y+25-this.mY));var e=this.paper.set();e.push(b,a,f,d);if(this.isLastNodeInPath(c)){b.attr("stroke","red");a.attr("stroke","red");f.attr("stroke","red");d.attr("stroke","red");e.attr("stroke","red");}e.attr({"stroke-width":"2"});e.attr({"type":"diamond"});e.attr({"fill":"white"});e.data({"diamond":"diamond"});return e;},createForkNode:function(c){var d=this.createDiamond(c);var b=this.paper.rect(c.x+7.5-this.mX,c.y+7.5-this.mY,35.4,35.4,0).transform("r45");b.attr({"fill":"white"});if(this.isLastNodeInPath(c)){b.attr("stroke","red");}d.paper.path("M"+(c.x+25-15-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25+15-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25+5-this.mX)+" "+(c.y+25+10-this.mY)+"L"+(c.x+25-6-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25+5-this.mX)+" "+(c.y+25-10-this.mY)+"L"+(c.x+25-6-this.mX)+" "+(c.y+25-this.mY));var e=d.paper.text(c.x+25-this.mX,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(e);}var a=e.attr().y+15-this.mY;e.attr({"y":""+a});b.hover(function(){b.attr({"cursor":"pointer"});},function(){});return d;},createJoinNode:function(c){var d=this.createDiamond(c);var b=this.paper.rect(c.x+7.5-this.mX,c.y+7.5-this.mY,35.4,35.4,0).transform("r45");if(this.isLastNodeInPath(c)){b.attr("stroke","red");}b.attr({"fill":"white"});d.paper.path("M"+(c.x+25-15-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25+15-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25+10-this.mY)+"L"+(c.x+25+6-this.mX)+" "+(c.y+25-this.mY));d.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25-10-this.mY)+"L"+(c.x+25+6-this.mX)+" "+(c.y+25-this.mY));var e=d.paper.text(c.x+25-this.mX,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(e);}var a=e.attr().y+15-this.mY;e.attr({"y":""+a});b.hover(function(){b.attr({"cursor":"pointer"});},function(){});return d;},createExclusiveForkNode:function(b){var d=this.createDiamond(b);var e=this.paper.rect(b.x+7.5-this.mX,b.y+7.5-this.mY,35.4,35.4,0).transform("r45");if(this.isLastNodeInPath(b)){e.attr("stroke","red");}e.attr({"fill":"white"});d.paper.path("M"+(b.x+25-5-this.mX)+" "+(b.y+25-5-this.mY)+"L"+(b.x+25+5-this.mX)+" "+(b.y+25+5-this.mY));d.paper.path("M"+(b.x+25-5-this.mX)+" "+(b.y+25+5-this.mY)+"L"+(b.x+25+5-this.mX)+" "+(b.y+25-5-this.mY));var c=d.paper.text(b.x+25-this.mX,b.y+b.height,b.caption);if(this.isIE()){this.textFormat(c);}var a=c.attr().y+15-this.mY;c.attr({"y":""+a});e.hover(function(){e.attr({"cursor":"pointer"});},function(){});return d;},createComplexJoinNode:function(c){var b=this.createDiamond(c);var e=this.paper.rect(c.x+7.5-this.mX,c.y+7.5-this.mY,35.4,35.4,0).transform("r45");e.attr({"fill":"white"});if(this.isLastNodeInPath(c)){e.attr("stroke","red");}b.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25-5-this.mY)+"L"+(c.x+25+5-this.mX)+" "+(c.y+25+5-this.mY));b.paper.path("M"+(c.x+25-5-this.mX)+" "+(c.y+25+5-this.mY)+"L"+(c.x+25+5-this.mX)+" "+(c.y+25-5-this.mY));b.paper.path("M"+(c.x+25-7-this.mX)+" "+(c.y+25-this.mY)+"L"+(c.x+25+7-this.mX)+" "+(c.y+25-this.mY));b.paper.path("M"+(c.x+25-this.mX)+" "+(c.y+25-7-this.mY)+"L"+(c.x+25-this.mX)+" "+(c.y+25+7-this.mY));var d=b.paper.text(c.x+25-this.mX,c.y+c.height,c.caption);if(this.isIE()){this.textFormat(d);}var a=d.attr().y+15-this.mY;d.attr({"y":""+a});e.hover(function(){e.attr({"cursor":"pointer"});},function(){});return b;},createDecisionNode:function(d){var c=this.createDiamond(d);var b=this.paper.rect(d.x+7.5-this.mX,d.y+7.5-this.mY,35.4,35.4,0).transform("r45");b.attr({"fill":"white"});if(this.isLastNodeInPath(d)){b.attr("stroke","red");}var e=c.paper.text(d.x+25-this.mX,d.y+25-this.mY,"?");e.attr("font-size","25px");if(this.isIE()){this.textFormat(e);}var f=c.paper.text(d.x+25-this.mX,d.y+d.height,d.caption);if(this.isIE()){this.textFormat(f);}var a=f.attr().y+15-this.mY;f.attr({"y":""+a});b.hover(function(){b.attr({"cursor":"pointer"});e.attr({"cursor":"pointer"});},function(){});return c;},createSubProcessNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/SubProcess-icon.png",b.x+b.width/2-10-this.mX,b.y+b.height-18-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createInlineNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/Inline-icon.png",b.x+b.width/2-10-this.mX,b.y+b.height-18-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createDataMapNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"fill":"white"});a.attr({"stroke-width":"2"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/DataMap-icon.png",b.x+b.width/2-10-this.mX,b.y+b.height-18-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}$(a[0]).attr("key",b.key);$(c[0]).attr("key",b.key);$(d[0]).attr("key",b.key);a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createCounterSignNode:function(b){var a=this.paper.rect(b.x-this.mX,b.y-this.mY,b.width,b.height,10);if(this.isLastNodeInPath(b)){a.attr("stroke","red");}a.attr({"stroke-width":"2"});a.attr({"fill":"white"});var c=a.paper.image("yesui/ui/res/css/blue/images/bpmgraph/UserTask-icon.png",b.x+2-this.mX,b.y+2-this.mY,18,18);var d=a.paper.text(b.x+b.width/2-this.mX,b.y+b.height/2-this.mY,b.caption);if(this.isIE()){this.textFormat(d);}a.hover(function(f){a.attr({"cursor":"pointer"});c.attr({"cursor":"pointer"});d.attr({"cursor":"pointer"});},function(){});return a;},createStateActionNode:function(a){var c=this.paper.rect(a.x-this.mX,a.y-this.mY,a.width,a.height,10);if(this.isLastNodeInPath(a)){c.attr("stroke","red");}c.attr({"stroke-width":"2"});c.attr({"fill":"white"});var b=c.paper.text(a.x-this.mX+a.width/2,a.y+a.height/2-this.mY,a.caption);if(this.isIE()){this.textFormat(b);}c.hover(function(d){c.attr({"cursor":"pointer"});b.attr({"cursor":"pointer"});},function(){});return c;},getShowCaption:function(e,b){var f=12,h=$.ygrid.getTextWidth(b,f),d="",g="";if(h>e){for(var c=0;c<b.length;c++){g=g+b.substr(c,1);var a=$.ygrid.getTextWidth(g,f);if(a>=e){g=g.substring(0,g.length-1);g+="\n";d+=g;g="";c--;}}d+=g;}return d;},brokenLine:function(b,d){var c=this.getCenter(b);var a=this.getCenter(d);this.isSourceLeft=c.x<=a.x;this.isSourceTop=c.y<=a.y;},stNode:function(b){var a={sourceNodeKey:b.source,targetNodeKey:b.target,sourceNode:this.nodeElements[b.source],targetNode:this.nodeElements[b.target]};return a;}});YIUI.reg("bpmgraph",YIUI.Control.BPMGraph);var BPMNodeType=(function(){var a={BEGIN:0,END:1,USER_TASK:2,AUDIT:3,COUNTERSIGN:4,DECISION:5,SUB_PROCESS:6,FORK:7,JOIN:8,EVENT:9,STATE:10,TIMER:11,INLINE:12,DATAMAP:13,COMPLEX_JOIN:14,MANUAL_TASK:15,EXCLUSIVE_FORK:16,SERVICE_TASK:17,BRANCH_END:18,STATE_ACTION:19};return a;})();var BPMLineType=(function(){var a={STEAIGHT_LINE:0,FILLET_CURVE_H_ONE:1,FILLET_CURVE_V_ONE:2,FILLET_CURVE_H_TWO:3,FILLET_CURVE_V_TWO:4,CHAMFER_CURVE_H_ONE:5,CHAMFER_CURVE_V_ONE:6,CHAMFER_CURVE_H_TWO:7,CHAMFER_CURVE_V_TWO:8,OBKIQUE_CURVE_H_TWO:9,OBKIQUE_CURVE_V_TWO:10};return a;})();YIUI.Control.Custom=YIUI.extend(YIUI.Control,{autoEl:"<div/>",height:"100%",onSetHeight:function(a){this.el.css("height",a);this.custom.setHeight(a);},onSetWidth:function(a){this.el.css("width",a);this.custom.setWidth(a);},afterRender:function(b){this.base(b);var c;switch(this.tag){case YIUI.Custom_tag.UserInfoPane:c=YIUI.CUSTOMVIEW.USERINFOPANE;break;case YIUI.Custom_tag.RoleRights:case YIUI.Custom_tag.OperatorRights:var a={el:this.el,container:this.container,tag:this.tag,width:this.el.width(),height:this.el.height(),key:this.key,objType:YIUI.Rights_objType[this.tag],formKey:YIUI.FormStack.getForm(this.ofFormID).formKey};c=YIUI.CUSTOM_ROLERIGHTS(a);break;default:c="";}this.custom=c;this.el.append(c.el);}});YIUI.reg("custom",YIUI.Control.Custom);YIUI.CUSTOMVIEW={};(function(c){var e=function(){self._dropdownItems.slideDown("fast");self._dropdownItems.slideDown("fast");self._dropdownItems.css({width:self.el.width()+"px",height:self.el.height()+"px"});c(document).on("mousedown",function(g){var f=c(g.target);if((f.closest(self._dropdownItems).length==0)&&(f.closest(self.buttonLeft).length==0)&&(f.closest(self.buttonRight).length==0)){self.hideDropdownList();c(document).off("mousedown");}self.el.removeClass("datepicker_btnClick");});self._hasShow=true;event.stopPropagation();};var a=function(){c.cookie("JSESSIONID",null);c.cookie("usercode",null);location.href="http://localhost:8089/yes";};var b=function(){c("#form").remove();c.cookie("JSESSIONID",null);c.cookie("usercode",null);};var d="<div class='btn-group'> "+"<button data-toggle='dropdown' class='btn btn-default dropdown-toggle' onclick='dropdown()'>系统管理员<span class='caret'></span></button>"+"<ul class='dropdown-menu'>"+"<li><a class='logout' onclick='logout()'>注销</a></li>"+"<li><a class='exit' onclick='exit()'>退出</a></li>"+"</ul>"+"</div>";YIUI.CUSTOMVIEW.USERINFOPANE=d;}(jQuery));(function(a){YIUI.CUSTOM_ROLERIGHTS=function(ac){var ag={height:"100%",width:"100%",maxRows:50,pageIndicatorCount:3};ac=a.extend(ag,ac);var l=function(aL,aK){var aH=aL.length;if(aH>0){for(var aJ=0,aH=aL.length;aJ<aH;aJ++){if(aK){aL[aJ].pid=aK;}aL[aJ].previd=aL[aJ].previd;aL[aJ].id=aL[aJ].OID||aL[aJ].oid||aL[aJ].key.trim();var aI=aL[aJ].id;if(a.isString(aI)){aI=aI.replace(/\//g,"_");aL[aJ].id=aI;}if(aL[aJ].items&&aL[aJ].items.length>0){aL[aJ].hasChild=true;l(aL[aJ].items,aL[aJ].id);}else{if(aL[aJ].nodeType==1){aL[aJ].hasChild=true;}}}}};var j=function(aH,aK,aI){var aJ=aK.rows,aL=aK.cols;l(aJ,aI);return P(aJ,aL,aH);};var P=function(aP,aN,aO){var aJ="";for(var aK=aP.length,aI=0;aI<aK;aI++){var aM=z(aO,aP[aI],aN);aJ+=aM[0].outerHTML;var aL=aP[aI].items;var aH="";if(aL&&aL.length>0){aJ+=P(aL,aN,aO);}}return aJ;};var z=function(aO,aP,aM){var aL=a('<tr id="'+aP.id+'"></tr>').attr("oid",aP.OID).attr("key",aP.key);if(ac.type==YIUI.Rights_type.TYPE_DICT){if(aP.hasRights&&!aP.changed){ac.dictRts.push(aP.id);var aQ=aP.hasRights==0?false:true;aL.attr("hasRts",aQ);}}else{if(ac.isFFData){if(!aP.visible){ac.visibleRts.push(aP.key);}if(!aP.enable){ac.enableRts.push(aP.key);}}else{if(ac.isFOData){if(aP.hasRights){ac.optRts.push(aP.key);}}}}if(aP.pid!=undefined){aL.attr("pId",aP.pid);}if(aP.previd!=undefined){aL.attr("previd",aP.previd);}if(aP.hasChild){aL.attr("hasChild",true);}if(aP.secondaryType){aL.attr("secondaryType",aP.secondaryType);}var aN,aJ=false;for(var aI=0,aK=aM.length;aI<aK;aI++){aN=aP[aM[aI].key];if(aM[aI].type=="checkbox"){var aH;if(aM[aI].isEntry){aH=a("<span class='checkbox state0' chkstate='0'/>");}else{aH=a("<input type='checkbox' value="+aN+" class='checkbox' />").attr("disabled","disabled");if(aN){aH.attr("checked",true);}}if(aM[aI].key=="enable"&&aP.disable){aH.attr("enable","false");}if(aM[aI].index){aH.attr("index",aM[aI].index);}a("<td></td>").append(aH).appendTo(aL);if(aM[aI].showText){aH.after(aN);}}else{a("<td><span>"+aN+"</span></td>").appendTo(aL);}}return aL;};var aj=function(aJ,aO,aX){if(aX.length==0){return null;}aJ.empty();var aV=aX.cols;var aW=a('<table cellpadding="0" cellspacing="0"></table>').appendTo(aJ);aW.attr("enable",true);var aS=a("<thead></thead>").appendTo(aW);a("<tbody></tbody>").appendTo(aW);var aU=a("<tr ></tr>").appendTo(aS),aK,aM,aQ,aH;aU.addClass("title");for(aM=0,aQ=aV.length;aM<aV.length;aM++){aK=aV[aM];if(aK.type=="checkbox"&&!aK.hide){var aL=a("<input type='checkbox' class='checkbox all' disabled='disabled'/>");if(aV[aM].index){aL.attr("index",aK.index);}a("<th>"+aK.caption+"</th>").prepend(aL).appendTo(aU);}else{a("<th>"+aK.caption+"</th>").appendTo(aU);}}var aN=j(aW,aX);a("tbody",aW).append(a(aN));aO=a.extend({expandable:true},aO);aW=aW.treetable(aO);var aP=a("thead tr.title .checkbox",aW),aR;var aI=a("tr:not([class~='title'])",aW);for(var aM=0,aQ=aP.length;aM<aQ;aM++){var aT=ac.type;switch(aT){case YIUI.Rights_type.TYPE_DICT:if(aX.hasAllRights){aP.eq(aM).prop("checked",true);}break;case YIUI.Rights_type.TYPE_FORM:if((aX.allOptRights)||(aM==0&&aX.allVisibleRights)||(aM==1&&aX.allEnableRights)){aP.eq(aM).prop("checked",true);}break;}}return aW;};var af=function(aI){var aJ={};aJ.service="SetRightsService";aJ=a.extend(aJ,aI);var aH=null;var aK=function(aL){if(aL){if(aL.length>0){aH={rows:aL,cols:[{key:"Code",caption:"代码"},{key:"Name",caption:"名称"}]};}else{aH=aL;}}};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,aJ,aK);return aH;};var e=ac.el||a("<div/>");var A=e.addClass("roleRights");A.css({height:"100%",width:"100%"});var an=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var S=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var aa=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var Y=new YIUI.Panel.GridLayoutPanel({widths:["99%",50],minWidths:["-1","-1"],heights:[25],height:30,metaObj:{columnGap:3},items:[an,S]});var V=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[Y,aa]});var X=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%"});var v=new YIUI.Panel.SplitPanel({height:ac.height||"100%",width:ac.width||"100%",metaObj:{orientation:"horizontal"},splitSizes:[{size:"25%"},{size:"75%"}],items:[V,X]});v.el=A;v.render();var W=function(aK,aI){var aH=false;if(aK.hasClass("title")){aH=true;}var aJ=a("tr.sel",aI);if(aJ.length>0){if(aJ.attr("id")==aK.attr("id")){aH=true;}aJ.removeClass("sel");aK.addClass("sel");}else{aK.addClass("sel");}return aH;};var ao=function(aN,aH,aO){var aP=aO.treeNode.tree;var aI=aP[aN];var aM=aI.parentId;if(aM){var aL=0;for(var aJ=0,aK=aH.length;aJ<aK;aJ++){if(aH[aJ]==aM){aL=aJ;}}if(aL>0){aH.splice(aL,0,aN);}else{aH.push(aN);}}else{aH.push(aN);}};var aq={theme:"default",expandLevel:1,onSelect:function(aO,aX){if(aO.attr("enable")=="true"){var aT=W(aX,aO);if(aT){return;}ac.clickTr=aX;ac.id=aX.attr("id");d&&d.removeAll();ad&&ad.removeAll();aC&&aC.removeAll();var aK={cmd:"LoadEntryRightsData",operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aY=af(aK);a(".checkbox").removeClass("state0").removeClass("state1").removeClass("state2").addClass("state0");a(".checkbox").attr("chkstate",0);aO.allRights=aY.allRights;if(aY.allRights){a(".checkbox",aG).removeClass("state0").addClass("state1");a(".title .checkbox",aG).prop("checked",true);var aP=a("tbody tr",aG);if(!aG.entryKeys){aG.entryKeys=[];}for(var aU=0,aV=aP.length;aU<aV;aU++){var aZ=aP.eq(aU).attr("key");aG.entryKeys.push(aZ);}}else{a(".title .checkbox",aG).prop("checked",false);var aW=aY.entryKeys,aS;aG.entryKeys=aW;var aN=[];for(var aU=0,aV=aW.length;aU<aV;aU++){aS=aW[aU];var aQ=aS.replace(/\//g,"_");var aX=a("[id='"+aQ+"']",aG);var aM=a(".checkbox",aX);var aL=1;aM.removeClass("state0");if(aX.attr("hasChild")=="true"){ao(aQ,aN,aG);}else{aM.addClass("state1");aM.attr("chkstate",1);}}for(var aU=0,aV=aN.length;aU<aV;aU++){var aR=aN[aU];var aX=a("[id='"+aN[aU]+"']",aG);var aJ=a("[pId='"+aR+"'] .checkbox",aG).hasClass("state0");var aI=a("[pId='"+aR+"'] .checkbox",aG).hasClass("state1");var aH=a("[pId='"+aR+"'] .checkbox",aG).hasClass("state2");if(aJ&&!aI&&!aH){continue;}else{if(aI&&!aJ&&!aH){a(".checkbox",aX).addClass("state1");a(".checkbox",aX).attr("chkstate",1);}else{a(".checkbox",aX).addClass("state2");a(".checkbox",aX).attr("chkstate",2);}}}}}}};var ak;var J=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%"});var w=new YIUI.Control.Button({value:"修改",metaObj:{x:0,y:0,},listeners:null});var D=new YIUI.Control.Button({value:"保存",metaObj:{enable:false,x:1,y:0},listeners:null});var aE=new YIUI.Control.Button({value:"取消",metaObj:{enable:false,x:2,y:0},listeners:null});var N=new YIUI.Panel.GridLayoutPanel({widths:[50,50,50,"100%"],minWidths:["-1","-1","-1","-1"],heights:[25,5],metaObj:{columnGap:3},height:30,items:[w,D,aE]});var T=new YIUI.Panel.FlexFlowLayoutPanel({metaObj:{overflowX:"auto",overflowY:"auto"},height:"100%",width:"100%"});var B=new YIUI.Panel({height:"100%",metaObj:{title:"入口权限设置"},items:[T]});var aA=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var k=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var x=new YIUI.Panel.GridLayoutPanel({widths:["100%",50],minWidths:["-1","-1"],heights:[25,5],height:30,metaObj:{columnGap:3},items:[aA,k]});var H=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var ar=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var g=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var ae=new YIUI.Panel.GridLayoutPanel({key:"test",widths:["100%",50],minWidths:["-1","-1"],heights:[25,5],height:30,metaObj:{columnGap:3,visible:false},items:[ar,g]});var al=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var q=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[x,H]});var o=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[ae,al]});var C=new YIUI.Panel.SplitPanel({height:"100%",metaObj:{orientation:"horizontal"},splitSizes:[{size:"30%"},{size:"70%"}],items:[q,o]});var R=new YIUI.Panel({height:"100%",metaObj:{title:"字典权限设置"},items:[C]});var n=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var am=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var Z=new YIUI.Panel.GridLayoutPanel({widths:["100%",50],minWidths:["-1","-1"],heights:[25],metaObj:{columnGap:3},height:30,items:[n,am]});var ai=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var U=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",items:[Z,ai]});var t=new YIUI.Control.TextEditor({metaObj:{x:0,y:0}});var L=new YIUI.Control.Button({value:"搜索",metaObj:{x:1,y:0}});var y=new YIUI.Panel.GridLayoutPanel({widths:["100%",50],minWidths:["-1","-1"],heights:[25],height:30,metaObj:{columnGap:3},items:[t,L]});var I=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var Q=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var aB=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{visible:false},items:[Q]});var au=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{overflowX:"auto",overflowY:"auto"}});var at=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{visible:false},items:[au]});var m=new YIUI.Panel.SplitPanel({metaObj:{orientation:"horizontal"},splitSizes:[{size:"40%"},{size:"60%"}],items:[at,aB]});var az=new YIUI.Panel.SplitPanel({height:"100%",metaObj:{orientation:"horizontal"},splitSizes:[{size:"30%"},{size:"70%"}],items:[U,m]});var h=new YIUI.Panel.FlexFlowLayoutPanel({height:"100%",metaObj:{title:"表单权限设置"},items:[az]});var p=new YIUI.Panel.TabPanel({height:"100%",items:[B,R,h]});J.add(N);J.add(p);X.add(J);X.doRenderChildren(false,true);var r={theme:"default",expandLevel:1,onSelect:function(aQ,aM){if(aQ.attr("enable")=="true"){ac.type=YIUI.Rights_type.TYPE_ENTRY;if(aM.hasClass("title")){var aL=a(".checkbox",aM).is(":checked");aQ.allRights=aL;if(aL){a(".checkbox",aQ).removeClass("state2").removeClass("state0").addClass("state1");var aN=a("tbody tr",aQ);if(!aQ.entryKeys){aQ.entryKeys=[];}for(var aK=0,aO=aN.length;aK<aO;aK++){var aP=aN.eq(aK).attr("key");aQ.entryKeys.push(aP);}}else{a(".checkbox",aQ).removeClass("state1").addClass("state0");aG.entryKeys=[];}return;}if(!a(aQ.target).hasClass("checkbox")){return;}var aJ=aM.attr("id");var aH=a(".checkbox",aM).is(":checked");var aI=a(".checkbox",aM).attr("chkstate")==0?1:0;a(".checkbox",aM).attr("chkstate",aI);if(aI>0){a(".checkbox",aM).removeClass("state0").removeClass("state2").addClass("state1");}else{a(".checkbox",aM).removeClass("state1").removeClass("state2").addClass("state0");}aD(aJ,aI,aQ);f(aQ,aJ,aI);ah(aQ,aJ,aI);}}};var ab=function(aO,aM,aI){var aL=ac.type,aI;aI=aG;if((aM==0)&&aI.allRights){aI.allRights=false;}if(!aI.entryKeys){aI.entryKeys=[];}var aN=aI.entryKeys;if(aM>0){var aK=a("#"+aO,aI).attr("key");aN.push(aK);}else{a(".title .checkbox",aI).prop("checked",false);if(a("[id='"+aO+"'] .checkbox",aI).attr("chkstate")==2){return;}for(var aJ=0,aH=aN.length;aJ<aH;aJ++){if(aN[aJ].replace(/\//g,"_")==aO){aN.splice(aJ,1);break;}}}};var aw=function(aI,aH,aP){var aK=aP.treeNode.tree[aI];var aR=aK.row.attr("hasRts")==undefined?false:true;if(aH!=aR&&!aK.changed){aK.changed=true;}var aQ=ac.clickTr.attr("secondaryType")==5;if(!aQ){return;}var aM=ac.dict.addRts;var aJ=ac.dict.delRts;var aS=aP.dictRts;var aO=true;for(var aL=0,aN=aS.length;aL<aN;aL++){if(aS[aL]==aI){aO=false;break;}}if(aH){if(aO){aM.push(aI);}else{for(var aL=0,aN=aJ.length;aL<aN;aL++){if(aJ[aL]==aI){aJ.splice(aL,1);break;}}}}else{if(aO){for(var aL=0,aN=aM.length;aL<aN;aL++){if(aM[aL]==aI){aM.splice(aL,1);break;}}}else{aJ.push(aI);}}};var O=function(aI,aH,aQ,aJ){if(aJ){var aN=aJ.enable;var aL=aJ.visible;var aK=false;var aR=false;for(var aM=0,aO=aQ.enableRts.length;aM<aO;aM++){if(aQ.enableRts[aM]==aJ.id){aK=true;if(aN){aQ.enableRts.splice(aM,1);}break;}}if(!aK&&!aN){aQ.enableRts.push(aJ.id);aQ.hasAllEnableRights=false;}for(var aM=0,aO=aQ.visibleRts.length;aM<aO;aM++){if(aQ.visibleRts[aM]==aJ.id){aR=true;if(aL){aQ.visibleRts.splice(aM,1);}break;}}if(!aR&&!aL){aQ.visibleRts.push(aJ.id);aQ.hasAllVisibleRights=false;}}else{var aP=false;for(var aM=0,aO=aQ.optRts.length;aM<aO;aM++){if(aQ.optRts[aM]==aI){aP=true;if(!aH){aQ.optRts.splice(aM,1);}}}if(!aP&&aH){aQ.optRts.push(aI);aQ.hasAllOptRights=false;}}};var aD=function(aL,aI,aH,aK){var aJ=ac.type,aH;switch(aJ){case YIUI.Rights_type.TYPE_ENTRY:ab(aL,aI,aH);break;case YIUI.Rights_type.TYPE_DICT:aw(aL,aI,aH,aK);break;case YIUI.Rights_type.TYPE_FORM:O(aL,aI,aH,aK);break;}};var f=function(aU,aJ,aH,aQ){if(!aJ){return;}var aM=aU.treeNode.tree[aJ],aT,aN,aR;var aL=aM.children,aK;if(!aL||aL.length==0){return;}for(var aO=0,aP=aL.length;aO<aP;aO++){aK=aL[aO];var aS=a("[id='"+aK.id+"']",aU);aN=a(".checkbox:not([index])",aS);if(ac.isField){if(aQ>0){aN=a(".checkbox[index='"+aQ+"']",aS);}aR=aN.parents("tr").eq(0);var aI={id:aR.attr("id")};if(aQ==0){if(!aH){a(".checkbox",aR).eq(1).prop("checked",false);aI.enable=false;}aI.visible=aH;}if(aQ==1){if(aH){a(".checkbox",aR).eq(0).prop("checked",true);aI.visible=true;}aI.enable=aH;}if(aQ==0){aI.visible=aH;}else{if(aQ==1){aI.enable=aH;}}aD(aR.attr("id"),aH,aU,aI);}else{if(aN.attr("chkstate")>-1){if(aN.attr("chkstate")!=aH){aN.removeClass("state0").removeClass("state1").removeClass("state2").addClass("state"+aH).attr("chkstate",aH);}}aD(aK.id,aH,aU);}if(!aN.attr("chkstate")){aN.prop("checked",aH);}f(aU,aK.id,aH);}};var ah=function(aS,aJ,aH,aM){var aK=aS.treeNode.tree[aJ],aL;if(aK){var aO=aK.parentId;if(!aO){return;}var aQ=aS.treeNode.tree[aO];if(aK.changed){aQ.changed=true;}var aR=a("[id='"+aO+"']",aS);aL=a(".checkbox:not([index])",aR);if(aL.attr("chkstate")!=aH){var aN=a("[pid='"+aO+"']",A);if(a(".checkbox",aN).hasClass("state0")||a(".checkbox",aN).hasClass("state2")){if(!a(".checkbox",aN).hasClass("state1")&&!a(".checkbox",aN).hasClass("state2")){aL.removeClass("state1").removeClass("state2").addClass("state0").attr("chkstate",0);}else{aL.removeClass("state0").removeClass("state1").addClass("state2").attr("chkstate",2);}}else{if(!a(".checkbox",aN).hasClass("state2")){aL.removeClass("state2").addClass("state1").attr("chkstate",1);}}}if(ac.isField){if(aM>0){aL=a(".checkbox[index='"+aM+"']",aR);}var aP=aL.parents("tr").eq(0);var aI={id:aP.attr("id")};if(aM==0){if(!aH){}}if(aM==1){if(aH){a(".checkbox",aP).eq(0).prop("checked",true);aI.visible=true;}}if(aH){a(".checkbox",aP).eq(aM).prop("checked",true);}aI.enable=a(".checkbox",aP).eq(1).prop("checked");aI.visible=a(".checkbox",aP).eq(0).prop("checked");aD(aP.attr("id"),aH,aS,aI);}else{if(a.isNumeric(aH)&&aL.attr("chkstate")!=aH){aD(aO,aH,aS);}else{if(aH&&aL.prop("checked")!=aH){aL.prop("checked",true);aD(aO,aH,aS);}}}ah(aS,aO,aH);}};var aG=null;var K={theme:"default",expandLevel:1,onSelect:function(aQ,aK){if(aQ.attr("enable")=="true"){if(!ac.id){return;}var aO=W(aK,aQ);if(aO){return;}ac.clickTr=aK;d&&d.removeAll();ac.type=YIUI.Rights_type.TYPE_DICT;ac.itemKey=aK.attr("id");ac.dict={addRts:[],delRts:[],saveType:0,allRights:false};var aH=aK.attr("id");var aI=aH;var aU={cmd:"LoadDictRightsData",itemKey:aI,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aT=al.el;var aR=aK.attr("secondaryType")==5;if(aR){ae.setVisible(true);aU.cmd="LoadChainDictRightsData";aU.startRow=0;aU.maxRows=ac.maxRows;aU.pageIndicatorCount=ac.pageIndicatorCount;aU.value=a("input",ar.el).val();aT.empty();}else{ae.setVisible(false);}var aS=af(aU);if(!aS){return;}if(!o.visisble){o.setVisible(true);}if(aR){var aL=aS.totalRowCount;var aN=al.el.pagination({pageSize:50,totalNumber:aL,showPages:true,showPageDetail:false,showFirstButton:false,showLastButton:false,pageIndicatorCount:3});aT=aN.content;var aP=a(".paginationjs-pages",al.el).is(":hidden")?0:a(".paginationjs-pages",al.el).outerHeight();var aM=al.el.height()-aP;aN.content.css("height",aM);aN.pageChanges=function(aW){var aV=ay(aI,aW);d.removeAll();ac.dictRts=[];d=aj(aT,F,aV);d.dictRts=ac.dictRts;aN.setTotalRowCount(aW*50+aV.totalRowCount);if(!w.enable){a(".checkbox",d).removeAttr("disabled");}};ac.setTotalRowCount=function(aW,aV){aN.setTotalRowCount(aV);};}ac.dictRts=[];var aJ={rows:aS.data,cols:[{key:"code",caption:"编码"},{key:"name",caption:"名称"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],hasAllRights:aS.hasAllRights};ac.dict.allRights=aS.hasAllRights;d=aj(aT,F,aJ);d.dictRts=ac.dictRts;d.isChain=aR;}}};var s=null;var ay=function(aK,aJ){var aI={cmd:"LoadChainDictRightsData",itemKey:aK,startRow:aJ*ac.maxRows,maxRows:ac.maxRows,pageIndicatorCount:ac.pageIndicatorCount,value:a("input",ar.el).val(),operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aH=af(aI);var aI={rows:aH.data,cols:[{key:"code",caption:"编码"},{key:"name",caption:"名称"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],hasAllRights:aH.hasAllRights,totalRowCount:aH.totalRowCount};return aI;};var F={theme:"default",expandLevel:1,beforeExpand:function(aI){var aH=aI.attr("id");var aO=aI.attr("expanded");if(aO){return;}var aL={cmd:"LoadDictRightsData",itemKey:ac.itemKey,parentID:aH,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aV=af(aL);var aU=aV.data;var aT=d.treeNode.tree[aH];var aK=aT.changed;var aQ=false;var aL={rows:aU,cols:[{key:"code",caption:"编码"},{key:"name",caption:"名称"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],hasAllRights:aV.hasAllRights};var aM=j(d,aL,aH);d.addChilds(aM);aI.attr("expanded","expanded");if(!w.enable){a(".checkbox",d).removeAttr("disabled");}if(aK){aQ=a(".checkbox",aI).is(":checked");if(aU.length>0){for(var aJ=0,aN=aU.length;aJ<aN;aJ++){var aS=aU[aJ].oid;var aP=d.treeNode.tree[aS];var aR=aU[aJ].hasRights==0?false:true;if(aR!=aQ){aP.changed=true;if(aQ){a(".checkbox",aP.row).prop("checked",true);ac.dict.addRts.push(aS);}else{a(".checkbox",aP.row).prop("checked",false);ac.dict.delRts.push(aS);}}}}}},onSelect:function(aH,aJ){if(!aH.target.hasClass("checkbox")){return;}av(aH);var aI=a(".checkbox",aJ).is(":checked");if(!aI&&ac.dict.allRights){ac.dict.allRights=false;ac.dict.saveType=1;}}};var d=null;var aF={theme:"default",expandLevel:1,onSelect:function(aP,aK){if(aP.attr("enable")=="true"){if(!ac.id){return;}var aM=W(aK,aP);if(aM){return;}ac.clickTr=aK;if(!aB.visible){aB.setVisible(true);}if(!at.visible){at.setVisible(true);}ad&&ad.removeAll();aC&&aC.removeAll();ac.type=YIUI.Rights_type.TYPE_FORM;ac.formKey=aK.attr("id");var aH=aK.attr("id");var aO=aH;var aI={cmd:"LoadFormRightsData",formKey:aO,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aL=af(aI);if(aL.fieldData){var aN={rows:aL.fieldData,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"标识"},{key:"visible",caption:"是否可见",type:"checkbox",index:0},{key:"enable",caption:"是否可编辑",type:"checkbox",index:1}],allEnableRights:aL.hasAllEnableRights,allVisibleRights:aL.hasAllVisibleRights};ac.isFFData=true;ac.visibleRts=[];ac.enableRts=[];ad=aj(Q.el,ax,aN);ad.hasAllEnableRights=aL.hasAllEnableRights;ad.hasAllVisibleRights=aL.hasAllVisibleRights;ad.enableRts=ac.enableRts;ad.visibleRts=ac.visibleRts;ac.isFFData=false;}if(aL.optData){var aJ={rows:aL.optData,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"标识"},{key:"hasRights",type:"checkbox",caption:"是否有权限"}],allOptRights:aL.hasAllOptRights};ac.isFOData=true;ac.optRts=[];aC=aj(au.el,u,aJ);aC.optRts=ac.optRts;aC.hasAllOptRights=aL.hasAllOptRights;ac.isFOData=false;}}}};var ap=null;var ax={theme:"default",expandLevel:1,onSelect:function(aI,aJ){if(aI.attr("enable")=="true"){if(!aI.target.hasClass("checkbox")){return;}ac.isField=true;var aK=aI.target;var aH=aK.attr("index")||0;E(aI,aH);ac.isField=false;}}};var ad=null;var u={theme:"default",expandLevel:1,onSelect:function(aH,aI){if(aH.attr("enable")=="true"){if(!aH.target.hasClass("checkbox")){return;}av(aH);}}};var aC=null;var av=function(aT){var aO=aT.target;var aU=a("tr.title .checkbox",aT),aJ,aK;var aS=aO.is(":checked");var aH=a("tr:not([class~='title'])",aT);if(aO.parents("tr").hasClass("title")){for(var aL=0,aN=aH.length;aL<aN;aL++){aJ=a(".checkbox",aH.eq(aL));if(aJ.attr("enable")=="false"){continue;}aJ.prop("checked",aS);var aQ=aJ.parents("tr").eq(0);aD(aQ.attr("id"),aS,aT);}var aP=ac.type;switch(aP){case YIUI.Rights_type.TYPE_DICT:if(aS){ac.dict.allRights=true;ac.dict.saveType=1;}else{ac.dict.allRights=false;ac.dict.saveType=-1;}break;case YIUI.Rights_type.TYPE_FORM:if(aS){aT.allOptRights=true;}else{aT.allOptRights=false;}break;}}else{var aQ=aO.parents("tr").eq(0);var aM=aQ.attr("pid");aD(aQ.attr("id"),aS,aT);f(aT,aQ.attr("id"),aS);ah(aT,aQ.attr("id"),aS);var aR=true;var aI=a(".checkbox:not([enable='false'])",aH);for(var aL=0,aN=aI.length;aL<aN;aL++){var aV=aI.eq(aL).is(":checked");if(!aV){aR=false;}}if(!aR){a(".checkbox",a("tr[class~='title']",aT)).prop("checked",false);if(aT.allOptRights){aT.allOptRights=false;}else{if(ac.dict&&ac.dict.allRights){ac.dict.allRights=false;}}}}};var E=function(aS,aP){var aZ=aS.target;var aJ=a("tr.title .checkbox",aS),aO,aX;var aQ=aZ.is(":checked");if(!aP){aP=0;aS.hasAllVisibleRights=aQ;if(!aQ){a(".checkbox",aZ.parents("tr")).eq(1).prop("checked",false);aS.hasAllEnableRights=false;}}else{aS.hasAllEnableRights=aQ;if(aQ){a(".checkbox",aZ.parents("tr")).eq(0).prop("checked",true);aS.hasAllEnableRights=true;}}var aY=a("tr:not([class~='title'])",aS);if(aZ.parents("tr").hasClass("title")){for(var aV=0,aW=aY.length;aV<aW;aV++){var a0=aY.eq(aV);aO=a(".checkbox",a0).eq(aP);if(aO.attr("enable")=="false"){continue;}aO.prop("checked",aQ);var aH=aO.parents("tr").eq(0);var aI={id:aH.attr("id")};if(aP==0){if(!aQ){a(".checkbox",aH).eq(1).prop("checked",false);}aI.enable=a(".checkbox",aH).eq(1).prop("checked");aI.visible=aQ;}if(aP==1){if(aQ){a(".checkbox",aH).eq(0).prop("checked",true);}aI.visible=a(".checkbox",aH).eq(0).prop("checked");aI.enable=aQ;}aD(aH.attr("id"),aQ,aS,aI);}}else{var aH=aZ.parents("tr").eq(0);var aI={id:aH.attr("id")};if(aP==0){if(!aQ){a(".checkbox",aH).eq(1).prop("checked",false);}aI.enable=a(".checkbox",aH).eq(1).prop("checked");aI.visible=aQ;}if(aP==1){if(aQ){a(".checkbox",aH).eq(0).prop("checked",true);}aI.visible=a(".checkbox",aH).eq(0).prop("checked");aI.enable=aQ;}var aT=aH.attr("pid");aD(aH.attr("id"),aQ,aS,aI);f(aS,aH.attr("id"),aQ,aP);ah(aS,aH.attr("id"),aQ,aP);var aN=a("thead tr.title .checkbox",aS),aM;var aY=a("tr:not([class~='title'])",aS);for(var aV=0,aW=aN.length;aV<aW;aV++){var aR=true;if(aV!=0){aM=a(".checkbox[index='"+aV+"'].checkbox:not([enable='false'])",aY);}else{aM=a(".checkbox:not([index]):not([enable='false'])",aY);}var aL=aM.length;if(aL==0){aN.eq(aV).attr("enable","false");break;}for(var aU=0;aU<aL;aU++){var aK=aM.eq(aU).is(":checked");if(!aK){aR=false;}}if(!aR){aN.eq(aV).prop("checked",false);if(aV==0){aS.hasAllEnableRights=aR;}else{aS.hasAllVisibleRights=aR;}}}}};var G=function(aH){for(var aI=0;aI<aH.data.length;aI++){if(aH.data[aI].OID==21||aH.data[aI].OID==11||aH.data[aI].OID==a.cookie("userID")){aH.data.splice(aI,1);aI--;}}var aJ={rows:aH.data,cols:[{key:"Code",caption:"代码"},{key:"Name",caption:"名称"}],totalRowCount:aH.totalRowCount};return aJ;};var c=function(aL,aN){var aM=ac.maxRows;var aJ=ac.pageIndicatorCount;var aK=a("input",an.el).val();var aO=true;var aH="Role";if(ac.tag==YIUI.Custom_tag.OperatorRights){aH="Operator";}var aQ={service:"DictService",cmd:"GetQueryData",itemKey:aH,startRow:aL*aM,maxRows:aM,pageIndicatorCount:aJ,value:aK};var aP=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,aQ,aN);if(!aN){var aI=G(aP);return aI;}};var M=function(aI,aJ){var aH=c(aI);ak.removeAll();ac.dictRts=[];ak=aj(ac.userPage.content,aq,aH);ac.userPage.setTotalRowCount(aI*ac.maxRows+aH.totalRowCount,aJ);if(!w.enable){a(".checkbox",ak).removeAttr("disabled");}};var b={el:A,setHeight:function(aH){v.setHeight(aH);v.doLayout(this.el.width(),aH);var aJ=a(".paginationjs-pages",al.el).is(":hidden")?0:a(".paginationjs-pages",al.el).outerHeight();var aI=al.el.height()-aJ;a(".paginationjs-content",al.el).css("height",aI);var aJ=a(".paginationjs-pages",aa.el).is(":hidden")?0:a(".paginationjs-pages",aa.el).outerHeight();var aI=aa.el.height()-aJ;a(".paginationjs-content",aa.el).css("height",aI);},setWidth:function(aH){v.setWidth(aH);v.doLayout(aH,this.el.height());},init:function(){var aM=function(aT){var aR=aT.totalRowCount;var aS=G(aT);var aQ=ac.userPage=aa.el.pagination({pageSize:ac.maxRows,totalNumber:aR,showPages:true,showPageDetail:false,showFirstButton:false,showLastButton:false,pageIndicatorCount:ac.pageIndicatorCount});ak=aj(aQ.content,aq,aS);aQ.pageChanges=function(aU){M(aU,false);};};c(0,aM);var aP={cmd:"LoadSetRightsList",operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aI=af(aP);if(!aI){return;}var aJ=aI.entry;var aN={rows:aJ,cols:[{key:"caption",caption:"全选",type:"checkbox",showText:true,isEntry:true}]};aG=aj(T.el,r,aN);T.el.addClass("entryRts");var aO=aI.dict;var aH={rows:aO,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"代码"}]};s=aj(H.el,K,aH);var aK=aI.form;var aL={rows:aK,cols:[{key:"caption",caption:"名称"},{key:"key",caption:"标志"}]};ap=aj(ai.el,aF,aL);aG.attr("enable",false);},install:function(){var aL=p;aL.el.children("ul").unbind();aL.el.children("ul").click(function(aN){var aO=a(aN.target);if(aO.hasClass("ui-anchor-label")||aO.hasClass("ui-tans-anchor")){if(aL.selectedTab&&aL.selectedTab.attr("aria-controls")!=aO.closest("li").attr("aria-controls")){if(!aL.enable){return false;}aO.closest("li").toggleClass("aria-selected");}var aM=aO.closest("li").attr("aria-controls");if(aL.selectedTab.attr("aria-controls")==aO.closest("li").attr("aria-controls")){aN.stopPropagation();return false;}else{aL.selectedTab.toggleClass("aria-selected");a("#"+aL.selectedTab.attr("aria-controls")).toggleClass("aria-show");}a("#"+aM).toggleClass("aria-show");aL.setActiveTab(aM);a("#"+aM).show();aL.layout.layout(aL.getWidth(),aL.getHeight());aL.selectedTab=aO.closest("li");}a(".tab-body .ui-corner-bottom",aL.el).css("display","none");a(".tab-body .ui-corner-bottom.aria-show ",aL.el).css("display","block");aN.stopPropagation();return false;});a("input[type='text']",A).unbind();a("button",A).unbind();w.el.click(function(aM){aG.attr("enable",true);ak.attr("enable",false);s.attr("enable",false);ap.attr("enable",false);w.setEnable(false);D.setEnable(true);aE.setEnable(true);V.setEnable(false);X.setEnable(true);p.setEnable(false);a(".checkbox",A).removeAttr("disabled");});var aK=function(aN){var aP=a("[pId='"+aN.id+"'] .checkbox:checked",d).size();var aQ=false;var aR=aN.children;if(aP==aR.length){for(var aO=0,aM=aR.length;aO<aM;aO++){var aS=aR[aO];if(aS.children&&aS.children.length>0){aQ=aK(aS);}}}else{aQ=true;}return aQ;};var aJ=function(aV,aS,aN,aM){if(aV.length>0){for(var aP=0,aQ=aV.length;aP<aQ;aP++){var aT=aV[aP];var aW=aT.row;var aR=a(".checkbox",aW);var aU=aR.is(":checked");if(aT.changed){if(aT.children&&aT.children.length>0){var aO=aK(aT);if(!aO){aS.push(aT.id);}else{if(aU){aN.push(aT.id);}else{aM.push(aT.id);}aJ(aT.children,aS,aN,aM);}}else{if(aU){aS.push(aT.id);}else{aM.push(aT.id);}}}else{if(aT.children&&aT.children.length>0){aJ(aT.children,aS,aN,aM);}}}}};D.el.click(function(aP){var aU={key:ac.key,id:ac.id,type:ac.type,operatorID:ac.tag==YIUI.Custom_tag.OperatorRights?ac.id:-1,roleID:ac.tag==YIUI.Custom_tag.RoleRights?ac.id:-1};var aR=ac.type;switch(aR){case YIUI.Rights_type.TYPE_ENTRY:aU.rights=a.toJSON(aG.entryKeys);aU.allRights=aG.allRights;aU.cmd="SaveEntryRights";break;case YIUI.Rights_type.TYPE_DICT:aU.allRights=ac.dict.allRights;var aT=ac.clickTr.attr("secondaryType")==5;if(!aT){var aQ=[],aN=[],aM=[];var aS=d.treeNode.roots;aJ(aS,aQ,aN,aM);aU.halfCheckRights=a.toJSON(aN);aU.delRights=a.toJSON(aM);aU.addRights=a.toJSON(aQ);}else{aU.addRights=a.toJSON(ac.dict.addRts);aU.delRights=a.toJSON(ac.dict.delRts);}aU.saveType=ac.dict.saveType;aU.itemKey=ac.itemKey;aU.cmd="SaveDictRights";break;case YIUI.Rights_type.TYPE_FORM:aU.allOptRights=aC.allOptRights;aU.optRights=a.toJSON(aC.optRts);aU.allEnableRights=ad.hasAllEnableRights;aU.enableRights=a.toJSON(ad.enableRts);aU.allVisibleRights=ad.hasAllVisibleRights;aU.visibleRights=a.toJSON(ad.visibleRts);aU.formKey=ac.formKey;aU.cmd="SaveFormRights";break;}aH(aU);a(".checkbox[type='checkbox']",A).attr("disabled","disabled");aG.attr("enable",false);ak.attr("enable",true);s.attr("enable",true);ap.attr("enable",true);D.setEnable(false);w.setEnable(true);aE.setEnable(false);V.setEnable(true);X.setEnable(false);p.setEnable(true);var aO=a(".checkbox:checked",A).parents("tr");});aE.el.click(function(aM){aG.attr("enable",false);ak.attr("enable",true);s.attr("enable",true);ap.attr("enable",true);aE.setEnable(false);D.setEnable(false);w.setEnable(true);V.setEnable(true);X.setEnable(false);p.setEnable(true);a(".checkbox[type='checkbox']",A).attr("disabled","disabled");if(ac.clickTr){ac.clickTr.removeClass("sel");ac.clickTr.click();}});S.el.click(function(aM){M(0,true);});var aH=function(aN){var aO={};aO.service="SetRightsService";aO=a.extend(aO,aN);var aM=null;var aP=function(){};Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,aO,aP);return aM;};var aI=function(a1,a2){if(a2.searchValue==a1){a2.searches++;}else{a2.searches=1;a2.searchValue=a1;}var aS=a("tr:gt(0)",a2),aX,aM,aQ,aW,aZ,a0=0,aU=true,aP,aO=false;var aN=a2.parent();for(var aV=0,aY=aS.length;aV<aY;aV++){aX=aS.eq(aV);aM=a("td",aX);aZ=false;for(var aT=0,aR=aM.length;aT<aR;aT++){aQ=aM.eq(aT);aW=aQ.text().toLowerCase();if(aW.indexOf(a1)>-1){if(aU){aP=aX;aU=false;}aZ=true;a0++;continue;}}if(aZ){if(a2.searches==a0){aN.scrollTop(0);aN.scrollTop(aX.position().top);aX.click();aO=true;break;}}}if(!aO&&aP){aN.scrollTop(0);aN.scrollTop(aP.position().top);aP.click();a2.searches=1;}};k.el.click(function(aN){var aM=a("input",aA.el).val().toLowerCase();aI(aM,s);});am.el.click(function(aN){var aM=a("input",n.el).val().toLowerCase();aI(aM,ap);});g.el.click(function(aQ){var aP=a("input",ar.el).val().toLowerCase();var aN=ac.clickTr.attr("secondaryType")==5;var aM=al.el;if(aN){aM=a(".paginationjs-content",al.el);var aO=ay(ac.itemKey,0);d.removeAll();ac.dictRts=[];d=aj(aM,F,aO);d.dictRts=ac.dictRts;ac.setTotalRowCount(0,aO.totalRowCount);}else{aI(aP,d);}});}};b.init();b.install();return b;};}(jQuery));YIUI.Control.Dialog=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.DialogHandler,msgType:YIUI.Dialog_MsgType.YES_NO_OPTION,eventList:{},onRender:function(a){this.base(a);this.dialog=new YIUI.Yes_Dialog({el:this.el,title:this.title,msg:this.msg,msgType:this.msgType});this.el.addClass("ui-dlg");this.dialog.show();},regEvent:function(a,b){this.eventList[a]=b;},getEvent:function(a){return this.eventList[a];},regExcp:function(a){this.excp=a;},setOwner:function(a){this.form=a;},getOwner:function(){return this.form;},install:function(){var a=this;$(".dlg-btn",a.el).click(function(c){var b=$(this).attr("key");a.handler.doOnClick(a,b);});$(".dialog-close",a.el).click(function(b){a.handler.doOnClick(a,YIUI.Dialog_Btn.STR_NO);});}});YIUI.reg("dialog",YIUI.Control.Button);YIUI.Control.FileChooser=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",useType:"open",allowMulti:false,extFilter:null,handler:YIUI.FileChooserHandler,onSetWidth:function(a){this.base(a);this.$input.width(a-this.$btn.width());this.$fileBtn.css("left",this.$btn.position().left);},onSetHeight:function(a){this.base(a);this.$input.height(a);this.$btn.height(a);},getValue:function(){},onRender:function(a){this.base(a);this.el.addClass("ui-fc");this.$input=$("<input class='txt' />").appendTo(this.el);this.$btn=$("<button class='btn'>...</button>").appendTo(this.el);this.$fileBtn=$("<input type='file' name='file' data-url='upload' class='fup'>").appendTo(this.el);},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());if(a.clickcontent){this.clickContent=a.clickcontent;}},install:function(){var a=this;this.el.delegate(".fup","change",function(b){a.$input.val(this.value);});}});YIUI.reg("filechooser",YIUI.Control.FileChooser);YIUI.Control.MapDraw=YIUI.extend(YIUI.Control,{handler:YIUI.MapDrawHandler,zoom:11,marker:false,lng:0,lat:0,polyEdit:false,height:500,width:500,setValue:function(b,d,a){var c=this.base(b,d,a);return c;},setZoom:function(a){this.zoom=a;},setMarker:function(a){this.marker=a;},setLng:function(a){this.lng=a;},setLat:function(a){this.lat=a;},setCenter:function(a){this.map.setCenter(a);},AddPoint:function(a){this.map.setPoint(a);},AddPoints:function(a){this.map.addPoints(a);},delPoints:function(a){this.map.delPoints(a);},delPoint:function(a){this.map.delPoint(a);},clear:function(){this.map.clear();},setDriveRoute:function(c,a,b){this.map.setDriveRoute(c,a,b);},startDraw:function(){this.map.startDraw();},getDrawPoints:function(){return this.map.getDrawPoints();},isInBounds:function(a){return this.map.isInBounds(a);},editPolygon:function(){this.map.editPolygon();},disablePolygon:function(){this.map.disablePolygon();},drawMarker:function(a){this.map.drawMarker(a);},drawPolyline:function(a){this.map.drawPolyline(a);},drawPolygon:function(a){this.map.drawPolygon(a);},getMapInfo:function(){return this.map.getMapInfo();},showMapInfo:function(a){this.map.showMapInfo(a);},setEnable:function(a){this.map.setEnable(a);},onRender:function(d){this.base(d);this.el.addClass("ui-map");this.marker&&this.setMarker(this.marker);this.zoom&&this.setZoom(this.zoom);this.lng&&this.setLng(this.lng);this.lat&&this.setLat(this.lat);var e=this;var b={id:this.el.attr("id"),lng:this.lng,lat:this.lat,zoom:this.zoom,marker:this.marker,type:this.getMetaObj().mapType,polyEdit:this.polyEdit};var a=this.paras;if(a){for(var c in a){b[c]=a[c];}}this.map=new MapUtils(b);},beforeDestroy:function(){},initDefaultValue:function(a){this.base(a);this.el.outerWidth(this.el.width());},install:function(){var a=this;}});YIUI.reg("map",YIUI.Control.MapDraw);YIUI.Control.UTCDatePicker=YIUI.extend(YIUI.Control,{autoEl:"<div></div>",handler:YIUI.DatePickerHandler,behavior:YIUI.UTCDatePickerBehavior,_hasShow:false,_firstClick:true,isOnlyDate:false,formatStr:"yyyy-MM-dd HH:mm:ss",isNoTimeZone:false,regional:"zh-CN",mask:null,calendars:1,setTip:function(a){var a=this.text;this.base(a);},setFormatStr:function(){if(this.getMetaObj().isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}},setEditable:function(a){this.editable=a;this.datePicker.setEditable(a);},setEnable:function(a){this.enable=a;this.datePicker.setEnable(a);},setBackColor:function(a){this.backColor=a;this.datePicker.getInput().css({"background-image":"none","background-color":a});},test:function(){return this.getValue();},setForeColor:function(a){this.foreColor=a;this.datePicker.getInput().css("color",a);},setFormatStyle:function(a){this.cssStyle=a;this.datePicker.getInput().css(a);},setText:function(b){if(b&&b.length>0){b=b.replace(/-/g,"/");var a=new Date(b);this.text=a.Format(this.formatStr);this.datePicker.getInput().val(this.text);}else{this.text=b;this.datePicker.getInput().val(this.text);}},getText:function(){var a=this.text||"";return a;},changeToVal:function(){var a=this.getText();if(this.getText()!=""){a=a.replace(/(\W+)/g,"");return a;}else{return null;}},checkEnd:function(a){this.value=a;this.caption=a;if(!a){return;}var b=YIUI.UTCDateFormat.formatCaption(a,this.getMetaObj().isOnlyDate,this.check);this.setText(b);},setValue:function(e,g,d,c,b){var a=false;if($.isNumeric(e)){a=true;}this.check=a;var f=this.base(e,g,d,c,b);return f;},onRender:function(a){this.base(a);var b=this;b.formatStr&&this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:b.id,el:b.el,formatStr:b.formatStr,isOnlyDate:b.getMetaObj().isOnlyDate,isNoTimeZone:b.getMetaObj().isNoTimeZone,regional:b.getMetaObj().regional,calendars:b.calendars});this.el.addClass("ui-dp ui-utc");if(this.value>0&&this.text){this.setText(this.text);}},afterRender:function(){this.base();if(this.mask){}},onSetWidth:function(a){this.datePicker.setWidth(a);},onSetHeight:function(a){this.datePicker.setHeight(a);},initDefaultValue:function(c){this.base(c);this.formatStr=c.formatstr;this.isOnlyDate=c.isonlydate;this.isNoTimeZone=c.isnotimezone;this.calendars=1;if(this.isOnlyDate){this.formatStr=this.formatStr.split(" ")[0];}var d=this;this.setFormatStr();this.datePicker=new YIUI.Yes_DatePicker({id:d.id,el:d.el,isPortal:true,formatStr:d.formatStr,isOnlyDate:d.isOnlyDate,isNoTimeZone:d.isNoTimeZone,regional:d.regional,calendars:d.calendars});this.datePicker.setIsNoTimeZone(this.isNoTimeZone);this.datePicker.setOnlyDate(this.isOnlyDate);this.datePicker.setRegional(this.regional);this.datePicker.setCalendars(this.calendars);this.datePicker.initDatePicker(this.id);var a=this.datePicker.getInput(),b=this.datePicker.getBtn();b.css({left:this._dateInput.outerWidth()-26+"px",top:(this._dateInput.outerHeight()-16)/2+"px",height:"16px",width:"16px"});if($.browser.isIE){a.css("line-height",(this.el.outerHeight()-3)+"px");}if(this.value){if(this.isOnlyDate){this.value=this.value.substring(0,this.value.indexOf(" "));}this.setValue(this.value);}if(this.text){this.setText(this.text);}},beforeDestroy:function(){this.datePicker.getDropView().remove();},focus:function(){this.datePicker&&this.datePicker.getInput().focus();},install:function(){this.base();var a=this;this.datePicker.getInput().bind("click",function(b){this.select();}).on("blur",function(b){var c=b.target.value;if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getDropView().blur(function(b){var c=a.datePicker.getInput().val();if(c!=a.text){a.text=c;a.setValue(a.changeToVal(),true,true);}});this.datePicker.getInput().keydown(function(b){var c=b.keyCode||b.charCode;if(c===9||c===13||c===108){a.focusManager.requestNextFocus(a);b.preventDefault();}});}});YIUI.reg("utcdatepicker",YIUI.Control.UTCDatePicker);YIUI.Control.SearchBox=YIUI.extend(YIUI.Control,{handler:YIUI.SearchBoxHandler,behavior:YIUI.SearchBoxBehavior,providerKey:null,providerFormulaKey:null,providerDependency:null,onRender:function(a){this.base(a);this.el.addClass("ui-srch");this.txt=$("<input type='text' class='txt'/>").appendTo(this.el);this.btn=$("<button class='btn'>...</button>").appendTo(this.el);},onSetHeight:function(a){this.base(a);},onSetWidth:function(a){this.base(a);this.txt.css("width",a-this.btn.outerWidth());},setEnable:function(a){this.base(a);},getControlValue:function(){return this.txt.val();},checkEnd:function(a){this.value=a;this.txt.val(this.value);},dependedValueChange:function(a){var b=this.getMetaObj();if(!b.providerKey){if(b.providerDependency==a){this.setValue(null,false,true);this.handler.setNeedRefresh(true);}}},install:function(){this.base();var a=this;a.btn.click(function(c){var b=a.getControlValue();a.handler.doOnClick(a);});a.txt.blur(function(c){var b=a.getControlValue();a.handler.autoComplete(a,b);});}});YIUI.reg("searchbox",YIUI.Control.SearchBox);YIUI.GridSumUtil=(function(){var Return={evalAffectSum:function(form,grid,rowIndex,colIndex){var rd=grid.dataModel.data[rowIndex],curGlevel=rd.rowGroupLevel,len=grid.dataModel.data.length,clen=grid.dataModel.colModel.columns.length,preRd,nextRd,column;for(var i=rowIndex-1;i>=0;i--){preRd=grid.dataModel.data[i];if(preRd.rowType=="Group"&&preRd.rowGroupLevel<=curGlevel){curGlevel=preRd.rowGroupLevel;this.evalSumFieldValue(form,grid,i,colIndex);}if(preRd.rowGroupLevel==0){break;}}curGlevel=rd.rowGroupLevel;for(var j=rowIndex+1;j<len;j++){nextRd=grid.dataModel.data[j];if(nextRd.isDetail&&nextRd.bookmark==null){continue;}if(nextRd.rowType=="Group"&&nextRd.rowGroupLevel<=curGlevel){curGlevel=nextRd.rowGroupLevel;this.evalSumFieldValue(form,grid,j,colIndex);}if(nextRd.rowGroupLevel==0){break;}}for(var k=0;k<clen;k++){column=grid.dataModel.colModel.columns[k];if(column.columnType!=null&&column.columnType!=="Detail"){this.evalSumFieldValue(form,grid,rowIndex,k);}}for(var m=0;m<len;m++){rd=grid.dataModel.data[m];if(rd.rowType=="Total"){for(var n=0;n<clen;n++){this.evalSumFieldValue(form,grid,m,n);}}}},evalSumFieldValue:function(form,grid,rowIndex,colIndex){var rowData=grid.dataModel.data[rowIndex],metaRow=grid.metaRowInfo.rows[rowData.metaRowIndex],metaCell=metaRow.cells[colIndex],defaultFormulaValue=metaCell.defaultFormulaValue;if(defaultFormulaValue!==undefined&&defaultFormulaValue.length>0&&defaultFormulaValue.indexOf("Sum")==0){var value=form.eval(defaultFormulaValue,{form:form,target:metaCell.key,rowIndex:rowIndex,colIndex:colIndex},null);grid.setValueAt(rowIndex,colIndex,value,true,false);}},evalSum:function(form,grid){var length=grid.dataModel.data.length,cLength=grid.dataModel.colModel.columns.length,row;for(var i=0;i<length;i++){row=grid.dataModel.data[i];if(row.rowType=="Group"||row.rowType=="Total"){for(var j=0;j<cLength;j++){this.evalSumFieldValue(form,grid,i,j);}}}}};return Return;})();YIUI.Control.Grid=YIUI.extend(YIUI.Control,{autoEl:"<table></table>",dataModel:{data:[],colModel:[]},groupHeaders:[],pageInfo:null,errorInfoes:{rows:[],cells:[]},hasRowClick:false,hasRowChange:false,hasRowDblClick:false,gridHandler:YIUI.GridHandler,rowHeight:32,selectFieldIndex:-1,init:function(a){this.base(a);if(this.dataModel.data.isFirstShow){this.rowIDMap=this.dataModel.data.rowIDMap;this.dataModel.data=this.dataModel.data.addRowArray;this.initRowDatas();}},initRowDatas:function(){var a=this.dataModel.data.length,c;for(var b=0;b<a;b++){c=this.dataModel.data[b];this.initOneRow(c);}},initOneRow:function(a){if(a.rowID==undefined){a.rowID=this.randID();}if(a.rowType==undefined){a.rowType="Detail";if(a.metaRowIndex==undefined||a.metaRowIndex==-1){a.metaRowIndex=this.metaRowInfo.dtlRowIndex;}}a.isDetail=(a.rowType=="Detail");a.isEditable=(a.rowType=="Fix"||a.rowType=="Detail");a.cellKeys=this.metaRowInfo.rows[a.metaRowIndex].cellKeys;a.rowHeight=this.metaRowInfo.rows[a.metaRowIndex].rowHeight;if(this.hasColExpand&&a.isDetail&&a.cellBkmks==undefined){a.cellBkmks=[];}},setVAlign:function(a){},setHAlign:function(a){},onSetWidth:function(a){this.el.setGridWidth(a);},setHeight:function(b){this.base(b);if(!this.isHeightSet){var d=this.el[0].grid.bDiv.scrollTop,e=this.el[0].grid.bDiv.scrollLeft;var c=this.getFocusRowIndex(),f=this.getFocusColIndex();this.refreshGrid({populate:true,rowNum:this.dataModel.data.length});this.el[0].grid.bDiv.scrollTop=d;this.el[0].grid.bDiv.scrollLeft=e;var a=this.el.getGridCellAt(c+1,f+1);if(a){a.notOnSelectRow=true;$(a).click();}}},onSetHeight:function(b){this.el.setGridHeight(b);var d=this.el[0].grid.bDiv.scrollTop,e=this.el[0].grid.bDiv.scrollLeft;var c=this.getFocusRowIndex(),f=this.getFocusColIndex();this.refreshGrid({populate:true,rowNum:parseInt((this.el[0].grid.bDiv.clientHeight/this.rowHeight),10)+2});this.el[0].grid.bDiv.scrollTop=d;this.el[0].grid.bDiv.scrollLeft=e;var a=this.el.getGridCellAt(c+1,f+1);if(a){a.notOnSelectRow=true;$(a).click();}this.isHeightSet=true;},getOuterEl:function(){return $("#gbox_"+this.id);},diff:function(C){var h=false;if(typeof C.editable!="undefined"&&C.editable!=this.isEnable()){this.setEnable(C.editable);this.el.setGridParam({enable:this.isEnable()});this.el[0].updatePager();}var o=false;if(C.pageInfo){if(C.pageInfo.currentPage){this.pageInfo.currentPage=C.pageInfo.currentPage;o=true;}if(C.pageInfo.totalRowCount){this.pageInfo.totalRowCount=C.pageInfo.totalRowCount;}if(C.pageInfo.totalPage){this.pageInfo.totalPage=C.pageInfo.totalPage;}}if(C.errorInfoes){this.errorInfoes.cells=C.errorInfoes.cells;this.errorInfoes.rows=C.errorInfoes.rows;}if(C.dataModel){if(C.dataModel.cellEnables){for(var t=0,D=C.dataModel.cellEnables.length;t<D;t++){var v=C.dataModel.cellEnables[t],c=v.rowID,d=this.getRowDataByID(c),q=this.getRowIndexByID(c);if(d==null||v.cells==undefined){continue;}for(var r in v.cells){this.setCellEnable(q,r,v.cells[r]);}}}if(C.dataModel.colModel){if(C.dataModel.colModel.columns){this.dataModel.colModel.columns=C.dataModel.colModel.columns;}if(C.dataModel.colModel.cells){this.dataModel.colModel.cells=C.dataModel.colModel.cells;}this.el[0].p.colModel.isChange=false;for(var u=0,A=this.dataModel.colModel.columns.length;u<A;u++){var k=this.dataModel.colModel.columns[u];var x=null;for(var f=0,n=this.el[0].p.colModel.length;f<n;f++){x=this.el[0].p.colModel[f];if(x.name==k.name){break;}}x.editable=k.editable;if(x.hidden!==k.hidden){this.el[0].p.colModel.isChange=true;h=true;}x.hidden=k.hidden;}}if(C.dataModel.data){var l=C.dataModel.data.isFirstShow;if(l){this.dataModel.data=C.dataModel.data.addRowArray;if(!this.dataModel.data){this.dataModel.data=new Array();}this.initRowDatas();if(this.treeType!==-1){this.rowIDMap=C.dataModel.data.rowIDMap;this.treeOldData=this.dataModel.data;this.dataModel.data=new Array();var B,w,D;if(this.treeExpand){for(B=0,D=this.treeOldData.length;B<D;B++){w=this.treeOldData[B];if(w.childRows.length>0){w.isExpand=true;}this.dataModel.data.push(w);}}else{for(B=0,D=this.treeOldData.length;B<D;B++){w=this.treeOldData[B];if(w.parentRow===undefined){this.dataModel.data.push(w);}}}}else{if(this.rowExpandIndex!=-1){for(var z=0,G=this.dataModel.data.length;z<G;z++){var m=this.dataModel.data[z];m.data[this.rowExpandIndex][2]=false;}}}h=true;}else{var E=C.dataModel.data.addRowArray;var p=C.dataModel.data.modifyRowArray;var g=C.dataModel.data.deleteRowArray;this.deleteRows(g);this.addNewRows(E);this.modifyRows(p);h=false;}}var b=this.el[0].grid.bDiv.scrollTop,y=this.el[0].grid.bDiv.scrollLeft;var a={enable:this.isEnable()};this.el.setGridParam(a);if(h){this.refreshGrid(a);}this.initPageOpts(o);this.initGridErrors();this.el[0].grid.bDiv.scrollTop=b;this.el[0].grid.bDiv.scrollLeft=y;var s=false,e=this.el[0].p.editCells;for(var B=0,F=e.length;B<F;B++){if(e[B].cell.editor!==undefined){s=true;break;}}if(s){this.el[0].p.editCells=e;}}},deleteRows:function(e){if(e){for(var b=this.dataModel.data.length-1;b>=0;b--){var d=this.dataModel.data[b];for(var c=e.length-1;c>=0;c--){var a=e[c]["rowID"];if(d.rowID==a){this.dataModel.data.splice(b,1);this.el[0].deleteGridRow(b);e.splice(c,1);break;}}}}},addNewRows:function(d){if(d){while(d.length!=0){for(var c=d.length-1;c>=0;c--){var a=d[c];if(a.data!==null&&a.data!==undefined){this.initOneRow(a);}var e=a["insertRowID"];if(e==-1){this.dataModel.data.splice(0,0,a);this.el[0].insertGridRow(0,a);d.splice(c,1);}else{for(var b=0,g=this.dataModel.data.length;b<g;b++){var h=this.dataModel.data[b];var f=h["rowID"];if(f==e){this.dataModel.data.splice(b+1,0,a);this.el[0].insertGridRow(b+1,a);d.splice(c,1);break;}}}}}}},modifyRows:function(f){if(f){for(var g=0,n=f.length;g<n;g++){var e=f[g];var o=e["rowID"],l,a,q,m=this.showRowHead?1:0;for(var d=0,h=this.dataModel.data.length;d<h;d++){var r=this.dataModel.data[d];var b=r["rowID"];if(b==o){a=this.dataModel.data[d];for(var c=0,p=e.cells.length;c<p;c++){q=e.cells[c];a.data[q.colIndex]=q.value;this.el[0].modifyGridCell(d,q.colIndex+m,a);}if(this.treeType!==-1){e.isExpand=r.isExpand;e.treeLevel=r.treeLevel;l=this.rowIDMap[o];this.treeOldData.splice(l,1,a);}this.dataModel.data.splice(d,1,a);break;}}}}},createCellEditor:function(cell,edittype,iRow,iCol,opt){if(edittype==="label"){return;}var editor,$t=this,self=$t.getControlGrid(),form=YIUI.FormStack.getForm(self.ofFormID),rowIndex=parseInt($.ygrid.stripPref($.ygrid.uidPref,$t.rows[iRow].id),10),rowData=$t.p.data[rowIndex],rowID=rowData.rowID,colIndex=$t.p.rowSequences?iCol-1:iCol,cellV=rowData.data[colIndex],oldV=cellV[0],oldCaption=cellV[1];if(oldV===null||oldV===undefined||oldV==="&nbsp;"||oldV==="&#160;"||($.isString(oldV)&&oldV.length===1&&oldV.charCodeAt(0)===160)){oldV="";}cell.html("").attr("tabIndex","0");var scrollTop=$t.grid.bDiv.scrollTop,scrollLeft=$t.grid.bDiv.scrollLeft;var setFocusAndSelect=function(editor){var moveStart=function(element){var pos=element.value.length;if(element.setSelectionRange){element.setSelectionRange(pos,pos);}else{if(element.createTextRange){var r=element.createTextRange();r.moveStart("character",pos);r.collapse(true);r.select();}}};window.setTimeout(function(){$(editor.getInput()).focus(function(){if(!$.ygrid.msie){moveStart(this);}});editor.getInput().focus();if(!cell[0].inKeyEvent){editor.getInput().select();}else{if($.ygrid.msie){moveStart(editor.getInput()[0]);}cell[0].inKeyEvent=false;}},0);};var hideDropView=function(){var th=self.el,p=th[0].p,value;if(p.editCells.length===0){var dV=p.data[iRow-1].data[iCol-(p.rowSequences?1:0)];p.editCells.push({ir:iRow,ic:iCol,name:p.colModel[iCol].name,v:dV,cell:cell});}th.yGrid("saveCell",iRow,iCol);th[0].selecting=false;var hCell=$("td.ui-state-highlight",th[0].grid.bDiv);if(hCell[0]&&(hCell[0].parentElement.id!==p.selectRow||hCell[0].cellIndex!==p.selectCell)){hCell.click();}window.setTimeout(function(){$("#"+self.el[0].p.knv).focus();self.el[0].grid.bDiv.scrollTop=scrollTop;self.el[0].grid.bDiv.scrollLeft=scrollLeft;},0);};var clickDropBtn=function(editor){var event=opt.event||window.event;if(event.type==="click"){var srcE=event.target||event.srcElement,x=event.offsetX||(event.clientX-srcE.getBoundingClientRect().left),y=event.offsetY||(event.clientY-srcE.getBoundingClientRect().top),btn=editor.getDropBtn()[0],top=btn.offsetTop,left=btn.offsetLeft,height=btn.offsetHeight,width=btn.offsetWidth;if(top<=y&&y<=(top+height)&&left<=x&&x<=(cell[0].offsetLeft+cell[0].offsetWidth)){editor.getDropBtn().click();}}};if(edittype=="dynamic"){var typeFormula=opt.typeFormula;var typeDefKey=form.eval(typeFormula,{form:form,rowIndex:rowIndex,colIndex:colIndex});var cellTypeDef=DynamicCell.getCellTypeTable()[form.formKey][typeDefKey];if(cellTypeDef!=null){if(cellTypeDef.options.isAlwaysShow){return;}cell[0].cellTypeDef=cellTypeDef;edittype=cellTypeDef.options.edittype;opt=$.extend(opt,cellTypeDef.options,{typeDefKey:typeDefKey});}}switch(edittype){case"textEditor":opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};editor=new YIUI.CellEditor.CellTextEditor(opt);editor.getInput().addClass("celled");editor.render(cell);editor.setValue(oldV);setFocusAndSelect(editor);break;case"numberEditor":opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};editor=new YIUI.CellEditor.CellNumberEditor(opt);editor.getInput().addClass("celled");editor.render(cell);editor.setValue(oldV);setFocusAndSelect(editor);break;case"dict":self.gridHandler.doGridCellSelect(self,rowID,colIndex);var stopClickCell=function(){self.el[0].grid.clearSelectCells();self.el[0].selecting=false;};opt=$.extend(true,opt,{ofFormID:self.ofFormID,hiding:hideDropView,rowIndex:self.getRowIndexByID(rowID),colIndex:colIndex,stopClickCell:stopClickCell});opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};editor=new YIUI.CellEditor.CellDict(opt,cell);editor.render(cell);if(oldV){oldV=new YIUI.ItemData(oldV);}editor.setValue(oldV);editor.setText(oldCaption);clickDropBtn(editor);break;case"comboBox":self.gridHandler.doGridCellSelect(self,rowID,colIndex);opt=$.extend(true,opt,{ofFormID:self.ofFormID,hiding:hideDropView,cxt:{form:form,rowIndex:self.getRowIndexByID(rowID),colIndex:colIndex}});editor=new YIUI.CellEditor.CellComboBox(opt);editor.render(cell);editor.setValue(oldV);editor.setText(oldCaption);editor.yesCom.setItems(editor.yesCom.items);editor.getDropBtn().click();break;case"datePicker":case"utcDatePicker":editor=new YIUI.CellEditor.CellDatePicker(opt);editor.render(cell);if(edittype=="utcDatePicker"&&oldV!=null&&oldV!=""){oldV=YIUI.UTCDateFormat.formatCaption(oldV,opt.isOnlyDate,true);}editor.setValue(oldV);editor.getDropView().blur(function(){self.el.yGrid("saveCell",iRow,iCol);});clickDropBtn(editor);break;case"textButton":opt.rowID=rowID;opt.colIndex=colIndex;opt.saveCell=function(value){self.el.yGrid("saveCell",iRow,iCol);self.el[0].selecting=false;};opt.click=function(){self.gridHandler.doOnCellClick(self,this.rowID,this.colIndex);window.setTimeout(function(){$("#"+$t.p.knv).focus();},0);};editor=new YIUI.CellEditor.CellTextButton(opt);editor.getInput().addClass("celled");editor.setValue(oldV);editor.render(cell);setFocusAndSelect(editor);break;}editor.getInput().keydown(function(event){var keyCode=event.charCode||event.keyCode||0;if(keyCode===13||keyCode===108||keyCode===9){editor.getInput().blur();if(editor.yesCom.isShowQuery){event.stopPropagation();}$("#"+self.el[0].p.knv).trigger("keydown",event);}});cell[0].editor=editor;},endCellEditor:function(m,k,e,l){var j=this.p.colModel[l],a=this.rows[e].id,f=$.ygrid.stripPref($.ygrid.uidPref,a),o=this.p.data[f],b=this.getCellEditOpt(o,l),d=o.data[j.index][2],h,n="";if(m[0].editor==null&&k!="label"){return[null,"",d];}if(k=="dynamic"&&m[0].cellTypeDef!=null){k=m[0].cellTypeDef.options.edittype;}switch(k){case"dict":m[0].editor.beforeDestroy();h=m[0].editor.getValue();if(h!==null){if(h.length&&h.length>=1){for(var c=0,g=h.length;c<g;c++){n+=h[c].caption+",";}n=n.substring(0,n.length-1);}else{n=h.caption==undefined?"":h.caption;}}if(b.multiSelect){h=[h];}h=[h,n,d];return h;case"numberEditor":case"textEditor":case"textButton":m[0].editor.finishInput();case"comboBox":m[0].editor.beforeDestroy();h=m[0].editor.getValue();h=[h,m[0].editor.getText(),d];return h;case"datePicker":case"utcDatePicker":m[0].editor.finishInput();m[0].editor.beforeDestroy();h=m[0].editor.getValue();if(h==null){h=[null,"",d];}else{n=new Date(h).Format(b.editOptions.formatStr).toLocaleString();if(k=="utcDatePicker"){h=YIUI.UTCDateFormat.format(new Date(h),b.editOptions);}h=[h,n,d];}return h;case"label":return o.data[j.index];}return[null,"",d];},afterEndCellEditor:function(l,j,n,f,k){var c=this,a=c.getControlGrid();if(j=="dynamic"&&l[0].cellTypeDef!=null){j=l[0].cellTypeDef.options.edittype;}if(j!==undefined&&j!=="label"&&l[0].editor!=null){var h=l[0].editor.getValue(),b=c.rows[f].id,g=$.ygrid.stripPref($.ygrid.uidPref,b),o=this.p.data[g],e=o.rowID,d=c.getCellEditOpt(o,k);if(j=="utcDatePicker"){h=YIUI.UTCDateFormat.format(new Date(h),d.editOptions);}if(j=="textEditor"||j=="textButton"){a.afterTextEditing=true;}if(n){a.gridHandler.doCellValueChanged(a,e,c.p.rowSequences?k-1:k,h);}if(j=="numberEditor"){var m=c.rows[f].cells[k];if(h.isNegative()){$(m).css({color:d.editOptions.negtiveForeColor});}else{$(m).css({color:""});}}}},alwaysShowCellEditor:function(c,j,g,n,v,b,f){var h,u=this.p,k=this,l=u.data[b.ri],d=l.rowID,a=this.getControlGrid(),q=v[2]||(v[2]==null&&a.isEnable()),e=k.getCellEditOpt(l,g),t=(u.rowSequences?g-1:g);c.html("");if(l.rowType=="Group"||l.rowType=="Total"){return;}b.rowID=d;b.colIndex=t;b.click=function(){var p=k.grid.bDiv.scrollTop,z=k.grid.bDiv.scrollLeft;if(e.formatter==="checkbox"){var A=$("input",h)[0].checked;a.gridHandler.doOnCellClick(a,this.rowID,this.colIndex,A);}else{a.gridHandler.doOnCellClick(a,this.rowID,this.colIndex);}if(k.p.selectFieldIndex==e.colIndex){a.checkHeadSelect(e.colIndex);}c.click();window.setTimeout(function(){if(k.grid){$("#"+u.knv).focus();k.grid.bDiv.scrollTop=p;k.grid.bDiv.scrollLeft=z;}},0);};c[0].style.height=f+"px";switch(e.formatter){case"button":var x="";if(b.icon){x="<span class='icon button' style='background-image: url(Resource/"+b.icon+")'></span>";}h=$("<button class='ui-btn button cellEditor' style='width: 100%;height: 100%'>"+x+"<span class='txt button'>"+(v[0]==null?"":v[0])+"</span></button>");h[0].enable=q;h.mousedown(function(p){p.delegateTarget.enable&&$(this).addClass("hover");}).mouseup(function(p){p.delegateTarget.enable&&$(this).removeClass("hover");});h.click(function(p){p.target.enable&&b.click();});h.delegate(".button","click",function(p){p.delegateTarget.enable&&b.click();});h.appendTo(c);h.attr("title",v[0]);c.attr("title",v[0]);break;case"hyperlink":var y="target='"+YIUI.Hyperlink_target[b.targetType]+"'",w=((b.url==undefined||b.url.length==0)?"":"href="+b.url),r=(v[0]==null?"":v[0]);h=$("<a class='ui-hlk cellEditor' "+y+" "+w+" style='width: 100%;height: 100%;line-height: "+f+"px'>"+r+"</a>");h[0].enable=q;h.mousedown(function(p){p.delegateTarget.enable&&$(this).addClass("hover");}).mouseup(function(p){p.delegateTarget.enable&&$(this).removeClass("hover");});h.click(function(p){p.target.enable&&b.click();});h.appendTo(c);h.attr("title",v[0]);c.attr("title",v[0]);break;case"checkbox":var m="",o,s;if(v[0]==="1"||v[0]===1||v[0]==="true"||v[0]===true){m="checked";}s=(f-16)/2;h=$("<div class='ui-chk cellEditor' style='width: 100%;height: 100%'>"+"<input  style='height:16px;top:"+s+"px;position: relative' type='checkbox' class='chk' "+m+"/></div>");h[0].enable=q;o=$("input",h);!q&&o.attr("disabled","disabled");h.click(function(p){a.setCellFocus(j-1,a.showRowHead?g-1:g);p.delegateTarget.enable&&b.click();});h.appendTo(c);h.attr("title",v[0]);c.attr("title",v[0]);break;case"image":b.ofFormID=a.ofFormID;b.enable=q;b.value=v[0];b.gridKey=a.key;b.rowIndex=a.getRowIndexByID(b.rowID);b.change=function(p){u.data[j-1].data[n.index]=[p,p];u.editCells.push({ir:j,ic:g,name:n.name,v:u.data[j-1].data[n.index],cell:c});if(u.afterEndCellEditor&&$.isFunction(u.afterEndCellEditor)){u.afterEndCellEditor.call(k,c,e.edittype,true,j,g);}u.selectRow=null;u.selectCell=null;u.editCells=[];k.grid.clearSelectCells();};h=new YIUI.CellEditor.CellImage(b);h.render(c);h.getEl().attr("title",h.pathV);c.attr("title",h.pathV);c[0].editor=h;break;}},doPageEvent:function(d,c,b){c=parseInt(c,10);if(d){this.dataModel.data=[];var a={optType:b};if(!isNaN(c)&&c>=0){a["pageIndex"]=c;}this.gridHandler.doGoToPage(this,JSON.stringify(a));}},initPageOpts:function(f){if(!this.pageInfo.isUsePaging){return;}if(f){this.pageInfo.totalPage+=this.pageInfo.currentPage-1;}var c=this,l=this.id+"_pager",p=$("#first_"+l).removeClass("ui-state-disabled").unbind("click"),s=$("#prev_"+l).removeClass("ui-state-disabled").unbind("click"),j=$("#next_"+l).removeClass("ui-state-disabled").unbind("click"),g=$("#last_"+l).removeClass("ui-state-disabled").unbind("click"),n=$("#pagination_"+l),m=$("#"+l+"_center .ui-pg-input").val(this.pageInfo.currentPage).unbind("keypress");$("#sp_1_"+l).html(this.pageInfo.totalPage);var a=this.pageInfo.currentPage*this.pageInfo.pageRowCount;var o=(this.pageInfo.currentPage-1)*this.pageInfo.pageRowCount+1;if(a==0){o=0;}var q="第"+o+" - "+a+"条";$("#"+l+"_right .ui-paging-info").html(q);p.bind("click",function(){c.doPageEvent(!p.hasClass("ui-state-disabled"),-1,"firstPage");});s.bind("click",function(){c.doPageEvent(!s.hasClass("ui-state-disabled"),-1,"prevPage");});j.bind("click",function(){c.doPageEvent(!j.hasClass("ui-state-disabled"),-1,"nextPage");});g.bind("click",function(){c.doPageEvent(!g.hasClass("ui-state-disabled"),-1,"lastPage");});if(this.pageInfo.totalPage==1){m.attr("readOnly","readOnly");}m.keypress(function(u){var t=u.charCode||u.keyCode||0;if(t===13){if(m.val()>c.pageInfo.totalPage){m.val(c.pageInfo.totalPage);}c.doPageEvent(!m.hasClass("ui-state-disabled"),m.val(),"turnToPage");}else{if(t>=48&&t<=57){return this;}}return false;});var b=function(x,u,y){$("ul",n).html();var t=[],w,z;for(var v=x;v<=u;v++){z=(v==y)?"ui-state-highlight":"";t.push(["<li class='pagination_btn ",z,"' style='",w,"' data-num=",v,">",v,"</li>"].join(""));}$("ul",n).html(t.join(""));};if(this.pageInfo.totalPage<=5){b(1,this.pageInfo.totalPage,this.pageInfo.currentPage);}else{var h=this.pageInfo.currentPage,e=this.pageInfo.totalPage,r=(h-2)>=1?(h-2):1,d=r+4;if(d>e){var k=d-e;r-=k;d-=k;}b(r,d,this.pageInfo.currentPage);}$("li",n).click(function(){var t=$(this).attr("data-num");c.doPageEvent(!$(this).hasClass("ui-state-disabled"),t,"turnToPage");});if(this.pageInfo.currentPage==1){p.addClass("ui-state-disabled");s.addClass("ui-state-disabled");}else{p.removeClass("ui-state-disabled");s.removeClass("ui-state-disabled");}if(this.pageInfo.currentPage==this.pageInfo.totalPage){j.addClass("ui-state-disabled");g.addClass("ui-state-disabled");}else{j.removeClass("ui-state-disabled");g.removeClass("ui-state-disabled");}},rowOptFunc:function(f){if(this.p.selectRow){var c=$.ygrid.stripPref($.ygrid.uidPref,this.p.selectRow),e=this.p.data[c].rowID,b=this.getControlGrid(),h=this.getControlGrid().getRowIndexByID(e);if(f==="add"){var a=this.p.selectCell;this.getControlGrid().gridHandler.doInsertGridRow(b,e);$($("#"+$.ygrid.uidPref+c)[0].cells[a]).click();}else{if(f==="del"){var g=this.getControlGrid().dataModel.data[h],d=this.getControlGrid().dataModel.data[h+1];if(!(g.isDetail&&d!==undefined&&d.isDetail)){return;}this.getControlGrid().gridHandler.doDeleteGridRow(b,e);}else{if(f=="upRow"||f=="downRow"){this.getControlGrid().gridHandler.doShiftRow(b,h,f=="upRow");}}}}},extKeyDownEvent:function(a){var e=this.p.selectRow,k=this.p.selectCell,h=a.charCode||a.keyCode||0,j=this.rows[e];if(e===undefined||e==null||k===undefined||k==null||j==undefined){return;}var d=$.ygrid.stripPref($.ygrid.uidPref,j.id),b=this.p.data[d],g=j.cells[k],c=this.getCellEditOpt(b,k);if(c.edittype=="textEditor"||c.edittype=="numberEditor"||c.edittype=="textButton"||c.edittype=="dict"||c.edittype=="datePicker"){var f;if(h>=48&&h<=57){f=String.fromCharCode(h);}else{if(h>=96&&h<=105){f=String.fromCharCode(h-48);}else{if(h>=65&&h<=90){if(c.edittype=="numberEditor"||c.edittype=="datePicker"){return;}f=String.fromCharCode(h).toLowerCase();if(a.shiftKey||document.isCapeLook){f=f.toUpperCase();}}else{if(h==107||h==109||h==187||h==189){f=String.fromCharCode(0);}}}}if(f==undefined){return;}g.inKeyEvent=true;g.click();if($(g).find("input")[0]!==undefined&&$(g).find("input")[0]!==document.activeElement){window.setTimeout(function(){$(g).find("input").focus();if(c.edittype=="textEditor"){var o,p="",m=g.editor.yesCom;if(m.invalidChars&&m.invalidChars.length>0&&f&&f.length>0){for(var n=0,l=f.length;n<l;n++){o=f.charAt(n);if(m.invalidChars.indexOf(o)<0){p+=o;}}}else{p=f;}if(m.textCase){if(m.textCase==YIUI.TEXTEDITOR_CASE.UPPER){p=p.toUpperCase();}else{if(m.textCase=YIUI.TEXTEDITOR_CASE.LOWER){p=p.toLowerCase();}}}f=p;}$(g).find("input").val(f);},0);}}},onSortClick:function(a,b){if(!this.getControlGrid().hasGroupRow){a=this.p.rowSequences?a-1:a;this.getControlGrid().gridHandler.doOnSortClick(this.getControlGrid(),a,b);}else{alert($.ygrid.error.isSortError);}},onSelectRow:function(h,d){var c=this.getControlGrid(),a=-1;if(this.p.selectRow!==undefined){var g=c.el.getGridRowById(this.p.selectRow);if(g){a=g.rowIndex;}if(!a){a=-1;}}if(c.hasRowClick){var e=this.p.data[h-1].rowID;c.gridHandler.doOnRowClick(c,e);}if(c.hasRowChange&&h!=a&&h>=0){c.el[0].p.selectRow=d;var f=this.p.data[h-1].rowID,b=(a===-1?-1:this.p.data[a-1].rowID);c.gridHandler.doGridCellSelect(c,f,this.p.selectCell?this.p.selectCell:-1);c.gridHandler.doOnFocusRowChange(c,b,f);}},getFocusRowIndex:function(){if(this.el[0].p.selectRow==undefined||this.el[0].p.selectRow==null){return -1;}var a=this.el.getGridRowById(this.el[0].p.selectRow);return parseInt($.ygrid.stripPref($.ygrid.uidPref,a.id));},getFocusColIndex:function(){var a=this.el[0].p.selectCell;if(a){a=this.el[0].p.rowSequences?a-1:a;}else{a=-1;}return a;},ondblClickRow:function(c){var a=this.getControlGrid();if(a.hasRowDblClick){var b=this.p.data[c-1].rowID;a.gridHandler.doOnRowDblClick(a,b);}},afterPaste:function(e){var a=this.p.selectRow,d=this.p.selectCell,c=this.getControlGrid();if(a==undefined||a==null){return;}var b=$.ygrid.stripPref($.ygrid.uidPref,a);if(a!==undefined&&d!==undefined&&e!==undefined&&e.length>0){c.gridHandler.doCellPast(c,this.p.data[b].rowID,this.p.rowSequences?d-1:d,e);}},getControlGrid:function(){return this;},treeIconClick:function(m,j){var f=m.childRows,h,k,a,b=this.getControlGrid();if(b.treeExpand){return;}var l=function(v,p,o){var q,s=0,t,u,n;if(v.isExpand){for(var q=0,r=v.childRows.length;q<r;q++){t=v.childRows[q];u=p[t];n=o[u];s+=l(n,p,o);s++;}v.isExpand=false;}return s;};if(!m.isExpand){var g=f.length;for(i=g-1;i>=0;i--){h=f[i];k=b.rowIDMap[h];a=b.treeOldData[k];a.treeLevel=m.treeLevel+1;if(b.treeColIndex!=null&&b.treeColIndex>=0){a.data[b.treeColIndex][2]=false;}if(j>=b.dataModel.data.length){b.dataModel.data.push(a);}else{b.dataModel.data.splice(j,0,a);}}b.dataModel.data[j-1].isExpand=true;}else{var e=l(m,b.rowIDMap,b.treeOldData);b.dataModel.data.splice(j,e);b.dataModel.data[j-1].isExpand=false;}var c=this.grid.bDiv.scrollTop,d=this.grid.bDiv.scrollLeft;b.refreshGrid();this.grid.bDiv.scrollTop=c;this.grid.bDiv.scrollLeft=d;},initOptions:function(){this.options={populate:false,treeType:this.treeType,hasRowExpand:this.hasRowExpand,rowSequences:this.showRowHead,enable:this.getMetaObj().editable,colModel:this.dataModel.colModel.columns,cellLookup:this.dataModel.colModel.cells,data:this.dataModel.data,navButtons:{add:this.canInsert,addIcon:"ui-icon-plus",addFunc:this.rowOptFunc,del:this.canDelete,delIcon:"ui-icon-trash",delFunc:this.rowOptFunc,upRow:this.canShift,upRowIcon:"ui-icon-up",upRowFunc:this.rowOptFunc,downRow:this.canShift,downRowIcon:"ui-icon-down",downRowFunc:this.rowOptFunc},createCellEditor:this.createCellEditor,endCellEditor:this.endCellEditor,alwaysShowCellEditor:this.alwaysShowCellEditor,afterEndCellEditor:this.afterEndCellEditor,extKeyDownEvent:this.extKeyDownEvent,onSortClick:this.onSortClick,onSelectRow:this.onSelectRow,ondblClickRow:this.ondblClickRow,afterPaste:this.afterPaste,getControlGrid:this.getControlGrid,treeIconClick:this.treeIconClick};var e=this.dataModel.colModel.columns.length,c;this.options.selectFieldIndex=this.selectFieldIndex;if(this.pageInfo.isUsePaging){this.options.showPageSet=true;this.options.scrollPage=false;this.options.rowNum=this.dataModel.data.length;}else{this.options.scrollPage=true;this.options.rowNum=100;}if(this.treeColIndex!==undefined&&this.treeColIndex!==-1){this.options.treeColName=this.dataModel.colModel.columns[this.treeColIndex].name;}if(this.treeType!==undefined&&this.treeType!==-1){this.treeOldData=this.dataModel.data;this.dataModel.data=new Array();var b,d,a;if(this.treeExpand){for(b=0,a=this.treeOldData.length;b<a;b++){d=this.treeOldData[b];if(d.childRows.length>0){d.isExpand=true;}this.dataModel.data.push(d);}}else{for(b=0,a=this.treeOldData.length;b<a;b++){d=this.treeOldData[b];if(d.parentRow===undefined){this.dataModel.data.push(d);}}}this.options.data=this.dataModel.data;}},initGroupHeaders:function(){this.el.initGroupHeaders(this.groupHeaders);},initGridErrors:function(){var d=this;if(!((d.errorInfoes.cells==undefined||d.errorInfoes.cells.length==0)&&(d.errorInfoes.rows==undefined||d.errorInfoes.rows.length==0))){for(var h=0,a=d.dataModel.data.length;h<a;h++){var g=d.dataModel.data[h].rowID;if(d.errorInfoes.cells!==undefined){for(var c=0,f=d.errorInfoes.cells.length;c<f;c++){if(d.errorInfoes.cells[c].rowID==g){d.errorInfoes.cells[c].rowIndex=h;}}}if(d.errorInfoes.rows!==undefined){for(var b=0,e=d.errorInfoes.rows.length;b<e;b++){if(d.errorInfoes.rows[b].rowID==g){d.errorInfoes.rows[b].rowIndex=h;}}}}}d.setGridErrorCells(d.errorInfoes.cells);d.setGridErrorRows(d.errorInfoes.rows);},setGridErrorCells:function(a){this.el.setErrorCells(a);},setGridErrorRows:function(a){this.el.setErrorRows(a);},onRender:function(b){var a=this;this.base(b);this.initOptions();this.el[0].getControlGrid=function(){return a;};this.el.yGrid(this.options);this.initPageOpts();this.initGroupHeaders();this.initGridErrors();this.options=null;if(this.selectFieldIndex>=0){this.checkHeadSelect(this.selectFieldIndex);}},beforeDestroy:function(){this.dataModel=null;this.groupHeaders=null;this.errorInfoes=null;this.el.GridDestroy();}});YIUI.Control.Grid=YIUI.extend(YIUI.Control.Grid,{rowIDMask:0,randID:function(){return this.rowIDMask++;},setGridEnable:function(f){this.colInfoMap={};this.setEnable(f);this.el.setGridParam({enable:f});this.el.reShowCheckColumn();if(f&&!this.hasAutoRow()&&this.treeType===-1&&!this.hasRowExpand&&this.metaRowInfo.dtlRowIndex!=-1){if(!this.getMetaObj().isSubDetail&&this.newEmptyRow){if(this.hasGroupRow){this.appendAutoRowAndGroup();}else{this.addGridRow();}}if(this.hideGroup4Editing&&f){var g=this.dataModel.data.length,h;for(var c=g-1;c>=0;c--){h=this.dataModel.data[c];if(h.rowType=="Group"||(h.isDetail&&h.bookmark==undefined)){this.dataModel.data.splice(c,1);}}if(this.newEmptyRow){var b=this.metaRowInfo.dtlRowIndex,a=-1;for(var d=this.dataModel.data.length-1;d>=0;d--){h=this.dataModel.data[d];if(h.rowType=="Group"||h.rowType=="Detail"){a=d+1;break;}else{if(h.metaRowIndex<b){a=d+1;break;}}}if(a==-1&&this.dataModel.data.length>0){a=0;}this.addGridRow(null,a,false);}this.refreshGrid();}}else{if(!f&&this.treeType===-1){this.removeAutoRowAndGroup();}}this.el[0].updatePager();this.initPageOpts();var e=this.el[0].grid.bDiv.scrollTop;this.el[0].grid.bDiv.scrollTop=e+1;YIUI.SubDetailUtil.clearSubDetailData(YIUI.FormStack.getForm(this.ofFormID),this);},setColumnVisible:function(j,c){var n,l,g,h,a,k,e=false,f=false,b;c=YIUI.TypeConvertor.toBoolean(c);for(n=0,l=this.dataModel.colModel.columns.length;n<l;n++){g=this.dataModel.colModel.columns[n];b=g.key;if(g.isExpandCol&&g.refColumn){b=g.refColumn;}if(b===j){k=(c==null?false:!c);e=(g.hidden!==k);g.hidden=k;if(this.el){a=this.showRowHead?n+1:n;h=this.el[0].p.colModel[a];h.hidden=g.hidden;}f=true;if(!this.hasColExpand){break;}}else{if(this.hasColExpand&&f){break;}}}if(e){var m=this.el[0].grid.bDiv.scrollTop,d=this.el[0].grid.bDiv.scrollLeft;this.el[0].p.colModel.isChange=true;this.refreshGrid();this.el[0].grid.bDiv.scrollTop=m;this.el[0].grid.bDiv.scrollLeft=d;}},setValueByKey:function(h,b,f,e,d){var g=this.getColInfoByKey(b);for(var c=0,a=g.length;c<a;c++){this.setValueAt(h,g[c].colIndex,f,e,d,true);}},setValueAt:function(k,m,c,g,l,o){if(k==undefined||k<0||k>this.dataModel.data.length){return;}var n=this.dataModel.data[k],a=n.cellKeys[m],h;h=n.data[m][2];n.data[m]=this.getCellNeedValue(k,m,c,o);this.afterTextEditing=false;n.data[m][2]=h;this.el[0].p.data[k].data[m]=n.data[m];this.dataModel.data[k].data[m]=n.data[m];this.el[0].modifyGridCell(k,this.showRowHead?m+1:m,n);if(g){var b=YIUI.FormStack.getForm(this.ofFormID);this.gridHandler.setCellValueToDocument(b,this,k,m,n.data[m][0]);if(l){this.gridHandler.fireCellChangeEvent(b,this,k,m);}this.gridHandler.doPostCellChangeEvent(b,this,k,m);if(!n.isDetail){return;}var d=b.subDetailInfo[this.getMetaObj().key].cells[a],f;if(d!=null&&d.length>0){for(var e=0,j=d.length;e<j;e++){f=d[e];f=b.getComponent(f);if(f&&parseInt($.ygrid.stripPref($.ygrid.uidPref,this.el[0].p.selectRow),10)==k){f.setValue(n.data[m][0],true,false);}}}}this.checkCellRequired(k,m);},checkCellRequired:function(f,b){var c=this.getRowDataAt(f),e=c.cellKeys[b],d=this.dataModel.colModel.cells[e],a=this.getCellDataAt(f,b);if(!d.isRequired){return;}if(a[1]==null||a[1]==""){this.setCellRequired(f,b,true);}else{this.setCellRequired(f,b,false);}},getValueByKey:function(c,b){var a=this.getColInfoByKey(b)[0].colIndex;return this.getValueAt(c,a);},getValueAt:function(b,a){if(b==undefined){b=this.getFocusRowIndex();}if(this.dataModel.data[b]==undefined||this.dataModel.data[b].data==undefined){return null;}return this.dataModel.data[b].data[a][0];},addGridRow:function(l,m,u,e){var v=this.dataModel.data,h=v.length,r,b=YIUI.FormStack.getForm(this.ofFormID),k=false,p=this.metaRowInfo.dtlRowIndex,d=this.metaRowInfo.rows[p];e=(e==null?true:e);if(!l){l={};l.isDetail=true;l.isEditable=true;l.rowHeight=d.rowHeight;l.rowID=this.randID();l.metaRowIndex=p;l.rowType="Detail";l.cellKeys=d.cellKeys;l.data=[];l.cellBkmks=[];l.rowGroupLevel=d.rowGroupLevel;k=true;}m=parseInt(m,10);if(isNaN(m)||m<0||(m>=h&&!u)){m=-1;}if(m==-1){var q,f;for(var o=h-1;o>=0;o--){q=v[o];if(q.isDetail){f=o;break;}}if(h==0){l.insertRowID=-1;m=0;v.push(l);}else{if(f==undefined){l.insertRowID=(v[p-1]==undefined?-1:v[p-1].rowID);m=p;}else{l.insertRowID=v[f].rowID;m=f+1;}v.splice(m,0,l);}}else{if(m==0){l.insertRowID=-1;}else{l.insertRowID=v[m-1].rowID;}v.splice(m,0,l);}if(k){for(var s=0,t=this.dataModel.colModel.columns.length;s<t;s++){var j=this.dataModel.colModel.columns[s],n=v[m].cellKeys[s],c=this.dataModel.colModel.cells[n];if(j.name=="rowID"){continue;}if(c!==undefined&&c.tableKey==undefined&&c.columnKey==undefined&&(c.edittype=="label"||c.edittype=="button"||c.edittype=="hyperLink")){r=d.cells[s].caption;}r=this.getCellNeedValue(m,s,r,true);r.push(true);l.data[s]=r;r=null;}}var a=this.el[0];if(a.p.selectRow){var g=$(a).yGrid("getGridRowById",a.p.selectRow);g&&$(g.cells[a.p.selectCell]).removeClass("ui-state-highlight");}a.insertGridRow(m,l);a.p.selectRow=null;a.p.selectCell=null;a.grid.clearSelectCells();this.refreshErrors(m,false);if(e){b.getUIProcess().calcEmptyRow(this,m);b.getUIProcess().doPostInsertRow(this,m);}return l;},refreshErrors:function(g,d){var c=this,e,f;for(var b=c.errorInfoes.cells.length-1;b>=0;b--){e=c.errorInfoes.cells[b];if(e.rowIndex>=g){if(d&&e.rowIndex==g){c.errorInfoes.cells.splice(b,1);}else{e.rowIndex=(d?e.rowIndex-1:e.rowIndex+1);}}}for(var a=c.errorInfoes.rows.length-1;a>=0;a--){f=c.errorInfoes.rows[a];if(f.rowIndex>=g){if(d&&f.rowIndex==g){c.errorInfoes.rows.splice(a,1);}else{f.rowIndex=(d?f.rowIndex-1:f.rowIndex+1);}}}c.el.setErrorCells(c.errorInfoes.cells);c.el.setErrorRows(c.errorInfoes.rows);},appendAutoRowAndGroup:function(){var a=this.el,m=this,b=false,l=false,e=this.dataModel.data;for(var f=0;f<e.length;f++){var n=e[f],j;if(b&&!l&&!n.isDetail){j=this.addGridRow(null,f,false);f++;}b=n.isDetail;l=(n.bookmark===undefined);}if(b&&!l){this.addGridRow(null,f,false);}var k=function(q,r){var o=q.metaRowInfo.dtlRowIndex;for(var p=r.length-1,s;p>=0;p--){s=r[p];if(s.rowType=="Group"||s.rowType=="Detail"){return p+1;}else{if(s.metaRowIndex<o){return p+1;}}}if(r.length>0){return 0;}return -1;};var c=function(t){for(var q=0,v=t.length;q<v;q++){var x=t[q];if(x.length>0){c(x);}else{var w={},D;if(x.rowType==="Group"){w.cellKeys=x.cellKeys;w.rowType=x.rowType;w.isDetail=false;w.isEditable=false;w.rowHeight=x.rowHeight;w.rowID=m.randID();w.data=[];w.cellBkmks=[];for(var C=0,y=x.cells.length;C<y;C++){var u=x.cells[C];w.data[C]=["",u.caption,false];}var z,s=-1,B,p,o;for(var r=0,A=m.metaRowInfo.rows.length;r<A;r++){z=m.metaRowInfo.rows[r];if(z.key==x.key){s=r;B=z.rowGroupLevel;p=z.isGroupHead;o=z.isGroupTail;break;}}w.metaRowIndex=s;w.rowGroupLevel=B;w.isGroupHead=p;w.isGroupTail=o;D=k(m,e);if(D==-1){e.push(w);a[0].insertGridRow(e.length-1,w);}else{e.splice(D,0,w);a[0].insertGridRow(D,w);}}else{if(x.rowType==="Detail"){w=m.addGridRow(null,k(m,e),true);}}w.inAutoGroup=true;}}};for(var d=0,h=this.metaRowInfo.rowGroupInfo.length;d<h;d++){var g=this.metaRowInfo.rowGroupInfo[d];if(g.length>0){c(g);}}},removeAutoRowAndGroup:function(){var b=this.el,c=this.dataModel.data,d;for(var a=c.length-1;a>=0;a--){d=c[a];if(d.inAutoGroup||(d.isDetail&&d.bookmark===undefined)){c.splice(a,1);this.el[0].deleteGridRow(a);}}},deleteGridRow:function(g){g=parseInt(g,10);if(isNaN(g)||g<0||g>=this.dataModel.data.length){return;}var k=this.dataModel.data[g],f=this.dataModel.data[g].bookmark,j=this.dataModel.data[g+1],a=this.el[0].p.selectCell;if(!(k.isDetail&&j!==undefined&&j.isDetail)){return;}this.dataModel.data.splice(g,1);this.el[0].deleteGridRow(g);this.el[0].p.selectRow=null;this.el[0].p.selectCell=null;this.el[0].grid.clearSelectCells();this.refreshErrors(g,true);$($("#"+$.ygrid.uidPref+g,this.el)[0].cells[a]).click();var b=YIUI.FormStack.getForm(this.ofFormID),h=b.getDocument();YIUI.GridSumUtil.evalSum(b,this);if(f==undefined){return;}if(!h){return;}var c=h.getByKey(this.tableKey);if(!c){return;}if(f.length==undefined){c.setByBkmk(f);c.delRow(c.pos);}else{for(var d=0,e=f.length;d<e;d++){c.setByBkmk(f[d]);c.delRow(c.pos);}}this.gridHandler.dealWithSequence(b,this);},hasAutoRow:function(){for(var c=0,a=this.dataModel.data.length;c<a;c++){var e=this.dataModel.data[c],b=e.isDetail,d=parseInt(e.bookmark,10);if(isNaN(d)&&b){return true;}}return false;},setFocusRowIndex:function(b){var a=this.el.getGridRowAt(b+1);this.el[0].p.selectRow=a.id;},getRowIndexByID:function(c){for(var b=0,a=this.dataModel.data.length;b<a;b++){var d=this.dataModel.data[b];if(d.rowID===c){return b;}}return -1;},getRowDataByID:function(c){for(var b=0,a=this.dataModel.data.length;b<a;b++){var d=this.dataModel.data[b];if(d.rowID===c){return d;}}return null;},getRowDataAt:function(a){return this.dataModel.data[a];},getCellIndexByKey:function(a){return this.getColInfoByKey(a)[0].colIndex;},getCellDataByKey:function(c,b){var a=this.getColInfoByKey(b)[0].colIndex;return this.getCellDataAt(c,a);},getCellDataAt:function(b,a){if(b==undefined){b=this.getFocusRowIndex();}if(this.dataModel.data[b]==undefined){return null;}return this.dataModel.data[b].data[a];},setColumnEnable:function(b,a){this.dataModel.colModel.columns[b].editable=a;},getFixRowInfoByCellKey:function(d){var f=function(h,o,s,k){var l,m,q=false,t=[],n;for(var p=0,r=h.dataModel.colModel.columns.length;p<r;p++){l=o.cellKeys[p];if(l==k){n=h.dataModel.colModel.columns[p];m=h.dataModel.colModel.cells[k];if(h.hasColExpand){t.push({rowIndex:s,colIndex:p,col:n,cell:m,metaRowIndex:o.metaRowIndex});q=true;}else{return[{rowIndex:s,colIndex:p,col:n,cell:m,metaRowIndex:o.metaRowIndex}];}}else{if(h.hasColExpand&&q){return t;}}}return null;};var e,b;for(var c=0,g=this.dataModel.data.length;c<g;c++){e=this.dataModel.data[c];if(e.rowType=="Fix"||e.rowType=="Total"){b=f(this,e,c,d);if(b!==null){return b;}}else{if(e.rowType=="Detail"||e.rowType=="Group"){break;}}}for(var a=this.dataModel.data.length-1;a>=0;a--){e=this.dataModel.data[a];if(e.rowType=="Fix"||e.rowType=="Total"){b=f(this,e,a,d);if(b!==null){return b;}}else{if(e.rowType=="Detail"||e.rowType=="Group"){break;}}}return null;},getColumnAt:function(a){return this.dataModel.colModel.columns[a];},getColInfoByKey:function(h){var j=this.dataModel.colModel.cells[h],k,a,c=this.metaRowInfo.dtlRowIndex,g=this.metaRowInfo.rows[c];if(j==null||j==undefined){return null;}if(this.hasColExpand){var e=[],d;for(var b=0,f=g.cells.length;b<f;b++){d=g.cells[b];if(d.key==h){a=this.dataModel.colModel.columns[b];e.push({col:a,cell:j,colIndex:b,metaRow:g});}}return e;}else{k=j.colIndex;a=this.dataModel.colModel.columns[k];return[{col:a,cell:j,colIndex:k,metaRow:g}];}},colInfoMap:{},setCellEnable:function(m,a,g){var q=this.dataModel.data[m],c=this.el[0].p.data[m],n,l=this.colInfoMap[a];if(l==undefined){l=this.getColInfoByKey(a);if(l!==null){this.colInfoMap[a]=l;}}if(l==null){l=this.getFixRowInfoByCellKey(a);if(l!==null){this.colInfoMap[a]=l;}}if(l==null){return;}for(var f=0,j=l.length;f<j;f++){var p=l[f].colIndex,h,o,k=(this.showRowHead?1:0),e=l[f].cell;if(e==null||e.edittype=="label"){continue;}if(this.rowExpandIndex==p||this.treeColIndex==p){g=false;}q.data[p][2]=g;c.data[p][2]=g;h=this.el[0].p._indexMap[m];if(h==undefined||h==null){return;}n=this.el[0].rows[this.el[0].p._indexMap[m]];if(n===undefined||n==null){return;}o=n.cells[p+k];var d=YIUI.FormStack.getForm(this.ofFormID).getOperationState();var b=(d==YIUI.Form_OperationState.New||d==YIUI.Form_OperationState.Edit);if(b!==g){if(g){$(o).removeClass("ui-cell-disabled");}else{$(o).addClass("ui-cell-disabled");}}else{if(g){$(o).removeClass("ui-cell-disabled");}}if(e&&e.isAlwaysShow&&(q.isDetail||q.rowType=="Fix")){switch(e.formatter){case"button":case"hyperlink":case"image":$(".cellEditor",o)[0]&&($(".cellEditor",o)[0].enable=g);break;case"checkbox":$(".cellEditor",o)[0]&&($(".cellEditor",o)[0].enable=g);if(g){$("input",o).removeAttr("disabled");}else{$("input",o).attr("disabled","disabled");}break;}}}},getCellNeedValue:function(rowIndex,colIndex,value,isData){var options,edittype,opt={},self=this,row=this.dataModel.data[rowIndex],cellKey=row.cellKeys[colIndex],editOpt=this.dataModel.colModel.cells[cellKey],caption=value,form=YIUI.FormStack.getForm(this.ofFormID);if(value instanceof Decimal){caption=value.toString();}if(editOpt==undefined){return[value,caption];}options=editOpt.editOptions;if(editOpt.edittype=="dynamic"){var typeFormula=options.typeFormula;var typeDefKey=form.eval(typeFormula,{form:form,rowIndex:rowIndex,colIndex:colIndex});var cellTypeDef=DynamicCell.getCellTypeTable()[form.formKey][typeDefKey];if(cellTypeDef!=null){edittype=cellTypeDef.options.edittype;opt=$.extend(opt,cellTypeDef.options,{typeDefKey:typeDefKey});}}else{edittype=editOpt.edittype;}switch(edittype){case"numberEditor":opt=$.extend(true,opt,options);opt.newVal=value;opt.oldVal=null;var callBack=function(v,c){value=v;if(value&&value.isZero()&&editOpt.editOptions.zeroString!==undefined){caption=editOpt.editOptions.zeroString;}else{caption=c;}};YIUI.NumberEditorBehavior.checkAndSet(opt,callBack);if(value==null){value=new Decimal(0);}else{if(!(value instanceof Decimal)){value=new Decimal(value,10);}}if(value.isZero()&&editOpt.editOptions.zeroString!==undefined){caption=editOpt.editOptions.zeroString;}break;case"textButton":case"textEditor":if(!this.afterTextEditing){opt=$.extend(true,opt,options);value=caption=YIUI.TextFormat.format(value,opt);}break;case"comboBox":if(value==null||value.length==0||value===undefined){return[null,""];}opt=$.extend(true,opt,options);var combobox={key:editOpt.key,typeDefKey:opt.typeDefKey,sourceType:opt.sourceType,formula:opt.formula,globalItems:opt.globalItems,queryParas:opt.queryParas,needRebuild:(editOpt.needRebuild==null?true:editOpt.needRebuild),ofFormID:this.ofFormID,setItems:function(items){opt.items=items;},checkItem:$.noop,getValue:$.noop};YIUI.ComboBoxHandler.getComboboxItems(combobox,{form:form,rowIndex:rowIndex,colIndex:colIndex});var realValue="",realCaption="",length=(opt.items==undefined?0:opt.items.length);for(var i=0;i<length;i++){var item=opt.items[i];if(item.value==null){continue;}if(opt.type==="combobox"){if(isData?(item.value.toString()==value.toString()):(item.caption==value.toString())){realValue=item.value;realCaption=item.caption;break;}}else{var valueArray=value.split(",");if(isData?(valueArray.indexOf(item.value.toString())!==-1):(valueArray.indexOf(item.caption)!==-1)){realValue+=","+item.value;realCaption+=","+item.caption;}}}if(opt.type==="checklistbox"){realValue=realValue.substr(1);realCaption=realCaption.substr(1);}value=realValue;caption=realCaption;break;case"dict":if(value==null||value.length==0||value===undefined){return[null,""];}opt=$.extend(true,opt,options);if(opt.isDynamic){opt.itemKey=form.eval(opt.refKey,{form:form});}if(value instanceof YIUI.ItemData){if(opt.multiSelect){var tempValue="";for(var di=0,dlen=value.length;di<dlen;di++){tempValue+=","+value[di].oid;}if(tempValue.length>0){value=tempValue.substr(1);}caption="";}else{value=value.oid;}}var values,ret,rootValue={oid:0,itemKey:opt.itemKey},dictFilter=editOpt.dictFilter;if(dictFilter==null||editOpt.needRefreshFilter){dictFilter=YIUI.DictHandler.getDictFilter(form,cellKey,opt.itemFilters,opt.itemKey);editOpt.needRefreshFilter=false;editOpt.dictFilter=dictFilter;}if(form.dictCaption==null){form.dictCaption={};}if(isData){if(opt.multiSelect){values=value.split(",");value=[];for(var index=0,len=values.length;index<len;index++){var tempCaption=form.dictCaption[opt.itemKey+"_"+values[index]];if(tempCaption==null){if(parseFloat(values[index])!=0){ret=YIUI.DictService.locate(opt.itemKey,"OID",values[index],dictFilter,rootValue,opt.stateMask);if(ret!=null){tempCaption=ret.caption;form.dictCaption[opt.itemKey+"_"+values[index]]=tempCaption;}}}if(tempCaption!=null){caption+=tempCaption+",";}value.push({oid:parseFloat(values[index]),caption:tempCaption,itemKey:opt.itemKey});}if(caption.length>0){caption=caption.substring(0,caption.length-1);}}else{caption=form.dictCaption[opt.itemKey+"_"+value];if(caption==null&&parseFloat(value)!=0){ret=YIUI.DictService.locate(opt.itemKey,"OID",parseFloat(value),dictFilter,rootValue,opt.stateMask);if(ret!=null){caption=ret.caption;form.dictCaption[opt.itemKey+"_"+value]=caption;}}value={oid:parseFloat(value),caption:caption,itemKey:opt.itemKey};}}else{if(opt.multiSelect){var str=value.split(",");values=[];for(var si=0,sLen=str.length;si<sLen;si++){values.push(str[si].split(" ")[0]);}value=[];caption=[];for(var ci=0,clen=values.length;ci<clen;ci++){ret=YIUI.DictService.locate(opt.itemKey,"Code",values[ci],dictFilter,rootValue,opt.stateMask);if(ret){value.push({oid:ret.value.oid,caption:ret.caption,itemKey:opt.itemKey});caption.push(ret.caption);caption.push(",");}}caption.pop();caption=caption.join("");}else{values=value.split(" ")[0];ret=YIUI.DictService.locate(opt.itemKey,"Code",values,dictFilter,rootValue,opt.stateMask);if(ret){value={oid:ret.oid,caption:ret.caption,itemKey:opt.itemKey};caption=ret.caption;}else{value=null;caption="";}}}break;case"datePicker":if(value==null||value.length==0||value===undefined){return[null,""];}var date,formatStr,dateStr;if(isData){if($.isNumeric(value)){date=new Date(parseFloat(value));}else{if($.isString(value)){dateStr=value.split(" ");if(dateStr.length==1){value=value+" 00:00:00";}date=new Date(Date.parse(value.replace(/-/g,"/")));}else{if(value instanceof Date){date=value;}}}}else{dateStr=value.split(" ");if(dateStr.length==1){value=value+" 00:00:00";}date=new Date(Date.parse(value.replace(/-/g,"/")));}value=date.getTime();formatStr=options.formatStr;caption=self.gridHandler.formatDate(date,formatStr);break;case"utcDatePicker":if(value==null||value.length==0||value===undefined||parseFloat(value)==0){return[null,""];}if($.isNumeric(value)){caption=YIUI.UTCDateFormat.formatCaption(parseFloat(value),options.isOnlyDate,true);}else{if($.isString(value)){caption=value;value=YIUI.UTCDateFormat.format(value,options);}}break;case"checkBox":if(value==null||value.length==0||value===undefined){return[false,"false"];}if(value instanceof Decimal){value=value.toNumber();}break;default:if(value==null||value.length==0||value===undefined){return[null,""];}}return[value,caption];},reload:function(){var a=YIUI.FormStack.getForm(this.ofFormID);var b=YIUI.ShowGridData(a,this);b.load(this);a.getUIProcess().doPostShowData();},repaint:function(){this.repaintHeaders();this.el[0].p.colModel.isChange=true;this.refreshGrid();},repaintHeaders:function(){var h=this.el[0],g=$("tr.ui-ygrid-headers",h.grid.hDiv),d=$("tr.ygfirstrow",h.grid.bDiv);$(h.grid.headers).each(function(m,n){if(h.p.colModel[m].hidden){$(n.el).css("display","none");d.find("td").eq(m).css("display","none");}else{$(n.el).css("display","");d.find("td").eq(m).css("display","");}});for(var b=0,e=h.grid.headers.length;b<e;b++){var f=h.grid.headers[b].el,k=g[0].cells;$("div",f).attr("style","");if($.inArray(k,f)==-1){g.append(f);}else{f.after(h.grid.headers[b-1].el);}}$(h.grid.hDiv).find("tr.ui-ygrid-columnheader").remove();var c,a;for(var l=0,j=this.dataModel.colModel.columns.length;l<j;l++){c=this.dataModel.colModel.columns[l];a=g[0].childNodes[l+(this.showRowHead?1:0)];$(a).attr("title",c.label);$(".colCaption",a).html(c.label);}$(h).initGroupHeaders(h.p.groupHeaders);},clearGridData:function(){this.dataModel.data=[];this.el.clearGridData();},refreshGrid:function(a){if(a==undefined||a==null){a={};}this.el.clearGridData();a.data=this.dataModel.data;if(this.pageInfo.isUsePaging||this.el[0].p.rowNum==0){a.rowNum=this.dataModel.data.length;}this.el.setGridParam(a);this.isActivity()&&this.el.trigger("reloadGrid");this.initPageOpts(a.needCalc);this.initGridErrors();YIUI.SubDetailUtil.showSubDetailData(this,-1);},getPageInfo:function(){return this.pageInfo;},getRowCount:function(){return this.dataModel.data.length;},addGridRows:function(m,g,c){var a,p,q,o,d=YIUI.FormStack.getForm(this.ofFormID),e=d.getDocument().getByKey(this.tableKey);var l=function(r){for(var j=r.dataModel.data.length-1,s;j>=0;j--){s=r.dataModel.data[j];if(s.isDetail&&s.bookmark!==undefined){return j;}}return -1;};for(var k=0,n=m.length;k<n;k++){a=m[k];this.initOneRow(a);p=l(this);a.rowID=this.randID();this.addGridRow(a,p+1,false,c);q=a.bookmark;g.setByBkmk(q);e.addRow();for(var h=0,b=e.cols.length,f;h<b;h++){f=e.cols[h];e.set(h,g.get(g.indexByKey(f.key)));}a.bookmark=e.getBkmk();}},getFieldArray:function(a,f,c){var k=a.getDocument(),j=new Array(),b;b=k.getByKey(this.tableKey);for(var e=0,g=this.dataModel.data.length;e<g;e++){var m=this.dataModel.data[e],h=m.bookmark,l;if(m.isDetail&&h!==undefined){b.setByBkmk(h);var d=false;if(this.selectFieldIndex!=-1){d=this.getValueAt(e,this.selectFieldIndex);}if(d){l=b.getByKey(f);j.push(l);}}}if(this.selectFieldIndex!=-1&&$.isEmptyObject(j)){YIUI.ViewException.throwException(YIUI.ViewException.DATA_BINDING_ERROR);}return j;},isCellNull:function(d,a){var c=this.getColInfoByKey(a)[0],b=this.getValueAt(d,c.colIndex);switch(c.cell.edittype){case"numberEditor":return b==0||b.isZero();case"textEditor":return b.length==0;case"datePicker":case"utcDatePicker":case"dict":case"comboBox":return b==null||b==undefined;}return false;},showDetailRow:function(k,d){var a=YIUI.FormStack.getForm(this.ofFormID),m=a.getDocument().getByKey(this.tableKey),f=this.metaRowInfo.dtlRowIndex,l=this.metaRowInfo.rows[f],n=this.dataModel.data[k];if(m==undefined||n==undefined||n==null||!n.isDetail||n.bookmark==undefined){return;}var j=n.bookmark,c,g,b;for(var e=0,h=this.dataModel.colModel.columns.length;e<h;e++){g=l.cells[e];c=this.dataModel.colModel.cells[n.cellKeys[e]];if(c.hasDB){if(g.isColExpand){b=n.cellBkmks[e];if(b){m.setByBkmk(b);this.setValueAt(k,e,m.getByKey(c.columnKey),false,false,true);}}else{m.setByBkmk(j);this.setValueAt(k,e,m.getByKey(c.columnKey),false,false,true);}}else{if(c.edittype=="label"||c.edittype=="button"||c.edittype=="hyperLink"){this.setValueAt(k,e,g.caption,false,false,false);}else{if(g.isSelect){m.setByBkmk(j);this.setValueAt(k,e,m.getByKey(YIUI.DataUtil.System_SelectField_Key),false,false,false);}}}}if(d){a.getUIProcess().calcEmptyRow(this,k);}},setColumnCaption:function(c,b){var e;for(var d=0,a=this.dataModel.colModel.columns.length;d<a;d++){e=this.dataModel.colModel.columns[d];if(e.key==c){e.label=b;break;}}this.repaintHeaders();},getColumnCount:function(){return this.dataModel.colModel.columns.length;},getMetaCellInDetail:function(a){var c=this.metaRowInfo.dtlRowIndex,b=this.metaRowInfo.rows[c];return b.cells[a];},setForeColor:function(a){this.el[0].p.foreColor=a;$(".ygrid-rownum,th",$("#gbox_"+this.id)).css({"color":a});},setBackColor:function(a){this.el[0].p.backColor=a;$(".ygrid-rownum,th",$("#gbox_"+this.id)).css({"background-image":"none","background-color":a});},initFirstFocus:function(){this.setCellFocus(0,0);},setCellFocus:function(b,a){this.el.setCellFocus(b+1,this.showRowHead?a+1:a);},requestNextFocus:function(){this.focusManager.requestNextFocus(this);},isActivity:function(){var b=this.el.parents(),d;for(var c=0,a=b.length;c<a;c++){d=b[c];if(d.style.display=="none"){return false;}}return true;},getLastDetailRowIndex:function(){for(var a=this.getRowCount()-1;a>=0;a--){var b=this.getRowDataAt(a);if(b.isDetail&&b.bookmark==null){return a;}}return -1;},setCellRequired:function(d,b,c){this.el.setCellRequired(d+1,this.showRowHead?b+1:b,c);var a=this.getCellDataAt(d,b);a[3]=c;},hasSubDetailData:function(f){var b=this.getRowDataAt(f);if(b==null){return false;}var e=b.bookmark,a=YIUI.FormStack.getForm(this.ofFormID),h=a.getDocument(),j=h.getByParentKey(this.tableKey),g;for(var c=0,d=j.length;c<d;c++){g=j[c];g.beforeFirst();while(g.next()){if(g.getParentBkmk()==e){return true;}}}return false;},clearAllSubDetailData:function(f){var d=this.getRowDataAt(f);if(d==null){return false;}var a=function(l,m){var h=e.getByParentKey(l),k;for(var j=0,g=h.length;j<g;j++){k=h[j];k.afterLast();while(k.previous()){if(k.getParentBkmk()==m){a(k.key,k.getBkmk());k.delRow();}}}};var b=d.bookmark,c=YIUI.FormStack.getForm(this.ofFormID),e=c.getDocument();a(this.tableKey,b);return true;},modifyCellErrors:function(h,d,e,f){var c,b,g,a=this.errorInfoes.cells.length;for(b=0;b<a;b++){g=this.errorInfoes.cells[b];if(g.rowIndex==h&&g.colIndex==d){c=b;break;}}if(e&&c!==undefined){this.errorInfoes.cells.splice(c,1);}else{if(!e&&c===undefined){this.errorInfoes.cells.push({rowIndex:h,colIndex:d,errorMsg:f});}}this.setGridErrorCells(this.errorInfoes.cells);},checkHeadSelect:function(d){var h=$(this.el[0].grid.hDiv).find(".ui-ygrid-htable"),c=true,f=0;for(var e=0,a=this.getRowCount();e<a;e++){var g=this.getRowDataAt(e),b=this.getCellDataAt(e,d);if(g.isDetail&&g.bookmark!=null){f++;if(b[0]==0||b[0]==null){c=false;break;}}}if(f==0){c=false;}$("input",h)[0].checked=c;},reShowCheckColumn:function(){this.el.reShowCheckColumn();},getHandler:function(){return this.gridHandler;},getMetaCellByKey:function(g){var c,e;for(var d=0,a=this.metaRowInfo.rows.length;d<a;d++){c=this.metaRowInfo.rows[d];for(var b=0,f=c.cells.length;b<f;b++){e=c.cells[b];if(e.key==g){return e;}}}return null;},dependedValueChange:function(b,c,a){this.gridHandler.dependedValueChange(this,b,c,a);},doPostCellValueChanged:function(d,c,b,a){this.gridHandler.doPostCellValueChanged(this,d,c,b,a);}});YIUI.reg("grid",YIUI.Control.Grid);YIUI.CellEditor=YIUI.extend({yesCom:null,value:null,setValue:function(a){this.value=a;},getValue:function(){return this.value;},render:function(a){a.append(this.yesCom.getEl());this.onRender(a);this.install();},getText:function(){return this.text;},setText:function(a){this.text=a;},getEl:function(){return this.yesCom.getEl();},onRender:$.noop,beforeDestroy:$.noop,install:$.noop});YIUI.CellEditor.CellTextEditor=YIUI.extend(YIUI.CellEditor,{behavior:YIUI.TextEditorBehavior,init:function(b){var a=this;b.valueChange=function(c){a.setValueWithEvent(c,true,true);};this.yesCom=new YIUI.Yes_TextEditor(b);this.yesCom.el.addClass("ui-txted");},onRender:function(a){this.base(a);this.yesCom.setEmbedText(this.yesCom.embedText);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());this.yesCom.setClearable(false);},getInput:function(){return this.yesCom.getInput();},setValueWithEvent:function(c,d,b){var a={oldVal:this.value,newVal:c,trim:this.yesCom.trim,textCase:this.yesCom.textCase,maxLength:this.yesCom.maxLength,invalidChars:this.yesCom.invalidChars};var f=this.yesCom;var e=function(g){f.value=g;f.caption=g;$("input",f.el).val(g);};return this.behavior.checkAndSet(a,e);},setValue:function(a){this.setValueWithEvent(a,true,true);this.base(this.yesCom.value);},getValue:function(){return this.yesCom.value;},getText:function(){return this.yesCom.value;},finishInput:function(){return this.yesCom.finishInput();},install:function(){this.base();var a=this;this.getInput().blur(function(b){a.yesCom.saveCell();});}});YIUI.CellEditor.CellNumberEditor=YIUI.extend(YIUI.CellEditor,{init:function(c){var a="";for(var b=0;b<c.decPrecision-c.decScale;b++){a+="9";}if(c.decScale>0){a+=".";for(var b=0;b<c.decScale;b++){a+="9";}}this.settings={aNum:"0123456789",aSep:c.useSep?c.sep:"",dGroup:c.groupingSize,aDec:c.decSep,aSign:"",pSign:"s",vMax:a,vMin:"-"+a,mDec:c.decScale,mPre:c.decPrecision,mRound:c.roundingMode,altDec:null};c.settings=this.settings;this.yesCom=new YIUI.Yes_NumberEditor(c);this.yesCom.el.addClass("ui-numed");},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());this.yesCom.getInput().css({width:"100%",height:"100%",padding:"0 2px 0 2px",margin:0});},getInput:function(){return this.yesCom.getInput();},setValue:function(a){this.base(a);this.yesCom.setValue(a);},getValue:function(){return this.yesCom.getValue();},getText:function(){return this.yesCom.getInput().val();},finishInput:function(){return this.yesCom.finishInput();},install:function(){this.base();var a=this;this.getInput().blur(function(b){a.yesCom.saveCell();});}});YIUI.CellEditor.CellDatePicker=YIUI.extend(YIUI.CellEditor,{init:function(a){this.yesCom=new YIUI.Yes_DatePicker(a);this.yesCom.el.addClass("ui-dp");a.formatStr&&this.yesCom.setFormatStr(a.formatStr);a.isNoTimeZone&&this.yesCom.setIsNoTimeZone(a.isNoTimeZone);a.isOnlyDate&&this.yesCom.setOnlyDate(a.isOnlyDate);a.regional&&this.yesCom.setRegional(a.regional);a.calendars&&this.yesCom.setCalendars(a.calendars);},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());},setValue:function(a){this.base(a);this.yesCom.setValue(a);},getValue:function(){return this.yesCom.getValue();},getDropBtn:function(){return this.yesCom.getBtn();},getDropView:function(){return this.yesCom.getDropView();},getInput:function(){return this.yesCom.getInput();},finishInput:function(){},beforeDestroy:function(){this.yesCom.getDropView().remove();},getText:function(){return this.yesCom.getInput().val();},install:function(){}});YIUI.CellEditor.CellComboBox=YIUI.extend(YIUI.CellEditor,{init:function(a){a=$.extend(true,a,{multiSelect:a.type!=="combobox",getItems:function(){YIUI.ComboBoxHandler.getComboboxItems(this,a.cxt);},getValue:function(){return this.getSelValue();}});this.yesCom=new YIUI.Yes_Combobox(a);this.yesCom.setEditable(a.editable);this.yesCom.getEl().addClass("ui-cmb");a.items&&this.yesCom.setItems(a.items);},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());},setValue:function(a){this.base(a);this.yesCom.setSelValue(a);},getValue:function(){var a=this.yesCom.getSelValue();return a;},getText:function(){return this.yesCom.getText();},setText:function(a){this.yesCom.setText(a);},getInput:function(){return this.yesCom._textBtn;},getDropBtn:function(){return this.yesCom._dropBtn;},beforeDestroy:function(){this.yesCom._dropView.remove();}});YIUI.CellEditor.CellDict=YIUI.extend(YIUI.CellEditor,{cellDictHandler:YIUI.DictHandler,init:function(b){var a=this;var c=YIUI.FormStack.getForm(b.ofFormID);a.cellDictHandler.setContext({form:c,rowIndex:b.rowIndex,colIndex:b.colIndex});b=$.extend(true,b,{getDictChildren:function(d){var f=this;var e=function(h){if(h){var g=d.attr("id");var j=f.dictTree.formatAsyncData(h);f.dictTree.buildTreenode(j,g,parseInt(d.attr("level"))+1);d.attr("isLoaded",true);}};YIUI.DictService.getDictChildren(f.itemKey,f.dictTree.getNodeValue(d),f.dictTree.dictFilter,f.stateMask,e);},getItemKey:function(){return this.itemKey;},setValue:function(d){var e=false;if(this.value){e=!this.value.equals(d);}else{if(d){e=true;}}this.value=d;if(this._resetTree&&this.multiSelect){this.dictTree.reset();this.setDictTreeCheckedNodes();}if(a.yesCom.isShowQuery&&b.saveCell!=null){b.saveCell();}return e;},checkDict:function(){a.cellDictHandler.checkDict(this);},doLostFocus:function(d){a.cellDictHandler.autoComplete(this,d);if(a.yesCom.isShowQuery){b.stopClickCell();}},beforeExpand:function(d,e){var f=function(g){if(g){$.each(g,function(h){var j=this.itemKey+"_"+this.oid;d.indeterminatedNodes[j]=this;});}};YIUI.DictService.getAllParentID(a.yesCom.itemKey,a.yesCom.getSelValue(),f);}});this.yesCom=new YIUI.Yes_Dict(b);this.yesCom.getEl().addClass("ui-dict");b.items&&this.yesCom.setItems(b.items);},onRender:function(a){this.base(a);this.yesCom.setWidth(a.width());this.yesCom.setHeight(a.height());},getDropBtn:function(){return this.yesCom._dropBtn;},getValue:function(){return this.yesCom.getSelValue();},setValue:function(a){this.yesCom.setSelValue(a);},getInput:function(){return this.yesCom._textBtn;},setText:function(a){this.yesCom.text=a;this.yesCom.setText(a);},getText:function(){return this.yesCom.getText();},beforeDestroy:function(){this.yesCom._dropView.remove();}});YIUI.CellEditor.CellImage=YIUI.extend(YIUI.CellEditor,{init:function(b){var c="",a=this;this.yesCom=$("<div class='ui-img cellEditor' style='width: 100%;height: 100%'></div>");this.yesCom.getEl=function(){return a.yesCom;};this.options=b;if(this.options.maxSize==-1){this.options.maxSize=1024;}this.yesCom[0].enable=b.enable;if(b.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){if(b.value!==null){c=b.value;}}else{c=b.image;}this.image=$("<img class='img' style='width: 100%;height: 100%'>").appendTo(this.yesCom);this.setValue(c);this.yesCom[0].enable=b.enable;this.pathV=c;},onRender:function(a){this.base(a);},getEl:function(){return this.yesCom;},setEnable:function(a){this.yesCom[0].enable=a;},setValue:function(c){var a=this;this.base(c);if(c===undefined||c===null||c.length==0){this.image.attr("src",YIUI.Image.EmptyImg);}else{if(this.options.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){var b=Svr.SvrMgr.AttachURL+"?path="+BASE64.encoder(this.value)+"&service=DownloadImage&mode=1&r="+Math.random();this.image.attr("src",b);}else{this.image.attr("src","Resource/"+c);}}if(c!==undefined&&c!==null&&c.length!==0){window.setTimeout(function(){if(a.options.stretch!=="true"&&a.options.stretch!==true){var d=a.yesCom.width(),f=a.yesCom.height(),e=a.image.clientWidth,g=a.image.clientHeight;if((e/d)>(g/f)){a.image.css({width:d+"px",height:""});}else{a.image.css({width:"",height:f+"px"});}}else{a.image.css({width:"100%",height:"100%"});}},0);}this.pathV=c;},install:function(){var b=this;this.yesCom.delegate($(b.image),"click",function(d){if(b.pathV.length>0&&d.delegateTarget.enable){b.options.click();}});var a=function(g,d){var e=YIUI.FormStack.getForm(b.options.ofFormID);var h=new Array("gif","jpg","jpeg","png","bmp");var f=function(k){var j=$.checkFile(k,b.options.maxSize,h);if(!j||e.OID==null||e.OID==-1){return;}d=$.extend({service:"UploadImage",controlKey:b.options.gridKey,rowIndex:b.options.rowIndex,colIndex:b.options.colIndex,formKey:e.formKey,operatorID:$.cookie("userID"),fileID:-1,oid:e.OID,mode:1},d);$.ajaxFileUpload({url:Svr.SvrMgr.AttachURL,secureuri:false,fileElement:k,data:d,type:"post",success:function(m,l,n){n.attr("accept","image/*");m=JSON.parse(m);b.setValue(m.data.replace(/\\/g,"/"));b.options.change(b.getValue());b.yesCom.delegate($(b.image),"click",function(o){o.delegateTarget.enable&&b.options.click();});},error:function(m,l,n){alert(n);}});};f(g);};var c=function(e){if(e==undefined||e==null){return;}var d={service:"DeleteImage",filePath:e,operatorID:$.cookie("userID"),mode:1};$.ajax({url:Svr.SvrMgr.AttachURL,data:d,type:"post",error:function(g,f,h){alert(h);}});};this.yesCom.delegate(".upbtn","change",function(g){var e=g.target.files[0],f=e.type.split("/")[1];if(b.options.imageCut){var d={type:f,callback:function(h){a($(g.target),h);}};$(".upbtn",b.el).photoCut(d);}else{a($(g.target),{imgType:f});}$(".opt,.bar",b.yesCom).remove();g.stopPropagation();});this.yesCom.mouseover(function(){if($(".opt",b.yesCom).length==0){var h=(b.options.sourceType==YIUI.IMAGE_SOURCETYPE.DATA&&b.yesCom[0].enable)?"block":"none",j=$("<div class='bar'></div>").appendTo(b.yesCom),f=$("<div class='opt upload' title='"+$.ygrid.cell_imgOpt.open+"'></div>").appendTo(b.yesCom),e=$("<div class='opt show' title='"+$.ygrid.cell_imgOpt.show+"'></div>").appendTo(b.yesCom),d=$("<div class='opt clear' title='"+$.ygrid.cell_imgOpt.clear+"'></div>").appendTo(b.yesCom),g=$("<input type='file' name='file' data-url='upload' class='opt upbtn' accept='image/*' title='"+$.ygrid.cell_imgOpt.open+"'>").appendTo(b.yesCom);j.css({top:(b.yesCom.height()-25)+"px"});f.css({left:(b.yesCom.width()-22)+"px",top:(b.yesCom.height()-22)+"px",display:h});g.css({left:(b.yesCom.width()-22)+"px",top:(b.yesCom.height()-22)+"px",opacity:0,display:h});e.css({left:(b.yesCom.width()-((h=="none")?22:46))+"px",top:(b.yesCom.height()-22)+"px"});d.css({left:(b.yesCom.width()-68)+"px",top:(b.yesCom.height()-22)+"px",display:h});$(".opt",b.yesCom).mouseover(function(l){var k=$(l.target);if(k.hasClass("upbtn")){f.addClass("sel");}else{k.addClass("sel");}}).mouseout(function(l){var k=$(l.target);if(k.hasClass("upbtn")){f.removeClass("sel");}else{k.removeClass("sel");}});d.click(function(k){if(b.getValue()!==""){b.setValue("");b.options.change("");}b.setValue("");k.stopPropagation();});g.click(function(k){k.stopPropagation();});e.click(function(m){var l;if(b.options.sourceType==YIUI.IMAGE_SOURCETYPE.DATA){if(b.getValue()==undefined||b.getValue()==null||b.getValue().length==0){return;}l=Svr.SvrMgr.AttachURL+"?path="+BASE64.encoder(b.value)+"&service=DownloadImage&mode=1&r="+Math.random();}else{l="Resource/"+b.options.image;}var n=$("<div class='ui-img-showDiv'></div>").appendTo(document.body);var k=$("<img class='ui-img-showImg' src='"+l+"'>").appendTo(document.body);k.load(function(){k.css({left:(n.width()-this.width)/2+"px",top:(n.height()-this.height)/2+"px",width:this.width,height:this.height});});n.click(function(){n.remove();k.remove();});k.click(function(){n.remove();k.remove();});m.stopPropagation();});if($.ygrid.msie){g[0].onchange=function(o){var m=this;var l=$(this).val().substring(l.lastIndexOf("\\")+1),n=l.split(".")[1];if(b.options.imageCut){var k={type:n,callback:function(p){a($(m),p);}};$(m).photoCut(k);}else{a($(this),{imgType:n});}$(".opt,.bar",b.yesCom).remove();o.stopPropagation();};}}}).mouseout(function(d){if(!$(d.relatedTarget).hasClass("opt")&&!$(d.relatedTarget).hasClass("bar")){$(".opt,.bar",b.yesCom).remove();}});}});YIUI.CellEditor.CellTextButton=YIUI.extend(YIUI.CellEditor.CellTextEditor,{init:function(a){this.base(a);this.opt=a;},onRender:function(a){this.base(a);this.yesCom.el.addClass("ui-txtbtn");this._btn=$("<button class='btn'>...</button>");this._btn.appendTo(this.yesCom.el);this._btn.css({height:this.yesCom.getInput().outerHeight()+"px",padding:"0",verticalAlign:"top"});this.yesCom.getInput().css({width:(a.width()-this._btn.outerWidth())+"px"});},finishInput:function(){return this.yesCom.finishInput();},install:function(){var a=this;a.clicking=false;this._btn.mousedown(function(b){$(this).addClass("hover");a.clicking=true;}).mouseup(function(b){$(this).removeClass("hover");window.setTimeout(function(){a.getInput().focus();},50);});this._btn.bind("click",function(){a.opt.click();});this.getInput().blur(function(b){window.setTimeout(function(){if(!a.clicking){a.yesCom.saveCell();}else{a.clicking=false;}},10);});}});YIUI.layout={};YIUI.layout.AutoLayout=YIUI.extend({prepared:false,init:function(a){$.extend(this,a);},layout:function(a,g){g-=this.getPlaceholderHeight();a-=this.getPlaceholderWidth();var d=this.container,h=d.items,j;for(var c=0,e=h.length;c<e;c++){j=h[c];var f=$.getReal("100%",a),b;if(j.height==-1){b=j.getHeight();}else{b=$.getReal(j.height,g);}j.setWidth(f);j.setHeight(b);if(j.hasLayout){j.doLayout(j.getWidth(),j.getHeight());}}},render:function(){var a=this.container.getRenderTarget();if(this.prepared||this.beforeRender()!==false){this.prepared=true;this.onRender(this.container,a);this.afterRender();}},onRender:function(a,b){this.renderChildren(a,b);},beforeRender:function(){var d=this.container,f=d.getRenderTarget();var b=d.items,e;var a;for(var c=0;c<b.length;c++){e=b[c];a=$("<div></div>").appendTo(f);e.doRender(a);}},afterRender:$.noop,isValidParent:function(b,a){return a&&b.getOuterEl().parent()[0]==a[0];},renderChildren:function(e,g){var b=e.items;for(var d=0,a=b.length;d<a;d++){var h=b[d],f=this.getItemTarget(h,d);if(h&&(!h.rendered)){this.renderItem(h,f);}}},getItemTarget:function(a,b){return a.container||this.container.getRenderTarget();},renderItem:function(b,a){if(b&&!b.rendered){b.doRender(a);}else{if(b&&!this.isValidParent(b,a)){a.insertBefore(b.getEl());b.container=a;}}},setContainer:function(a){this.container=a;},setActiveItem:function(a){},getPlaceholderWidth:function(){var a=this.container;var b=0;b=parseInt(a.getMetaObj().leftPadding||a.getMetaObj().padding||0)+parseInt(a.getMetaObj().rightPadding||a.getMetaObj().padding||0);return b;},getPlaceholderHeight:function(){var b=this.container;var a=0;a=parseInt(b.getMetaObj().topPadding||b.getMetaObj().padding||0)+parseInt(b.getMetaObj().bottomPadding||b.getMetaObj().padding||0);return a;}});YIUI.layout["auto"]=YIUI.layout.AutoLayout;YIUI.layout["flow"]=YIUI.layout.AutoLayout;(function(a,b){var c={top:true,bottom:true,left:true,right:true,center:true};YIUI.layout.BorderLayout=YIUI.extend(YIUI.layout.AutoLayout,{init:function(d){this.base(d);},layout:function(d,q){var o=this.container,r=this.top,e=this.bottom,j=this.left,v=this.right,f=this.center,m=[];d-=this.getPlaceholderWidth();q-=this.getPlaceholderHeight();var u=d,n=q,l=u,g=n,s;if(r!=b){r.setWidth(u);if(r.height!=-1){s=a.getReal(r.height,n);r.setHeight(s);}else{s=r.getHeight();}g-=s;m.push(r);}if(e!=b){e.setWidth(u);if(e.height!=-1){s=a.getReal(e.height,n);e.setHeight(s);}else{s=e.getHeight();}g-=s;m.push(e);}if(j!=b){if(j.width!=-1){s=a.getReal(j.width,u);j.setWidth(s);}else{s=j.getWidth();}l-=s;j.setHeight(g);m.push(j);}if(v!=b){if(v.width!=-1){s=a.getReal(v.width,u);v.setWidth(s);}else{s=v.getWidth();}l-=s;v.setHeight(g);m.push(v);}l=a.isNumeric(l)?l:"auto";g=a.isNumeric(g)?g:"auto";f.setWidth(l);f.setHeight(g);m.push(f);for(var k=0,p=m.length;k<p;k++){var x=m[k];if(x.hasLayout){x.doLayout(x.getWidth(),x.getHeight());}}},beforeRender:function(){var h=this.container,k=h.getRenderTarget();var l=h.items,q,m;for(var g=0,j=l.length;g<j;g++){q=l[g];m=q.getMetaObj().region;if(c[m]){this[m]=q;}}var n=this.top,e=this.bottom,f=this.left,p=this.right,d=this.center;if(!d){throw"No center region defined in borderlayout "+h.id;}h.el.addClass("ui-blp");k.addClass("ui-nooverflow");if(n){n.container=this.topEl=a('<div class="item-ct"></div>').attr("id",n.id).appendTo(k);}var o=a('<div class="mid"></div>').appendTo(k);if(e){e.container=this.bottomEl=a('<div class="item-ct"></div>').attr("id",e.id).appendTo(k);}if(f){f.container=this.leftEl=a('<div class="item-ct"></div>').attr("id",f.id).appendTo(o);}d.container=this.centerEl=a('<div class="item-ct"></div>').attr("id",d.id).appendTo(o);if(p){p.container=this.rightEl=a('<div class="item-ct"></div>').attr("id",p.id).appendTo(o);}this.midEl=o;},isValidParent:function(e,d){return true;}});YIUI.layout["BorderLayout"]=YIUI.layout.BorderLayout;})(jQuery);YIUI.layout.ColumnLayout=YIUI.extend(YIUI.layout.AutoLayout,{ctCls:"container-fluid",colClsPrefix:"col-xs-",layout:function(a,h){var f=this.container,j=f.items,m,c,o,n;o=$(".row",f.el).data("height",0);a-=this.getPlaceholderWidth();h-=this.getPlaceholderHeight();for(var d=0,g=j.length;d<g;d++){m=j[d];var l=0,b=0,k=m.getMetaObj().colspan||1;if(m.height==-1){l=m.getHeight();}else{l=$.getReal(m.height,h);}b=$.getReal(m.width,a);if(b=="auto"){b=a;}var e=k/12*b;m.setWidth(parseInt(e));m.container.width(parseInt(e));c=m.container.parent();if(c.data("height")<l){c.data("height",l);m.setHeight(l);m.container.height(l);}else{m.setHeight(c.data("height"));m.container.height(c.data("height"));}if(m.hasLayout){m.doLayout(m.getWidth(),m.getHeight());}}for(var d=0,g=o.length;d<g;d++){n=o.eq(d);n.height(n.data("height"));}},beforeRender:function(){var c=this.container,t=c.getRenderTarget(),k=c.items,q,e,d,m,b=[],r={row:0,len:0};for(var n=0,o=k.length;n<o;n++){q=k[n];e=q.getMetaObj().y;d=q.getMetaObj().x;m=q.getMetaObj().colspan||1;if(r.row!=e){r.row=e;r.len=0;}if(r.row==e&&r.len>=12||d>11||d+m>12){}r.len=d+m;b[e]=b[e]||[];b[e][d]=q;}this.rows=b;var h=$("<div></div>").addClass(this.ctCls),s,a;for(var n=0,o=b.length;n<o;n++){a=b[n];if(!a){continue;}s=$("<div></div>").addClass("row").appendTo(t);for(var l=0,f=a.length;l<f;l++){q=a[l];if(q){m=q.getMetaObj().colspan||1;q.container=$("<div></div>").attr("col",l).attr("span",m).addClass(this.colClsPrefix+m).appendTo(s);}}}for(var n=0,o=b.length;n<o;n++){a=b[n];if(!a){delete b[n];continue;}for(var l=0,f=a.length;l<f;l++){delete a[l];}delete b[n];}delete b;for(var n=0,g=t.children(),o=g.length;n<o;n++){var e=g[n];for(var l=0,a=e.childNodes,f=a.length;l<f;l++){var p;if(l==0&&$(a[0]).attr("col")>0){p=$(a[0]).attr("col")-0;$("<div></div>").attr("col",0).attr("span",p).addClass(this.colClsPrefix+p).insertBefore($(a[0]));}else{p=$(a[l+1]).attr("col")-$(a[l]).attr("col")-$(a[l]).attr("span");if(p>0){var d=parseInt($(a[l]).attr("col"))+parseInt($(a[l]).attr("span"))+1;$("<div></div>").attr("col",d).attr("span",p).addClass(this.colClsPrefix+p).insertAfter($(a[l]));}}}}}});YIUI.layout["ColumnLayout"]=YIUI.layout.ColumnLayout;YIUI.layout.FluidColumnLayout=YIUI.extend(YIUI.layout.AutoLayout,{fill:false,colClsPrefix:"col-md-",init:function(a){this.base(a);if(!this.fill){this.ctCls="container";}}});YIUI.layout["FluidLayout"]=YIUI.layout.FluidColumnLayout;YIUI.layout.GridLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(c,e){var k=this.container,s=k.getMetaObj(),E=k.getRenderTarget(),g=s.rowGap||0,F=s.columnGap||0,p=k.widths,r=k.minWidths,z=k.heights,A=this.table,a=true,d,n;if(!p||!z){YIUI.ViewException.throwException(YIUI.ViewException.NO_WIDTH_OR_HEIGHT);}e-=g*(z.length-1)+this.getPlaceholderHeight();c-=F*(p.length-1)+this.getPlaceholderWidth();var b=this.calcRealValues(c,p);var D=-1;var h=this.calcRealValues(e,z);for(var w=0;w<h.length;w++){d=$(A[0].rows[w]).height(h[w]);for(var v=0;v<b.length;v++){n=$(d[0].cells[v]);if(a){var o=n.attr("col");D=this.getRealWidth(r[o],b[o]);if(v>0){n.width(D+F);}else{n.width(D);}if(k.oddColumnColor&&v%2==0){n.css("background-color",k.oddColumnColor);}}}a=false;}var q=k.items,B,m,l,f,C;for(var w=0,y=q.length;w<y;w++){B=q[w];l=B.getMetaObj().x;m=B.getMetaObj().y;f=B.getMetaObj().colspan||1;C=B.getMetaObj().rowspan||1;var t=this.getRealWidth(r[l],b[l]),u=h[m];if(f>1){for(var v=1;v<f;v++){D=this.getRealWidth(r[l+v],b[l+v]);t+=D+F;}}if(C>1){for(var v=1;v<C;v++){u+=h[m+v]+g;}}if(m>0){B.topMargin=g;B.getOuterEl().css("margin-top",g+"px");}if(l>0){B.leftMargin=g;B.getOuterEl().css("margin-left",F+"px");}B.setWidth(t);B.setHeight(u);if(B.hasLayout){B.doLayout(B.getWidth(),B.getHeight());}}},getRealWidth:function(b,a){var c=a;if(b!=-1&&b>a){c=b;}return c;},beforeRender:function(){var g=this.container,o=g.getMetaObj(),x=g.getRenderTarget(),m=g.widths,t=g.heights;if(!m||!t){YIUI.ViewException.throwException(YIUI.ViewException.NO_WIDTH_OR_HEIGHT);}var b=this.calcRealValues(g.getWidth(),m);var f=this.calcRealValues(g.getHeight(),t);var u=$('<table class="layout"></table>').attr({border:0,cellpadding:0,cellspacing:0}).appendTo(x),a=true,e=o.rowGap||0,c,l;this.table=u;var p=0;for(var r=0;r<f.length;r++){c=$('<tr row="'+r+'"></tr>').appendTo(u);for(var q=0;q<b.length;q++){l=$('<td col="'+q+'"></td>').appendTo(c);}p+=f[r];}p+=(f.length-1)*e;u.css("height",p);var n=g.items,v,k,h,d,w;for(var r=0,s=n.length;r<s;r++){v=n[r];if(!v.getMetaObj().visible){continue;}h=v.getMetaObj().x;k=v.getMetaObj().y;d=v.getMetaObj().colspan||1;w=v.getMetaObj().rowspan||1;c=$("tr:eq("+k+")",u);l=this.getCell(k,h);l.nextAll("td:lt("+(d-1)+")").remove();c.nextAll("tr:lt("+(w-1)+")").each(function(){var j=$("td[col="+h+"]",$(this));j.nextAll("td:lt("+(d-1)+")").remove();j.remove();});l.attr("colspan",d).attr("rowspan",w);v.width=b[h];v.height=f[k];}},calcRealValues:function(n,b){var r=[],d=0,k,l=b.length,a=[],m=0,h,g;for(h=0;h<l;h++){g=b[h];if($.isPercentage(g)){g=parseInt(g,10)/100;d+=g;a.push(h);}else{if($.isNumeric(g)&&g<1){a.push(h);}else{if(g=="auto"){a.push(h);}else{if(g=="pref"){a.push(h);}else{m+=g;}}}}r[h]=g;}if(m<=n){k=n-m;if(d==0){d=1;}l=a.length;for(h=0;h<l;h++){if((g=r[a[h]])>0){r[a[h]]=Math.floor(k*g);m+=r[a[h]];}else{if((g=r[a[h]])=="auto"){r[a[h]]=Math.floor(k/l);}else{if((g=r[a[h]])=="pref"){var q,e,o=-1;for(var f=0,c=this.container.items.length;f<c;f++){q=this.container.items[f];var p=q.height==-1?q.getHeight():q.height;e=q.rowspan||1;if(q.y==a[h]&&e==1&&p>o){o=p;}}r[a[h]]=o;}}}}}return r;},getCell:function(c,a){var b=$(this.table[0].rows[c]);return $("td[col="+a+"]",b);},getItemTarget:function(a,b){return this.getCell(a.getMetaObj().y,a.getMetaObj().x);}});YIUI.layout["GridLayout"]=YIUI.layout.GridLayout;YIUI.layout.TabsLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(g,e){var d=this.container;var a=$(d.el.children()[1]),h=a.css("overflow");e-=this.getPlaceholderHeight();g-=this.getPlaceholderWidth();if(d.items&&d.items.length!=0){var c=$(d.el.children("ul")),a=$(d.el.children(".tab-body"));var b=d.tabPosition;switch(b){case YIUI.DirectionType.TOP:case YIUI.DirectionType.BOTTOM:c.width(g);a.height(e-c.outerHeight(true));a.width(g);break;case YIUI.DirectionType.LEFT:case YIUI.DirectionType.RIGHT:a.height(e);var f=c.outerHeight(true);if($.browser.isIE){f=c.outerWidth();}a.width(g-f);c.width(e);break;}tab=d.items[d.activeTab];if(tab){tab.setWidth(a.width());tab.setHeight(a.height());if(tab.hasLayout){tab.doLayout(tab.getWidth(),tab.getHeight());}}}},beforeRender:function(){var d=this.container,h=d.getRenderTarget(),k=d.items,m;var j=$("<ul class='ui-tabs-nav tab-head'/>");var e=$("<div class='tab-body'>");var n=d.tabPosition;switch(n){case YIUI.DirectionType.TOP:j.addClass("top");j.appendTo(h);e.appendTo(h);break;case YIUI.DirectionType.BOTTOM:j.addClass("bottom");e.appendTo(h);j.appendTo(h);break;case YIUI.DirectionType.LEFT:j.addClass("left");e.appendTo(h);j.appendTo(h);e.css("float","right");break;case YIUI.DirectionType.RIGHT:j.addClass("right");e.appendTo(h);j.appendTo(h);e.css("float","left");break;}for(var b=0,g=k.length;b<g;b++){m=k[b];m.id=m.id||YIUI.allotId();var f="tab_"+m.id;var l=m.getMetaObj().title;if(!l){l=m.caption;}var c=$(YIUI.Panel.TabPanel.prototype.tabTemplate.replace(/#\{href\}/g,"#"+f).replace(/#\{title\}/g,l)).appendTo(j);c.addClass("ui-state-default ui-corner-top").attr("role","tab").attr("aria-controls",f);$("[href=#"+f+"]",c).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+f+"] label",c).addClass("ui-anchor-label");var a=$("<div>").attr("id",f).appendTo(e);m.container=a;a.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");if(d.activeTab<0&&m.visible){d.selectedTab=c;d.activeTab=b;c.toggleClass("aria-selected");a.toggleClass("aria-show");a.show();}else{a.hide();}if(!m.visible){c.css("display","none");}}},afterRender:function(){var b=this.container;var a=$(b.el.children()[1]),c=a.css("overflow");},isValidParent:function(b,a){return true;}});YIUI.layout["TabLayout"]=YIUI.layout.TabsLayout;YIUI.layout.Tab=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(f,d){var c=this.container;d-=this.getPlaceholderHeight();f-=this.getPlaceholderWidth();if(c.items&&c.items.length!=0){var b=$("ul.ui-tabs-nav",c.el),a=$(c.el.children(".ui-tabs-body"));a.width(f);a.height(d-b.outerHeight(true));$(".ui-tabs-header",this.el).width(f-30);var e=c.items[c.activeTab];if(e){e.setWidth(a.width());e.setHeight(a.height());if(e.hasLayout){e.doLayout(e.getWidth(),e.getHeight());}if(c.selectedTab){$(".ui-tabs-header",c.el).scrollLeft(c.selectedTab.position().left-$(".ui-tabs-header",c.el).width()+c.selectedTab.width());}}}c.setDropBtnView();c.setTabListColor();},beforeRender:function(){var e=this.container,h=e.getRenderTarget(),l=e.items,m;var j=$("<ul/>");var c=$("<div></div>").addClass("ui-tabs-header").appendTo(h).append(j);var k=e._dropBtn=$("<span></span>").addClass("ui-tabs dropdownBtn").appendTo(h);e._dropView=$("<div><ul/></div>").addClass("ui-tabs tabs-list");$(document.body).append(e._dropView);j.addClass("ui-tabs-nav ui-corner-all");j.attr("role","tablist");var f=$("<div>").addClass("ui-tabs-body").appendTo(h);for(var b=0,g=l.length;b<g;b++){m=l[b];m.id=m.id||YIUI.allotId();if(!m.title){m.title=m.caption;}var d=$(YIUI.Panel.TabPanel.prototype.tabTemplate.replace(/#\{href\}/g,"#"+m.id).replace(/#\{title\}/g,m.title)).appendTo(j);if(b==0){e.selectedTab=d;e.activeTab=0;}else{}d.addClass("ui-state-default ui-corner-top").attr("role","tab").attr("aria-controls",m.id);$("[href=#"+m.id+"]",d).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+m.id+"] label",d).addClass("ui-anchor-label");var a=$("<div>").attr("id",m.id).appendTo(f);m.container=a;a.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");if(b==0){d.toggleClass("aria-selected");a.toggleClass("aria-show");}}},afterRender:function(){var b=this.container;var a=$(b.el.children()[1]),c=a.css("overflow");},isValidParent:function(b,a){return true;}});YIUI.layout["tab"]=YIUI.layout.Tab;(function(a,b){YIUI.layout.SplitLayout=YIUI.extend(YIUI.layout.AutoLayout,{resizerSize:4,regionMinSize:0,init:function(c){this.base(c);this.resize={};},layout:function(c,k){var h=this.container,l=h.items,o,e=h.el.children(".spl-item"),n=h.el.children(".spl-resizer"),f=h.getMetaObj().orientation==="vertical",m=h.splitSizes;k-=this.getPlaceholderHeight();c-=this.getPlaceholderWidth();for(var g=0,j=n.length;g<j;g++){if(f){n.eq(g).width(c);}else{n.eq(g).height(k);}}for(var g=0,j=e.length;g<j;g++){var d=e.eq(g);if(f){d.height(a.getReal(m[g].size,(k-this.getPlaceholderSize())));}else{d.width(a.getReal(m[g].size,(c-this.getPlaceholderSize())));}}for(var g=0,j=l.length;g<j;g++){o=l[g];if(f){o.setWidth(c);o.setHeight(o.container.height());}else{o.setWidth(o.container.width());o.setHeight(k);}if(o.hasLayout){o.doLayout(o.getWidth(),o.getHeight());}}},beforeRender:function(){var f=this.container,h=f.getRenderTarget(),j=f.items,l=f.splitSizes,c=f.getMetaObj().orientation==="vertical",k,m,d;h.css("overflow","hidden");for(var e=0,g=l.length;e<g;e++){k=l[e];m=j[e];d=a('<div class="spl-item"></div>').appendTo(h);if(m){m.container=d;}if(e<g-1){a('<div class="spl-resizer"></div>').addClass(c?"resizer-h":"resizer-v").attr("region",e).appendTo(h);}if(c){d.addClass("v-item");}else{d.addClass("h-item");}}},getPlaceholderSize:function(){var g=0,e=this.container,f=e.splitSizes;for(var d=0,c=f.length;d<c;d++){if(!a.isPercentage(f[d].size)&&f[d].size>0){g+=f[d].size;}}return g;},afterRender:function(){this.base();},getPlaceholderWidth:function(){var f=this.base();var e=this.container,d=e.items,c=e.getMetaObj().orientation==="vertical";f+=(c?0:this.resizerSize*(d.length-1));return f;},getPlaceholderHeight:function(){var c=this.base();var f=this.container,e=f.items,d=f.getMetaObj().orientation==="vertical";c+=(d?this.resizerSize*(e.length-1):0);return c;}});YIUI.layout["SplitLayout"]=YIUI.layout.SplitLayout;})(jQuery);YIUI.layout.FlexFlowLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(g,e){var d=this.container,b=d.items,f;g-=this.getPlaceholderWidth();e-=this.getPlaceholderHeight();for(var c=0,a=b.length;c<a;c++){f=b[c];f.setWidth(g);f.setHeight($.getReal(f.height,(e-this.getPlaceholderSize())));if(f.hasLayout){f.doLayout(f.getWidth(),f.getHeight());}}},getPlaceholderSize:function(){var f=0,d=this.container,b=d.items,e;for(var c=0,a=b.length;c<a;c++){e=b[c];if($.isNumeric(e.height)){f+=(e.height==-1?e.getHeight():e.height);}else{if(e.height=="pref"){f+=e.getHeight();}}}return f;}});YIUI.layout["FlexFlowLayout"]=YIUI.layout.FlexFlowLayout;YIUI.layout.FlowLayout=YIUI.extend(YIUI.layout.AutoLayout,{});YIUI.layout["FlowLayout"]=YIUI.layout.FlowLayout;YIUI.layout.TableLayout=YIUI.extend(YIUI.layout.AutoLayout,{beforeRender:function(){var g=this.container,E=g.getRenderTarget(),o=g.widths,A=g.heights;if(!o||!A){throw"widths or heights not defined!";}var b=YIUI.layout.GridLayout.prototype.calcRealValues.call(this,g.getWidth(),o);var e=YIUI.layout.GridLayout.prototype.calcRealValues.call(this,g.getHeight(),A);var B=$('<div class="table"></div>').appendTo(E),a=true,F=0;this.table=B;for(var w=0;w<e.length;w++){var h=$('<div class="table-row" row="'+w+'"></div>').appendTo(B);for(var v=0;v<b.length;v++){var c=$('<div col="'+v+'"></td>').addClass("table-cell").css({height:e[w]}).appendTo(h);if(a){F+=b[v];c.css({width:b[v],"max-width":b[v]});}}a=false;}if(F<g.getWidth()){$(B.children(null,".table-row")[0]).append($('<div class="table-cell" style="visibility:hidden;"></div>').css("width",g.getWidth()-F));}var s=g.items,n=B[0].childNodes,p=n[0].childNodes;for(var w=0,z=s.length;w<z;w++){var C=s[w],m=C.x,l=C.y,d=C.colspan||1,D=C.rowspan||1,c=this.getCell(l,m);if(d==1&&D==1){c.attr("pos",l+"_"+m);}else{var t=0,r=0,f=0,q=0;for(var v=0;v<d;v++){t+=b[m+v];}for(var v=0;v<D;v++){r+=e[l+v];}for(var v=D-1;v>=0;v--){for(var u=d-1;u>=0;u--){if(v==0&&u==0){continue;}this.getCell(l+v,m+u).css("visibility","hidden");}}c.css({position:"absolute",width:t,height:r}).attr("pos",l+"_"+m);}C.width=c.width();C.height=c.height();}},afterRender:function(){},getCell:function(b,a){return $(this.table[0].childNodes[b].childNodes[a]);},getItemTarget:function(a,b){return $("div[pos="+a.y+"_"+a.x+"]");}});YIUI.layout["TableLayout"]=YIUI.layout.TableLayout;YIUI.layout.FluidTableLayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(c,e){var h=this.container,y=h.getRenderTarget(),b=h.repeatCount||1,r=h.items,f=h.rowHeight,g=h.rowGap||0,z=h.columnGap||0,x=h.repeatGap||0,n=h.widths;if(!n){throw"widths is undefined";}var v=this.table,a=true,d,l,k=0;for(var u=0;u<r.length;u++){if(r[u].getMetaObj().buddyKey){k++;}}k=r.length-2*k;var m=(r.length+k)/2;if(m%b==0){m=m/b;}else{m=parseInt(m/b)+1;}var o=2*b;c-=n.length*z*b+(b-1)*x+this.getPlaceholderWidth();e-=m*f+this.getPlaceholderHeight();var p=this.getRealWidth(n,c/b);var w;for(var u=0;u<m;u++){d=$(v[0].rows[u]).height(f);for(var t=0;t<o;t++){l=$(d[0].cells[t]);var s=$.getReal(n[t%2==0?0:1],p);if(a){l.width(s);}if(l.children().length>0){var q=l.attr("index");w=r[q];w.setWidth(s);w.setHeight(f);w.getOuterEl().css("margin-left","0");w.getOuterEl().css("margin-top","0");if(z>0&&!w.hasBuddyKey){w.getOuterEl().css("margin-left",z+"px");}if(b>1&&t>1){if(w.hasBuddyKey){w.getOuterEl().css("margin-left",x+"px");}}if(u>0){w.getOuterEl().css("margin-top",g+"px");}if(w.hasLayout){w.doLayout(w.getWidth(),w.getHeight());}}}a=false;}},getRealWidth:function(c,b){var d=0;for(var a=0;a<c.length;a++){if($.isNumeric(c[a])&&c[a]>0){d+=c[a];}}return b-d;},repaint:function(){this.reset();var a=this.container;this.layout(a.getWidth(),a.getHeight());},reset:function(){var d=this.container,v=d.getRenderTarget(),a=d.repeatCount||1,n=d.items,c=d.rowHeight,k=d.widths;if(!k){throw"widths is undefined";}var s=this.table,b,g;var e=0;for(var p=0;p<n.length;p++){if(n[p].getMetaObj().buddyKey){e++;}}e=n.length-2*e;var h=(n.length+e)/2;if(h%a==0){h=h/a;}else{h=parseInt(h/a)+1;}for(var p=0;p<n.length;p++){t=n[p];if(t.getMetaObj().buddyKey!=undefined){for(var o=0;o<n.length;o++){var l=n[o];if(l.getMetaObj().key==t.getMetaObj().buddyKey){l.rgtVisible=t.visible;l.hasBuddyKey=true;t.leftVisible=l.visible;continue;}}}}var u=0;var f=[];for(var p=0;p<h;p++){b=$("tr[row="+p+"]",s);for(var o=0;o<(2*a);o++){var t=n[u];var m=u;if(t){u++;if(t.hasBuddyKey){if(!t.rgtVisible){o--;f.push(t);}}else{if(t.visible){if(!t.getMetaObj().buddyKey){o++;}}else{if(t.getMetaObj().buddyKey){if(!t.visible){o--;f.push(t);}}else{o--;}continue;}}g=$("td[col="+o+"]",b);g.attr("index",m);t.container=g;t.el.appendTo(g);t.width=k[o%2==0?0:1];t.height=c;}}}var r=f.length/a/2+h;$("tr[row]",s).slice(h).remove();for(var p=h;p<r;p++){b=$("<tr row="+p+"/>").appendTo(s);for(var o=0,q=f.length;o<q;o++){var t=f[o];g=$("<td/>").appendTo(b);t.el.appendTo(g);}b.hide();}},beforeRender:function(){var e=this.container,w=e.getRenderTarget(),a=e.repeatCount||1,o=e.items,d=e.rowHeight,l=e.widths;if(!l){throw"widths is undefined";}var t=$('<table class="layout"></table>').attr({border:0,cellpadding:0,cellspacing:0}).appendTo(w),b,h;this.table=t;var f=0;for(var q=0;q<o.length;q++){if(o[q].getMetaObj().buddyKey){f++;}}f=o.length-2*f;var k=(o.length+f)/2;if(k%a==0){k=k/a;}else{k=parseInt(k/a)+1;}for(var q=0;q<o.length;q++){u=o[q];if(u.getMetaObj().buddyKey!=undefined){for(var p=0;p<o.length;p++){var m=o[p];if(m.getMetaObj().key==u.getMetaObj().buddyKey){m.hasBuddyKey=true;m.rgtVisible=u.getMetaObj().visible;continue;}}}}var v=0;var g=[];for(var q=0;q<k;q++){b=$('<tr row="'+q+'"></tr>').appendTo(t);for(var p=0;p<(2*a);p++){var u=o[v];var n=v;if(u){if(!u.getMetaObj().visible){g.push(u);v++;p--;continue;}if(!u.getMetaObj().buddyKey&&!u.hasBuddyKey){$('<td col="'+p+'"></td>').appendTo(b);p++;}if(u.getMetaObj().buddyKey){var c=e.get(u.getMetaObj().buddyKey);if(!c.visible){$('<td col="'+p+'"></td>').appendTo(b);p++;}}h=$('<td col="'+p+'"></td>').appendTo(b);h.attr("index",n);u.container=h;if(u.width==-1){u.width=l[p%2==0?0:1];}u.height=d;}else{$('<td col="'+p+'"></td>').appendTo(b);}v++;}}var s=g.length/a/2+k;for(var q=k;q<s;q++){b=$('<tr row="'+q+'"></tr>').appendTo(t);b.hide();for(var p=0,r=g.length;p<r;p++){var u=g[p];h=$('<td col="'+p+'"></td>').appendTo(b);u.container=h;}}}});YIUI.layout["FluidTableLayout"]=YIUI.layout.FluidTableLayout;YIUI.layout.Wizardlayout=YIUI.extend(YIUI.layout.AutoLayout,{layout:function(a,f){var c=this.container;var e=c.selectItem.index();var k=e*a;c.body.css("right",k+"px");var h=(f-$(".wizard-btn",this.el).height())/2;$(".wizard-btn",this.el).css("margin-top",h+"px");f-=this.getPlaceholderHeight();a-=this.getPlaceholderWidth();var g=c.items;if(g&&g.length!=0){for(var b=0,d=g.length;b<d;b++){var m=g[b];var j=m.container.next(".wizard-foot");var l=f-j.outerHeight();m.setHeight(l);m.setWidth(a);if(m.hasLayout){m.doLayout(m.getWidth(),m.getHeight());}}}},beforeRender:function(){var e=this.container,g=e.getRenderTarget(),h=e.items,k,j=e.funcMap,d=$(".ui-wizard-warp",e.el);for(var b=0,f=h.length;b<f;b++){k=h[b];var a=$("<div class='wizard-item'></div>").attr("key",k.getMetaObj().key).appendTo(e.body);var c=$("<div class = 'wizard-body'></div>").appendTo(a);if(k){k.container=c;if(b==0){d.addClass("first");e.selectItem=a;}a.attr("index",b);j[k.getMetaObj().key]={check:k.check,leave:k.leave,active:k.active};}}},isValidParent:function(b,a){return true;}});YIUI.layout["WizardLayout"]=YIUI.layout.Wizardlayout;YIUI.Panel=YIUI.extend(YIUI.Component,{defaultType:"component",layout:"auto",overflowX:"visible",overflowY:"visible",backImage:"",backImagePosition:"",isBackImageRepeatX:false,isBackImageRepeatY:false,padding:1,init:function(b){this.base(b);var a=this.items;if(a){delete this.items;this.add(a);}},needClean:function(){return false;},build:function(b){var a=b.getRoot();this.add(a);this.doRenderChildren();this.doLayout(this.el[0].clientWidth,this.el[0].clientHeight);b.setContainer(this);},removeForm:function(b){var a=b.getRoot();this.remove(a);},initDefaultValue:function(a){this.el=a.el;this.container=a.container;this.layout=a.layout;this.items=a.items;},setOverflowX:function(a){if(a.toLowerCase()!="visible"){this.overflowX=a;this.el.css("overflow-x",a.toLowerCase());}},setOverflowY:function(a){if(a.toLowerCase()!="visible"){this.overflowY=a;this.el.css("overflow-y",a.toLowerCase());}},setBackImage:function(a){this.backImage=a;this.el.css("background-image","url(Resource/"+a+")");},setLeftMargin:function(a){this.el.css("margin-left",a);},setRightMargin:function(a){this.el.css("margin-right",a);},setTopMargin:function(a){this.el.css("margin-top",a);},setBottomMargin:function(a){this.el.css("margin-bottom",a);},setBackImagePosition:function(a){this.backImagePosition=a;switch(a){case"top":this.el.css("background-position","top left");break;case"bottom":this.el.css("background-position","bottom left");break;case"left":this.el.css("background-position","center left");break;case"right":this.el.css("background-position","center right");break;case"center":this.el.css("background-position","center center");break;}this.el.css("background-position",a);},setBackImageRepeatX:function(a){this.isBackImageRepeatX=a;if(a){this.el.css("background-repeat","repeat-x");}},setbackImageRepeatY:function(a){this.isBackImageRepeatY=a;if(a){this.el.css("background-repeat","repeat-y");}},add:function(a){this.initItems();if(this.beforeAdd(a)!==false){if($.isArray(a)){var d=this;$.each(a,function(c){d.add(this);});return;}if(this.get(a.id)){return;}var b=this.lookupComponent(a);this.items.push(b);b.ownerCt=this;this.afterAdd(b);}},beforeAdd:$.noop,afterAdd:$.noop,reduceVisible:$.noop,get:function(c){if($.isNumeric(c)){return this.items[c];}else{if($.isString(c)){var b=this.items,e;for(var d=0,a=b.length;d<a;d++){e=b[d];if(e&&(e.id===c||e.getMetaObj().key===c)){return e;}}}}return null;},indexOf:function(c){var b=this.items;for(var d=0,a=b.length;d<a;d++){if(b[d]===c){return d;}}return -1;},remove:function(a,c){var b=this.indexOf(a);if(b===-1){return;}if(c===false){a.getEl().remove();}else{a.destroy();}this.items.splice(b,1);return a;},lookupComponent:function(a){if($.isString(a)){return YIUI.ComponentMgr.get(a);}else{if(!(a instanceof YIUI.Component)){return YIUI.create(a,this.defaultType);}}return a;},doLayout:function(b,a){if(this.layout){this.layout.layout(b,a);}},onRenderChildren:function(){if(this.html){this.el.html(this.html);}else{this.getOuterEl().addClass("ui-pnl");if($.isObject(this.layout)&&!this.layout.layout){this.layoutConfig=this.layout;this.layout=this.layoutConfig.type;}if($.isString(this.layout)){if(this.layout=="auto"||this.layout=="flow"){this.el.css("white-space","normal");}this.layout=new YIUI.layout[this.layout](this.layoutConfig);}this.setLayout(this.layout);if(this.activeItem!==undefined){var a=this.activeItem;delete this.activeItem;this.layout.setActiveItem(a);}this.doRenderChildren(false,true);}},setTip:$.noop,afterRender:function(){this.base();var a=this.getMetaObj();a.overflowX&&this.setOverflowX(a.overflowX);a.overflowY&&this.setOverflowY(a.overflowY);a.backImage&&this.setBackImage(a.backImage);a.backImagePosition&&this.setBackImagePosition(a.backImagePosition);a.isBackImageRepeatX&&this.setBackImageRepeatX(a.isBackImageRepeatX);a.isBackImageRepeatY&&this.setbackImageRepeatY(a.isBackImageRepeatY);a.leftMargin&&this.setLeftMargin(a.leftMargin);a.rightMargin&&this.setRightMargin(a.rightMargin);a.topMargin&&this.setTopMargin(a.topMargin);a.bottomMargin&&this.setBottomMargin(a.bottomMargin);},setLayout:function(a){if(this.layout&&this.layout!=a){this.layout.setContainer(null);}this.layout=a;this.initItems();a.setContainer(this);},initItems:function(){if(!this.items){this.items=[];}},beforeDoRenderChildren:$.noop,afterDoRenderChildren:$.noop,doRenderChildren:function(b,a){if(!this.html&&this.beforeDoRenderChildren()!==false){var d=this.rendered;var c=a;if(!this.canLayout()||this.collapsed){this.deferLayout=this.deferLayout||!b;if(!c){return;}b=b&&!this.deferLayout;}else{delete this.deferLayout;}if(d&&this.layout){this.layout.render();}if(d){this.afterDoRenderChildren(b,c);}this.hasLayout=true;}},canLayout:function(){var a=this.getEl();return a&&a.css("display")!="none";},getRenderTarget:function(){return this.getEl();},getValidWidth:function(){return this.el.width();},getValidHeight:function(){if(this.ownerCt&&this.ownerCt.type==YIUI.CONTROLTYPE.TABPANEL){return this.ownerCt.el.height()-$(".ui-tabs-nav",this.ownerCt.getEl()).outerHeight(true)-this.getToolBarHeight()-this.layout.getPlaceholderHeight();}if(this.type==YIUI.CONTROLTYPE.TABPANEL){return $(".ui-tabs-body",this.getEl()).height()-this.getToolBarHeight()-this.layout.getPlaceholderHeight();}if(!this.height||this.height<=0){return 0;}return this.el.height()-this.getToolBarHeight();},getToolBarHeight:function(){var a=0;$.each(this.items,function(b,c){if(c.type==YIUI.CONTROLTYPE.TOOLBAR){a=c.getHeight();return false;}});return a;},beforeDestroy:function(){var a=this.items;if(a){for(var b=a.length-1;b>=0;b--){a[b].destroy();delete a[b];}}delete this.items;this.base();},getWidth:function(){if(this.rendered){return this.getOuterEl()[0].clientWidth||this.getOuterEl().width();}return this.width;},getHeight:function(){if(this.rendered){return this.getOuterEl()[0].clientHeight;}return this.height;},needTip:function(){return false;},reLayout:$.noop,getNoTabOrderComps:function(e){for(var c=0,b,a=this.items.length;c<a;c++){b=this.items[c];if(b==undefined||b==null){continue;}var d=b.getMetaObj().tabOrder;if(b.getMetaObj().crFocus&&(d==-1||d==undefined||d==null)){e.push(b);}else{if(b.isPanel){b.getNoTabOrderComps(e);}}}},diff:function(a){if(a.items){var b=this.items;$.each(a.items,function(d,e){var c=e.metaObj.key;$.each(b,function(g,f){if(f.metaObj.key==c){f.diff(e);return false;}});});}}});YIUI.reg("panel",YIUI.Panel);YIUI.reg("body",YIUI.Panel);YIUI.Panel.BorderLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"BorderLayout",initDefaultValue:function(n){this.base(n);var d=this.el;var j,a,e,m,b;if(d.find(".border-north").length>0){j=this.el.find(".border-north");}if(d.find(".border-south").length>0){a=this.el.find(".border-south");}if(d.find(".border-western").length>0){e=this.el.find(".border-western");}if(d.find(".border-east").length>0){m=this.el.find(".border-east");}if(d.find(".border-center").length>0){b=this.el.find(".border-center");}var l=d.width(),g=d.height(),f=l,c=g,k;if(j!=undefined){k=j.height();c-=k;j.width(l);}if(a!=undefined){k=a.height();c-=k;a.width(l);}if(e!=undefined){k=e.width();f-=k;e.height(c);}if(m!=undefined){k=m.width();f-=k;m.height(c);}f=$.isNumeric(f)?f:"100%";c=$.isNumeric(c)?c:"100%";b.width(f);b.height(c);},getNoTabOrderComps:function(h){var g=[];for(var d=0,a=this.items.length,e;d<a;d++){e=this.items[d];switch(e.getMetaObj().region){case"top":g.splice(0,0,e);break;case"left":g.splice(1,0,e);break;case"center":g.splice(2,0,e);break;case"right":g.splice(3,0,e);break;case"bottom":g.splice(4,0,e);break;}}for(var c=0,b;c<g.length;c++){b=g[c];if(b==undefined||b==null){continue;}var f=b.getMetaObj().tabOrder;if(b.getMetaObj().crFocus&&(f==-1||f==undefined||f==null)){h.push(b);}else{if(b.isPanel){b.getNoTabOrderComps(h);}}}},install:function(){var a=this;}});YIUI.reg("borderlayoutpanel",YIUI.Panel.BorderLayoutPanel);YIUI.Panel.ColumnLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"ColumnLayout",onRender:function(a){this.base(a);this.el.addClass("ui-clp");},});YIUI.reg("columnlayoutpanel",YIUI.Panel.ColumnLayoutPanel);YIUI.Panel.FlowLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FlowLayout"});YIUI.reg("flowlayoutpanel",YIUI.Panel.FlowLayoutPanel);YIUI.Panel.FlexFlowLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FlexFlowLayout",initDefaultValue:function(c){this.base(c);var b=this.items,f,e=this.el.outerHeight()-this.getPlaceholderSize();for(var d=0,a=b.length;d<a;d++){f=b[d].el;if($.isPercentage(f.attr("height"))){f.height($.getReal(f.attr("height"),e));}}},getPlaceholderSize:function(){var e=0,b=this.items,d;for(var c=0,a=b.length;c<a;c++){d=b[c].el;if(!$.isPercentage(d.attr("height"))){e+=d.height();}}return e;}});YIUI.reg("flexflowlayoutpanel",YIUI.Panel.FlexFlowLayoutPanel);YIUI.Panel.FluidColumnLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FluidLayout",fill:false,init:function(a){this.base(a);this.layoutConfig=this.layoutConfig||{};this.layoutConfig.fill=this.fill;}});YIUI.reg("fluidcolumnlayoutpanel",YIUI.Panel.FluidColumnLayoutPanel);YIUI.Panel.FluidTableLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"FluidTableLayout",widths:null,rowGap:0,columnGap:0,repeatCount:1,repeatGap:0,rowHeight:30,init:function(a){this.base(a);},setRowGap:function(a){this.rowGap=a;},setColumnGap:function(a){this.columnGap=a;},setRepeatCount:function(a){if(a>1){this.repeatCount=a;}},setRepeatGap:function(a){this.repeatGap=a;},setRowHeight:function(a){this.rowHeight=a;},onRender:function(b){this.base(b);var a=this.getMetaObj();a.rowGap&&this.setRowGap(a.rowGap);a.columnGap&&this.setColumnGap(a.columnGap);a.repeatGap&&this.setRepeatGap(a.repeatGap);a.repeatCount&&this.setRepeatCount(a.repeatCount);a.rowHeight&&this.setRowHeight(a.rowHeight);this.el.addClass("ui-ftlp");},reLayout:function(){this.layout.repaint();},initDefaultValue:function(p){this.base(p);var j=this,h=j.repeatCount=p.repeatCount,k=j.items=p.items,b=j.rowHeight=p.rowHeight,c=j.rowGap=p.rowGap,d=j.columnGap=p.columnGap,q=j.repeatGap=p.repeatGap,f=j.widths=p.widths,a=this.el.outerWidth();if(!f){throw"widths is undefined";}var n=$("table",this.el),g=true,l,e;var o=$("tr",this.el).length;var m=$("tr",this.el).eq(0).children().length;}});YIUI.reg("fluidtablelayoutpanel",YIUI.Panel.FluidTableLayoutPanel);YIUI.Panel.GridLayoutPanel=YIUI.extend(YIUI.Panel,{layout:"GridLayout",widths:null,minWidths:null,heights:null,rowGap:0,columnGap:0,oddColumnColor:null,forceLayout:true,setOddColumnColor:function(a){this.oddColumnColor=a;this.el.addClass("oddColumnColor");},setForceLayout:function(a){this.forceLayout=a;this.layout.layout=$.noop;this.layout.render=$.noop;},setRowGap:function(a){this.rowGap=a;},setColumnGap:function(a){this.columnGap=a;},onRender:function(b){this.base(b);this.el.addClass("ui-glp");var a=this.getMetaObj();a.oddColumnColor&&this.setOddColumnColor(a.oddColumnColor);a.rowGap&&this.setRowGap(a.rowGap);a.columnGap&&this.setColumnGap(a.columnGap);},afterRender:function(){this.base();if(this.forceLayout==false){this.setForceLayout(this.forceLayout);}},initDefaultValue:function(w){this.base(w);var m=this.rowGap=w.rowgap;var B=this.columnGap=w.columngap;var C=this.heights=w.heights;var f=this.widths=w.widths;var v=this,a=v.getRenderTarget(),I=v.el,A=I.innerHeight(),K=I.innerWidth();if(!f||!C){throw"widths or heights undefined";}var G=parseInt(I.css("padding")),x=parseInt(I.css("padding-left")),D=parseInt(I.css("padding-right")),L=parseInt(I.css("padding-top")),E=parseInt(I.css("padding-bottom")),g=parseInt(I.css("margin")),q=parseInt(I.css("margin-left")),y=parseInt(I.css("margin-right")),c=parseInt(I.css("margin-top")),r=parseInt(I.css("margin-bottom"));A-=(G==0?(L+E):G*2)+(g==0?(c+r):g*2);K-=(G==0?(x+D):G*2)+(g==0?(q+y):g*2);var k=v.layout.calcRealValues(K,f),o=v.layout.calcRealValues(A,C),t=I.find("table"),n=true,J,e;for(var H=0;H<o.length;H++){J=$(t[0].rows[H]).height(o[H]);for(var F=0;F<k.length;F++){e=$(J[0].cells[F]);if(n){e.width(k[F]);}var z=e.children();var b;if(z.length>0){b=z[0].nodeName.toLowerCase();}var h=parseInt(e.attr("col")),p=parseInt(e.parent().attr("row")),s=parseInt(e.attr("colspan")),u=parseInt(e.attr("rowspan"));var l=k[h],d=o[p];if(s>1){for(var F=1;F<s;F++){l+=k[h+F];}}if(u>1){for(var F=1;F<u;F++){d+=o[p+F];}}z.height(d);if(b=="label"){z.css("line-height",d+"px");}if(B>0){z.width(l-B);}else{z.width(l);}z.css("margin-top",m+"px");z.css("margin-left",B+"px");}n=false;}}});YIUI.reg("gridlayoutpanel",YIUI.Panel.GridLayoutPanel);YIUI.Panel.SplitPanel=YIUI.extend(YIUI.Panel,{layout:"SplitLayout",orientation:"vertical",splitSizes:null,init:function(a){this.base(a);},afterAdd:function(b){var a=this.items,c=a.length-1;if(this.orientation=="vertical"){if(!b.width){b.width="100%";}}else{if(!b.height){b.height="100%";}}},setOrientation:function(a){this.orientation=a;},onRender:function(a){this.base(a);this.el.addClass("ui-spl");this.getMetaObj().orientation&&this.setOrientation(this.getMetaObj().orientation);},install:function(){var a=this.getRenderTarget();a.children(".spl-resizer").off("mousedown").on("mousedown",null,this,resizeStart);},initDefaultValue:function(n){this.el=n.el;this.splitSizes=n.splitsizes;this.orientation=n.orientation;this.layout.container=this;var f=this,j=f.items,m,a=f.el.outerWidth(),h=f.el.outerHeight(),c=f.el.children(".spl-item"),l=f.el.children(".spl-resizer"),d=f.orientation==="vertical",k=f.splitSizes;for(var e=0,g=l.length;e<g;e++){if(d){l.eq(e).width(a);}else{l.eq(e).height(h);}}for(var e=0,g=c.length;e<g;e++){var b=c.eq(e);if(d){b.height($.getReal(k[e].size,(h-f.layout.getPlaceholderSize())));}else{b.width($.getReal(k[e].size,(a-f.layout.getPlaceholderSize())));}}for(var e=0,g=j.length;e<g;e++){m=j[e].el;if(d){m.height($.getReal("100%",c.eq(e).height()));m.width(a);}else{m.height(h);m.width($.getReal("100%",c.eq(e).width()));}}}});YIUI.reg("splitpanel",YIUI.Panel.SplitPanel);function resizeStart(b){b.preventDefault();var e=b.data.layout,f=b.data,a=$(this),g=parseInt(a.attr("region")),h=f.items[g],j=f.items[g+1],c=e.resize,d=f.orientation!=="horizontal";e.container=f;if(f.splitSizes&&(f.splitSizes[g].resizable===false||f.splitSizes[g+1].resizable===false)){return;}c.splitter=a;c.startPos=a.cssNum(!d?"left":"top",0);c.startMouse=!d?b.screenX:b.screenY;a.addClass("r-moving");$(document).off("mousemove").off("mouseup.splitter").on("mousemove",null,e,resizeMove).on("mouseup.splitter",null,e,resizeStop);}function resizeMove(b){b.preventDefault();var j=b.data,k=j.container,e=j.resize,a=e.splitter,m=parseInt(a.attr("region")),g=k.getRenderTarget().children(".spl-item"),h=$(g[m]),d=$(g[m+1]),f=k.orientation!=="horizontal",l=!f?b.screenX:b.screenY,n=l-e.startMouse,c=j.regionMinSize;if(f){if(h.height()+n<c){n=c-h.height();}else{if(d.height()-n<c){n=d.height()-c;}}}else{if(h.width()+n<c){n=c-h.width();}else{if(d.width()-n<c){n=d.width()-c;}}}e.delta=n;a.css(!f?"left":"top",e.startPos+n);}function resizeStop(c){c.preventDefault();var l=c.data,m=l.container,g=l.resize,b=g.splitter,p=parseInt(b.attr("region")),f=m.getRenderTarget(),j=f.children(".spl-item"),k=$(j[p]),e=$(j[p+1]),o=m.items[p],q=m.items[p+1],h=m.orientation!=="horizontal",d=l.regionMinSize,r=g.delta||0,a=m.getWidth(),n=m.getHeight();$(document).off("mousemove",resizeMove).off("mouseup.splitter",resizeStop);if(r!==0){if(h){k.height(k.height()+r);e.height(e.height()-r);if(o.height==-1){o.setHeight($.getReal("100%",k.height()));}else{o.setHeight($.getReal(o.height,k.height()));}if(q.height==-1){q.setHeight($.getReal("100%",e.height()));}else{q.setHeight($.getReal(q.height,e.height()));}n-=m.layout.getPlaceholderHeight();m.splitSizes[p].size=k.height();m.splitSizes[p+1].size="100%";}else{k.width(k.width()+r);e.width(e.width()-r);if(o.width==-1){o.setWidth($.getReal("100%",k.width()));}else{o.setWidth($.getReal(o.width,k.width()));}if(q.width==-1){q.setWidth($.getReal("100%",e.width()));}else{q.setWidth($.getReal(q.width,e.width()));}a-=m.layout.getPlaceholderWidth();m.splitSizes[p].size=k.width();m.splitSizes[p+1].size="100%";}if(o.hasLayout){o.doLayout(o.getWidth(),o.getHeight());}if(q.hasLayout){q.doLayout(q.getWidth(),q.getHeight());}}b.removeClass("r-moving");b.css(!h?"left":"top",0);$.destroy(g);}YIUI.Panel.TabPanel=YIUI.extend(YIUI.Panel,{layout:"TabLayout",tabTemplate:'<li><a href="#{href}"><label style="float: left;">#{title}</label></a></li>',activeTab:-1,selectedTab:null,height:"100%",tabPosition:YIUI.DirectionType.TOP,setTabPosition:function(a){this.tabPosition=a;},onRender:function(a){this.base(a);this.el.addClass("ui-tabpnl");this.getMetaObj().tabPosition&&this.setTabPosition(this.getMetaObj().tabPosition);if(this.height=="pref"){this.height="100%";}},afterAdd:function(c){if(!this.rendered){return;}var h=c.getMetaObj().title||item.caption,a=c.id||YIUI.allotId(),e="tab_"+a,j=$(this.tabTemplate.replace(/#\{href\}/g,"#"+e).replace(/#\{title\}/g,h)),f=this.getEl(),g=f.children(".ui-tabs-nav"),d=f.children(".tab-body");$("[href=#"+e+"]",j).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+e+"] label",j).addClass("ui-anchor-label");g.append(j);var b=$("<div id="+e+"></div>").appendTo(d);c.el.appendTo(b);b.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").toggleClass("aria-show").attr("role","tabpanel");j.addClass("ui-state-default ui-corner-top").attr("role","tab").toggleClass("aria-selected").attr("aria-controls",e);if(this.selectedTab){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}this.setActiveTab(c);this.layout.layout(this.getWidth(),this.getHeight());this.selectedTab=j;},reduceVisible:function(g,c){var d=c.key;var e=$("[aria-controls='tab_"+c.id+"']",this.el);if(g){e.show();}else{e.hide();if(e.attr("aria-controls")!=this.selectedTab.attr("aria-controls")){return;}var a=e.prevAll().not(":hidden").eq(0);var b=e.nextAll().not(":hidden").eq(0);var f=null;if(a.length>0){f=a;}else{if(b.length>0){f=b;}}if(!f){return;}this.setTabSel($("a",f));}},setTabSel:function(target,event){var _this=this;if(target.hasClass("ui-anchor-label")||target.hasClass("ui-tans-anchor")){var $sel_li=target.closest("li");if(_this.selectedTab&&_this.selectedTab.attr("aria-controls")!=$sel_li.attr("aria-controls")){$sel_li.toggleClass("aria-selected");}var tabID=$sel_li.attr("aria-controls");if(_this.selectedTab.attr("aria-controls")==$sel_li.attr("aria-controls")){if(event){if(event.stopPropagation){event.stopPropagation();}else{event.cancelBubble=true;}}return false;}else{var form=YIUI.FormStack.getForm(_this.ofFormID);var cxt={form:form};if(_this.itemChanged){form.eval(_this.itemChanged,cxt);}var tab=_this.get(tabID.substr(4));var active=tab.active;if(active){form.eval(active,cxt);}_this.selectedTab.toggleClass("aria-selected");$("#"+_this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}$("#"+tabID).toggleClass("aria-show");_this.setActiveTab(tabID);$("#"+tabID).show();_this.layout.layout(_this.getWidth(),_this.getHeight());_this.selectedTab=$sel_li;}},install:function(){var a=this;a.el.children("ul").click(function(b){var c=$(b.target);a.setTabSel(c,b);b.stopPropagation();return false;});},setActiveTab:function(c){var a=-1;if($.isNumeric(c)){if(c<0&&c>this.items.length-1){return;}a=c;}else{if($.isString(c)){for(var b=0;b<this.items.length;b++){if(c=="tab_"+this.items[b].getId()){a=b;break;}}}else{if($.isObject(c)){for(var b=0;b<this.items.length;b++){if(c==this.items[b]){a=b;break;}}}}}if(a!=-1){if(this.activeTab!=a){this.activeTab=a;}}},initDefaultValue:function(d){this.base(d);this.lookupComponent(d);this.selectedTab=$(".ui-tabs-nav",this.el).children().eq(0);this.setActiveTab(0);var g=this,f=$("ul",this.el),b=$(".tab-body",this.el);if(g.items&&g.items.length!=0){f=$(g.el.children()[0]);b=$(g.el.children()[1]);b.height(g.el.outerHeight()-f.outerHeight(true));var c=this.items;for(var e=0,a=c.length;e<a;e++){c[e]=g.lookupComponent(c[e]);}}}});YIUI.reg("tabpanel",YIUI.Panel.TabPanel);YIUI.Panel.TabPanelEx=YIUI.extend(YIUI.Panel.TabPanel,{listeners:{closetab:function(b){var a=$(b.target);var d=a.closest("li").attr("aria-controls");var c=a.closest("li").index()-2;if((this.activeTab==c&&this.activeTab!=0)||c<this.activeTab){this.activeTab-=1;}this.remove(this.get(d));}},afterRender:function(){this.base();var c=this.el;var b=$(".ui-tabs-nav",c);b.addClass("ui-tabs-ex");var a="<li><img alt='图片' src='Resource/file.png'><label class='ui-tabs-nav-label' style='vertical-align: middle;'>物料订单</label></li>"+"<li class='customView_li' style='float: right;'></li>";b.prepend(a);},remove:function(a,b){this.base(a,b);var c;if($(".tab-body",tabs).children().length<=0){$(".ui-tabs-nav-label",tabs).html("物料订单");}else{c=this.items[this.activeTab];$(".ui-tabs-nav-label",tabs).html(c.title);}},setActiveTab:function(a){this.base(a);if(index!=-1&&this.rendered){$(".ui-tabs-nav-label",this.el).html(a.title);}}});YIUI.reg("tabpanelex",YIUI.Panel.TabPanelEx);YIUI.TREEPANEL_CKBOXTYPE_NORMAL_SELECT={"Y":"ps","N":"ps"};YIUI.TREEPANEL_CKBOXTYPE_SINGLE_SELECT={"Y":"","N":""};YIUI.TreePanel=YIUI.extend(YIUI.Panel,{showIcon:true,showLine:true,width:null,height:null,showCheckBox:false,checkBoxType:YIUI.TREEPANEL_CKBOXTYPE_NORMAL_SELECT,dblClickExpand:true,dataSource:null,tree:null,addDiyDom:null,async:{autoParam:[],dataFilter:null,enable:false,otherParam:[],type:"post",url:""},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null},initEvert:function(){},init:function(a){this.base(a);},onRender:function(a){this.base(a);this.el.addClass("ztree");var b={check:{enable:this.showCheckBox,chkboxType:this.checkBoxType},data:{simpleData:{enable:true}},view:{showLine:this.showLine,showIcon:this.showIcon,selectedMulti:false,dblClickExpand:this.dblClickExpand,addDiyDom:this.addDiyDom},callback:this.callback,async:this.async};$.fn.zTree.init(this.el,b,this.dataSource);this.tree=$.fn.zTree.getZTreeObj(this.id);},expandNode:function(d,e,c,a,b){return this.tree.expandNode(d,e,c,a,b);},selectNode:function(b,a){this.tree.selectNode(b,a);},getNodes:function(){return this.tree.getNodes();},getCheckedNodes:function(a){return this.tree.getCheckedNodes(a);}});YIUI.reg("treepanel",YIUI.TreePanel);YIUI.Panel.TabContainer=YIUI.extend(YIUI.Panel,{layout:"tab",tabTemplate:'<li><a href="#{href}"><label style="float: left;">#{title}</label><span class="ui-icon ui-icon-close" role="presentation">Remove Tab</span></a></li>',activeTab:-1,selectedTab:null,_hasShow:false,listeners:{closetab:function(b){var a=$(b.target);var c=a.closest("li").attr("aria-controls");YIUI.EventHandler.doCloseForm(this.get(c));}},close:function(a){var b=$("[aria-controls="+a+"]").index();if((this.activeTab==b&&this.activeTab!=0)||b<this.activeTab){this.activeTab-=1;}this.remove(this.get(a));},afterAdd:function(c){if(!this.rendered){return;}var g=c.abbrCaption||"",h=c.id||YIUI.allotId(),b=$(this.tabTemplate.replace(/#\{href\}/g,"#"+h).replace(/#\{title\}/g,g)),e=this.getEl(),d=$("ul.ui-tabs-nav",e.children(".ui-tabs-header")),a=e.children(".ui-tabs-body");$("[href=#"+h+"]",b).addClass("ui-tans-anchor").attr("role","presentation");$("[href=#"+h+"] label",b).addClass("ui-anchor-label");b.data("key",this.key);d.append(b);c.el=$("<div id="+h+"></div>").appendTo(a);c.el.addClass("ui-tabs-tabcontainer ui-widget-content ui-corner-bottom").toggleClass("aria-show").attr("role","tabpanel");b.addClass("ui-state-default ui-tabcontainer").attr("role","tab").toggleClass("aria-selected").attr("aria-controls",c.id);if(this.selectedTab){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}this.setActiveTab(c);this.layout.layout(this.getWidth(),this.getHeight());this.selectedTab=b;var f=$("<li/>").attr("aria-controls",b.attr("aria-controls")).html($("label",b).text());$("ul",this._dropView).append(f);this.setDropBtnView();this.setTabListColor();},setDropViewLeft:function(){this._dropView.css({"top":this._dropBtn.offset().top+this._dropBtn.height(),"left":document.body.clientWidth-this._dropView.outerWidth()-30});},setSelectedTab:function(a){if(!this.selectedTab||this.selectedTab.attr("aria-controls")==a.attr("aria-controls")){return;}else{a.toggleClass("aria-selected");this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}var b=this.get(a.attr("aria-controls"));$("#"+b.id).toggleClass("aria-show");this.setActiveTab(b);this.layout.layout(this.getWidth(),this.getHeight());this.selectedTab=a;var c=a.position().left-$(".ui-tabs-header",this.el).width()+a.width();$(".ui-tabs-header",this.el).scrollLeft(c<0?0:c);this.setTabListColor();},setDropBtnView:function(){var a=$(".ui-tabs-header li",this.el).last();if(a.length==0||!this.selectedTab){return;}if(a.position().left+a.width()<=$(".ui-tabs-header",this.el).width()){this._dropBtn.removeClass("show");}a=this.selectedTab;if(a.position().left+a.width()>$(".ui-tabs-header",this.el).width()){if(!this._dropBtn.hasClass("show")){this._dropBtn.addClass("show");}$(".ui-tabs-header",this.el).scrollLeft(a.position().left-$(".ui-tabs-header",this.el).width()+a.width());}},setTabListColor:function(){var f=$(".ui-tabs-header",this.el).offset().left;var b=$(".ui-tabs-header li",this.el),e,c;for(var d=0,a=b.length;d<a;d++){e=b.eq(d);c=$("li[aria-controls = "+e.attr("aria-controls")+"]",this._dropView);if(e.offset().left>=f&&e.offset().left<=f+$(".ui-tabs-header",this.el).width()){c.addClass("lightColor");}else{c.removeClass("lightColor");}}},install:function(){var a=this;$(".ui-tabs-header",a.el).delegate("li","click",function(b){var c=$(b.target);if(c.hasClass("ui-icon-close")){a.fireEvent("closetab",b);}else{if(c.hasClass("ui-anchor-label")||c.hasClass("ui-tans-anchor")){a.setSelectedTab(c.closest("li"));}}b.stopPropagation();return false;});a._dropBtn.click(function(b){if(!$(this).hasClass("show")){return;}if(a._hasShow){a.hideTabList();a._dropView.removeClass("showList");return;}else{a._dropView.addClass("showList");}a.setDropViewLeft();a._dropView.slideDown("fast");a._dropView.css("z-index",$.getZindex(a._dropBtn)+1);$(document).on("mousedown",function(d){var c=$(d.target);if((c.closest(a._dropView).length==0)&&(c.closest(a._dropBtn).length==0)){a.hideTabList();a._dropView.removeClass("showList");}});a._hasShow=true;b.stopPropagation();});$("ul",a._dropView).delegate("li","click",function(d){var b=$(this).attr("aria-controls");var c=$("li[aria-controls = "+b+"]",a.el);a.setSelectedTab(c);a.hideTabList();});},hideTabList:function(){this._dropView.hide();this._hasShow=false;},remove:function(a,b){var f=a.getId();var e=a.ofFormID;a=this.base(a,b);if(!a){return;}var c=this.getEl();YIUI.FormStack.removeForm(e);$("#"+f,c).remove();$("[aria-controls="+f+"]",c).remove();$("li[aria-controls="+f+"]",this._dropView).remove();this.setDropBtnView();var d;if($(".ui-tabs-body",c).children().length<=0){this.activeTab=-1;return;}else{d=this.items[this.activeTab];}if(this.selectedTab&&this.selectedTab.attr("aria-controls")==f){d.el.toggleClass("aria-show");$("li[aria-controls = "+d.id+"]").toggleClass("aria-selected");}this.selectedTab=$("li[aria-controls = "+d.id+"]");this.layout.layout(this.getWidth(),this.getHeight());},setActiveTab:function(c){var a=-1;if($.isNumeric(c)){if(c<0&&c>this.items.length-1){return;}a=c;}else{if($.isString(c)){for(var b=0;b<this.items.length;b++){if(c==this.items[b].getId()){a=b;break;}}}else{if($.isObject(c)){for(var b=0;b<this.items.length;b++){if(c==this.items[b]){a=b;break;}}}}}if(a!=-1){if(this.activeTab!=a){this.activeTab=a;}}}});YIUI.reg("tabcontainer",YIUI.Panel.TabContainer);YIUI.Panel.TabExContainer=YIUI.extend(YIUI.Panel.TabPanelEx,{afterRender:function(){this.base();var a;switch(this.customTag){case"UserInfoPane":a=YIUI.CUSTOMVIEW.USERINFOPANE;break;default:a="";}$(a).appendTo($(".customView_li"));}});YIUI.reg("tabexcontainer",YIUI.Panel.TabExContainer);YIUI.Panel.StackContainer=YIUI.extend(YIUI.Panel,{init:function(a){this.base(a);this.formID=null;},onSetHeight:function(a){this.base(a);},afterAdd:function(a){if(this.items.length>=2){this.items.shift();}if(this.el){this.el.empty();if(!this.isReplace){this.formID&&YIUI.FormStack.removeForm(this.formID);this.isReplace=false;}}this.formID=a.ofFormID;},remove:function(a,b){this.base(a,b);this.formID&&YIUI.FormStack.removeForm(this.formID);},getActivePane:function(){return YIUI.FormStack.getForm(this.formID);},build:function(b){var a=b.getRoot();this.add(a);this.doRenderChildren();this.doLayout(this.el[0].clientWidth,this.el[0].clientHeight);b.setContainer(this);},removeForm:function(a){this.remove(a.getRoot());this.formID&&YIUI.FormStack.removeForm(this.formID);}});YIUI.reg("stackcontainer",YIUI.Panel.StackContainer);YIUI.Panel.WizardPanel=YIUI.extend(YIUI.Panel,{layout:"WizardLayout",funcMap:{},onRender:function(a){this.base(a);this.el.addClass("ui-wizard");$("<div class = 'ui-wizard-warp'></div>").appendTo(this.el);this.body=$("<div class = 'body'></div>").appendTo(this.el);},afterRender:function(){this.base();var h=this.el.children();var b=h.length;var g=$(h.get(0)).width();var f=this.el.css("padding");var a=this.el.children().css("padding");f=parseInt(f.substring(0,f.length-2));a=parseInt(a.substring(0,a.length-2));g=g+a*2;$(".ui-wizard-warp").width(g);var c=$('<div class="wizard-btn left"><span class="btn-left"></span><span class="prev">上一步</span></div>');var d=$('<div class="wizard-btn right"><span class="btn-right"></span><span class="next">下一步</span><span class="finish">完成</span></div>');var e=$('<div class="paginfo"></div>');c.appendTo($(".ui-wizard-warp"));d.appendTo($(".ui-wizard-warp"));e.appendTo($(".ui-wizard-warp"));},install:function(){var self=this;$(".ui-wizard-warp .btn-left",this.el).click(function(){$(".ui-wizard-warp .prev",self.el).click();});$(".ui-wizard-warp .btn-right",this.el).click(function(){if($(".ui-wizard-warp",self.el).hasClass("last")){$(".ui-wizard-warp .finish",self.el).click();}else{$(".ui-wizard-warp .next",self.el).click();}});$(".ui-wizard-warp .next",this.el).click(function(){if(!self.enable){return false;}var next_div=self.selectItem.next();if(next_div.length==0){return;}var key=self.selectItem.attr("key");var item=self.funcMap[key];var form=YIUI.FormStack.getForm(self.ofFormID);if(item){var check=item.check;var ret=true;if(check){ret=form.eval(check,{form:form});}if(!ret){return;}}var right=(parseInt(self.body.css("right"))||0)+self.getWidth();self.body.animate({right:right+"px"},"slow");if(item){var leave=item.leave;if(leave){form.eval(leave,{form:form});}}var next_key=next_div.attr("key");var next_item=self.funcMap[next_key];if(next_item){var next_active=next_item.active;if(next_active){form.eval(next_active,{form:form});}}var warp=$(".ui-wizard-warp",self.el);if(warp.hasClass("first")){warp.removeClass("first");}if(next_div.index()==self.items.length-1){warp.addClass("last");}self.selectItem=next_div;});$(".ui-wizard-warp .prev",this.el).click(function(){if(!self.enable){return false;}var prev_div=self.selectItem.prev();if(prev_div.length==0){return;}var key=self.selectItem.attr("key");var item=self.funcMap[key];var form=YIUI.FormStack.getForm(self.ofFormID);if(item){var leave=item.leave;if(leave){form.eval(leave,{form:form});}}var right=(parseInt(self.body.css("right"))||0)-self.getWidth();self.body.animate({right:right+"px"},"slow");var prev_key=prev_div.attr("key");var prev_item=self.funcMap[prev_key];if(prev_item){var prev_active=prev_item.active;if(prev_active){form.eval(prev_active,{form:form});}}self.selectItem=prev_div;var warp=$(".ui-wizard-warp",self.el);if(warp.hasClass("last")){warp.removeClass("last");}if(prev_div.index()==0){warp.addClass("first");}});$(".ui-wizard-warp .finish",this.el).click(function(){var finish=self.finish;if(finish){var form=YIUI.FormStack.getForm(self.ofFormID);form.eval(finish,{form:form});}});}});YIUI.reg("wizardpanel",YIUI.Panel.WizardPanel);(function(a){a.ygrid=a.ygrid||{};a.extend(a.ygrid,{defaults:{seqColText:"序号",emptyrecords:"无数据显示",recordtext:"{0} - {1}\u3000共 {2} 条",pgtext:" 跳转至：{0}页"},del:{caption:"删除",msg:"删除所选记录？",bSubmit:"删除",bCancel:"取消"},nav:{addtext:"",addtitle:"添加新记录",deltext:"",deltitle:"删除所选记录",uprowtext:"",uprowtitle:"上移数据行",downrowtext:"",downrowtitle:"下移数据行"},formatter:{integer:{thousandsSeparator:",",defaultValue:"0"},number:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,defaultValue:"0.00"},currency:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"",suffix:"",defaultValue:"0.00"}},error:{isNotTable:"表格初始化错误，初始化所用HtmlElement不是Table类型",isErrorMode:"表格所在页面的渲染模式(documentMode)低于5",model:"colNames 和 colModel 长度不等！",isSortError:"行分组情况下不允许进行排序",compDictNotDataBinding:"多选复合字典{0}不允许有数据绑定字段"},alert:{title:"提示",confirm:"确认"},cell_imgOpt:{open:"打开",show:"查看",clear:"清除"}});})(jQuery);(function($){$.ygrid=$.ygrid||{};$.extend($.ygrid,{version:"1.0.0",guid:1,uidPref:"ygd",msie:navigator.appName==="Microsoft Internet Explorer",getTextWidth:function(text,fontSize){var span=document.getElementById("__getWidth");if(span==null){span=document.createElement("span");span.id="__getWidth";document.body.appendChild(span);span.style.visibility="hidden";span.style.whiteSpace="nowrap";}span.innerText=text;span.style.fontSize=(fontSize==null?12:fontSize)+"px";return span.offsetWidth;},msiever:function(){var rv=-1;var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1);}return rv;},getCellIndex:function(cell){var c=$(cell);if(c.is("tr")){return -1;}c=(!c.is("td")&&!c.is("th")?c.closest("td,th"):c)[0];if($.ygrid.msie){return $.inArray(c,c.parentNode.cells);}return c.cellIndex;},formatString:function(format){var args=$.makeArray(arguments).slice(1);if(format==null){format="";}return format.replace(/\{(\d+)\}/g,function(m,i){return args[i];});},stripPref:function(pref,id){var obj=$.type(pref);if(obj==="string"||obj==="number"){pref=String(pref);id=pref!==""?String(id).replace(String(pref),""):id;}return id;},stripHtml:function(v){v=String(v);var regexp=/<("[^"]*"|'[^']*'|[^'">])*>/gi;if(v){v=v.replace(regexp,"");return(v&&v!=="&nbsp;"&&v!=="&#160;")?v.replace(/\"/g,"'"):"";}return v;},randId:function(prefix){return(prefix||$.ygrid.uidPref)+($.ygrid.guid++);},intNum:function(val,defval){val=parseInt(val,10);if(isNaN(val)){return defval||0;}return val;},extend:function(methods){$.extend($.fn.yGrid,methods);if(!this.no_legacy_api){$.fn.extend(methods);}}});$.fn.yGrid=function(options){if(this.grid){return;}if(typeof options==="string"){var fn=$.fn.yGrid[options];if(!fn){throw ("yGrid - No such method: "+options);}var args=$.makeArray(arguments).slice(1);return fn.apply(this,args);}return this.each(function(){var p={enable:true,width:100,height:150,rowNum:50,showPager:true,showPageSet:true,navButtons:{},scrollPage:false,colModel:[],colNames:[],data:[],editCells:[],_indexMap:{},viewRecords:true,rowSequences:true,rowSeqWidth:40,scrollTimeout:40,lastpage:1,onSelectRow:null,ondblClickRow:null,onSortClick:null,specialCellClick:null,createCellEditor:null,alwaysShowCellEditor:null,endCellEditor:null,afterEndCellEditor:null,extKeyDownEvent:null,afterCopy:null,afterPaste:null,groupHeaders:[]};for(var key in options){var value=options[key];if($.isArray(value)){p[key]=value.slice(0);}else{p[key]=value;}}options=null;var ts=this,grid={headers:[],cols:[],dragStart:function(i,x,y){var gridLeftPos=$(this.bDiv).offset().left;this.resizing={idx:i,startX:x.clientX,sOL:x.clientX-gridLeftPos};this.hDiv.style.cursor="col-resize";this.curGbox=$("#rs_m"+p.id,"#gbox_"+p.id);this.curGbox.css({display:"block",left:x.clientX-gridLeftPos,top:y[1],height:y[2]});document.onselectstart=function(){return false;};},dragMove:function(x){if(this.resizing){var diff=x.clientX-this.resizing.startX,h=this.headers[this.resizing.idx],newWidth=h.width+diff;if(newWidth>33){this.curGbox.css({left:this.resizing.sOL+diff});this.newWidth=p.tblwidth+diff;h.newWidth=newWidth;}}},dragEnd:function(){this.hDiv.style.cursor="default";if(this.resizing){var idx=this.resizing.idx,nw=this.headers[idx].newWidth||this.headers[idx].width;nw=parseInt(nw,10);this.resizing=false;this.curGbox&&this.curGbox.css({display:"none"});p.colModel[idx].width=nw;this.headers[idx].width=nw;this.headers[idx].el.style.width=nw+"px";this.cols[idx].style.width=nw+"px";p.tblwidth=this.newWidth||p.tblwidth;$("table:first",this.bDiv).css("width",p.tblwidth+"px");$("table:first",this.hDiv).css("width",p.tblwidth+"px");this.hDiv.scrollLeft=this.bDiv.scrollLeft;$(ts).triggerHandler("yGridResizeStop",[nw,idx]);}this.curGbox=null;document.onselectstart=function(){return true;};},populateVisible:function(){if(grid.timer){clearTimeout(grid.timer);}grid.timer=null;var dh=$(grid.bDiv).height();if(!dh){return;}var table=$("table:first",grid.bDiv);var rows,rh;if(table[0].rows.length){try{rows=table[0].rows[1];rh=rows?$(rows).outerHeight()||grid.prevRowHeight:grid.prevRowHeight;}catch(pv){rh=grid.prevRowHeight;}}if(!rh){return;}grid.prevRowHeight=rh;var rn=p.rowNum;var scrollTop=grid.scrollTop=grid.bDiv.scrollTop;var ttop=Math.round(table.position().top)-scrollTop;var tbot=ttop+table.height();var div=rh*rn;var page,npage,empty;if(tbot<dh&&ttop<=0&&(p.lastpage===undefined||parseInt((tbot+scrollTop+div-1)/div,10)<=p.lastpage)){npage=parseInt((dh-tbot+div-1)/div,10);if(tbot>=0||npage<2||p.scroll===true){page=Math.round((tbot+scrollTop)/div)+1;ttop=-1;}else{ttop=1;}}if(ttop>0){page=parseInt(scrollTop/div,10)+1;npage=parseInt((scrollTop+dh)/div,10)+2-page;empty=true;}if(npage){if(p.lastpage&&(page>p.lastpage||p.lastpage===1||(page===p.page&&page===p.lastpage))){return;}p.page=page;if(empty){grid.emptyRows.call(table[0],false);}grid.populate(npage);$(ts).setErrorCells();$(ts).setErrorRows();}},scrollGrid:function(e){if(p.scrollPage){var scrollTop=grid.bDiv.scrollTop;if(grid.scrollTop===undefined){grid.scrollTop=0;}if(scrollTop!==grid.scrollTop){grid.scrollTop=scrollTop;if(grid.timer){clearTimeout(grid.timer);}grid.timer=setTimeout(grid.populateVisible,p.scrollTimeout);}}grid.hDiv.scrollLeft=grid.bDiv.scrollLeft;if(e){e.stopPropagation();}}};var setColWidth=function(){var th=this;th.p.scrollOffset=18;var initwidth=0,scw=$.ygrid.intNum(th.p.scrollOffset),cw;$.each(th.p.colModel,function(index,col){if(this.hidden===undefined){this.hidden=false;}this.widthOrg=cw=$.ygrid.intNum(col.width);if(this.hidden===false){initwidth+=cw;}});if(isNaN(th.p.width)){th.p.width=initwidth+(!isNaN(th.p.height)?scw:0);}grid.width=th.p.width;th.p.tblwidth=initwidth;};var getOffset=function(iCol){var th=this,$th=$(th.grid.headers[iCol].el);var ret=[$th.position().left+$th.outerWidth()];ret[0]-=th.grid.bDiv.scrollLeft;ret.push($(th.grid.hDiv).position().top);ret.push($(th.grid.bDiv).offset().top-$(th.grid.hDiv).offset().top+$(th.grid.bDiv).height());return ret;};var getColumnHeaderIndex=function(th){var $t=this,i,headers=$t.grid.headers,ci,len=headers.length;for(i=0;i<len;i++){if(th===headers[i].el){ci=i;break;}}return ci;};ts.getCellEditOpt=function(rdata,colPos){if(rdata==undefined){return{};}var cellKey=rdata.cellKeys[colPos-(ts.p.rowSequences?1:0)],editOpt=ts.p.cellLookup[cellKey];if(editOpt==undefined){editOpt={};}return editOpt;};var formatCol=function(pos,rowInd,tv,cellval,rdata){var th=this,cm=th.p.colModel[pos],editOpt=th.getCellEditOpt(rdata,pos),ral=editOpt.align==undefined?cm.align:editOpt.align,result=["style='"],nm=cm.name;if(ral){result.push("text-align:");result.push(ral);result.push(";");}if(editOpt.backColor){result.push("background-color:");result.push(editOpt.backColor);result.push(";");}if(editOpt.foreColor){result.push("color:");result.push(editOpt.foreColor);result.push(";");}if(nm=="rn"){if(th.p.backColor){result.push("background-color:");result.push(th.p.backColor);result.push(";");}if(th.p.foreColor){result.push("color:");result.push(th.p.foreColor);result.push(";");}}if(cm.hidden===true){result.push("display:none;");}if(editOpt.edittype=="numberEditor"&&parseFloat(cellval[0])<0){result.push("color:");result.push(editOpt.editOptions.negtiveForeColor);}result.push("' class='");if(cellval!==undefined&&((cellval[2]==null&&!th.getControlGrid().isEnable())||cellval[2]===false)){result.push("ui-cell-disabled ");}if(editOpt.editOptions==null||editOpt.editOptions.edittype=="label"){result.push("ui-cell-disabled ");}var rowExpIndex=th.getControlGrid().rowExpandIndex;if((th.p.rowSequences==true?rowExpIndex+1:rowExpIndex)==pos){result.push("ui-cell-disabled ");}if(editOpt.isRequired&&(cellval==null||cellval[1]==null||cellval[1]=="")){result.push("ui-cell-required ");cellval[3]=true;}result.push("'");result.push($.fmatter.isEmpty(tv)?"":[" title='",$.ygrid.stripHtml(tv),"' "].join(""));result.push(" aria-describedby='");result.push([th.p.id,"_",nm,"'"].join(""));result=result.join("");return result;};var addCell=function(rowId,cell,pos,irow,srvr,isTreeCol){var v=cell[1];var prp=formatCol.call(ts,pos,irow,v,cell,srvr);var tcIcon="";if(isTreeCol){var pl=(srvr.treeLevel*16)+"px",icon=srvr.isExpand?"cell-expand":"cell-collapse";if(srvr.isLeaf){tcIcon=["<span class='cell-treeIcon ",ts.getControlGrid().treeExpand?" ui-state-disabled":"","' style='margin-left: ",pl,"'></span>"].join("");}else{tcIcon=["<span class='cell-treeIcon ",icon,ts.getControlGrid().treeExpand?" ui-state-disabled":"","' style='margin-left: ",pl,"'></span>"].join("");}}return['<td role="gridcell" ',prp,">",tcIcon,v,"</td>"].join("");};var addRowNum=function(pos,irow,pG,rN){var v=irow+1,prp=formatCol.call(ts,pos,irow,v);return['<td role="gridcell" class="ui-state-default ygrid-rownum" ',prp,">",v,"</td>"].join("");};var addGridRow=function(curRd,iRow,riOfData,isTemp){var rowData=[],th=this,nbIndex=th.p.rowSequences===true?1:0,asrds=[],rh="",rowId=$.ygrid.uidPref+(isTemp?-(riOfData+1):riOfData),treeColInd=-1;if(curRd.rowHeight){rh=curRd.rowHeight+"px";}rowData.push(['<tr style="height:',rh,'" role="row" id="',rowId,'" tabindex="-1" class="ui-widget-content ygrow ui-row-ltr">'].join(""));if(nbIndex){rowData.push(addRowNum(0,riOfData,th.p.page,th.p.rowNum));}for(var j=0,len=th.p.colModel.length;j<len-nbIndex;j++){var cm=th.p.colModel[j+nbIndex],cellKey=curRd.cellKeys[j],editOptions=th.p.cellLookup[cellKey];(editOptions&&editOptions.isAlwaysShow)?asrds.push(j+nbIndex):null;var v=curRd.data[cm.index],isTreeCol=(cm.name===th.p.treeColName);var cell=addCell(rowId,v,j+nbIndex,iRow,curRd,isTreeCol);if(isTreeCol){treeColInd=j+nbIndex;}rowData.push(cell);}rowData.push("</tr>");$("#"+th.p.id+" tbody:first").append(rowData.join(""));var row=th.rows[th.rows.length-1],treeCell,treeIcon,showFunc=th.p.alwaysShowCellEditor,rowHeight=(curRd.rowHeight===undefined?row.offsetHeight:curRd.rowHeight);for(var ci=0,adlen=asrds.length;ci<adlen;ci++){var iCol=asrds[ci],colM=th.p.colModel[iCol],nm=colM.name,editOpt=th.getCellEditOpt(curRd,iCol),val=curRd.data[colM.index],opt=$.extend({},editOpt.editOptions||{},{ri:riOfData,key:nm,id:iRow+"_"+nm,name:nm});if(editOpt.isAlwaysShow){if(showFunc&&$.isFunction(showFunc)){showFunc.call(th,$(row.cells[iCol]),iRow,iCol,colM,val,opt,rowHeight);}}}if(treeColInd!==-1){treeCell=row.cells[treeColInd];treeIcon=$("span.cell-treeIcon",treeCell);treeIcon.click(function(event){var grow=event.target.parentNode.parentNode,grind=parseInt($.ygrid.stripPref($.ygrid.uidPref,grow.id),10);if(th.p.treeIconClick&&$.isFunction(th.p.treeIconClick)&&!curRd.isLeaf){th.p.treeIconClick.call(th,th.p.data[grind],(grind+1));}});}return $(row);};var loadGridData=function(data,t,rcnt){if(data){if(!ts.p.scrollPage){grid.emptyRows.call(ts,false);rcnt=1;}else{rcnt=rcnt>1?rcnt:1;}}else{return;}ts.p.page=$.ygrid.intNum(data[ts.p.localReader.page],ts.p.page);ts.p.lastpage=$.ygrid.intNum(data[ts.p.localReader.total],1);ts.p.records=$.ygrid.intNum(data[ts.p.localReader.records]);ts.p.reccount=data.rows.length;for(var i=0,len=data.rows.length;i<len;i++){var ri=ts.p.data.indexOf(data.rows[i]);addGridRow.call(ts,data.rows[i],ri+rcnt,ri);}ts.refreshIndex();ts.updatePager.call(ts);};var afterRowOpt=function(ri,isDelete){var i,th=this,seq,rid,len=th.rows.length;for(i=ri;i<len;i++){if(th.p.rowSequences){seq=parseInt($(th.rows[i].cells[0]).html(),10);$(th.rows[i].cells[0]).html(seq+(isDelete?-1:+1));}rid=parseInt($.ygrid.stripPref($.ygrid.uidPref,th.rows[i].id),10);rid=rid+(isDelete?-1:+1);th.rows[i].id=$.ygrid.uidPref+rid;}ts.refreshIndex();};ts.refreshIndex=function(){ts.p._indexMap={};for(var ti=0,tlen=ts.rows.length;ti<tlen;ti++){ts.p._indexMap[$.ygrid.stripPref($.ygrid.uidPref,ts.rows[ti].id)]=ti;}};ts.deleteGridRow=function(ri){var th=this,gridRow=$(th).getGridRowById($.ygrid.uidPref+ri),rind;if(gridRow){rind=gridRow.rowIndex;th.p.data.splice(ri,1);$(gridRow).remove();afterRowOpt.call(th,rind,true);}};ts.insertGridRow=function(ri,rowData){var th=this,gridRow,lastRid=$.ygrid.stripPref($.ygrid.uidPref,th.rows[th.rows.length-1].id);var lri=isNaN(parseInt(lastRid,10))?0:parseInt(lastRid,10);th.p.data.splice(ri,0,rowData);if(ri<=lri+1){gridRow=addGridRow.call(th,rowData,ri+1,ri,true);gridRow.insertBefore($(th).getGridRowById($.ygrid.uidPref+ri));var seq,rid,nRi=gridRow[0].rowIndex+1,pRi=gridRow[0].rowIndex-1;if(th.rows[nRi]){if(th.p.rowSequences){seq=$(th.rows[nRi].cells[0]).html();$(gridRow[0].cells[0]).html(seq);}rid=th.rows[nRi].id;gridRow[0].id=rid;}else{if(th.rows[pRi]!==$("tr.ygfirstrow",th.grid.bDiv)[0]){if(th.p.rowSequences){seq=parseInt($(th.rows[pRi].cells[0]).html(),10);$(gridRow[0].cells[0]).html(seq+1);}rid=parseInt($.ygrid.stripPref($.ygrid.uidPref,th.rows[pRi].id),10);gridRow[0].id=$.ygrid.uidPref+(rid+1);}else{if(th.p.rowSequences){$(gridRow[0].cells[0]).html(1);}gridRow[0].id=$.ygrid.uidPref+0;}}afterRowOpt.call(th,gridRow[0].rowIndex+1,false);}};ts.modifyGridCell=function(ri,iCol,rowData){var th=this,cm=th.p.colModel[iCol],editOpt=th.getCellEditOpt(rowData,iCol),row=$(th).getGridRowById($.ygrid.uidPref+ri),cname=cm.name;if(row==undefined){return;}var cellV,cell=row.cells[iCol],value;if(cname=="rn"){return;}cellV=rowData.data[cm.index][1];value=rowData.data[cm.index][0];if(editOpt.isAlwaysShow){if(!rowData.isDetail){return;}$(".cellEditor",cell)[0].title=cellV;switch(editOpt.formatter){case"button":$(".cellEditor span.txt",cell).html(value);break;case"hyperlink":$(".cellEditor",cell).html(value);break;case"checkbox":$(".cellEditor input",cell)[0].checked=(value==1||value==true||value=="true");$(".cellEditor",cell)[0].title=(value==1||value==true||value=="true");break;case"image":cell.editor.setValue(value);break;}}else{$(cell).html(cellV);if(editOpt.edittype=="numberEditor"){if(value instanceof Decimal&&value.isNegative()){$(cell).css({color:editOpt.editOptions.negtiveForeColor});}else{$(cell).css({color:""});}}}};var initQueryData=function(){if(!$.isArray(ts.p.data)){return null;}var queryResults=ts.p.data,recordsperpage=parseInt(ts.p.rowNum,10),total=queryResults.length,page=parseInt(ts.p.page,10),totalpages=Math.ceil(total/recordsperpage),retresult={};queryResults=queryResults.slice((page-1)*recordsperpage,page*recordsperpage);retresult[ts.p.localReader.total]=totalpages==0?1:totalpages;retresult[ts.p.localReader.page]=page;retresult[ts.p.localReader.records]=total;retresult[ts.p.localReader.root]=queryResults;queryResults=null;return retresult;};grid.emptyRows=function(scroll){var firstrow=ts.rows.length>0?ts.rows[0]:null;$(this.firstChild).empty().append(firstrow);if(scroll&&ts.p.scrollPage){$(ts.grid.bDiv.firstChild).css({height:"auto"});$(ts.grid.bDiv.firstChild.firstChild).css({height:0,display:"none"});if(ts.grid.bDiv.scrollTop!==0){ts.grid.bDiv.scrollTop=0;}}};grid.populate=function(npage){var pvis=ts.p.scrollPage&&npage===false,lc;if(ts.p.page===undefined||ts.p.page<=0){ts.p.page=Math.min(1,ts.p.lastpage);}npage=npage||1;if(npage>1){lc=function(){if(ts.p.page==1&&ts.grid.scrollTop==0){return;}ts.p.page++;ts.grid.hDiv.loading=false;grid.populate(npage-1);};}var rcnt=!ts.p.scrollPage?1:ts.rows.length;var req=initQueryData();loadGridData(req,ts.grid.bDiv,rcnt);if(lc){lc.call(ts);}if(pvis){grid.populateVisible();}};ts.updatePager=function(){var th=this,from,to,total,base=parseInt(th.p.page,10)-1;if(base<0){base=0;}base=base*parseInt(th.p.rowNum,10);to=base+th.p.reccount;to=to>th.p.data.length?th.p.data.length:to;if(th.p.scrollPage){var rows=$("tbody:first > tr:gt(0)",th.grid.bDiv);base=to-rows.length;th.p.reccount=rows.length;var rh=rows.outerHeight()||th.grid.prevRowHeight;if(rh){var top=base*rh;var height=parseInt(th.p.records,10)*rh;$(">div:first",th.grid.bDiv).css({height:height}).children("div:first").css({height:top,display:top?"":"none"});if(th.grid.bDiv.scrollTop==0&&th.p.page>1){th.grid.bDiv.scrollTop=th.p.rowNum*(th.p.page-1)*rh;}}th.grid.bDiv.scrollLeft=th.grid.hDiv.scrollLeft;}var pgboxes=th.p.pager||"";if(pgboxes){$(["#add_",th.id,",#del_",th.id,", #upRow_",th.id,", #downRow_",th.id].join("")).each(function(){(th.p.enable&&th.p.treeType===-1&&!th.p.hasRowExpand)?$(this).removeClass("ui-state-disabled"):$(this).addClass("ui-state-disabled");});if(th.p.viewRecords){if(th.p.reccount===0){$(".ui-paging-info",pgboxes).html($.ygrid.defaults.emptyrecords);}else{from=base+1;total=th.p.records;$(".ui-paging-info",pgboxes).html($.ygrid.formatString($.ygrid.defaults.recordtext,from,to,total));}}if(th.p.showPageSet){$(".ui-pg-input",pgboxes).val(th.p.page);var cp=$.ygrid.intNum(th.p.page,1),last=$.ygrid.intNum(th.p.lastpage,1);var tspg="_"+th.p.pager.substr(1);if(cp===1){$("#first"+tspg+", #prev"+tspg).addClass("ui-state-disabled").removeClass("ui-state-hover");}else{$("#first"+tspg+", #prev"+tspg).removeClass("ui-state-disabled");}if(cp===last){$("#next"+tspg+", #last"+tspg).addClass("ui-state-disabled").removeClass("ui-state-hover");}else{$("#next"+tspg+", #last"+tspg).removeClass("ui-state-disabled");}}}};if(ts.tagName.toUpperCase()!=="TABLE"){alert($.ygrid.error.isNotTable);return;}if(document.documentMode!==undefined){if(document.documentMode<5){alert($.ygrid.error.isErrorMode);return;}}$(this).empty().attr("tabindex","0");this.p=p;this.grid=grid;this.p.useProp=!!$.fn.prop;if(this.p.colNames.length===0){for(var ci=0,len=this.p.colModel.length;ci<len;ci++){var name=this.p.colModel[ci].label||this.p.colModel[ci].name,formulaCaption=this.p.colModel[ci].formulaCaption;if(formulaCaption!=null&&formulaCaption.length>0){var form=YIUI.FormStack.getForm(this.getControlGrid().ofFormID);name=form.eval(formulaCaption,{form:form});}this.p.colNames[ci]=name;}}if(this.p.colNames.length!==this.p.colModel.length){alert($.ygrid.errors.model);return;}if(this.p.rowSequences){this.p.colNames.unshift($.ygrid.defaults.seqColText);this.p.colModel.unshift({label:$.ygrid.defaults.seqColText,name:"rn",width:ts.p.rowSeqWidth,sortable:false,resizable:true,align:"center"});}var gv=$("<div class='ui-ygrid-view'></div>");$(gv).insertBefore(this);$(this).removeClass("scroll").appendTo(gv);var eg=$("<div class='ui-ygrid ui-widget ui-widget-content'></div>");$(eg).attr({id:"gbox_"+this.id,dir:"ltr"}).insertBefore(gv);$(gv).attr("id",this.id+"_view").appendTo(eg);$(this).attr({cellspacing:"0",cellpadding:"0",border:"0","role":"grid","aria-labelledby":"gbox_"+this.id});this.p.id=this.id;ts.p.localReader=$.extend(true,{root:"rows",page:"page",total:"total",records:"records",cell:"cell",id:"id"},ts.p.localReader);if(ts.p.scrollPage){ts.p.showPageSet=false;}setColWidth.call(ts);$(eg).css("width",grid.width+"px");$(gv).css("width",grid.width+"px").before("<div class='ui-ygrid-resize-mark' id='rs_m"+ts.p.id+"'>&#160;</div>");var hTable=$(["<table class='ui-ygrid-htable' style='width:",ts.p.tblwidth,"px' role='ygrid' aria-labelledby='gbox_",this.id,"' cellspacing='0' cellpadding='0' border='0'></table>"].join("")),hb=$("<div class='ui-ygrid-hbox-ltr'></div>").append(hTable);grid.hDiv=document.createElement("div");$(grid.hDiv).addClass("ui-state-default ui-ygrid-hdiv").css({width:grid.width+"px"}).append(hb);grid.hDiv.onselectstart=function(){return false;};$(ts).before(grid.hDiv);var thead=["<thead><tr class='ui-ygrid-headers' role='rowheader'>"];var tdc=$.ygrid.msie?"class='ui-th-div-ie'":"";var imgs=["<span class='s-ico' style='position: absolute;top:0;right:0;display:none;'>","<span class='ui-ygrid-ico-sort ui-icon-asc ui-state-disabled ui-icon ui-sort-ltr'/>","<span class='ui-ygrid-ico-sort ui-icon-desc ui-state-disabled ui-icon ui-sort-ltr'/>","</span>"].join("");for(var i=0,clen=ts.p.colNames.length;i<clen;i++){var tooltip=[' title="',ts.p.colNames[i],'"'].join(""),cm=ts.p.colModel[i],cname=cm.name;thead.push("<th id='");thead.push([ts.p.id,"_",cname].join(""));thead.push("' role='columnheader' class='ui-state-default ui-th-column ui-th-ltr'");thead.push(tooltip);thead.push(">");thead.push("<div id='");thead.push([$.ygrid.uidPref,"_",ts.p.id,"_",cname].join(""));thead.push("' ");thead.push(tdc);thead.push("><span style='overflow: hidden;position: absolute;left: 0;width: 100%;' class='colCaption'>");var colIndex=(i+(ts.p.rowSequences?-1:0));if(ts.p.selectFieldIndex!=-1&&ts.p.selectFieldIndex==colIndex){var margin=(ts.p.colNames[i]==""?"":"margin-bottom: 3px;margin-right: 3px;");thead.push("<Input type='checkbox' style='");thead.push(margin);thead.push(["vertical-align: middle' ofColIndex=",i,ts.p.enable?"":" disabled='disabled'",">"].join(""));thead.push(ts.p.colNames[i]);thead.push(" </span>");}else{thead.push(ts.p.colNames[i]);thead.push("</span>");}if(!cm.width){cm.width=150;}else{cm.width=parseInt(cm.width,10);}thead.push(imgs);thead.push("</div></th>");}thead.push("</tr></thead>");imgs=null;hTable.append(thead.join(""));$("input",hTable).click(function(e){var ci=parseInt($(this).attr("ofColIndex"),10)-(ts.p.rowSequences?1:0),newValue=this.checked;ts.getControlGrid().gridHandler.doAllChecked(ts.getControlGrid(),ci,newValue);e.stopPropagation();});$(ts).reShowCheckColumn();thead=$("thead:first",grid.hDiv).get(0);var thr=$("tr:first",thead),w,res,sort,cModel;var firstRow=["<tr class='ygfirstrow' role='row' style='height:auto'>"];$("th",thr).each(function(j){cModel=ts.p.colModel[j];w=cModel.width;if(cModel.resizable===undefined){cModel.resizable=true;}if(cModel.resizable){res=document.createElement("span");$(res).html("&#160;").addClass("ui-ygrid-resize ui-ygrid-resize-ltr").css("cursor","col-resize");}else{res="";}$(this).css("width",w+"px").prepend(res);res=null;var hdcol="";if(cModel.hidden){$(this).css("display","none");hdcol="display:none;";}firstRow.push("<td role='gridcell' style='height:0px;width:");firstRow.push(w+"px;");firstRow.push(hdcol);firstRow.push("'></td>");grid.headers[j]={width:w,el:this};if(typeof cModel.sortable!=="boolean"){cModel.sortable=true;}$(">div",this).addClass("ui-ygrid-sortable");}).mousedown(function(e){if($(e.target).closest("th>span.ui-ygrid-resize").length==1){var ci=getColumnHeaderIndex.call(ts,this);grid.dragStart(ci,e,getOffset.call(ts,ci));}}).click(function(e){var ci=getColumnHeaderIndex.call(ts,this);var sort=ts.p.colModel[ci].sortable;if(!ts.p.lastsort){ts.p.sortorder="asc";}else{if(ts.p.lastsort===ci){ts.p.sortorder=(ts.p.sortorder=="asc"?"desc":"asc");}else{var previousSelectedTh=ts.grid.headers[ts.p.lastsort].el;$("div span.s-ico",previousSelectedTh).hide();$("div span.colCaption",previousSelectedTh).css({width:"100%"});$("span.ui-ygrid-ico-sort",previousSelectedTh).addClass("ui-state-disabled");ts.p.sortorder="asc";}}if(sort){$("div span.s-ico",this).show();var width=this.clientWidth-$("div span.s-ico",this)[0].clientWidth;$("div span.colCaption",this).css({width:width+"px"});$("span.ui-ygrid-ico-sort",this).addClass("ui-state-disabled");$("div span.ui-icon-"+ts.p.sortorder,this).removeClass("ui-state-disabled");if($.isFunction(ts.p.onSortClick)){ts.p.onSortClick.call(ts,getColumnHeaderIndex.call(ts,this),ts.p.sortorder=="asc"?"desc":"asc");}else{}ts.p.lastsort=ci;}else{ts.p.lastsort=null;}}).dblclick(function(e){var ci=getColumnHeaderIndex.call(ts,this),headTh=ts.grid.headers[ci].el;var oldWidth=headTh.offsetWidth,width=$.ygrid.getTextWidth(headTh.title);if($("input",headTh).length>0){width+=14;}$(".ygrow",ts.grid.bDiv).each(function(){var td=$("td",this)[ci],tdWidth=$.ygrid.getTextWidth(td.title);if(tdWidth>width){width=tdWidth;}});width+=5;grid.newWidth=p.tblwidth+(width-oldWidth);grid.resizing={idx:ci};grid.headers[ci].newWidth=width;grid.dragEnd();});firstRow.push("</tr>");var tbody=document.createElement("tbody");this.appendChild(tbody);$(this).addClass("ui-ygrid-btable").append(firstRow.join(""));firstRow=null;if($.ygrid.msie){if(String(ts.p.height).toLowerCase()==="auto"){ts.p.height="100%";}}grid.bDiv=document.createElement("div");var height=ts.p.height+(isNaN(ts.p.height)?"":"px");$(grid.bDiv).addClass("ui-ygrid-bdiv").css({height:height,width:grid.width+"px"}).append($('<div style="position:relative;'+($.ygrid.msie&&$.ygrid.msiever()<8?"height:0.01%;":"")+'"></div>').append("<div></div>").append(this)).scroll(grid.scrollGrid);$("table:first",grid.bDiv).css({width:ts.p.tblwidth+"px"});if(!$.support.tbody){if($("tbody",this).length===2){$("tbody:gt(0)",this).remove();}}$(grid.hDiv).after(grid.bDiv);$(gv).mousemove(function(e){if(grid.resizing){grid.dragMove(e);}});$(".ui-ygrid-labels",grid.hDiv).bind("selectstart",function(){return false;});$(document).bind("mouseup.yGrid"+ts.p.id,function(){if(grid.resizing){grid.dragEnd();return false;}return true;});if(ts.p.populate){grid.populate();}this.grid.cols=this.rows[0].cells;grid.clearSelectCells=function(){if(ts.p.selectCells){for(var i=0,len=ts.p.selectCells.length;i<len;i++){$(ts.p.selectCells[i]).removeClass("ui-state-highlight").removeClass("ui-cell-multiselect");}}ts.p.selectCells=[];};$(grid.bDiv).mousemove(function(e){if(ts.selecting&&e.target.tagName==="TD"){var fc=ts.p.selectCells[0],lc=e.target;if(fc==null){return;}var bri=Math.min(fc.parentElement.rowIndex,lc.parentElement.rowIndex),eri=Math.max(fc.parentElement.rowIndex,lc.parentElement.rowIndex),bci=Math.min(fc.cellIndex,lc.cellIndex),eci=Math.max(fc.cellIndex,lc.cellIndex);grid.clearSelectCells();ts.p.selectCells.push(fc);$(fc).addClass("ui-state-highlight");if(e.target==fc){return;}ts.p.selectRow=fc.parentElement.id;ts.p.selectCell=fc.cellIndex;for(var ri=bri;ri<=eri;ri++){var row=ts.rows[ri];if(!row){continue;}for(var ci=bci;ci<=eci;ci++){var cell=row.cells[ci];if($.inArray(ts.p.selectCells,cell)===-1&&cell!==fc){$(cell).addClass("ui-cell-multiselect");ts.p.selectCells.push(cell);}}}}});$(ts).mousedown(function(e){if(e.target.tagName==="TD"){document.onselectstart=function(){return false;};var td=e.target;var ptr=$(td,ts.rows).closest("tr.ygrow");$("td.ui-state-highlight",ts.grid.bDiv).removeClass("ui-state-highlight");grid.clearSelectCells();ts.p.selectCells.push(e.target);$(e.target).addClass("ui-state-highlight");ts.selecting=true;}}).mouseup(function(e){if(e.target.tagName==="TD"){document.onselectstart=function(){return true;};}ts.selecting=false;if(e.target.tagName==="INPUT"){return;}window.setTimeout(function(){if(ts.grid){var scrollLeft=ts.grid.bDiv.scrollLeft,scrollTop=ts.grid.bDiv.scrollTop;$("#"+ts.p.knv).attr("tabindex","-1").focus();ts.grid.bDiv.scrollTop=scrollTop;ts.grid.bDiv.scrollLeft=scrollLeft;}},0);}).click(function(e){var td=e.target;var ptr=$(td,ts.rows).closest("tr.ygrow");if($(ptr).length===0||ptr[0].className.indexOf("ui-state-disabled")>-1){return;}var ri=ptr[0].id,ci=$.ygrid.getCellIndex(td);if(td.tagName!=="TD"){return;}if(ts.p.selectRow!=ri||ts.p.selectCell!=ci){if(ts.p.selectRow){var preSelRow=$(ts).yGrid("getGridRowById",ts.p.selectRow);preSelRow&&$(preSelRow.cells[ts.p.selectCell]).removeClass("ui-state-highlight");}if(ts.p.editCells.length>0){$(ts).yGrid("saveCell",ts.p.editCells[0].ir,ts.p.editCells[0].ic);}if($.isFunction(ts.p.onSelectRow)){!td.notOnSelectRow&&ts.p.onSelectRow.call(ts,ptr[0].rowIndex,ri);ts.p.selectRow=ri;ts.p.selectCell=ci;window.setTimeout(function(){if(ts.p==null||ts.grid==null){return;}var scrollLeft=ts.grid.bDiv.scrollLeft,scrollTop=ts.grid.bDiv.scrollTop,knv=$("#"+ts.p.knv);knv.css({left:e.clientX+"px",top:e.clientY+"px"});knv.attr("tabindex","-1").focus();ts.grid.bDiv.scrollTop=scrollTop;ts.grid.bDiv.scrollLeft=scrollLeft;},0);}var cr=$(ts).yGrid("getGridRowById",ri);cr&&$(cr.cells[ci]).addClass("ui-state-highlight");}else{$(ts).yGrid("editCell",ptr[0].rowIndex,ci,true,e);}}).dblclick(function(e){var td=e.target;if($.ygrid.msie){$(td).click();}var ptr=$(td,ts.rows).closest("tr.ygrow");if($(ptr).length===0){return;}var ri=ptr[0].rowIndex;if($.isFunction(ts.p.ondblClickRow)){ts.p.ondblClickRow.call(ts,ri);}}).bind("reloadGrid",function(e,opts){var $rowHeader=$("tr.ui-ygrid-headers",ts.grid.hDiv);var firstRow=$("tr.ygfirstrow",grid.bDiv);if(ts.p.colModel.isChange){ts.p.colModel.isChange=false;$(ts.grid.headers).each(function(iCol){var th=this.el;if(ts.p.colModel[iCol].hidden){$(th).css("display","none");firstRow.find("td").eq(iCol).css("display","none");}else{$(th).css("display","");firstRow.find("td").eq(iCol).css("display","");}});if(ts.p.groupHeaders.length>0){for(var i=0,len=ts.grid.headers.length;i<len;i++){var header=ts.grid.headers[i].el,cells=$rowHeader[0].cells;$("div",header).attr("style","");if($.inArray(cells,header)==-1){$rowHeader.append(header);}else{header.after(ts.grid.headers[i-1].el);}}$(ts.grid.hDiv).find("tr.ui-ygrid-columnheader").remove();$(ts).initGroupHeaders(ts.p.groupHeaders);}}if(opts&&opts.page){var page=opts.page;if(page>ts.p.lastpage){page=ts.p.lastpage;}if(page<1){page=1;}ts.p.page=page;if(ts.grid.prevRowHeight){ts.grid.bDiv.scrollTop=(page-1)*ts.grid.prevRowHeight*ts.p.rowNum;}else{ts.grid.bDiv.scrollTop=0;}}if(ts.grid.prevRowHeight&&ts.p.scrollPage){delete ts.p.lastpage;ts.grid.populateVisible();}else{ts.grid.populate();}});if(this.p.showPager){var op=$.extend(this.p.navButtons,$.ygrid.nav);var pager=$("<div id='"+this.p.id+"_pager'></div>");var onHoverIn=function(){if(!$(this).hasClass("ui-state-disabled")){$(this).addClass("ui-state-hover");}},onHoverOut=function(){$(this).removeClass("ui-state-hover");};ts.p.pager="#"+pager[0].id;pager.css({width:grid.width+"px"}).addClass("ui-state-default ui-ygrid-pager").attr("dir","ltr").appendTo(eg);pager.append(["<div id='pg_",pager[0].id,"' class='ui-pager-control' role='group' style='height:100%'>","<table cellpadding='0' border='0' class='ui-pg-table' style='width:100%;height:100%;' role='row'>","<tbody><tr><td id='",pager[0].id,"_left' align='left' style='width:300px'></td>","<td id='",pager[0].id,"_center' align='center' style='white-space:pre;'></td>","<td id='",pager[0].id,"_right' align='right' style='width:300px'></td>","</tr></tbody></table></div>"].join(""));var tbd,navBTtbl=$("<table cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),sep="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>";if(op.add){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.addIcon,"'></span>",op.addtext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.addtitle||"",id:"add_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.addFunc)){op.addFunc.call(ts,"add");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.del){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.delIcon,"'></span>",op.deltext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.deltitle||"",id:"del_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.delFunc)){op.delFunc.call(ts,"del");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.upRow){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.upRowIcon,"'></span>",op.uprowtext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.uprowtitle||"",id:"upRow_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.upRowFunc)){op.upRowFunc.call(ts,"upRow");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.downRow){tbd=$("<td class='ui-pg-button ui-corner-all'></td>");$(tbd).append(["<div class='ui-pg-div'><span class='ui-icon ",op.downRowIcon,"'></span>",op.downrowtext,"</div>"].join(""));$("tr",navBTtbl).append(tbd);$(tbd,navBTtbl).attr({"title":op.downrowtitle||"",id:"downRow_"+ts.p.id}).click(function(){if(!$(this).hasClass("ui-state-disabled")){if($.isFunction(op.downRowFunc)){op.downRowFunc.call(ts,"downRow");}else{}}return false;}).hover(onHoverIn,onHoverOut);tbd=null;}if(op.add||op.del||op.upRow||op.downRow){$("tr",navBTtbl).append(sep);}$(ts.p.pager+"_left",ts.p.pager).append(navBTtbl);tbd=null;navBTtbl=null;if(ts.p.showPageSet){var pgcnt="pg_"+pager[0].id;var pgl=["<table cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>"];var po=["first_"+pager[0].id,"prev_"+pager[0].id,"next_"+pager[0].id,"last_"+pager[0].id];var pagination="<td><div id='pagination_"+pager[0].id+"' class='ui-pagination'><ul></ul></div></td>";pgl.push("<td id='");pgl.push(po[0]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-first'></span></td>");pgl.push("<td id='");pgl.push(po[1]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-prev'></span></td>");pgl.push(pagination);pgl.push("<td id='");pgl.push(po[2]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-next'></span></td>");pgl.push("<td id='");pgl.push(po[3]);pgl.push("' class='ui-pg-button'><span class='ui-icon ui-icon-seek-end'></span></td>");pgl.push("</tr></tbody></table>");$(ts.p.pager+"_center",ts.p.pager).append(pgl.join(""));var tp="_"+ts.p.pager.substr(1);$("#first"+tp+", #prev"+tp+", #next"+tp+", #last"+tp).click(function(){if($(this).hasClass("ui-state-disabled")){return false;}var cp=$.ygrid.intNum(ts.p.page,1),last=$.ygrid.intNum(ts.p.lastpage,1),selclick=false,fp=true,pp=true,np=true,lp=true,el=this;if(last===1){fp=false;pp=false;np=false;lp=false;}else{if(last>1&&cp>=1){if(cp===1){fp=false;pp=false;}else{if(cp===last){np=false;lp=false;}}}}if(el.id==="first"+tp&&fp){ts.p.page=1;selclick=true;}if(el.id==="prev"+tp&&pp){ts.p.page=(cp-1);selclick=true;}if(el.id==="next"+tp&&np){ts.p.page=(cp+1);selclick=true;}if(el.id==="last"+tp&&lp){ts.p.page=last;selclick=true;}if(selclick){grid.populate();}return false;});$("input.ui-pg-input","#"+pgcnt).keypress(function(e){var key=e.charCode||e.keyCode||0;if(key===13){$(this).val($.ygrid.intNum($(this).val(),1));ts.p.page=($(this).val()>0)?$(this).val():ts.p.page;if(ts.p.page>ts.p.lastpage){ts.p.page=ts.p.lastpage;}grid.populate();return false;}else{if(key>=48&&key<=57){return this;}}return false;});}if(ts.p.viewRecords===true){$(ts.p.pager+"_right",ts.p.pager).append("<div style='text-align:right' class='ui-paging-info'></div>");}ts.updatePager.call(ts);$(ts).bindKeys();}});};})(jQuery);(function(a){a.ygrid.extend({getGridParam:function(b){var c=this[0];if(!c||!c.grid){return null;}if(!b){return c.p;}return c.p[b]!==undefined?c.p[b]:null;},reShowCheckColumn:function(){return this.each(function(){var f=this,e=a(f.grid.hDiv).find(".ui-ygrid-htable"),d;for(var c=0,b=this.p.data.length;c<b;c++){d=this.p.data[c];if(d.isDetail&&d.bookmark!=undefined){break;}}a("input",e).each(function(){if(d==undefined){return;}var g=d.data[parseInt(a(this).attr("ofColIndex"),10)-(f.p.rowSequences?1:0)];if(g[2]){a(this).removeAttr("disabled");}else{if(g[2]==undefined&&f.p.enable){a(this).removeAttr("disabled");}else{a(this).attr("disabled","disabled");}}});});},setGridParam:function(b){return this.each(function(){if(this.grid&&typeof b==="object"){for(var c in b){var d=b[c];if(a.isArray(d)){this.p[c]=d.slice(0);}else{this.p[c]=d;}}}});},refreshData:function(){return this.each(function(){var e=this,d=e.grid.bDiv.scrollTop,c=e.grid.bDiv.scrollLeft;if(!e.grid){return;}var b=a("#"+e.p.id+" tbody:first tr:first")[0];a("#"+e.p.id+" tbody:first").empty().append(b);e.updatePager.call(e);e.grid.populate();a(e).setErrorCells();a(e).setErrorRows();e.grid.bDiv.scrollTop=d;e.grid.bDiv.scrollLeft=c;});},clearGridData:function(){return this.each(function(){var c=this;if(!c.grid){return;}var b=a("#"+c.p.id+" tbody:first tr:first")[0];a("#"+c.p.id+" tbody:first").empty().append(b);c.p.selectRow=null;c.p.selectCell=null;c.p.editCells=[];c.p.records=0;c.p.page=1;c.p.lastpage=1;c.p.reccount=0;c.p.data=[];c.updatePager.call(c);});},bindKeys:function(){return this.each(function(){var c=function(g,f,e){var h,d=g.length;if(e==="next"){for(h=f+1;h<d;h++){if(g[h].hidden!==true){return h;}}}else{if(e==="pre"){for(h=f-1;h>=0;h--){if(g[h].hidden!==true){return h;}}}}return -1;};this.p.knv=this.p.id+"_kn";var b=a("#"+this.p.knv);if(b.length==0){b=a(["<div tabindex='-1' style='left:-1px;width:1px;height:0px;' id='",this.p.knv,"'></div>"].join("")).insertBefore(a(this.grid.bDiv).parents(".ui-ygrid-view")[0]);}b.focus().keydown(function(u,e){if(e!=null&&e.isPropagationStopped()){return;}var j=a(".ui-ygrid-btable",u.target.nextSibling)[0],o=j.p.colModel;j.keyEvent=true;var m=u.charCode||u.keyCode||0;if(m==0&&e!==undefined){m=e.charCode||e.keyCode||0;}var r=j.p.selectRow,n=j.p.selectCell,f,k;if(a(j).getGridRowById(r)==undefined){k=false;}else{if(m===13||m===108||m===9){r=a(j).getGridRowById(r).rowIndex;n=c(o,n,"next");if(n==-1){n=j.p.rowSequences?1:0;r=r+1;}if(r==j.rows.length){var l=a(j).yGrid("getGridRowById",j.p.selectRow);l&&a(l.cells[j.p.selectCell]).removeClass("ui-state-highlight");if(j.p.editCells.length>0){a(j).yGrid("saveCell",j.p.editCells[0].ir,j.p.editCells[0].ic);}j.getControlGrid().requestNextFocus();}k=true;}else{if(m===38){r=a(j).getGridRowById(r).rowIndex-1;if(r<0){return;}k=true;}else{if(m===40){r=a(j).getGridRowById(r).rowIndex+1;if(r>=j.rows.length){return;}k=true;}else{if(m===37){r=a(j).getGridRowById(r).rowIndex;n=c(o,n,"pre");if(n<(j.p.rowSequences?1:0)){return;}k=true;}else{if(m===39){r=a(j).getGridRowById(r).rowIndex;n=c(o,n,"next");if(n===-1||n>=o.length){return;}k=true;}}}}}}if(k&&j.p.selectRow&&j.p.selectCell){j.grid.clearSelectCells();a(a(j).getGridRowById(j.p.selectRow).cells[j.p.selectCell]).find(".celleditor").blur();f=j.rows[r];if(f){f.cells[n].click();a(j).scrollVisibleCell(r,n);}u.preventDefault();u.stopPropagation();}if(j.p.extKeyDownEvent&&a.isFunction(j.p.extKeyDownEvent)&&!u.ctrlKey){j.p.extKeyDownEvent.call(j,u);}j.keyEvent=false;if(u.ctrlKey){var w=a("#copyText"+j.p.id),s=j.grid.bDiv.scrollTop,h=j.grid.bDiv.scrollLeft;if(!w[0]){w=a("<textarea id='copyText"+j.p.id+"'></textarea>").appendTo(a(document.body));w.css({position:"fixed",top:"-10000px",left:h+"px",width:"1000px",height:"200px"});}var x=[],q=-1,g=(j.p.selectCells==undefined?0:j.p.selectCells.length);for(var v=0;v<g;v++){var d=j.p.selectCells[v],p=a.ygrid.stripHtml(a(d).html());r=d.parentElement.rowIndex-1;var t="";if(parseInt(q,10)>=0){if(r>q){t="\n";q=r;}}else{q=r;}if(t.length>0){x.pop();}x.push(t);x.push(p);x.push("\t");}x.pop();w.val(x.join(""));w.focus();w.select();w.keyup(function(y){var z=y.charCode||y.keyCode||0;j.grid.bDiv.scrollTop=s;j.grid.bDiv.scrollLeft=h;if(y.ctrlKey&&z==86&&j.p.enable){w.blur();if(j.p.afterPaste&&a.isFunction(j.p.afterPaste)){j.p.afterPaste.call(j,a("#copyText"+j.p.id).val());}}else{if(y.ctrlKey&&z==67){if(j.p.afterCopy&&a.isFunction(j.p.afterCopy)){j.p.afterCopy.call(j,a("#copyText"+j.p.id).val());}}}w.remove();window.setTimeout(function(){var A=j.grid.bDiv.scrollTop;a("#"+j.p.knv).attr("tabindex","-1").focus();j.grid.bDiv.scrollTop=A;},0);});j.grid.bDiv.scrollTop=s;j.grid.bDiv.scrollLeft=h;}});});},setGridWidth:function(b){return this.each(function(){if(!this.grid){return;}var c=this;if(isNaN(b)){return;}b=parseInt(b,10);c.grid.width=c.p.width=b;a("#gbox_"+c.p.id).css("width",b+"px");a(c.p.id+"_view").css("width",b+"px");a(c.grid.bDiv).css("width",(b-5)+"px");a(c.grid.hDiv).css("width",(b-5)+"px");if(c.p.showPager){a(c.p.pager).css("width",b+"px");}});},setGridHeight:function(b){return this.each(function(){var h=this;if(!h.grid){return;}var f=a(h.grid.hDiv).height();if(f===0){var d=a("tr.ui-ygrid-headers",h.grid.hDiv);var e=a("tr.ui-ygrid-columnheader",h.grid.hDiv).length+d.length;var c=a("th",d).height();f=(c+2)*e;}b=b-f-a(h.p.pager).height()-2;var g=a(h.grid.bDiv);g.css({height:(b)+(isNaN(b)?"":"px")});h.p.height=b;if(h.p.scroll){h.grid.populateVisible();}});},initGroupHeaders:function(b){return this.each(function(){var d=this,g=b.length;d.p.groupHeaders=[];if(g>0){for(var e=0;e<g;e++){var f=b[e];a(d).setGroupHeaders(f);d.p.groupHeaders.push(f);}}var n=a("tr.ui-ygrid-columnheader",d.grid.hDiv);for(var j=n.length-1;j>=0;j--){var m=n[j];for(var o=0,l=0,h=m.cells.length;o<h;o++){var k=a(m.cells[o]),c=a(d.grid.headers[l].el);if(k[0].colSpan>1){l+=k[0].colSpan;}else{if(k[0].style.display!=="none"){c[0].rowSpan+=1;c.insertBefore(k);a("div",c).css({height:c.height()+"px",lineHeight:c.height()+"px"});k.remove();}l++;}}}});},setGroupHeaders:function(b){return this.each(function(){var o=function(B,z){var A=z.length;for(var j=0;j<A;j++){if(z[j].startColumnName===B){return j;}}return -1;};var c=this,l=b,n=a("tr.ui-ygrid-headers",c.grid.hDiv),s=a("<tr class='ui-ygrid-columnheader' role='columnheader'></tr>").insertBefore(n),h=a(c.grid.hDiv).find("tr.yg-first-row-header");if(h[0]===undefined){h=a("<tr>",{role:"row","aria-hidden":"true"}).addClass("yg-first-row-header").css("height","auto");}else{h.empty();}for(var u=0,w=c.p.colModel.length;u<w;u++){var e={height:0,width:c.grid.headers[u].width+"px",display:(c.p.colModel[u].hidden?"none":"")};a("<th>",{role:"gridcell"}).css(e).addClass("ui-first-th-ltr").appendTo(h);}var k,g,t,d,f;for(var v=0,p=c.p.colModel.length;v<p;v++){g=o(c.p.colModel[v].name,l);if(g>=0){k=l[g];var y=0,q=0,r=k.numberOfColumns,x=c.p.colModel.length;for(t=0,d=0;d<r&&(v+d<x);d++){if(!c.p.colModel[v+d].hidden){t++;y+=c.grid.headers[v+d].width+1;}else{q++;}}f=a('<th class="ui-state-default ui-th-column ui-th-ltr" role="columnheader"></th>').html(k.titleText).appendTo(s);if(t>0){f.attr("colspan",String(t));f.css({width:y+"px"});f.attr("title",f.text());}if(t===0){f.hide();f.attr("colspan",String(q));}v+=t-1+q;}else{var m=a('<th class="ui-state-default ui-th-column ui-th-ltr" role="columnheader"></th>').appendTo(s);if(c.p.colModel[v].hidden){m.hide();}}}a(c.grid.hDiv).find(".ui-ygrid-htable").children("thead").prepend(h);a(c).bind("yGridResizeStop.setGroupHeaders",function(A,z,j){h.find("th").eq(j).width(z-1);});});},getGridRowById:function(b){var c;this.each(function(){try{var d=this.rows.length;while(d--){if(b.toString()===this.rows[d].id){c=this.rows[d];break;}}}catch(f){c=a(this.grid.bDiv).find("#"+b);}});return c;},getGridRowAt:function(c){var b;this.each(function(){var d=this;b=d.rows[c];});return b;},getGridCellAt:function(d,c){var b;this.each(function(){var e=this;var f=e.rows[d];if(f){b=f.cells[c];}});return b;},setCellRequired:function(d,b,c){this.each(function(){var f=this.rows[d],e;if(f){e=f.cells[b];}if(e==null){return;}if(c){a(e).addClass("ui-cell-required");}else{a(e).removeClass("ui-cell-required");}});},setCellFocus:function(c,b){this.each(function(){var d=a(this).getGridCellAt(c,b);d&&a(d).click();});},setErrorCells:function(b){return this.each(function(){var c=this;if(c.p.errorCells){for(var g=0,j=c.p.errorCells.length;g<j;g++){var h=c.p.errorCells[g].cell;if(h){h.find("div").remove();h.removeAttr("position");h.attr({title:h.html()});}}}var f=b||c.p.errorCells;c.p.errorCells=[];if(f==undefined||f.length==0){return;}var n,m,l,d;for(var e=0,k=f.length;e<k;e++){n=f[e];m=a.ygrid.uidPref+n.rowIndex;l=a(c).getGridRowById(m);if(l){d=a(l.cells[n.colIndex+(c.p.rowSequences?1:0)]);d.attr({title:n.errorMsg}).css({position:"relative"});a("<div></div>").addClass("ui-cell-error").appendTo(d);n.cell=d;}c.p.errorCells.push(n);}});},setErrorRows:function(b){return this.each(function(){var c=this;if(c.p.errorRows){for(var f=0,g=c.p.errorRows.length;f<g;f++){var l=c.p.errorRows[f].row;if(l){a(l.cells[0]).find("div").remove();a(l.cells[0]).removeAttr("position");}}}var h=b||c.p.errorRows;if(h==undefined||h.length==0){return;}var j,m,k;c.p.errorRows=[];for(var e=0,d=h.length;e<d;e++){j=h[e];m=a.ygrid.uidPref+j.rowIndex;k=a(c).getGridRowById(m);if(k){a(k.cells[0]).attr({title:j.errorMsg}).css({position:"relative"});a("<div></div>").addClass("ui-cell-error").appendTo(a(k.cells[0]));j.row=k;}c.p.errorRows.push(j);}});},editCell:function(e,c,b,d){return this.each(function(){var j=this;if(!j.grid){return;}c=parseInt(c,10);j.p.selectRow=j.rows[e].id;if(j.p.editCells.length>0){if(b===true){if(e==j.p.iRow&&c==j.p.iCol){return;}}a(j).yGrid("saveCell",j.p.editCells[0].ir,j.p.editCells[0].ic);}var n=j.p.colModel[c],l=a.ygrid.stripPref(a.ygrid.uidPref,j.rows[e].id),p=j.p.data[l],g=j.getCellEditOpt(p,c),m=g.formatter;var q=n.name;if(q==="rn"||m==undefined||m=="button"||m=="hyperlink"||m=="checkbox"||m=="image"){return;}var o=a("td:eq("+c+")",j.rows[e]),k=p.data[n.index][2];if(k===undefined||k===null){k=n.editable;}if(k===undefined||k===null){k=j.p.enable;}var h=(p.isEditable===undefined?true:p.isEditable);if(k===true&&b===true&&h&&!o.hasClass("not-editable-cell")){if(parseInt(j.p.iCol,10)>=0&&parseInt(j.p.iRow,10)>=0){a("td:eq("+j.p.iCol+")",j.rows[j.p.iRow]).removeClass("edit-cell ui-state-highlight");a(j.rows[j.p.iRow]).removeClass("selected-row ui-state-hover");}a(o).addClass("edit-cell ui-state-highlight");a(j.rows[e]).addClass("selected-row ui-state-hover");if(!g.edittype){g.edittype="label";}j.p.editCells.push({ir:e,ic:c,name:q,v:p.data[n.index],cell:o});var f=a.extend({},g.editOptions||{},{event:d,key:g.key,id:e+"_"+q,name:q});if(g.customedit&&j.p.createCellEditor&&a.isFunction(j.p.createCellEditor)){j.p.createCellEditor.call(j,o,g.edittype,e,c,f);}}j.p.iCol=c;j.p.iRow=e;});},saveCell:function(c,b){return this.each(function(){var h=this,m;if(!h.grid){return;}if(h.p.editCells.length>=1){m=0;}else{m=null;}if(m!==null){var d=a("td:eq("+b+")",h.rows[c]),q,o=a.ygrid.stripPref(a.ygrid.uidPref,h.rows[c].id),e=h.getCellEditOpt(h.p.data[o],b),r=false;if(e.customedit&&h.p.endCellEditor&&a.isFunction(h.p.endCellEditor)){q=h.p.endCellEditor.call(h,d,e.edittype,c,b);}var j=(q==undefined?"":q[0]);var p=h.p.editCells[m].v===undefined?"":h.p.editCells[m].v[0];var g=function(t){var s=false;if(t==undefined||t==null||t.length==0){s=true;}return s;};var n=function(y,x){if(y==null&&x!==null){return false;}else{if(y!==null&&x==null){return false;}else{if(y==null&&x==null){return true;}else{if(y instanceof Decimal&&x instanceof Decimal){return y.equals(x);}}}}switch(e.edittype){case"dict":if(e.editOptions.multiSelect){if(y.length!=x.length){return false;}else{for(var u=0,s=y.length;u<s;u++){var v=false;for(var t=0,w=x.length;t<w;t++){if(y[u].oid==x[t].oid){v=true;break;}}if(!v){return false;}}return true;}}return y.oid==x.oid;}return y==x;};if((g(j)&&g(p))||n(j,p)){a(h).yGrid("restoreCell",c,b);}else{r=true;a(h).yGrid("setCell",h.rows[c].id,b,q,false,false);h.p.editCells.splice(0,1);}if(h.p.afterEndCellEditor&&a.isFunction(h.p.afterEndCellEditor)){h.p.afterEndCellEditor.call(h,d,e.edittype,r,c,b);}}if(h.p.errorCells){for(var f=0,l=h.p.errorCells.length;f<l;f++){var k=h.p.errorCells[f];if(k.rowIndex+1==c&&(h.p.rowSequences?k.colIndex+1:k.colIndex)==b){k.cell.attr({title:k.errorMsg}).css({position:"relative"});a("<div></div>").addClass("ui-cell-error").appendTo(k.cell);}}}});},restoreCell:function(c,b){return this.each(function(){var f=this,d;if(!f.grid){return;}if(f.p.editCells.length>=1){d=0;}else{d=null;}if(d!==null){var e=a("td:eq("+b+")",f.rows[c]);a(e).empty().attr("tabindex","-1");a(f).yGrid("setCell",f.rows[c].id,b,f.p.editCells[d].v,false,false);f.p.editCells.splice(0,1);}});},setCell:function(d,e,b,f,c){return this.each(function(){var h=this,k=-1,p,l;if(!h.grid){return;}if(isNaN(e)){a(h.p.colModel).each(function(q){if(this.name===e){k=q;return false;}});}else{k=parseInt(e,10);}if(k>=0){var g=a(h).yGrid("getGridRowById",d),n=parseInt(a.ygrid.stripPref(a.ygrid.uidPref,d),10);if(g){var m=a("td:eq("+k+")",g);if(b!==undefined){p=b[1];l={"title":p};a(m).html(p).attr(l);var o=h.p.colModel[k],j;h.p.data[n].data[o.index]=b;}if(typeof f==="string"){a(m).addClass(f);}else{if(f){a(m).css(f);}}if(typeof c==="object"){a(m).attr(c);}}}});},scrollVisibleCell:function(c,b){return this.each(function(){var j=this;var d=j.grid.bDiv.clientHeight,n=j.grid.bDiv.scrollTop,e=j.rows[c].offsetTop+j.rows[c].clientHeight,m=j.rows[c].offsetTop;if(e>=d+n){j.grid.bDiv.scrollTop=e-d+2;}else{if(m<n){j.grid.bDiv.scrollTop=j.rows[c].offsetTop;}}var h=j.grid.bDiv.clientWidth,g=j.grid.bDiv.scrollLeft,k=j.rows[c].cells[b].offsetLeft+j.rows[c].cells[b].clientWidth,l=j.rows[c].cells[b].offsetLeft;if(k>=h+parseInt(g,10)){j.grid.bDiv.scrollLeft=j.grid.bDiv.scrollLeft+j.rows[c].cells[b].clientWidth;}else{if(l<g){var f=l-j.rows[c].cells[b].clientWidth;j.grid.bDiv.scrollLeft=f<0?0:f;}}});},clearBeforeUnload:function(){return this.each(function(){var d=this.grid;if(a.isFunction(d.emptyRows)){d.emptyRows.call(this,true,true);}a(document).unbind("mouseup.yGrid"+this.p.id);a(d.hDiv).unbind("mousemove");a(d.bDiv).unbind("mousemove");a(this).unbind();d.dragEnd=null;d.dragMove=null;d.dragStart=null;d.emptyRows=null;d.populate=null;d.populateVisible=null;d.scrollGrid=null;d.clearSelectCells=null;d.timer=null;d.prevRowHeight=null;d.bDiv=null;d.hDiv=null;d.cols=null;var c,b=d.headers.length;for(c=0;c<b;c++){d.headers[c].el=null;}this.updatepager=null;this.refreshIndex=null;this.modifyGridCell=null;this.formatter=null;this.grid=null;this.p._indexMap=null;this.p.data=null;this.p=null;});},GridDestroy:function(){return this.each(function(){if(this.grid){if(this.p.pager){a(this.p.pager).remove();}try{a(this).clearBeforeUnload();a("#gbox_"+this.id).remove();}catch(b){}}});}});})(jQuery);(function(a){a.fmatter={};a.fn.fmatter=function(g,h,f,b,c){var d=h;f=a.extend({},a.ygrid.formatter,f);try{d=a.fn.fmatter[g].call(this,h,f,b,c);}catch(e){}return d;};a.extend(a.fmatter,{isBoolean:function(b){return typeof b==="boolean";},isObject:function(b){return(b&&(typeof b==="object"||a.isFunction(b)))||false;},isString:function(b){return typeof b==="string";},isNumber:function(b){return typeof b==="number"&&isFinite(b);},isValue:function(b){return(this.isObject(b)||this.isString(b)||this.isNumber(b)||this.isBoolean(b));},isEmpty:function(b){if(!this.isString(b)&&this.isValue(b)){return false;}if(!this.isValue(b)){return true;}b=a.trim(b).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return b==="";},extend:function(b,c){if(a.isFunction(c)){a.fn.fmatter[b]=c;}}});a.fn.fmatter.defaultFormat=function(c,b){return(a.fmatter.isValue(c)&&c!=="")?c:b.defaultValue||"&#160;";};a.fn.fmatter.hyperlink=function(d,b){var f={baseLinkUrl:b.baseLinkUrl,showAction:b.showAction,addParam:b.addParam||"",target:b.target,idName:b.idName},c="",e;if(b.colModel!==undefined&&b.colModel.formatOptions!==undefined){f=a.extend({},f,b.colModel.formatOptions);}if(f.target){c="target="+f.target;}if(f.baseLinkUrl){e=f.baseLinkUrl+f.showAction+"?"+f.idName+"="+b.rowId+f.addParam;}else{e="#";}if(a.fmatter.isString(d)||a.fmatter.isNumber(d)){return["<a  style='width: 100%' ",c," href='",e,"' class='ui-hyperlink'>",d,"</a>"].join("");}return a.fn.fmatter.defaultFormat(d,b);};a.fn.fmatter.button=function(c,b){if(a.fmatter.isString(c)||a.fmatter.isNumber(c)){c=typeof(c)=="undefined"?"":c;return"<button style='width: 100%;height: 100%' class='ui-button'>"+c+"</button>";}return a.fn.fmatter.defaultFormat(c,b);};a.fn.fmatter.checkbox=function(e,c){var f=a.extend({},c.checkbox),d;if(c.colModel!==undefined&&c.colModel.formatOptions!==undefined){f=a.extend({},f,c.colModel.formatOptions);}if(f.disabled===true||(c.colModel.editable===undefined?!this.p.enable:!c.colModel.editable)){d='disabled="disabled"';}else{d="";}if(a.fmatter.isEmpty(e)||e===undefined){e=false;}e=String(e);e=(e+"").toLowerCase();var b=e.search(/(false|f|0|no|n|off|undefined)/i)<0?" checked='checked' ":"";return"<input type=\"checkbox\" style='text-align: center' "+b+' value="'+e+'" offval="false" '+d+"/>";};a.fn.fmatter.textEditor=function(c,b){return a.fn.fmatter.defaultFormat(c,b);};a.fn.fmatter.numberEditor=function(c,b){if(isNaN(parseFloat(c))){c="";}return a.fn.fmatter.defaultFormat(c,b);};a.fn.fmatter.datePicker=function(e,d){if(!a.fmatter.isEmpty(e)){var c=d.colModel.editOptions;var b=new Date(parseFloat(e,10));return b.Format(c.formatStr);}return a.fn.fmatter.defaultFormat(e,d);};})(jQuery);(function(){YIUI.TabContainer=function(){var a={tabTemplate:'<li><a href="#{href}"><label style="float: left;">#{title}</label><span class="ui-icon ui-icon-close">Remove Tab</span></a></li>',activeTab:-1,selectedTab:null,_hasShow:false,aueltoEl:"<div></div>",items:[],close:function(c){var b=$("[aria-controls="+c.id+"]",this.el);var d=b.index();if(b.hasClass("aria-selected")&&this.activeTab!=d){this.activeTab=d>0?d-1:0;}else{if((this.activeTab==d&&this.activeTab!=0)||d<this.activeTab){this.activeTab-=1;}}this.remove(c);},closeAll:function(){var e=$("ul.ui-tabs-nav",this.el),c=this.el.children(".ui-tabs-body");e.empty();c.empty();if(this.items){for(var d=0,b=this.items.length;d<b;d++){var f=this.items[d];f.destroy();}}this.items=[];YIUI.FormStack.removeAll();},removeForm:function(b){this.close(b.getRoot());},afterAdd:function(j){if(!this.rendered){return;}var d=YIUI.FormStack.getForm(j.ofFormID);var p=j.abbrCaption||"",n=this.getEl(),o=$("ul.ui-tabs-nav",n.children(".ui-tabs-header")),k=n.children(".ui-tabs-body"),c=j.id||YIUI.allotId(),q=$(this.tabTemplate.replace(/#\{href\}/g,"#"+c).replace(/#\{title\}/g,p));if(d.isStack){var l=this.selectedTab;var e=this.items[this.activeTab];var m=e.stack=e.stack||[];m.push(j.id);e.activeItem=j;var b=$("#"+l.attr("aria-controls"));b.toggleClass("aria-show");var h=b.parent();j.el=$("<div id="+c+"></div>").appendTo(k);j.el.addClass("tabcnt-cont ui-widget-content ui-corner-bottom").toggleClass("aria-show");$("label",l).html(p);l.attr("aria-controls",c);return;}$("[href=#"+c+"]",q).addClass("ui-tans-anchor");$("[href=#"+c+"] label",q).addClass("ui-anchor-label");if(d.entryPath){q.attr("formKey",d.formKey);q.attr("paras",d.entryParas);}q.data("key",this.key);o.append(q);j.el=$("<div id="+c+"></div>").appendTo(k);var f=$('<div class="errorinfo"><label/><span class="closeIcon"></span></div>');f.prependTo(j.el);d.setErrDiv(f);j.el.addClass("tabcnt-cont ui-widget-content ui-corner-bottom").toggleClass("aria-show");q.addClass("ui-state-default ui-tabcontainer").toggleClass("aria-selected").attr("aria-controls",j.id);if(this.selectedTab&&this.selectedTab.attr("aria-controls")!=q.attr("aria-controls")){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}this.setActiveTab(j);this.selectedTab=q;var g=$("<li/>").attr("aria-controls",q.attr("aria-controls")).html($("label",q).text());$("ul",this._dropView).append(g);this.setDropBtnView();this.setTabListColor();},setDropViewLeft:function(){this._dropView.css({"top":this._dropBtn.offset().top+this._dropBtn.height(),"left":document.body.clientWidth-this._dropView.outerWidth()-30});},clearSelect:function(){if(this.selectedTab){this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");this.selectedTab=null;}},setSelectedTab:function(b){if(!this.selectedTab){b.toggleClass("aria-selected");}else{if(this.selectedTab.attr("aria-controls")==b.attr("aria-controls")){return;}else{b.toggleClass("aria-selected");this.selectedTab.toggleClass("aria-selected");$("#"+this.selectedTab.attr("aria-controls")).toggleClass("aria-show");}}var c=this.get(b.attr("aria-controls"));$("#"+c.id).toggleClass("aria-show");this.setActiveTab(c);this.layout(this.getWidth(),this.getHeight());this.selectedTab=b;var d=b.position().left-$(".ui-tabs-header",this.el).width()+b.width();$(".ui-tabs-header",this.el).scrollLeft(d<0?0:d);this.setTabListColor();},setDropBtnView:function(){this._dropView.removeClass("showList");var b=$(".ui-tabs-header li",this.el).last();if(b.length==0||!this.selectedTab){return;}if(b.position().left+b.width()<=$(".ui-tabs-header",this.el).width()){this._dropBtn.removeClass("show");}b=this.selectedTab;if(b.position().left+b.width()>$(".ui-tabs-header",this.el).width()){if(!this._dropBtn.hasClass("show")){this._dropBtn.addClass("show");}$(".ui-tabs-header",this.el).scrollLeft(b.position().left-$(".ui-tabs-header",this.el).width()+b.width());}},setTabListColor:function(){var g=$(".ui-tabs-header",this.el).offset().left;var c=$(".ui-tabs-header li",this.el),f,d;for(var e=0,b=c.length;e<b;e++){f=c.eq(e);d=$("li[aria-controls = "+f.attr("aria-controls")+"]",this._dropView);if(f.offset().left>=g&&f.offset().left<=g+$(".ui-tabs-header",this.el).width()){d.addClass("lightColor");}else{d.removeClass("lightColor");}}},install:function(){var b=this;$(".ui-tabs-header",b.el).delegate("li","click",function(c){var d=$(c.target);if(d.hasClass("ui-icon-close")){var d=$(c.target);var e=d.closest("li").attr("aria-controls");YIUI.EventHandler.doCloseForm(b.get(e));}else{b.setSelectedTab(d.closest("li"));}c.stopPropagation();return false;});b._dropBtn.click(function(c){if(!$(this).hasClass("show")){return;}if(b._hasShow){b.hideTabList();b._dropView.removeClass("showList");return;}else{b._dropView.addClass("showList");}b.setDropViewLeft();b._dropView.slideDown("fast");b._dropView.css("z-index",$.getZindex(b._dropBtn)+1);$(document).on("mousedown",function(f){var d=$(f.target);if((d.closest(b._dropView).length==0)&&(d.closest(b._dropBtn).length==0)){b.hideTabList();b._dropView.removeClass("showList");}});b._hasShow=true;c.stopPropagation();});$("ul",b._dropView).delegate("li","click",function(e){var c=$(this).attr("aria-controls");var d=$("li[aria-controls = "+c+"]",b.el);b.setSelectedTab(d);b.hideTabList();});$(".ui-tabs-body",b.el).delegate(".errorinfo .closeIcon","click",function(){$(this).parent().hide();var c=$(this).parents(".aria-show");b.items[b.activeTab].doLayout(c.width(),c.height());});},hideTabList:function(){this._dropView.hide();this._hasShow=false;},indexOf:function(d){var c=this.items;for(var e=0,b=c.length;e<b;e++){if(c[e]===d){return e;}}return -1;},closeTo:function(c){var e,d;for(var b=this.items.length-1;b>=0;b--){e=this.items[b];d=YIUI.FormStack.getForm(e.ofFormID);if(d.formKey==c){break;}this.removeForm(d);}},remove:function(h,j){if(!h){return;}var c=h.getId();var p=h.ofFormID;var k=this.indexOf(h);if(k===-1){return;}var m=this.getEl();YIUI.FormStack.removeForm(p);$("#"+c,m).remove();if(j===false){h.getEl().remove();}else{h.destroy();}var d=this.items[this.activeTab];this.items.splice(k,1);if(d.stack&&d.stack.length>0){var n=d.stack;var g=n.indexOf(c);var f=-1;if(g==0&&n.length>1){f=1;}else{if(g>0){f=g-1;}}var b=null;if(f>-1){var e=this.get(n[f]);d.activeItem=e;b=e;}else{d.activeItem=null;b=d;}var o=b.abbrCaption||"";b.el.toggleClass("aria-show");var l=this.selectedTab;$("label",l).html(o);l.attr("aria-controls",b.id);n.splice(g,1);}else{$("[aria-controls="+c+"]",m).remove();$("li[aria-controls="+c+"]",this._dropView).remove();this.setDropBtnView();if($(".ui-tabs-body",m).children(".tabcnt-cont").length<=0){this.activeTab=-1;return;}d=this.items[this.activeTab];if(this.selectedTab&&this.selectedTab.attr("aria-controls")==c){d.el.toggleClass("aria-show");$("li[aria-controls = "+d.id+"]").toggleClass("aria-selected");}this.selectedTab=$("li[aria-controls = "+d.id+"]");}this.layout(this.getWidth(),this.getHeight());},setActiveTab:function(d){var b=-1;if($.isNumeric(d)){if(d<0&&d>this.items.length-1){return;}b=d;}else{if($.isString(d)){for(var c=0;c<this.items.length;c++){if(d==this.items[c].getId()){b=c;break;}}}else{if($.isObject(d)){for(var c=0;c<this.items.length;c++){if(d==this.items[c]){b=c;break;}}}}}if(b!=-1){if(this.activeTab!=b){this.activeTab=b;}}},add:function(b){if($.isArray(b)){var e=this;$.each(b,function(c){e.add(this);});return;}if(this.get(b.id)){return;}var d=this.lookupComponent(b);this.items.push(d);this.afterAdd(d);},get:function(d){if($.isNumeric(d)){return this.items[d];}else{if($.isString(d)){var c=this.items,f;for(var e=0,b=c.length;e<b;e++){f=c[e];if(f&&f.id===d){return f;}}}}return null;},setWidth:function(c){if(!c||!$.isNumeric(c)||c<=0){return;}if(!this.rendered){this.width=c;return;}var b=this.lastSize;if(b.width!==c){b.width=c;this.onSetWidth(c);}},onSetWidth:function(b){this.el.css("width",b);},getWidth:function(){if(this.rendered){return this.getEl().width();}return this.width;},setHeight:function(b){if(!b||!$.isNumeric(b)||b<=0){return;}if(!this.rendered){this.height=b;return;}var c=this.lastSize;if(c.height!==b){c.height=b;this.onSetHeight(b);}},onSetHeight:function(b){this.el.css("height",b);},getHeight:function(){if(this.rendered){return this.getEl().height();}return this.height;},lookupComponent:function(b){if($.isString(b)){return YIUI.ComponentMgr.get(b);}else{if(!(b instanceof YIUI.Component)){return YIUI.create(b,this.defaultType);}}return b;},doLayout:function(c,b){if(this.layout){this.layout(c,b);}},onRenderChildren:function(){this.el.addClass("ui-panel");this.doRenderChildren(false,true);},doRenderChildren:function(c,b){if(!this.html){var e=this.rendered;var d=b;if(e){this.layoutRender();}this.hasLayout=true;this.doLayout(this.getWidth(),this.getHeight());}},render:function(b){if(!this.rendered){this.rendered=true;this.container=b?$(b):(this.container?$(this.container):$.getBody());this.onRender(this.container);this.onRenderChildren();this.install();}},onRender:function(b){var c=this.el;this.el.addClass("ui-tabcnt");if(c&&(!b||b.length==0)){this.container=b=$(c).parent();}if(!c&&this.autoEl){if($.isString(this.autoEl)){c=$(this.autoEl);}}if(c){if(!c.attr("id")){c.attr("id",this.getId());}this.el=$(c);if(this.el.parents("body")[0]!=$.getBody()[0]){b.append(this.el);}}},layoutRender:function(){var b=this.getRenderTarget();if(this.prepared||this.beforeLayoutRender()!==false){this.prepared=true;this.onLayoutRender(this,b);}},getRenderTarget:function(){return this.getEl();},getEl:function(){return this.el;},onLayoutRender:function(b,c){this.renderLayoutChildren(b,c);},renderLayoutChildren:function(f,h){var d=f.items;for(var e=0,b=d.length;e<b;e++){var j=d[e],g=this.getItemTarget(j,e);if(j&&(!j.rendered)){this.renderItem(j,g);}}},getItemTarget:function(b,c){return b.container||this.getRenderTarget();},renderItem:function(d,b){if(d&&!d.rendered){d.doRender(b);}else{if(d&&!this.isValidParent(d,b)){b.insertBefore(d.getEl());d.container=b;}}},layout:function(f,e){var d=this;if(d.items&&d.items.length!=0){var c=$("ul.ui-tabs-nav",d.el),b=$(d.el.children(".ui-tabs-body"));b.width(f);b.height(e-c.outerHeight(true));$(".ui-tabs-header",this.el).width(f-30);tab=d.items[d.activeTab];if(tab){if(tab.activeItem){tab=tab.activeItem;}tab.setWidth(b.width());tab.setHeight(b.height());if(tab.hasLayout){tab.doLayout(tab.getWidth(),tab.getHeight());}if(d.selectedTab){$(".ui-tabs-header",d.el).scrollLeft(d.selectedTab.position().left-$(".ui-tabs-header",d.el).width()+d.selectedTab.width());}}}d.setDropBtnView();d.setTabListColor();},beforeLayoutRender:function(){var f=this,j=f.getRenderTarget(),m=f.items,n;var k=$("<ul/>");var d=$("<div></div>").addClass("ui-tabs-header").appendTo(j).append(k);var l=f._dropBtn=$("<span></span>").addClass("ui-tabs dropdownBtn").appendTo(j);f._dropView=$("<div><ul/></div>").addClass("ui-tabs tabs-list");$(document.body).append(f._dropView);k.addClass("ui-tabs-nav ui-corner-all");var g=$("<div>").addClass("ui-tabs-body").appendTo(j);for(var c=0,h=m.length;c<h;c++){n=m[c];n.id=n.id||YIUI.allotId();if(!n.title){n.title=n.caption;}var e=$(YIUI.Panel.TabPanel.prototype.tabTemplate.replace(/#\{href\}/g,"#"+n.id).replace(/#\{title\}/g,n.title)).appendTo(k);if(c==0){f.selectedTab=e;f.activeTab=0;}else{}e.addClass("ui-state-default ui-corner-top").attr("aria-controls",n.id);$("[href=#"+n.id+"]",e).addClass("ui-tans-anchor");$("[href=#"+n.id+"] label",e).addClass("ui-anchor-label");var b=$("<div>").attr("id",n.id).appendTo(g);n.container=b;b.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(c==0){e.toggleClass("aria-selected");b.toggleClass("aria-show");}}},afterLayoutRender:function(){var c=this.container;var b=$(c.el.children()[1]),d=b.css("overflow");}};return a;};})();(function(){YIUI.MainTree=function(rootEntry,dom,container){$("ul.tm",dom).remove();var el=$("<ul></ul>").addClass("tm").appendTo(dom);var options={el:el,_open:false,menuType:rootEntry.style,_openedItem:null,_data:[],rootEntry:rootEntry,clickEvent:{expandNode:function($this,self){var nodeId=$this.attr("id");var node=self.getTreeNode(nodeId);self.callback.beforeExpand(node);var expandNode=node.id+"-"+self.el.attr("id");if(!node.isLoaded){node.isLoaded=true;}$this.next().show();$this.removeClass("close collapse").addClass("open expand cursel");$this.parent().addClass("sel");$this.parent().siblings().find(".open.expand").removeClass("open expand cursel").addClass("close collapse").next().hide();},collapse:function($this,self){if($this.has("open expand")){$this.parent().removeClass("sel");$this.parent().find(".open.expand").removeClass("open expand cursel").addClass("close collapse").next().hide();}},selectNode:function($this,self){var id=$this.attr("id");var treeId=self.el.attr("id");if(self.selectedNodeId){$("#"+self.selectedNodeId).removeClass("clicked");$("#"+self.selectedNodeId).parent().removeClass("clicked");}self.selectedNodeId=id;$("#"+id).addClass("clicked");$("#"+id).parent().addClass("clicked");self.callback.onSelect($this,$("#"+treeId),self.getTreeNode(id));}},callback:$.extend({beforeExpand:$.noop,onSelect:function($this,$tree,node){if(node.children){if(self.menuType==YIUI.TREEMENU_TYPE.GROUPTREE){$("#"+node.id+" span.icon").click();}else{if(self.menuType==YIUI.TREEMENU_TYPE.TREE){if($("#"+node.id).attr("open")){self.clickEvent.collapse($this,self,null);$("#"+node.id).attr("open",false);$(this).removeClass("cursel");$(this).parent().removeClass("sel");}else{self.clickEvent.expandNode($this,self,null);$("#"+node.id).attr("open",true);$(this).addClass("cursel");$(this).parent().addClass("sel");}}}}else{YIUI.EventHandler.doTreeClick(node,container);}}}),getTreeNode:function(nodeId){for(var i=0,len=this._data.length;i<len;i++){if(this._data[i].id==nodeId){return this._data[i];}}},initDataSource:function(dataSource){if(dataSource){if(!dataSource.length){dataSource=$(dataSource);}var data;for(var i=0,len=dataSource.length;i<len;i++){data=dataSource[i];if(!data.id){data.id=data.key+i;}if(data.children){data.isParent=true;this.initDataSource(data.children);}}}},dataSourceCopy:function(dataSource,parentID){if(dataSource){if(!dataSource.length){dataSource=$(dataSource);}for(var i=0,len=dataSource.length;i<len;i++){var ds=dataSource[i];var parent=ds.parent;var d=new Object();d.name=ds.name;d.id=ds.id;d.itemKey=ds.itemKey;d.layerItemKey=ds.layerItemKey;if(ds.isLoaded){d.isLoaded=ds.isLoaded;}else{d.isLoaded=false;}if(ds.children&&ds.children.length>0){d.open=ds.open;var children=[];for(var j=0,length=ds.children.length;j<length;j++){var child=ds.children[j];children.push(child.id);this.dataSourceCopy($(child),ds.id);}d.children=children;}else{d.key=ds.key;d.formKey=ds.formKey;d.paras=ds.parameters;d.single=ds.single;}d.path=ds.path;if(ds.parent){d.parentId=ds.parent.id;}if(parentID){d.parentID=parentID;}this._data.push(d);}}},buildTreenode:function(el,nodes,parentId){if(!nodes){return;}if(!nodes.length){if(!parentId){nodes=nodes.children;}}nodes&&this.addChilds(nodes,parentId,0,this);},calcBoolean:function(str){if(!this.parser){this.parser=new View.Parser();}return this.parser.eval(str);},addChilds:function(nodes,parentId,level,options){if(nodes.length<=0){if(parentId){$("#"+parentId,options.el).next().remove();$("#"+parentId,options.el).children().first().removeClass("tm-collapse");}return;}var node,nid,isTree=options.menuType!=YIUI.TREEMENU_TYPE.GROUPTREE?true:false;if(parentId){var parentNode=options.getTreeNode(parentId);parentNode.children=[];}if(isTree){options.el.addClass("tree");}for(var i=0,len=nodes.length;i<len;i++){node=nodes[i];nid=node.id;node.parentId=parentId;var isVisible=node.visible==""?true:this.calcBoolean(node.visible);if(!isVisible){continue;}var _li=$("<li class='tm-node' level='"+level+"'></li>").attr("path",node.path);if(node.single){_li.attr("single","true").attr("formKey",node.formKey).attr("paras",node.parameters);}if(!node.parentId){_li.addClass("top-level");}if(parentId){parentNode.children.push(nid);_li.appendTo($("#"+parentId,options.el).next());}else{_li.appendTo(options.el);}var _a=$("<a id='"+nid+"' class='tm-anchor'></a>").appendTo(_li),_ul;if(node.isParent){if(level==1){_a.css({"backgroundPosition":30,"padding-left":45});}if(level>1){var disX=level*5+36;_a.css({"backgroundPosition":disX,"padding-left":disX+15+"px"});}}else{if(level==1){_a.css("padding-left",40);}if(level>1){_a.css("padding-left",level*10+36);}}if(node.isParent){_li.addClass("isparent");_ul=$("<ul class='tm-ul'></ul>");if(node.open&&!options._isOpen&&!node.parentId){_li.addClass("sel");_a.addClass("cursel open expand").attr("open",true);options._isOpen=true;options._openedItem=_a;}else{_a.attr("open",false).addClass("close collapse");_ul.css("display","none");}_ul.appendTo(_li);}$("<span class='tm-name'>"+node.name+"</span>").appendTo(_a);if(node.children){this.addChilds(node.children,node.id,level+1,options);}else{_a.addClass("noExpand");}}},install:function(){var self=this;self.el.delegate("a","click",function(e){if($(this).hasClass("open")){self.clickEvent.collapse($(this),self);return;}if($(this).hasClass("close")){self.clickEvent.expandNode($(this),self);return;}});self.el.delegate("a","dblclick",function(e){if($(this).hasClass("noExpand")){self.clickEvent.selectNode($(this),self);return;}});},init:function(){this.initDataSource(this.rootEntry);this.dataSourceCopy(this.rootEntry.children);this.buildTreenode(this.el,this.rootEntry);this.install();},reload:function(entry){this.el.empty();this._data=[];this.initDataSource(entry);this.dataSourceCopy(entry.children);this.buildTreenode(this.el,entry);}};options.init();return options;};})();YIUI.EventHandler=(function(){var a={doTreeClick:function(e,b){var k=e.path;var c=$("[path='"+k+"']");if(c.length>0){var f=YIUI.TypeConvertor.toBoolean(c.attr("single"));if(f){var j=c.attr("formKey");var l=c.attr("paras");var g=$("[formKey='"+j+"'][paras='"+l+"']",b.el);if(g.length>0){g.click();return;}}}var d={};d.path=k;d.async=true;var h=function(o){var m;var n=YIUI.FormBuilder.build(o);n.entryPath=k;n.entryParas=l;if(n.target!=YIUI.FormTarget.MODAL){b.build(n);m=n.formID;}if(n.getOperationState()==YIUI.Form_OperationState.New){n.resetUIStatus(YIUI.FormUIStatusMask.ENABLE|YIUI.FormUIStatusMask.VISIBLE|YIUI.FormUIStatusMask.OPERATION);n.getUIProcess().checkAll();n.initFirstFocus();}};Svr.SvrMgr.doPureTreeEvent(d,h);},doCloseForm:function(d){var c=d.ofFormID;var b=YIUI.FormStack.getForm(c);b.fireClose();}};return a;})();var FilterMap=FilterMap||{};(function(){FilterMap=function(b){var a={type:b["type"]||YIUI.DocumentType.DATAOBJECT,OID:b["OID"]||-1,needDocInfo:b["needDocInfo"]||true,filterMap:b["filterMap"]||new Array(),setOID:function(c){this.OID=c;},getOID:function(){return this.OID;},setType:function(c){this.type=c;},getType:function(){return this.type;},setNeedDocInfo:function(c){this.needDocInfo=c;},isNeedDocInfo:function(){return this.needDocInfo;},setFilterMap:function(c){this.filterMap=c;},getFilterMap:function(){return this.filterMap;},addTblDetail:function(c){this.filterMap.push(c);},setStartRow:function(c,d){this.getTblFilter(c).startRow=d;},setMaxRows:function(d,c){this.getTblFilter(d).maxRows=c;},getTblFilter:function(c){var d=this.get(c);if(d==null){d=new TableFilterDetail();d.setTableKey(c);this.addTblDetail(d);}return d;},get:function(e){var g=this.filterMap,f;for(var d=0,c=g.length;d<c;d++){f=g[d];if(f.tableKey==e){return f;}}return null;}};return a;};TableFilterDetail=function(){var a={tableKey:"",filter:"",startRow:0,maxRows:0,OID:-1,fieldValues:null,paraValues:null,SourceKey:"",setTableKey:function(b){this.tableKey=b;},setFilter:function(b){this.filter=b;},setStarRow:function(b){this.startRow=b;},setMaxRows:function(b){this.maxRows=b;},setFieldValues:function(b){this.fieldValues=b;},setParaValues:function(b){this.paraValues=b;},setSourceKey:function(b){this.SourceKey=b;}};return a;};})();(function(){YIUI.UICheckOpt=function(form){var Return={showError:function(errorMsg){$.error(errorMsg);},doOpt:function(){var self=this,result=true;if(form.errorInfo.error){this.showError("表单("+form.formKey+" "+form.formCaption+"):"+form.errorInfo.errorMsg);return false;}for(var i in form.getComponentList()){var er,ec,isBreak=false,comp=form.getComponentList()[i],rd;if(comp.type==YIUI.CONTROLTYPE.GRID){for(var m=0;m<comp.errorInfoes.rows.length;m++){er=comp.errorInfoes.rows[m];rd=comp.dataModel.data[er.rowIndex];if(rd==null||(rd.bookmark===undefined&&rd.isDetail)){continue;}self.showError("表格("+comp.key+" "+comp.caption+")第"+(er.rowIndex+1)+"行:"+er.errorMsg);result=false;isBreak=true;break;}if(isBreak){break;}for(var n=0;n<comp.errorInfoes.cells.length;n++){ec=comp.errorInfoes.cells[n];rd=comp.dataModel.data[ec.rowIndex];if(rd==null||(rd.bookmark===undefined&&rd.isDetail)){continue;}self.showError("表格("+comp.key+" "+comp.caption+")第"+(ec.rowIndex+1)+"行,第"+(ec.colIndex+(comp.showRowHead?1:0))+"列:"+ec.errorMsg);result=false;isBreak=true;break;}if(isBreak){break;}for(var ri=0,rlen=comp.getRowCount();ri<rlen;ri++){var rowData=comp.getRowDataAt(ri);if(rowData==null||(rowData.isDetail&&rowData.bookmark==null)){continue;}for(var ci=0,clen=comp.getColumnCount();ci<clen;ci++){var cellData=comp.getCellDataAt(ri,ci),cm=comp.dataModel.colModel.columns[ci];if(cellData[3]){self.showError("表格("+comp.key+" "+comp.caption+")\n第"+(ri+1)+"行,第"+(ci+(comp.showRowHead?1:0))+"列:"+cm.label+"为必填项");result=false;isBreak=true;break;}}}if(isBreak){break;}}else{if(!((comp.errorInfo&&comp.errorInfo.error)||comp.isRequired())){continue;}var parentGridKey=comp.getMetaObj().parentGridKey;if(comp.getMetaObj().isSubDetail&&parentGridKey!=null&&parentGridKey!=""){var grid=form.getComponent(parentGridKey);if(grid==null||grid.getFocusRowIndex()==-1){continue;}var pRowData=grid.getRowDataAt(grid.getFocusRowIndex());if(pRowData.isDetail&&pRowData.bookmark==null){continue;}}if(comp.errorInfo&&comp.errorInfo.error){self.showError("表单控件("+comp.key+" "+comp.caption+"):"+comp.errorInfo.msg);result=false;break;}else{if(comp.isRequired()){self.showError("表单控件("+comp.key+" "+comp.caption+")是必填项，当前未填值。");result=false;break;}}}}return result;}};return Return;};YIUI.EditOpt=function(form){var Return={doOpt:function(){form.setInitOperationState(YIUI.Form_OperationState.Edit);form.setOperationState(YIUI.Form_OperationState.Edit);form.resetUIStatus(YIUI.FormUIStatusMask.ENABLE|YIUI.FormUIStatusMask.VISIBLE|YIUI.FormUIStatusMask.OPERATION);form.initFirstFocus();}};return Return;};YIUI.SaveOpt=function(form){var Return={doOpt:function(){form.setOperationState(YIUI.Form_OperationState.Default);var paras={};paras.service="PureOpt";paras.cmd="GetOptScript";paras.formKey=form.formKey;paras.type=YIUI.OptScript.SAVE;var formula=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,paras);form.eval(formula,{form:form},null);}};return Return;};YIUI.LoadOpt=function(form){var Return={doOpt:function(){form.setOperationState(YIUI.Form_OperationState.Default);var paras={};paras.service="PureOpt";paras.cmd="GetOptScript";paras.formKey=form.formKey;paras.type=YIUI.OptScript.LOAD;var formula=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,paras);form.eval(formula,{form:form},null);}};return Return;};YIUI.NewOpt=function(form,refreshUI){var Return={doOpt:function(){var paras={};paras.service="PureOpt";paras.cmd="GetNewDocument";paras.formKey=form.formKey;paras.type=YIUI.OptScript.LOAD;var document=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,paras);if(document){var doc=YIUI.DataUtil.fromJSONDoc(document);form.setDocument(doc);}form.setInitOperationState(YIUI.Form_OperationState.New);form.setOperationState(YIUI.Form_OperationState.New);if(refreshUI){form.showDocument();form.resetUIStatus(YIUI.FormUIStatusMask.ENABLE|YIUI.FormUIStatusMask.VISIBLE|YIUI.FormUIStatusMask.OPERATION);}}};return Return;};YIUI.CopyNewOpt=function(form){var Return={doOpt:function(){var paras={};paras.service="PureOpt";paras.cmd="GetNewCopyDocument";paras.formKey=form.formKey;paras.type=YIUI.OptScript.LOAD;var docStr=YIUI.DataUtil.toJSONDoc(form.getDocument());paras.document=$.toJSON(docStr);var document=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,paras);if(document){doc=YIUI.DataUtil.fromJSONDoc(document);form.setDocument(doc);}form.setInitOperationState(YIUI.Form_OperationState.New);form.setOperationState(YIUI.Form_OperationState.New);form.showDocument();form.resetUIStatus(YIUI.FormUIStatusMask.ENABLE|YIUI.FormUIStatusMask.VISIBLE|YIUI.FormUIStatusMask.OPERATION);}};return Return;};})();(function(){YIUI.ShowData=function(b){var a={resetDocument:function(){var d=b.getDocument();if(d==null){return;}var f=null;for(var e=0,c=d.tbls.length;e<c;e++){f=d.tbls[e];f.first();}},loadHeader:function(f){var c=b.getDocument();var e=f.getMetaObj().tableKey;var d=e&&c.getByKey(e);if(!d){return;}var j=f.getMetaObj().columnKey,g="";if(d.getRowCount()>0){g=d.getByKey(j);if(f.type==YIUI.CONTROLTYPE.DYNAMICDICT){var h=d.getByKey(j+"ItemKey");f.itemKey=h;}}f.setValue(g);},loadListView:function(c){var d=new YIUI.ShowListView(b,c);d.load();},loadGrid:function(c){var d=YIUI.ShowGridData(b,c);d.load();},show:function(){this.resetDocument();var c=b.getComponentList(),e;for(var d in c){e=c[d];if(e.getMetaObj().isSubDetail){continue;}switch(e.type){case YIUI.CONTROLTYPE.LISTVIEW:this.loadListView(e);break;case YIUI.CONTROLTYPE.GRID:this.loadGrid(e);break;case YIUI.CONTROLTYPE.CHART:break;default:if(e instanceof YIUI.Control){if(e.needClean()&&!e.condition){e.setValue(null,false,false);}this.loadHeader(e);}break;}}this.postShowData();},postShowData:function(){b.getUIProcess().doPostShowData();b.getUIProcess().calcToolBar();b.initFirstFocus();}};return a;};YIUI.ShowListView=function(c,a){var b={load:function(){a.clearAllRows();var s=c.getDocument();var r=a.getMetaObj().tableKey;if(!r){return;}var A=s.getByKey(r);if(!A){return;}a.totalRowCount=A.allRows.length;var o=[],n,l,F;for(var v=0,h=A.getRowCount();v<h;v++){n={};A.setPos(v);for(var u=0,p=a.columnInfo.length;u<p;u++){var g=a.columnInfo[u];var G=g.key;n[G]={};var F=a.columnInfo[u].columnKey;if(F){var B="",t=A.getByKey(F);switch(g.columnType){case YIUI.CONTROLTYPE.DATEPICKER:if(t){var E=new Date(parseInt(t));var y="yyyy-MM-dd";if(!g.onlyDate){y="yyyy-MM-dd HH:mm:ss";}B=E.Format(y);t=E.toString();}break;case YIUI.CONTROLTYPE.DICT:var z=g.itemKey;var e=YIUI.TypeConvertor.toInt(t);B=YIUI.DictService.getCaption(z,e);break;case YIUI.CONTROLTYPE.COMBOBOX:var q=g.items;for(var w=0,x=q.length,D;w<x;w++){var D=q[w];if(D.value==t){B=D.caption;break;}}break;case YIUI.CONTROLTYPE.NUMBEREDITOR:var k=g.decScale;var f=g.roundingMode;var C=null;if(t){C=YIUI.TypeConvertor.toDecimal(t);B=C.toFormat(k,f);}break;default:B=A.getByKey(F);break;}n[G].caption=B;n[G].value=t;}else{n[G].caption=g.caption;n[G].value=g.caption;}}o.push(n);}if(!a.getMetaObj().pageRowCount||a.totalRowCount<a.getMetaObj().pageRowCount){a._pagination.hidePagination();}else{if(a.totalRowCount){a._pagination.setTotalRowCount(a.totalRowCount,true);}}a.data=o;a.addDataRow(o);a.addEmptyRow();}};return b;};YIUI.ShowGridData=function(c,b){var a={load:function(){b.clearGridData();var l=c.getDocument();var r=b.tableKey;var e=function(v,x){var w={};w.isDetail=false;w.isEditable=true;w.rowHeight=v.rowHeight;w.rowID=b.randID();w.metaRowIndex=x;w.rowType=v.rowType;w.cellKeys=v.cellKeys;w.data=[];w.cellBkmks=[];for(var u=0,s=v.cells.length;u<s;u++){var t=v.cells[u];w.data[u]=["",t.caption,false];}b.dataModel.data.push(w);return w;};if(r){var q=l.getByKey(r),h=0,g=q.getRowCount(),d,o=b.rootGroupBkmk;if(o==null||o.length==0){o=[];q.beforeFirst();while(q.next()){if(q.rows[q.pos].state!=DataDef.R_Deleted){o.push(q.getBkmk());}}}if(q){if(b.getPageInfo().pageLoadType=="UI"){h=(b.getPageInfo().currentPage-1)*b.getPageInfo().pageRowCount;g=b.getPageInfo().currentPage*b.getPageInfo().pageRowCount;if(g>o.length){g=o.length;}}for(var k=0,j=b.metaRowInfo.rows.length;k<j;k++){var n=b.metaRowInfo.rows[k];if(n.rowType=="Fix"||n.rowType=="Total"){var p=e(n,k);b.el[0].insertGridRow(b.getRowCount()-1,p);}else{if(n.rowType=="Detail"){for(var f=h;f<g;f++){d=b.addGridRow(null,-1,false);d.bookmark=o[f];var m=b.getRowIndexByID(d.rowID);b.showDetailRow(m,false);}}}}b.gridHandler.dealWithSequence(c,b);b.setGridEnable(b.isEnable());}}}};return a;};})();(function(){YIUI.DefaultStatusProxy=YIUI.extend({form:null,init:function(form){this.form=form;},validateEnable:function(key,content,context,formEnable){var result=false;if(content!=null&&content.length>0){result=YIUI.TypeConvertor.toBoolean(this.form.eval(content,context,null));}else{result=formEnable;}return this.checkAccessControl(context,key)?result:false;},validateEnableByTree:function(key,syntaxTree,context,formEnable){var result=false;if(syntaxTree!=null){result=YIUI.TypeConvertor.toBoolean(this.form.evalByTree(syntaxTree,context,null));}else{result=formEnable;}return this.checkAccessControl(context,key)?result:false;},validateVisible:function(key,content,context){if(content!=null&&content.length>0){return YIUI.TypeConvertor.toBoolean(this.form.eval(content,context,null));}return true;},validateVisibleByTree:function(key,syntaxTree,context){if(syntaxTree!=null){return YIUI.TypeConvertor.toBoolean(this.form.evalByTree(syntaxTree,context,null));}return true;},checkAccessControl:function(context,key){var cellLocation=this.form.getCellLocation(key),metaComp=this.form.getComponent(key),result=true,dataTable,value;if(cellLocation!=null&&context!=null){var grid=this.form.getComponent(cellLocation.key),metaCell=grid.getMetaCellByKey(key);if(metaCell!=null&&this.accessControl(this.form,metaCell)){if(cellLocation.row!=null&&cellLocation.row!=-1){dataTable=this.form.getDocument().getByKey(metaCell.tableKey);value=0;if(dataTable.first()){value=YIUI.TypeConvertor.toInt(dataTable.getByKey(metaCell.columnKey+"_CF"));}if((value&YIUI.FormUIStatusMask.ENABLE)!=0){result=false;}}else{if(context.rowIndex!=null&&context.rowIndex!=-1){dataTable=this.form.getDocument().getByKey(grid.tableKey);var rowData=grid.getRowDataAt(context.rowIndex);if(rowData.isDetail&&rowData.bookmark!=null){if(grid.hasColExpand){var rowBkmk=rowData.bookmark[0];dataTable.setByBkmk(rowBkmk);}else{dataTable.setByBkmk(rowData.bookmark);}value=YIUI.TypeConvertor.toInt(dataTable.getByKey(metaCell.columnKey+"_CF"));if((value&YIUI.FormUIStatusMask.ENABLE)!=0){result=false;}}}}}}else{if(metaComp!=null){if(this.accessControlByComp(this.form,metaComp)){dataTable=this.form.getDocument().getByKey(metaComp.tableKey);value=0;if(dataTable.first()){value=YIUI.TypeConvertor.toInt(dataTable.getByKey(metaComp.columnKey+"_CF"));}if((value&YIUI.FormUIStatusMask.ENABLE)!=0){result=false;}}}}return result;},accessControl:function(form,metaCell){if(metaCell&&metaCell.tableKey&&metaCell.columnKey){var doc=form.getDocument();if(doc){var dataTable=doc.getByKey(metaCell.tableKey);if(dataTable==null){return false;}var cellKey=metaCell.columnKey;if(cellKey==null||cellKey.length==0){return false;}return dataTable.getColByKey(cellKey).getAccessControl();}}return false;},accessControlByComp:function(form,comp){if(comp&&comp.tableKey&&comp.columnKey){var doc=form.getDocument();if(doc){var dataTable=doc.getByKey(comp.tableKey);if(dataTable==null){return false;}var cellKey=comp.columnKey;if(cellKey==null||cellKey.length==0){return false;}return dataTable.getColByKey(cellKey).getAccessControl();}}return false;}});YIUI.HostStatusProxy=YIUI.extend({info:null,init:function(info){this.info=info;},validateEnable:function(key,content,context,formEnable){var enableList=this.info["enableList"],match;return $.inArray(key,enableList)!=-1;},validateEnableByTree:function(key,syntaxTree,context,formEnable){var enableList=this.info["enableList"],match;return $.inArray(key,enableList)!=-1;},validateVisible:function(key,content,context){var visibleList=this.info["visibleList"],match;return $.inArray(key,visibleList)==-1;},validateVisibleByTree:function(key,syntaxTree,context){var visibleList=this.info["visibleList"],match;return $.inArray(key,visibleList)==-1;}});})();(function(){YIUI.UIProcess=function(form){this.form=form;this.enableProcess=new YIUI.UIEnableProcess(form);this.visibleProcess=new YIUI.UIVisibleProcess(form);this.calcProcess=new YIUI.UICalcProcess(form);this.checkRuleProcess=new YIUI.UICheckRuleProcess(form);this.dependencyProcess=new YIUI.UIDependencyProcess(form);this.checkAll=function(){this.checkRuleProcess.checkAll();};this.resetUIStatus=function(mask){var calcEnable=(mask&YIUI.FormUIStatusMask.ENABLE)!=0;var calcVisible=(mask&YIUI.FormUIStatusMask.VISIBLE)!=0;var addOperation=(mask&YIUI.FormUIStatusMask.OPERATION)!=0;if(calcEnable){this.enableProcess.calcAll();}if(calcVisible){this.visibleProcess.calcAll();}if(addOperation){this.calcToolBar();}};this.calcToolBar=function(){var tblKey=form.defTbr,tbl=form.getComponent(tblKey);if(tbl&&!tbl.isDestroyed){for(var i=0,len=tbl.items.length;i<len;i++){var item=tbl.items[i];var visible,enable;var f=form;if(item.formID){f=YIUI.FormStack.getForm(item.formID);}var cxt={form:f};visible=item.visibleCont?f.eval(item.visibleCont,cxt,null):tbl.visible;enable=item.enableCont?f.eval(item.enableCont,cxt,null):tbl.enable;item.visible=visible;item.enable=enable;if(item.items){for(var m=0,len=item.items.length;m<len;m++){visible=item.items[m].visibleCont?f.eval(item.items[m].visibleCont,cxt,null):tbl.visible;item.items[m].visible=visible;enable=item.items[m].enableCont?f.eval(item.items[m].enableCont,cxt,null):tbl.enable;item.items[m].enable=enable;}}form.getOptMap()[item.key].opt=item;}tbl.repaint();}};this.doPostShowData=function(){this.calcProcess.calcAll();this.enableProcess.calcAll();this.visibleProcess.calcAll();this.checkRuleProcess.checkAll();this.dependencyProcess.calcAll();};this.calcEmptyRow=function(grid,rowIndex){this.calcProcess.calcEmptyRow(grid,rowIndex);this.enableProcess.calcEmptyRow(grid,rowIndex);this.checkRuleProcess.calcEmptyRow(grid,rowIndex);this.dependencyProcess.calcEmptyRow(grid,rowIndex);};this.doValueChanged=function(key){this.calcProcess.valueChanged(key);var control=this.form.getComponent(key);if(control.valueChanged){this.form.eval(control.valueChanged,{form:this.form});}};this.doPostValueChanged=function(key){this.enableProcess.valueChanged(key);this.visibleProcess.valueChanged(key);this.checkRuleProcess.valueChanged(key);this.dependencyProcess.valueChanged(key);};this.doCellValueChanged=function(grid,rowIndex,colIndex,cellKey){this.calcProcess.cellValChanged(grid,rowIndex,colIndex,cellKey);};this.doPostCellValueChanged=function(grid,rowIndex,colIndex,cellKey){this.enableProcess.cellValChanged(grid,rowIndex,colIndex,cellKey);this.visibleProcess.cellValChanged(grid,rowIndex,colIndex,cellKey);this.checkRuleProcess.cellValChanged(grid,rowIndex,colIndex,cellKey);this.dependencyProcess.cellValChanged(grid,rowIndex,colIndex,cellKey);};this.calcSubDetail=function(gridKey){this.calcProcess.calcSubDetail(gridKey);this.enableProcess.calcSubDetail(gridKey);this.visibleProcess.calcSubDetail(gridKey);this.checkRuleProcess.checkSubDetail(gridKey);};this.doPostInsertRow=function(grid,rowIndex){this.calcProcess.calcEmptyRow(grid,rowIndex);this.enableProcess.calcEmptyRow(grid,rowIndex);this.checkRuleProcess.calcEmptyRow(grid,rowIndex);this.dependencyProcess.calcEmptyRow(grid,rowIndex);};this.doPostDeleteRow=function(grid,rowIndex){this.calcProcess.doAfterDeleteRow(grid,rowIndex);this.enableProcess.doAfterDeleteRow(grid,rowIndex);};this.doPostClearAllRow=function(grid){this.enableProcess.doAfterDeleteRow(grid,-1);};};YIUI.UIEnableProcess=function(form){this.EnabltItemType={Head:0,List:1,Column:2,Operation:3};this.form=form;this.doAfterDeleteRow=function(grid,rowIndex){this.calcRowCountChange(grid,rowIndex);};this.calcRowCountChange=function(grid,rowIndex){var calcKey=grid.key+":RowCount";var affectItems=form.dependency.enableTree.affectItems;var item,expItems,expItem;for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key==calcKey){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];var isFinish=false;if(expItem.items!=null&&expItem.items.length>0){var subExpItem,sTrees=[];for(var ti=0,tlen=expItem.items.length;ti<tlen;ti++){subExpItem=expItem.items[ti];sTrees[ti]=form.getSyntaxTree(subExpItem.right);var cellLocation=form.getCellLocation(subExpItem.left);if(cellLocation!=null){if(cellLocation.key==grid.key){this.calcDetailRow(grid,subExpItem,sTrees,j,rowIndex,this.getFormEnable());isFinish=true;}else{if(grid.parentGrid!=null&&grid.parentGrid==cellLocation.key){var targetGrid=form.getComponent(cellLocation.key);this.calcDetailRow(targetGrid,subExpItem,sTrees,ti,targetGrid.getFocusRowIndex(),this.getFormEnable());isFinish=true;}}}}}if(!isFinish){this.calcExpItem(expItem,true);}}}}};this.calcAll=function(){var items=form.dependency.enableTree.items;var i,expItem,len;for(i=0,len=items.length;i<len;i++){expItem=items[i];this.calcExpItem(expItem);}};this.valueChanged=function(key){var affectItems=form.dependency.enableTree.affectItems;var item,expItems,expItem;for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key==key){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];if(expItem.type==YIUI.EnableItem.Operation){if(YIUI.TypeConvertor.toBoolean(form.eval(expItem.right,{form:form},null))){form.setOperationEnable(expItem.left,true);}else{form.setOperationEnable(expItem.left,false);}}else{this.calcExpItem(expItem,true);}}}}};this.calcOptItem=function(expItem){var optInfo=form.getOptMap()[expItem.left];if(optInfo){var toolbar=form.getComponent(optInfo.barKey);var enable=form.eval(expItem.right,{form:form},null);if(enable==null){enable=this.getFormEnable();}toolbar.setItemEnable(expItem.left,enable);}};this.dealSubDetailComps=function(form,comp,cellKey,enable){var subDetailComps=form.getCellSubDtlComps(comp.key,cellKey);if(subDetailComps!=null){for(var si=0,slen=subDetailComps.length;si<slen;si++){var subDtlComp=subDetailComps[si];subDtlComp.setEnable(enable);}}};this.calcDetailRow=function(comp,subExpItem,sTrees,treeIndex,rowIndex,formEnable){var evalV=null,evalEnable;if(!comp.getRowDataAt(rowIndex).isDetail){return false;}evalV=this.calcEnableByTree(form,subExpItem.left,sTrees[treeIndex],formEnable,rowIndex,comp.getCellIndexByKey(subExpItem.left));evalEnable=(evalV===null?formEnable:evalV);if(subExpItem.left==""){return false;}comp.setCellEnable(rowIndex,subExpItem.left,evalEnable);this.dealSubDetailComps(form,comp,subExpItem.left,evalEnable);return true;};this.calcEnable=function(form,expItem,formEnable,rowIndex,colIndex){var enable=false,defaultProxy=form.defaultUIStatusProxy,hostProxy=form.hostUIStatusProxy;if(hostProxy!=null){enable=hostProxy.validateEnable(expItem.left,expItem.right,{form:form,rowIndex:rowIndex,colIndex:colIndex},formEnable);}else{enable=defaultProxy.validateEnable(expItem.left,expItem.right,{form:form,rowIndex:rowIndex,colIndex:colIndex},formEnable);}return enable;};this.calcEnableByTree=function(form,key,syntaxTree,formEnable,rowIndex,colIndex){var enable=false,defaultProxy=form.defaultUIStatusProxy,hostProxy=form.hostUIStatusProxy;if(hostProxy!=null){enable=hostProxy.validateEnableByTree(key,syntaxTree,{form:form,rowIndex:rowIndex,colIndex:colIndex},formEnable);}else{enable=defaultProxy.validateEnableByTree(key,syntaxTree,{form:form,rowIndex:rowIndex,colIndex:colIndex},formEnable);}return enable;};this.calcExpItem=function(expItem,needCalc,isCalcSubDetailComp){var comp=form.getComponent(expItem.source);if(comp==undefined){comp=form.getPanel(expItem.source);}if(comp===undefined){this.calcOptItem(expItem);return;}var enable=null;if(enable==null&&isCalcSubDetailComp&&comp.getMetaObj().bindingCellKey!=null){var parentGrid=YIUI.SubDetailUtil.getBindingGrid(form,comp),cellData=parentGrid.getCellDataByKey(parentGrid.getFocusRowIndex(),comp.getMetaObj().bindingCellKey);if(cellData!=null){enable=cellData[2];}}if(enable==null){enable=this.getFormEnable();}if(expItem.type!==this.EnabltItemType.List){enable=this.calcEnable(form,expItem,enable);}if(comp.type==YIUI.CONTROLTYPE.LISTVIEW){$.each(comp.columnInfo,function(i,column){if(column.key==expItem.left){column.enable=enable;column.el&&comp.setColumnEnable(column.enable,column.el);}});}else{if(comp.type==YIUI.CONTROLTYPE.GRID){if(expItem.items==undefined){if(expItem.source==expItem.left){comp.setGridEnable(enable);}else{if(expItem.left!==""){var fixRowInfoes=comp.getFixRowInfoByCellKey(expItem.left);if(fixRowInfoes!==null){for(var n=0,nlen=fixRowInfoes.length;n<nlen;n++){evalV=this.calcEnable(form,expItem,enable,fixRowInfoes[n].rowIndex,fixRowInfoes[n].colIndex);evalEnable=(evalV===null?enable:evalV);comp.setCellEnable(fixRowInfoes[n].rowIndex,expItem.left,evalEnable);this.dealSubDetailComps(form,comp,expItem.left,evalEnable);}}}}}else{var subExpItem,evalV=null,evalEnable,sTrees=[];for(var ti=0,tlen=expItem.items.length;ti<tlen;ti++){subExpItem=expItem.items[ti];sTrees[ti]=form.getSyntaxTree(subExpItem.right);}for(var ind=0,ilen=expItem.items.length;ind<ilen;ind++){subExpItem=expItem.items[ind];if(subExpItem.type==this.EnabltItemType.Column){if(subExpItem.left==""){continue;}evalV=null;evalV=this.calcEnableByTree(form,subExpItem.left,sTrees[ind],enable);evalEnable=(evalV===null?enable:evalV);var colInfoes=comp.getFixRowInfoByCellKey(subExpItem.left);if(colInfoes==null){colInfoes=comp.getColInfoByKey(subExpItem.left);}if(colInfoes!==null){for(var ci=0,len=colInfoes.length;ci<len;ci++){comp.setColumnEnable(ci,evalEnable);}}}else{for(var i=0,clen=comp.getRowCount();i<clen;i++){this.calcDetailRow(comp,subExpItem,sTrees,ind,i,enable);}}}}comp.reShowCheckColumn();}else{comp.setEnable(enable);var cell_key=comp.getMetaObj().bindingCellKey;if(needCalc&&cell_key!=null&&cell_key!=""){var grid=YIUI.SubDetailUtil.getBindingGrid(form,comp);if(grid!=null){grid.setCellEnable(grid.getFocusRowIndex(),cell_key,enable);}}}}};this.cellValChanged=function(grid,rowIndex,colIndex,cellKey){var affectItems=form.dependency.enableTree.affectItems;var item,expItems,enable,expItem,subItem,colInfoes;var dealSubDetailComps=function(form,comp,cellKey,enable){var subDetailComps=form.getCellSubDtlComps(comp.key,cellKey);if(subDetailComps!=null){for(var si=0,slen=subDetailComps.length;si<slen;si++){var subDtlComp=subDetailComps[si];subDtlComp.setEnable(enable);}}};for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key.toLowerCase()==cellKey.toLowerCase()){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];if(expItem.items){for(var ind=0,elen=expItem.items.length;ind<elen;ind++){subItem=expItem.items[ind];if(subItem.left==""){continue;}colInfoes=grid.getColInfoByKey(subItem.left);if(colInfoes==null){continue;}for(var m=0,mlen=colInfoes.length;m<mlen;m++){enable=form.eval(subItem.right,{form:form,rowIndex:rowIndex,colIndex:colInfoes[m].colIndex},null);if(enable===null){enable=this.getFormEnable();}grid.setCellEnable(rowIndex,subItem.left,enable);dealSubDetailComps(form,grid,subItem.left,enable);}}}else{if(expItem.left==""){continue;}colInfoes=grid.getFixRowInfoByCellKey(expItem.left);if(colInfoes==null){continue;}for(var n=0,nlen=colInfoes.length;n<nlen;n++){enable=form.eval(expItem.right,{form:form,rowIndex:colInfoes[n].rowIndex,colIndex:colInfoes[n].colIndex},null);if(enable===null){enable=this.getFormEnable();}grid.setCellEnable(colInfoes[n].rowIndex,expItem.left,enable);dealSubDetailComps(form,grid,expItem.left,enable);}}}}}};this.calcEmptyRow=function(grid,rowIndex){var items=form.dependency.enableTree.items;var i,expItem,subItem,enable,len;for(i=0,len=items.length;i<len;i++){expItem=items[i];if(expItem.source===grid.key&&expItem.type===this.EnabltItemType.List){if(!expItem.items){continue;}for(var ind=0,elen=expItem.items.length;ind<elen;ind++){subItem=expItem.items[ind];if(subItem.type==this.EnabltItemType.Column){continue;}enable=form.eval(subItem.right,{form:form,rowIndex:rowIndex},null);if(enable===null){enable=this.getFormEnable();}if(subItem.left==""){continue;}grid.setCellEnable(rowIndex,subItem.left,enable);}}}this.calcRowCountChange(grid,rowIndex);};this.getFormEnable=function(){var operationState=form.getOperationState();return(operationState==YIUI.Form_OperationState.New||operationState==YIUI.Form_OperationState.Edit);};this.calcSubDetail=function(gridKey){var items=form.dependency.enableTree.items;var i,expItem,len,comp;for(i=0,len=items.length;i<len;i++){expItem=items[i];comp=form.getComponent(expItem.source);if(comp&&comp.getMetaObj().isSubDetail&&comp.getMetaObj().parentGridKey==gridKey){this.calcExpItem(expItem,false,true);}}};};YIUI.UIVisibleProcess=function(form){this.VisibleItemType={Head:0,Column:1,Operation:2};this.form=form;this.calcAll=function(){var items=form.dependency.visibleTree.items;var i,expItem,len;for(i=0,len=items.length;i<len;i++){expItem=items[i];this.calcExpItem(expItem);}};this.valueChanged=function(key){var affectItems=form.dependency.visibleTree.affectItems;var item,expItems,expItem;for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key.toLowerCase()==key.toLowerCase()){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];this.calcExpItem(expItem);}}}};this.cellValChanged=function(grid,rowIndex,colIndex,cellKey){var affectItems=form.dependency.visibleTree.affectItems;var item,expItems,expItem;for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key.toLowerCase()==cellKey.toLowerCase()){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];this.calcExpItem(expItem);}}}};this.calcOptItem=function(expItem){var optInfo=form.getOptMap()[expItem.left];if(optInfo){var toolbar=form.getComponent(optInfo.barKey);var visible=form.eval(expItem.right,{form:form},null);visible=(visible===null?true:visible);toolbar.setItemVisible(expItem.left,visible);}};this.calcVisible=function(form,expItem){var visible=false,defaultProxy=form.defaultUIStatusProxy,hostProxy=form.hostUIStatusProxy;if(hostProxy!=null){visible=hostProxy.validateVisible(expItem.left,expItem.right,{form:form});}else{visible=defaultProxy.validateVisible(expItem.left,expItem.right,{form:form});}return visible;};this.calcExpItem=function(expItem){var comp=form.getComponent(expItem.source);if(comp==undefined){comp=form.getPanel(expItem.source);this.calcOptItem(expItem);return;}var visible=this.calcVisible(form,expItem);if(comp.type==YIUI.CONTROLTYPE.LISTVIEW){var i,column,len;for(i=0,len=comp.columnInfo.length;i<len;i++){column=comp.columnInfo[i];if(column.key===expItem.left){column.visible=visible;comp.setColumnVisible(column.key,visible);break;}}}else{if(comp.type==YIUI.CONTROLTYPE.GRID){if(expItem.type!==this.VisibleItemType.Column){return;}comp.setColumnVisible(expItem.left,visible);}else{if(comp.isBuddy()){return;}comp.setVisible(visible);if(!comp.isVisible()&&(comp.errorInfo.error||comp.isRequired())){if(!form.errorInfo.error){if(comp.isRequired()){form.setError(true,comp.key+"必填",comp.key);}else{form.setError(true,comp.errorInfo.msg,comp.key);}}}else{if(form.errorInfo.error&&form.errorInfo.errorSource!=null&&form.errorInfo.errorSource==comp.key){form.setError(false,null);}}var ownerCt=comp.ownerCt;if(ownerCt&&ownerCt.type==YIUI.CONTROLTYPE.FLUIDTABLELAYOUTPANEL){if(comp.visible==visible){return;}ownerCt.reLayout();}}}};this.calcSubDetail=function(gridKey){var items=form.dependency.visibleTree.items;var i,expItem,comp,len;for(i=0,len=items.length;i<len;i++){expItem=items[i];comp=form.getComponent(expItem.source);if(comp&&comp.getMetaObj().isSubDetail&&comp.getMetaObj().parentGridKey==gridKey){this.calcExpItem(expItem);}}};};YIUI.UICalcProcess=function(form){this.CalcItemType={Head:0,List:1};this.form=form;this.doAfterDeleteRow=function(grid,rowIndex){var metaDtlRow=grid.metaRowInfo.rows[grid.metaRowInfo.dtlRowIndex];var affectItems=form.dependency.calcTree.affectItems;var item,expItems,expItem,needCalcItems=[];for(var i=0,len=metaDtlRow.cells.length;i<len;i++){var metaCell=metaDtlRow.cells[i];for(var ind=0,ilen=affectItems.length;ind<ilen;ind++){item=affectItems[ind];if(item.key.toLowerCase()==metaCell.key.toLowerCase()){if(item.expItems==null||item.expItems.length==0){needCalcItems.push(item);}else{for(var m=0,mlen=item.expItems.length;m<mlen;m++){expItem=item.expItems[m];var g=form.getComponent(expItem.source);if(YIUI.SubDetailUtil.isSubDetail(form,grid,g.key)){this.calcEmptyRow(g,g.getFocusRowIndex());}}}}}}needCalcItems.sort(function(item1,item2){return parseFloat(item1.order)-parseFloat(item2.order);});for(var k=0,kLen=needCalcItems.length;k<kLen;k++){this.calcExpItem(needCalcItems[k],true);}};this.calcAll=function(){switch(form.getOperationState()){case YIUI.Form_OperationState.New:this.calcAllItems(true);break;case YIUI.Form_OperationState.Default:case YIUI.Form_OperationState.Edit:this.calcAllItems(false);break;default:break;}};this.calcAllItems=function(calcAll){var items=form.dependency.calcTree.items;var i,expItem,len;for(i=0,len=items.length;i<len;i++){expItem=items[i];this.calcExpItem(expItem,calcAll);}};this.valueChanged=function(key){var affectItems=form.dependency.calcTree.affectItems;var item,expItems,expItem;for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key.toLowerCase()==key.toLowerCase()){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];this.calcExpItem(expItem,true);}}}};this.hasDefaultValue=function(expItem){return(expItem.formulaValue!==null&&expItem.formulaValue.length>0)||(expItem.defaultValue!==null&&expItem.defaultValue.length>0);};this.isNeedCalcDefaultValue=function(curGridKey,metaRow,rowIndex,cellIndex){var valueDependency=metaRow.cells[cellIndex].valueDependency,isNeedCalc=true;if(valueDependency!=null){var dependencyArray=valueDependency.split(",");for(var di=0,dlen=dependencyArray.length;di<dlen;di++){var dependency=dependencyArray[di],dpComp=form.getCellLocation(dependency);if(dpComp==null){dpComp=form.getComponent(dependency);}else{dpComp=form.getComponent(dpComp.key);}if(dpComp!=null&&dpComp.parentGrid!=null&&dpComp.parentGrid==curGridKey){var pGrid=form.getComponent(dpComp.parentGrid);if(pGrid!=null&&pGrid.getFocusRowIndex()!=rowIndex){isNeedCalc=false;}}}}return isNeedCalc;};this.getCalcValue=function(expItem,rowIndex,colIndex,gridKey,metaRow){var value,cxt={form:form};if(expItem.formulaValue!==null&&expItem.formulaValue.length>0){if((metaRow!=null&&this.isNeedCalcDefaultValue(gridKey,metaRow,rowIndex,colIndex))||metaRow==null){value=form.eval(expItem.formulaValue,{form:form,target:expItem.left,rowIndex:rowIndex,colIndex:colIndex},null);}}else{if(expItem.defaultValue!==null&&expItem.defaultValue.length>0){value=expItem.defaultValue;}}return value;};this.cellValChanged=function(grid,rowIndex,cellIndex,cellkey){var affectItems=form.dependency.calcTree.affectItems,self=this,item,expItems,expItem,value,colInfoes,comp,calcV,metaRow;for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key.toLowerCase()==cellkey.toLowerCase()){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];comp=form.getComponent(expItem.source);if(comp.type==YIUI.CONTROLTYPE.GRID){colInfoes=comp.getFixRowInfoByCellKey(expItem.left);if(colInfoes==null){colInfoes=comp.getColInfoByKey(expItem.left);if(colInfoes!==null){for(var m=0,mlen=colInfoes.length;m<mlen;m++){metaRow=comp.metaRowInfo.rows[comp.metaRowInfo.dtlRowIndex];calcV=self.getCalcValue(expItem,rowIndex,colInfoes[m].colIndex,grid.key,metaRow);if(calcV===undefined){continue;}if(comp.getFocusRowIndex()!=-1&&comp.getFocusRowIndex()!=rowIndex){rowIndex=comp.getFocusRowIndex();}comp.setValueAt(rowIndex,colInfoes[m].colIndex,calcV,true,false,true);}}}else{for(var n=0,nlen=colInfoes.length;n<nlen;n++){metaRow=comp.metaRowInfo.rows[colInfoes[n].metaRowIndex];calcV=self.getCalcValue(expItem,colInfoes[n].rowIndex,colInfoes[n].colIndex,grid.key,metaRow);if(calcV===undefined){continue;}comp.setValueAt(colInfoes[n].rowIndex,colInfoes[n].colIndex,calcV,true,false,true);}}YIUI.GridSumUtil.evalSum(form,comp);}else{value=this.getCalcValue(expItem);comp.setValue(value,true,false);}}}}};this.calcExpItem=function(expItem,calcAll){var comp=form.getComponent(expItem.source),needCalc,calcV;if(comp===undefined){return;}if(comp.type==YIUI.CONTROLTYPE.LISTVIEW){var getColInfo=function(colKey){var colInfo;for(var ind=0,clen=comp.columnInfo.length;ind<clen;ind++){colInfo=comp.columnInfo[ind];if(colInfo.key===colKey){return{index:ind,col:colInfo};}}return null;};var colInfo=getColInfo(expItem.left);if(calcAll){needCalc=true;}else{needCalc=colInfo.col.columnKey===undefined||(colInfo.col.columnKey.length==0);}if(needCalc){for(var i=0,len=comp.data.length;i<len;i++){calcV=this.getCalcValue(expItem,i,colInfo.index);if(calcV!==undefined){comp.setValByIndex(i,colInfo.index,calcV);}}}}else{if(comp.type==YIUI.CONTROLTYPE.GRID){var rowData,self=this,cEditOpt,cInfoes=comp.getFixRowInfoByCellKey(expItem.left),cInfo,isNotDetail=true;var calcValue=function(colInfo,rowIndex,colIndex){cEditOpt=cInfo.cell;if(calcAll){needCalc=true;}else{needCalc=(cEditOpt.columnKey==undefined||cEditOpt.columnKey.length==0);}if(needCalc&&self.hasDefaultValue(expItem)){rowData=comp.getRowDataAt(rowIndex);var commit=!(rowData.isDetail&&rowData.bookmark==undefined);calcV=self.getCalcValue(expItem,rowIndex,colIndex,comp.key,colInfo.metaRow);if(calcV!==undefined){comp.setValueAt(rowIndex,colIndex,calcV,commit,false,true);}}};if(cInfoes==null){cInfoes=comp.getColInfoByKey(expItem.left);isNotDetail=false;}if(cInfoes==null){return;}if(isNotDetail){for(var m=0,mlen=cInfoes.length;m<mlen;m++){cInfo=cInfoes[m];calcValue(cInfo,cInfo.rowIndex,cInfo.colIndex);}}else{for(var ind=0,dlen=comp.getRowCount();ind<dlen;ind++){rowData=comp.getRowDataAt(ind);if(rowData.isDetail){for(var n=0,nlen=cInfoes.length;n<nlen;n++){cInfo=cInfoes[n];calcValue(cInfo,ind,cInfo.colIndex);}}}}YIUI.GridSumUtil.evalSum(form,comp);}else{var hasData=(comp.tableKey!==undefined&&comp.tableKey.length!==0&&comp.columnKey!==undefined&&comp.columnKey.length!==0);if(calcAll){needCalc=true;}else{needCalc=!hasData&&(comp.getMetaObj().bindingCellkey==undefined||comp.getMetaObj().bindingCellkey.length==0);}if(needCalc){calcV=this.getCalcValue(expItem);if(calcV!==undefined){comp.setValue(calcV,true,false);}}}}};this.calcEmptyRow=function(grid,rowIndex){var items=form.dependency.calcTree.items,rd=grid.getRowDataAt(rowIndex);if(!rd.isDetail){return;}var i,len,expItem,colInfoes,value,needCalc,calcV,rnct,colIndex;for(i=0,len=items.length;i<len;i++){expItem=items[i];if(expItem.source===grid.key&&expItem.type===this.CalcItemType.List){colInfoes=grid.getColInfoByKey(expItem.left);if(colInfoes==null){continue;}for(var j=0,jlen=colInfoes.length;j<jlen;j++){colIndex=colInfoes[j].colIndex;rnct=grid.showRowHead?1:0;calcV=this.getCalcValue(expItem,rowIndex,colIndex,grid.key,colInfoes[j].metaRow);if(calcV==undefined){continue;}grid.setValueAt(rowIndex,colIndex,calcV,false,true,true,true);value=null;}}}};this.calcSubDetail=function(gridKey){var items=form.dependency.calcTree.items;var i,expItem,len,comp;for(i=0,len=items.length;i<len;i++){expItem=items[i];comp=form.getComponent(expItem.source);if(comp&&comp.getMetaObj().isSubDetail&&comp.getMetaObj().parentGridKey==gridKey){this.calcExpItem(expItem);}}};};YIUI.UICheckRuleProcess=function(form){this.CheckRuleItemType={Head:0,List:1};this.form=form;this.checkAll=function(){var formState=form.getOperationState();var enableOnly=(formState==YIUI.Form_OperationState.New||formState==YIUI.Form_OperationState.Edit)?false:formState==YIUI.Form_OperationState.Default;this.checkGlobal();this.checkAllComponent(enableOnly);this.checkAllRowCheckRule();};this.checkGlobal=function(){if(!form.checkRules){return;}var i,len,checkRule,result=true;for(i=0,len=form.checkRules.length;i<len;i++){checkRule=form.checkRules[i];if(checkRule.content&&checkRule.content.length>0){result=form.eval($.trim(checkRule.content),{form:form},null);form.setError(!result,checkRule.errorMsg);if(!result){break;}}}};this.checkAllRowCheckRule=function(){var i,j,gridInfo,grid,len,dlen;for(i=0,len=form.getGridInfoMap().length;i<len;i++){gridInfo=form.getGridInfoMap()[i];grid=form.getComponent(gridInfo.key);grid.errorInfoes.rows=[];for(j=0,dlen=grid.getRowCount();j<dlen;j++){if(grid.getRowDataAt(j).isDetail){this.checkRow(grid,j);}}grid.setGridErrorRows(grid.errorInfoes.rows);}};this.checkRow=function(grid,rowIndex){if(rowIndex==-1){return;}var k,len,rowCheckRule,result=true,metaRowIndex=grid.getRowDataAt(rowIndex).metaRowIndex,rowCheckRules=grid.rowCheckRules[metaRowIndex];if(!rowCheckRules){return;}for(k=0,len=rowCheckRules.length;k<len;k++){rowCheckRule=rowCheckRules[k];result=form.eval($.trim(rowCheckRule.content),{form:form,rowIndex:rowIndex},null);if(!result){var length=grid.errorInfoes.rows.length,errorRow,match=false;for(var m=0;m<length;m++){errorRow=grid.errorInfoes.rows[m];if(errorRow.rowIndex==rowIndex){match=true;break;}}if(!match){grid.errorInfoes.rows.push({rowIndex:rowIndex,errorMsg:rowCheckRule.errorMsg});}}else{var rlen=grid.errorInfoes.rows.length,errRow;for(var i=rlen-1;i>=0;i--){errRow=grid.errorInfoes.rows[i];if(errRow.rowIndex==rowIndex){grid.errorInfoes.rows.splice(i,1);}}}}};this.checkAllComponent=function(enableOnly){var items=form.dependency.checkRuleTree.items;var i,expItem,gridMap=form.getGridInfoMap(),len=gridMap.length,ilen=items.length;for(var j=0;j<len;j++){var grid=form.getComponent(gridMap[j].key);grid.errorInfoes.cells=[];}for(i=0;i<ilen;i++){expItem=items[i];this.checkComponent(expItem,enableOnly,false);}};this.checkComponent=function(expItem,enableOnly,needCheck){var comp=form.getComponent(expItem.source),result=true;if(comp===undefined||(enableOnly&&!comp.isEnable())){return;}if(comp.type==YIUI.CONTROLTYPE.GRID){if(expItem.items==undefined){if(expItem.content&&expItem.content.length>0){var fixRowInfoes=comp.getFixRowInfoByCellKey(expItem.left),fixRowInfo;if(fixRowInfoes==null){return;}for(var fi=0,flen=fixRowInfoes.length;fi<flen;fi++){fixRowInfo=fixRowInfoes[fi];result=form.eval($.trim(expItem.content),{form:form,rowIndex:fixRowInfo.rowIndex,colIndex:fixRowInfo.colIndex},null);comp.modifyCellErrors(fixRowInfo.rowIndex,fixRowInfo.colIndex,result,expItem.errorMsg);}}else{return;}}else{var subExpItem,colInfoes,rowData;for(var ind=0,len=expItem.items.length;ind<len;ind++){subExpItem=expItem.items[ind];if(!subExpItem.content||subExpItem.content.length==0){continue;}for(var i=0,dlen=comp.getRowCount();i<dlen;i++){rowData=comp.getRowDataAt(i);if(!rowData.isDetail){continue;}colInfoes=comp.getColInfoByKey(subExpItem.left);if(colInfoes==null){continue;}for(var ci=0,clen=colInfoes.length;ci<clen;ci++){result=form.eval(subExpItem.content,{form:form,rowIndex:i,colIndex:colInfoes[ci].colIndex},null);comp.modifyCellErrors(i,colInfoes[ci].colIndex,result,subExpItem.errorMsg);}}}}comp.setGridErrorCells(comp.errorInfoes.cells);}else{if(comp.type==YIUI.CONTROLTYPE.LISTVIEW){}else{var selfDefined=false,selfRequiredDefined=false,cellErrorInfo,cellData;if(comp.getMetaObj().required){comp.setRequired(comp.isNull());selfRequiredDefined=true;}if(expItem.content&&expItem.content.length>0){result=form.eval($.trim(expItem.content),{form:form},null);if(result){comp.setError(false,null);}else{comp.setError(true,expItem.errorMsg);}selfDefined=true;}cellErrorInfo=YIUI.SubDetailUtil.getBindingCellError(form,comp);cellData=YIUI.SubDetailUtil.getBindingCellData(form,comp);if(!selfDefined&&cellErrorInfo!=null){comp.setError(true,cellErrorInfo.errorMsg);}if(!selfRequiredDefined&&cellData!=null){comp.setRequired(cellData[3]);}if(!comp.isVisible()&&(comp.errorInfo.error||comp.isRequired())){if(!form.errorInfo.error){if(comp.isRequired()){form.setError(true,comp.key+"必填",comp.key);}else{form.setError(true,comp.errorInfo.msg,comp.key);}}}else{if(form.errorInfo.error&&form.errorInfo.errorSource!=null&&form.errorInfo.errorSource==comp.key){form.setError(false,null);}}if(needCheck&&comp.getMetaObj().bindingCellKey!=null){var grid=YIUI.SubDetailUtil.getBindingGrid(form,comp);var rowIndex=grid.getFocusRowIndex(),cellIndex=grid.getCellIndexByKey(comp.getMetaObj().bindingCellKey);if(rowIndex>-1&&cellIndex>-1){grid.modifyCellErrors(rowIndex,cellIndex,!comp.errorInfo.error,comp.errorInfo.msg);grid.setGridErrorCells(grid.errorInfoes.cells);grid.setCellRequired(rowIndex,cellIndex,comp.isRequired());}}}}};this.calcEmptyRow=function(grid,rowIndex){var items=form.dependency.checkRuleTree.items;var i,expItem,subExpItem,colInfoes,colIndex,result,len=items.length;for(i=0;i<len;i++){expItem=items[i];if(expItem.source===grid.key&&expItem.type===this.CheckRuleItemType.List){if(!expItem.items){return;}for(var ind=0,elen=expItem.items.length;ind<elen;ind++){subExpItem=expItem.items[ind];if(!subExpItem.content||subExpItem.content.length==0){continue;}colInfoes=grid.getColInfoByKey(subExpItem.left);if(colInfoes!==null){for(var j=0,jlen=colInfoes.length;j<jlen;j++){colIndex=colInfoes[j].colIndex;result=form.eval(subExpItem.content,{form:form,rowIndex:rowIndex,colIndex:colIndex},null);grid.modifyCellErrors(rowIndex,colIndex,result,subExpItem.errorMsg);}}}}}grid.setGridErrorCells(grid.errorInfoes.cells);this.checkRow(grid,rowIndex);grid.setGridErrorRows(grid.errorInfoes.rows);};this.valueChanged=function(key){var formState=form.getOperationState();var enableOnly=(formState==YIUI.Form_OperationState.New||formState==YIUI.Form_OperationState.Edit)?false:formState==YIUI.Form_OperationState.Default;var comp=form.getComponent(key);if(comp.getMetaObj().required){comp.setRequired(comp.isNull());}var affectItems=form.dependency.checkRuleTree.affectItems;var item,expItems,expItem;for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key.toLowerCase()==key.toLowerCase()){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];this.checkComponent(expItem,enableOnly,true);}}}if(comp.getMetaObj().isSubDetail&&!enableOnly){var parentGrid=form.getComponent(comp.getMetaObj().parentGridKey);if(parentGrid){this.calcEmptyRow(parentGrid,parentGrid.getFocusRowIndex());}}this.checkGlobal();};this.cellValChanged=function(grid,rowIndex,colIndex,cellKey){var affectItems=form.dependency.checkRuleTree.affectItems;var item,expItems,expItem,subExpItem,result=false,colInfoes,colInfo;var dealSubDetailCompError=function(error,msg,isRequired){if(grid.getFocusRowIndex()==rowIndex){var cellSubDtlComps=form.getCellSubDtlComps(grid.key,cellKey);if(cellSubDtlComps!=null&&cellSubDtlComps.length>0){for(var csi=0,csLen=cellSubDtlComps.length;csi<csLen;csi++){var comp=cellSubDtlComps[csi];comp.setError(!error,msg);comp.setRequired(isRequired);}}}};for(var i=0,len=affectItems.length;i<len;i++){item=affectItems[i];if(item.key.toLowerCase()==cellKey.toLowerCase()){expItems=item.expItems;for(var j=0,length=expItems.length;j<length;j++){expItem=expItems[j];if(expItem.items==undefined){if(!expItem.content||expItem.content.length==0){continue;}colInfoes=grid.getFixRowInfoByCellKey(expItem.left);if(colInfoes==null){continue;}for(var m=0,mlen=colInfoes.length;m<mlen;m++){colInfo=colInfoes[m];result=form.eval($.trim(expItem.content),{form:form,rowIndex:colInfo.rowIndex,colIndex:colInfo.colIndex},null);grid.modifyCellErrors(colInfo.rowIndex,colInfo.colIndex,result,expItem.errorMsg);dealSubDetailCompError(result,expItem.errorMsg,colInfo.isRequired);}}else{for(var k=0,elen=expItem.items.length;k<elen;k++){subExpItem=expItem.items[k];if(!subExpItem.content||subExpItem.content.length==0){continue;}colInfoes=grid.getColInfoByKey(subExpItem.left);if(colInfoes==null){continue;}for(var n=0,nlen=colInfoes.length;n<nlen;n++){colInfo=colInfoes[n];result=form.eval($.trim(subExpItem.content),{form:form,rowIndex:rowIndex,colIndex:colInfo.colIndex},null);grid.modifyCellErrors(rowIndex,colInfo.colIndex,result,subExpItem.errorMsg);dealSubDetailCompError(result,expItem.errorMsg,colInfo.isRequired);}}}}}}grid.setGridErrorCells(grid.errorInfoes.cells);this.checkRow(grid,rowIndex);grid.setGridErrorRows(grid.errorInfoes.rows);this.checkGlobal();};this.checkSubDetail=function(gridKey){var formState=form.getOperationState();var enableOnly=(formState==YIUI.Form_OperationState.New||formState==YIUI.Form_OperationState.Edit)?false:formState==YIUI.Form_OperationState.Default;var items=form.dependency.checkRuleTree.items;var i,expItem,comp,len=items.length;for(i=0;i<len;i++){expItem=items[i];comp=form.getComponent(expItem.source);if(comp&&comp.getMetaObj().isSubDetail&&comp.getMetaObj().parentGridKey==gridKey){this.checkComponent(expItem,enableOnly,true);}}};};YIUI.UIDependencyProcess=function(form){this.form=form;this.calcAll=function(){if(this.form.getOperationState()==YIUI.Form_OperationState.Default){var relations=form.getRelations(),targetFields,targetField,targetComp,value;if(relations!=null){for(var dependencyField in relations){value=this.form.getComponentValue(dependencyField);if(!YIUI.TypeConvertor.toBoolean(value)){return;}targetFields=relations[dependencyField];for(var i=0,len=targetFields.length;i<len;i++){targetField=targetFields[i];targetComp=this.form.getComponent(targetField);if(targetComp!=null){if(!targetComp.hasDataBinding){targetComp.dependedValueChange(dependencyField);}}}}}}};this.valueChanged=function(key){var relations=form.getRelations(),targetFields,targetField,targetComp,cellLocation,grid;if(relations==null){return;}for(var dependencyField in relations){if(dependencyField!=key){continue;}targetFields=relations[dependencyField];for(var i=0,len=targetFields.length;i<len;i++){targetField=targetFields[i];targetComp=this.form.getComponent(targetField);cellLocation=this.form.getCellLocation(targetField);if(targetComp!=null){targetComp.dependedValueChange(dependencyField);}else{if(cellLocation!=null){grid=this.form.getComponent(cellLocation.key);grid.dependedValueChange(targetField,dependencyField,null);}}}}};this.cellValChanged=function(grid,rowIndex,colIndex,cellKey){var relations=form.getRelations(),targetFields,targetField;if(relations==null){return;}for(var dependencyField in relations){if(dependencyField!=cellKey){continue;}targetFields=relations[dependencyField];for(var i=0,len=targetFields.length;i<len;i++){targetField=targetFields[i];grid.doPostCellValueChanged(rowIndex,dependencyField,targetField,null);}}};this.calcEmptyRow=function(grid,rowIndex){var gridRow=grid.getRowDataAt(rowIndex),metaRow=grid.metaRowInfo.rows[gridRow.metaRowIndex];for(var i=0,len=metaRow.cells.length;i<len;i++){var metaCell=metaRow.cells[i];if(metaCell.cellType==YIUI.CONTROLTYPE.DYNAMIC){}}};};})();(function(){YIUI.Paras=function(b){var a={map:{},mapType:{},put:function(c,d){this.map[c]=d;},get:function(c){return this.map[c]||null;},getMap:function(){return this.map;},init:function(){if($.isEmptyObject(b)){return;}var d=b.items;for(var e=0,c=d.length;e<c;e++){var f=d[e];this.put(f.key,f.value);this.mapType[f.key]=f.type;}},toJSON:function(){var f={};if(!$.isEmptyObject(this.map)){var e=[];for(var c in this.map){var d=this.map[c];var g=this.mapType[c];if(!g){if($.isNumeric(d)){g=YIUI.JavaDataType.USER_LONG;}else{if(d instanceof Decimal){g=YIUI.JavaDataType.USER_NUMERIC;d=d.toString();}else{if(typeof d=="boolean"){g=YIUI.JavaDataType.USER_BOOLEAN;}else{if(d instanceof Date){g=YIUI.JavaDataType.USER_DATETIME;d=d.getTime();}else{if(typeof d=="string"){g=YIUI.JavaDataType.USER_STRING;}}}}}}var h={key:c,value:d||null,type:g};e.push(h);}f.items=e;}return $.toJSON(f);}};a.init();return a;};})();(function(){YIUI.PPObject=function(b){var a={LONG:1,ARRAY:2,DATATABLE:3,type:-1,operatorID:-1,operatorList:[],complexOperatorTable:null,init:function(){if($.isNumeric(b)){this.type=this.LONG;this.operatorID=parseInt(b);}else{if(b instanceof Array){this.type=this.ARRAY;this.operatorList=b;}else{if(b instanceof DataDef.DataTable){this.type=this.DATATABLE;this.complexOperatorTable=b;}}}},toJSON:function(){var g={};g.Type=this.type;if(this.type==this.LONG){g.OperatorID=this.operatorID;}else{if(this.type==this.ARRAY){var f=[];for(var e=0,c=this.operatorList.length;e<c;e++){f.push(this.operatorList[e]);}g.OperatorList=f;}else{if(this.type==this.DATATABLE){var d=YIUI.DataUtil.toJSONDataTable(this.complexOperatorTable);g.ComplexOperatorTable=d;}}}return g;}};a.init();return a;};})();(function(){YIUI.PrintURLs={};YIUI.Print={print:function(a,d){var b=$("iframe",document.body);if(b.length==0){b=$("<iframe src='"+a+"' style='display:none;'></iframe>");b.appendTo($(document.body));}var c=b[0].contentWindow;if(!YIUI.PrintURLs[d]){YIUI.PrintURLs[d]=[];}YIUI.PrintURLs[d].push(a);c.print();},del:function(c){var b=YIUI.PrintURLs[c];if(b&&b.length>0){var a={};a.service="PrintService";a.cmd="DeletePDF";a.names=$.toJSON(b);Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,a);b=[];}},delAll:function(){for(var a in YIUI.PrintURLs){YIUI.Print.del(a);}}};YIUI.PrintPreview=function(d){var c=$("<div/>");var b=d.url;var f=d.target;var e=d.formKey;var a={init:function(){if(!YIUI.PrintURLs[e]){YIUI.PrintURLs[e]=[];}YIUI.PrintURLs[e].push(b);if(f=="self"){c.modalDialog(null,{title:"预览",showClose:false,width:"80%",height:"80%"});c.dialogContent().attr("id","print-ct");var g=new PDFObject({url:b}).embed("print-ct");}else{window.open(b);}},setHeight:function(g){c.css("height",g);}};a.init();};})();YIUI.Form=YIUI.extend({init:function(g){this.operationState=g["operationState"]?g["operationState"]:YIUI.Form_OperationState.Default;this.initOperationState=g["initOperationState"]||YIUI.Form_OperationState.Default;this.type=g["type"];this.mergeOpt=g["mergeOpt"];this.options=g["options"];this.defTbr=g["defTbr"];this.OID=g["OID"]||-1;this.formID=g["formID"]||YIUI.Form_allocFormID();this.formKey=g["key"];this.formCaption=g["caption"];this.abbrCaption=g["abbrCaption"];this.target=g["target"];this.pFormID=g["parentID"];this.mainTableKey=g["mainTableKey"];var a=g["body"];var e=a["index_of_block"];var f=a["items"][e];var d=f["rootPanel"];d.topMargin=g["topMargin"];d.bottomMargin=g["bottomMargin"];d.leftMargin=g["leftMargin"];d.rightMargin=g["rightMargin"];d.abbrCaption=g["abbrCaption"];d.hAlign=g["hAlign"];var c={formID:this.formID,rootPanelObj:d,defCtKey:g["defCtKey"]};this.formAdapt=new YIUI.FormAdapt(c);this.standalone=g["standalone"]||false;this.relations=g["relations"];this.macroMap=g["macroMap"];this.statusItems=g["statusItems"];this.paraGroups=g["paraGroups"];this.sysExpVals=g["sysExpVals"];this.filterMap=g["filterMap"]===undefined?null:new FilterMap(g["filterMap"]);this.dependency=g["dependency"];this.paras=new YIUI.Paras(g["parameters"]);this.callParas=new YIUI.Paras(g["callParameters"]);this.paraCollection=g["paraCollection"];this.checkRules=g["checkRules"];this.subDetailInfo=g["subDetailInfo"];this.mapGrids=g["mapGrids"];this.errorInfo={error:g["isError"],errorMsg:g["errorMsg"],errorSource:g["errorSource"]};this.dataObjectKey=g["dataObjectKey"]||null;this.refObjectKey=g["refObjectKey"]||null;this.refTableKey=g["refTableKey"]||null;this.parser=new View.Parser(this);this.uiProcess=new YIUI.UIProcess(this);this.result=null;this.eventList={};this.defaultUIStatusProxy=new YIUI.DefaultStatusProxy(this);var b=this.sysExpVals?this.sysExpVals[YIUI.BPMConstants.WORKITEM_INFO]:null;if(g["hostUIStatusProxy"]&&b!=null){this.hostUIStatusProxy=new YIUI.HostStatusProxy(b);}YIUI.FormStack.addForm(this);},setSysExpVals:function(a,b){if(!this.sysExpVals){this.sysExpVals={};}this.sysExpVals[a]=b;},getSysExpVals:function(a){if(this.sysExpVals){return this.sysExpVals[a];}return null;},isStandalone:function(){return this.standalone;},setResult:function(a){this.result=a;},getResult:function(){return this.result;},setAbbrCaption:function(a){this.abbrCaption=a;},getAbbrCaption:function(){return this.abbrCaption;},getFormAdapt:function(){return this.formAdapt;},addOpt:function(c,f,g){var b=f.items;for(var d=0,a=b.length;d<a;d++){var e=b[d];e.formID=f.formID;c.items.push(e);g[e.key]={barKey:this.defTbr,opt:e};}this.cFormID=f.formID;this.hasMerge=true;},delOpt:function(d,g,h){var c=g.items;var a=c.length;var b=d.items.length;d.items.splice(b-a,a);this.hasMerge=false;for(var e=0,a=c.length;e<a;e++){var f=c[e];delete h[f.key];}},getOptMap:function(){var f=this.formAdapt.getOptMap();var d=this.expOpts;if(this.mergeOpt){var b=this.defTbr;var a=this.getComponent(b);if(this.cFormID){var e=d.formID;var c=YIUI.FormStack.getForm(e);this.delOpt(a,d,f);if(!c){this.cFormID=null;}else{d.formID=c.formID;this.addOpt(a,d,f);}}else{if(!this.hasMerge){this.addOpt(a,d,f);}}}return f;},setError:function(a,b,c){this.errorInfo={error:a,errorMsg:b,errorSource:c};if(a){this.showErrMsg(b);}else{this.hideErrMsg();}},getCellSubDtlComps:function(a,d){var c=this.formAdapt.getCellSubDtlCompMap();if(c==null){return null;}var b=c[a];if(b==null){return null;}return b[d];},getGridInfoMap:function(){return this.formAdapt.getGridMap();},getGridInfoByTableKey:function(d){var e=this.getGridInfoMap(),c;for(var b=0,a=e.length;b<a;b++){c=e[b];if(c.tableKey==d){return c;}}},getGridInfoByKey:function(d){var e=this.getGridInfoMap(),c;for(var b=0,a=e.length;b<a;b++){c=e[b];if(c.key==d){return c;}}},getListView:function(a){return this.formAdapt.getListView(a);},diff:function(e){this.operationState=e["operationState"];var a=e["body"];var c=a["index_of_block"];var d=a["items"][c];var b=d["rootPanel"];this.sysExpVals=e.sysExpVals;this.getRoot().diff(b);this.setError(e["isError"],e["errorMsg"],e["errorSource"]);},getComponentList:function(){return this.formAdapt.getCompList();},getComponent:function(a){return this.formAdapt.getComp(a);},getPanel:function(a){return this.formAdapt.getPanel(a);},setFormKey:function(a){this.formKey=a;},getFormKey:function(){return this.formKey;},setFormCaption:function(a){this.formCaption=a;},getFormCaption:function(){return this.formCaption;},getDataObjectKey:function(){return this.dataObjectKey;},getRoot:function(){return this.formAdapt.getRoot();},setDocument:function(a){this.document=a;},getDocument:function(){return this.document;},showDocument:function(){var a=new YIUI.ShowData(this);return a.show();},setComponentValue:function(b,c,a){this.formAdapt.setCompValue(b,c,a);},setCellValByIndex:function(c,e,a,d,b){this.formAdapt.setCellValByIndex(c,e,a,d,b);},getCellValByIndex:function(b,c,a){return this.formAdapt.getCellValByIndex(b,c,a);},setCellValByKey:function(c,e,a,d,b){this.formAdapt.setCellValByKey(c,e,a,d,b);},getCellValByKey:function(b,c,a){return this.formAdapt.getCellValByKey(b,c,a);},getComponentValue:function(b,a){return this.formAdapt.getCompValue(b,a);},getCellLocation:function(a){return this.formAdapt.getCellLocation(a);},setFilterMap:function(a){this.filterMap=a;},getFilterMap:function(){return this.filterMap;},getMainTableKey:function(){return this.mainTableKey;},setCondParas:function(a){this.conParas=a;},getCondParas:function(){return this.conParas==null?{}:this.conParas;},setInitOperationState:function(a){this.initOperationState=a;},getInitOperationState:function(){return this.initOperationState;},setOperationState:function(a){this.operationState=a;},getOperationState:function(){return this.operationState;},setOperationEnable:function(d,b){var f=this.getOptMap();var c=f[d];var a=c.barKey;var e=this.getComponent(a);e.setItemEnable(d,b);},resetUIStatus:function(a){this.uiProcess.resetUIStatus(a);},getUIProcess:function(){return this.uiProcess;},setDefContainer:function(a){this.formAdapt.setDefContainer(a);},getDefContainer:function(){return this.formAdapt.getDefContainer();},setContainer:function(a){var b=this;this.formAdapt.setContainer(a);b.initFirstFocus();},getContainer:function(){return this.formAdapt.getContainer();},newCxt:function(){return{form:this};},getRelations:function(){return this.relations;},setPara:function(a,b){this.paras.put(a,b);},getPara:function(a){return this.paras.get(a);},setCallPara:function(a,b){this.callParas.put(a,b);},getCallPara:function(a){return this.callParas.get(a);},getParaCollection:function(){return this.paraCollection;},getParas:function(){if(this.paras==undefined){this.paras={};}return this.paras;},getCallParas:function(){if(this.callParas==undefined){this.callParas={};}return this.callParas;},setErrDiv:function(b){this.errDiv=b;var a=this;window.setTimeout(function(){if(!a.isDestroyed){a.setError(a.errorInfo.error,a.errorInfo.errorMsg,a.errorInfo.errorSource);}},0);},showErrMsg:function(b){if(!this.errDiv||this.errDiv.css("display")=="block"){return;}$("label",this.errDiv).text(b);this.errDiv.show();var a=this.getRoot().getHeight()-this.errDiv.height();var c=this.getRoot().getWidth();this.getRoot().doLayout(c,a);},hideErrMsg:function(){if(!this.errDiv||this.errDiv.css("display")=="none"){return;}this.errDiv.hide();var a=this.getRoot().getHeight();var b=this.getRoot().getWidth();this.getRoot().doLayout(b,a);},reloadTable:function(e){var a=this.getDocument();var g=this.getFilterMap();g.setType(YIUI.DocumentType.DETAIL);var b=this.getCondParas();var d={};d.service="PureOpt";d.cmd="ReloadTable";d.tableKey=e;d.formKey=this.formKey;d.filterMap=$.toJSON(g);d.condParas=$.toJSON(b);var c=Svr.Request.getSyncData(Svr.SvrMgr.ServletURL,d);if(c){var f=YIUI.DataUtil.fromJSONDataTable(c);a.remove(e);a.add(e,f);}},initFirstFocus:function(){var h=this;var a=this.getContainer();var j;if(a){if(a[0]&&a[0].tagName){j=a;}else{j=a.container.el||a.container;}}else{j=this.getRoot().container.el;}var b=this.getTabCompList(),d=null;for(var c=0,e=b.length;c<e;c++){d=b[c];if(d==undefined||d==null){continue;}var f=$(d.el).parents(".ui-tabs-panel");var g=(f.length>0&&f[0].style.display!=="none")||(f.length==0);if(d.enable&&d.visible&&g){switch(d.type){case YIUI.CONTROLTYPE.GRID:d.initFirstFocus();break;default:d.focus();break;}break;}}},getParentForm:function(){return YIUI.FormStack.getForm(this.pFormID);},fireClose:function(){if(this.type!=YIUI.Form_Type.Entity){this.close();return true;}if(this.operationState==YIUI.Form_OperationState.Default||this.operationState==YIUI.Form_OperationState.Delete){this.close();return true;}var b={msg:"是否确定要关闭界面？",msgType:YIUI.Dialog_MsgType.YES_NO};var c=new YIUI.Control.Dialog(b);c.render();var a=this;c.regEvent(YIUI.Dialog_Btn.STR_YES,function(){a.close();});c.regEvent(YIUI.Dialog_Btn.STR_NO,function(){});},close:function(){var a=this.getEvent(YIUI.FormEvent.Close);if(a){a.doTask(this,null);}if(this.target==2){$("#"+this.formID).close();YIUI.FormStack.removeForm(this.formID);}else{this.getContainer().removeForm(this);}},eval:function(formula,context,callback){if(formula){return this.parser.eval(formula,context,callback);}return null;},evalByTree:function(a,b,c){if(a!==null&&a!==undefined){return this.parser.evalByTree(a,b,c);}return null;},getSyntaxTree:function(a){if(a.length==0){return null;}else{return this.parser.getSyntaxTree(a);}},toJSON:function(){var b={};var a=this.formAdapt.toJSON();b.key=this.formKey;b.items=a;b.filterMap=this.getFilterMap();b.condParas=this.getCondParas();b.operationState=this.operationState;return $.toJSON(b);},destroy:function(){this.uiProcess=null;this.parser=null;this.document=null;this.dependency=null;this.isDestroyed=true;},regEvent:function(a,b){if(!this.eventList){this.eventList={};}this.eventList[a]=b;},getEvent:function(a){var b=null;if(this.eventList){b=this.eventList[a];}return b;},removeEvent:function(a){if(this.eventList){delete this.eventList[a];}},getTabCompList:function(){return this.tabCompList;},getFocusManager:function(){if(!this.focusManager){this.focusManager=new FocusPolicy(this);}return this.focusManager;},dealTabOrder:function(){this.tabCompList=[];var b;for(var d in this.getComponentList()){b=this.getComponentList()[d];b.setFocusManager(this.getFocusManager());if(b.getMetaObj().crFocus&&$.isNumeric(b.getMetaObj().tabOrder)&&b.getMetaObj().tabOrder!=-1){this.tabCompList.push(b);}}this.tabCompList.sort(function(g,f){return g.getMetaObj().tabOrder-f.getMetaObj().tabOrder;});var e=[];this.getRoot().getNoTabOrderComps(e);this.tabCompList=this.tabCompList.concat(e);for(var c=0,a=this.tabCompList.length;c<a;c++){b=this.tabCompList[c];if(b==undefined){continue;}b.setTabIndex(c);}}});var formID=1;YIUI.Form_allocFormID=function(){return formID++;};var FocusPolicy=FocusPolicy||{};(function(){FocusPolicy=function(b){var a={form:b,requestNextFocus:function(c){if(c==undefined||c==null){a.focusNextNode(0,a.form.getTabCompList().length);}else{a.doFocusNext(c.getTabIndex());}},doFocusNext:function(e){var d=e+1,c=a.form.getTabCompList().length;if(d<c){a.focusNextNode(d,c);}else{a.focusNextNode(0,c);}},focusNextNode:function(g,d){var f=false,e=g;var c=function(j){var h=a.form.getTabCompList()[j];var m=$(h.el).parents(".ui-tabs-panel");var l=(m.length>0&&m[0].style.display!=="none")||(m.length==0);if(h.enable&&h.visible&&l){if(h.type==YIUI.CONTROLTYPE.GRID){h.initFirstFocus();return true;}else{var k=h.el[0];if(k.getBoundingClientRect().top<document.documentElement.clientHeight&&k.getBoundingClientRect().left<document.documentElement.clientWidth){h.focus();return true;}}}return false;};while(e<d&&!f){f=c(e);e++;}if(!f){e=0;while(e<g&&!f){f=c(e);e++;}}}};return a;};})();(function(){YIUI.FormAdapt=function(b){var a={formID:-1,compList:{},cellMap:{},gridMap:[],cellSubDtlCompMap:{},LVMap:[],panelMap:[],optMap:{},rootPanel:null,defCtKey:null,init:function(c){if(!c){return;}this.rootPanel=YIUI.create(c);this.loadComp(this.compList,this.rootPanel);},loadComp:function(h,d){d.ofFormID=this.formID;d.id=d.ofFormID+"_"+d.getMetaObj().key;if(d.type==YIUI.CONTROLTYPE.LISTVIEW||d.type==YIUI.CONTROLTYPE.GRID){this.loadCellMap(this.cellMap,d);}if(d.items&&(d instanceof YIUI.Panel)){this.panelMap[d.getMetaObj().key]=d;for(var e=0;e<d.items.length;e++){this.loadComp(h,d.items[e]);}}else{if(d.type==YIUI.CONTROLTYPE.TOOLBAR){this.loadOptMap(this.optMap,d);}}h[d.getMetaObj().key]=d;var g=d.getMetaObj().bindingCellKey;var c=d.getMetaObj().parentGridKey;if(g!=null&&c!=null){var f=this.cellSubDtlCompMap[c];if(f==null){f={};this.cellSubDtlCompMap[c]=f;}if(f[g]==null){f[g]=[];}f[g].push(d);}},loadOptMap:function(l,e){for(var g=0,h,c=e.items.length;g<c;g++){h=e.items[g];l[h.key]={barKey:e.getMetaObj().key,opt:h};if(h.items){for(var f=0,k,d=h.items.length;f<d;f++){k=h.items[f];l[k.key]={barKey:e.getMetaObj().key,opt:k};}}}},loadCellMap:function(k,d){var h,j,g,n;if(d.type==YIUI.CONTROLTYPE.LISTVIEW){for(h=0,j=d.columnInfo.length;h<j;h++){var f=d.columnInfo[h];f.tableKey=d.getMetaObj().tableKey;n={};n.tableKey=d.getMetaObj().tableKey;n.key=d.getMetaObj().key;n.column=h;n.columnKey=f.columnKey;n.row=-1;this.addCellLocation(f.key,n);}this.LVMap.push(d);}else{if(d.type==YIUI.CONTROLTYPE.GRID){var c=d.dataModel.colModel.cells;var e={key:d.getMetaObj().key,tableKey:d.getMetaObj().tableKey};this.gridMap.push(e);for(var m in c){var l=c[m];if(l==undefined||l==null||l.length==0){continue;}n=this.getCellLocation(l.key);if(!n){n={};this.addCellLocation(l.key,n);}n.key=d.getMetaObj().key;n.column=l.colIndex;n.row=-1;n.tableKey=d.getMetaObj().tableKey;n.columnKey=l.columnKey;}}}},addCellLocation:function(d,c){this.cellMap[d]=c;},getOptMap:function(){return this.optMap;},getListView:function(d){if($.isNumeric(d)){var e=YIUI.TypeConvertor.toInt(d);return this.LVMap[e];}else{for(var f=0,c=this.LVMap.length;f<c;f++){var g=this.LVMap[f];if(g.getMetaObj().tableKey==d){return g;}}}},getPanel:function(c){return this.panelMap[c];},getCellSubDtlCompMap:function(){return this.cellSubDtlCompMap;},getGridMap:function(){return this.gridMap;},getCompList:function(){return this.compList;},getComp:function(c){return this.compList[c];},getRoot:function(){return this.rootPanel;},setRootPanel:function(c){this.rootPanel=c;},setCompValue:function(d,e,c){if(this.getComp(d)==undefined){YIUI.ViewException.throwException(YIUI.ViewException.NO_COMPONENT_KEY,d);}this.getComp(d).setValue(e,true,c);},setCellValByIndex:function(f,j,d,h,e){var c=this.getComp(f);var g=c==undefined?-1:c.type;switch(g){case YIUI.CONTROLTYPE.LISTVIEW:c.setValByIndex(j,d,h,true,e);break;case YIUI.CONTROLTYPE.GRID:if(c.getRowDataAt(j).isDetail){c.setValueAt(j,d,h,true,e,true);}break;default:YIUI.ViewException.throwException(YIUI.ViewException.NO_CELL_CANNOT_SET_VALUE);}},getCellValByIndex:function(e,h,d){var c=this.getComp(e);var f=c==undefined?-1:c.type,g;switch(f){case YIUI.CONTROLTYPE.LISTVIEW:g=c.getValue(h,d);break;case YIUI.CONTROLTYPE.GRID:g=c.getValueAt(h,d);break;default:YIUI.ViewException.throwException(YIUI.ViewException.CANNNOT_GET_NO_CELL_VALUE);}return g;},setCellValByKey:function(f,j,d,h,e){var c=this.getComp(f);var g=c==undefined?-1:c.type;switch(g){case YIUI.CONTROLTYPE.LISTVIEW:c.setValByKey(j,d,h,true,e);break;case YIUI.CONTROLTYPE.GRID:if(j!=-1&&c.getRowDataAt(j).isDetail){c.setValueByKey(j,d,h,true,e);}break;default:YIUI.ViewException.throwException(YIUI.ViewException.NO_CELL_CANNOT_SET_VALUE);}},getCellValByKey:function(e,h,d){var c=this.getComp(e);var f=c==undefined?-1:c.type,g;switch(f){case YIUI.CONTROLTYPE.LISTVIEW:g=c.getValByKey(h,d);break;case YIUI.CONTROLTYPE.GRID:g=c.getValueByKey(h,d);break;default:YIUI.ViewException.throwException(YIUI.ViewException.CANNNOT_GET_NO_CELL_VALUE);}return g;},getCompValue:function(f,e){var d=this.getCellLocation(f);var c,h;if(d){if(e==null){return null;}c=this.getComp(d.key);if(c.type==YIUI.CONTROLTYPE.LISTVIEW){return c.getValue(e.rowIndex,d.column);}else{if(c.type==YIUI.CONTROLTYPE.GRID){return c.getValueAt(e.rowIndex,d.column);}}var g=this.getDocument().getByKey(d.tableKey);var j=e.rowIndex;g.setPos(j);return g.getByKey(d.columnKey);}else{c=this.getComp(f);if(c==undefined){YIUI.ViewException.throwException(YIUI.ViewException.NO_COMPONENT_KEY,f);}h=c.getValue();return h;}},getCellLocation:function(c){return this.cellMap[c];},setDefContainer:function(c){this.defContainer=c;},getDefContainer:function(){if(this.defCtKey){return this.getComp(this.defCtKey);}return null;},setContainer:function(c){this.container=c;},getContainer:function(){return this.container;},toJSON:function(){var c=[],d=this.rootPanel;this.compToJson(d,c);return c;},compToJson:function(d,j){var f=d.items,h,e;for(var g=0,c=f.length;g<c;g++){h=f[g];if(h instanceof YIUI.Panel){this.compToJson(h,j);}else{if(!(h.type==YIUI.CONTROLTYPE.LISTVIEW||h.type==YIUI.CONTROLTYPE.GRID)){e={};e.key=h.getMetaObj().key;if(h.type==YIUI.CONTROLTYPE.DATEPICKER){if(h.getValue()){e.value=h.getValue().getTime();}else{e.value=null;}}else{e.value=h.getValue();}e.caption=h.caption;j.push(e);}}}}};a=$.extend(a,b);a.init(a.rootPanelObj);return a;};})();YIUI.FormBuilder=(function(){var a={build:function(p,k,e,d,b){var n=p.form,c=new YIUI.Form(n),l=p.document,o,j=p.dictCaption;c.dealTabOrder();if(l){o=YIUI.DataUtil.fromJSONDoc(l);c.setDocument(o);}if(j){c.dictCaption=j;}c.target=k||c.target;c.pFormID=e||c.parentID;if(k==YIUI.FormTarget.MODAL||c.target==YIUI.FormTarget.MODAL){var h=n.popHeight||"60%";var g=n.popWidth||"40%";var f=c.formID;var m=$("<div id="+f+"></div>");m.modalDialog(null,{title:c.formCaption,showClose:false,width:g,height:h});c.getRoot().render(m.dialogContent());}return c;},diff:function(d,f){var c=f.form,b=f.document,e;if(b){e=YIUI.DataUtil.fromJSONDoc(b);d.setDocument(e);}d.diff(c);return d;}};return a;})();YIUI.FormStack=(function(){var a={addForm:function(b){if(typeof this.formList=="undefined"){this.formList=new Array();}this.formList.push(b);},getForm:function(c){for(var b=0;b<this.formList.length;b++){if(c==this.formList[b].formID){return this.formList[b];}}return null;},removeForm:function(c){for(var b=0;b<this.formList.length;b++){if(c==this.formList[b].formID){this.formList[b].destroy();this.formList.splice(b,1);}}},removeAll:function(){if(!this.formList){return;}for(var b=0;b<this.formList.length;b++){this.formList[b].destroy();}this.formList=[];}};return a;})();(function(){YIUI.FileChooser=function(){var a={init:function(){this.$input=$("<input type='file' name='file' data-url='upload' class='opt upbtn' />").appendTo($(document.body)).hide();},upload:function(b,c){this.options=b||{};this.callback=c;this.$input.click();},install:function(){var b=this;this.$input.change(function(){var c=$.extend({cmd:"Import",service:"PureFileOperate",mode:1},b.options);$.ajaxFileUpload({url:Svr.SvrMgr.AttachURL,secureuri:false,fileElement:b.$input,data:c,type:"post",success:function(e,d,f){if($.isFunction(b.callback)){b.callback();}},error:function(f,d,g){alert(g);}});});}};a.init();a.install();return a;};})();