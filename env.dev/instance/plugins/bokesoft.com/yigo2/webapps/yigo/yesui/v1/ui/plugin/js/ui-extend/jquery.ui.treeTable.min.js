(function(a){a.fn.treeTable=function(b){b=a.extend({theme:"default",expandLevel:1,column:0,enable:true,onSelect:function(q,p){},beforeExpand:function(q,p){},doubleClick:null},b);var o=this;o.addClass("tree_table");var h={N:b.theme+"_node",AN:b.theme+"_active_node",O:b.theme+"_open",LO:b.theme+"_last_open",S:b.theme+"_shut",LS:b.theme+"_last_shut",HO:b.theme+"_hover_open",HS:b.theme+"_hover_shut",HLO:b.theme+"_hover_last_open",HLS:b.theme+"_hover_last_shut",L:b.theme+"_leaf",LL:b.theme+"_last_leaf",B:b.theme+"_blank",V:b.theme+"_vertline"};var m=this.pMap={},d=this.cMap={};var c=o.find("tr");f(c,true);o.click(function(s){var p=a(s.target);if(!b.enable){return}if(p.attr("arrow")){var q=p.attr("class");if(q==h.AN+" "+h.HLO||q==h.AN+" "+h.HO){var r=p.parents("tr[haschild]").eq(0);p.attr("class",h.AN+" "+(q.indexOf(h.HO)!=-1?h.HS:h.HLS));p.next().removeClass("icon_open").addClass("icon_close");l(r.attr("id"));return}else{if(q==h.AN+" "+h.HLS||q==h.AN+" "+h.HS){var r=p.parents("tr").eq(0);p.attr("class",h.AN+" "+(q.indexOf(h.HS)!=-1?h.HO:h.HLO));p.next().removeClass("icon_close").addClass("icon_open");b.beforeExpand(o,r);g(r.attr("id"));e(r);return}}}else{o.target=p;var r=p.parents("tr").eq(0);e(r)}});if(b.doubleClick){o.dblclick(function(r){var p=a(r.target);if(p.attr("arrow")){}else{var q=p.parents("tr").eq(0);k(q)}})}function k(p){if(p){if(b.doubleClick&&b.doubleClick(o,p)===false){return}}}function e(p){if(p){if(b.onSelect&&b.onSelect(o,p)===false){return}}}o.mouseover(j).mouseout(j);function j(s){var q=a(s.target);if(q.attr("controller")){q=q.parents("tr[haschild]").find("[arrow]")}if(q.attr("arrow")){var r=q.attr("class");if(r&&!r.indexOf(h.AN)){var p=b.theme.length+1;r=r.split(" ")[1].substr(p);if(r.indexOf("hover_")===0){r=b.theme+"_"+r.substr(6)}else{r=b.theme+"_hover_"+r}q.attr("class",h.AN+" "+r);return}}}function f(q,p){q.each(function(t){if(!this.id){return}var s=a(this).attr("pid")||-99999999;m[s]||(m[s]=[]);m[s].push(this.id);d[this.id]=s;a(this).addClass(s)}).find("[controller]").css("cursor","pointer");q.each(function(s){if(!this.id){return}var u=a(this);var v=r(this.id);u.attr("depth",v);if(p){v>b.expandLevel&&u.hide();if(u.attr("haschild")&&u.attr("depth")<b.expandLevel){var t=u.attr("islastone")?h.LO:h.O;u.find("."+h.AN).attr("class",h.AN+" "+t);u.find(".icon_close").removeClass("icon_close").addClass("icon_open")}}});q.each(function(s){if(!this.id){return}var t=a(this);n(t)});function r(t){if(d[t]==undefined||d[t]==-99999999){return 1}var s=r(d[t]);return s+1}}function l(q){if(!m[q]){return false}for(var p=0;p<m[q].length;p++){l(m[q][p])}a("tr."+q,o).hide()}function g(s){a("tr."+s,o).show();if(!m[s]){return false}for(var q=0;q<m[s].length;q++){var p=m[s][q];if(m[p]){var r=a("#"+p,o).find("."+h.AN).attr("class");(r==h.AN+" "+h.O||r==h.AN+" "+h.LO)&&g(p)}}}function n(x){var r=x.attr("id");if(x.children("td").eq(b.column).find(".prev_span").length>0){return x}if(d[r]==-99999999){var A=a('<span class="prev_span"></span>')}else{if(!x.attr("isfirstone")){var t=n(a("#"+x.attr("previd"),o));var A=t.children("td").eq(b.column).find(".prev_span").clone()}else{var u=a("#"+d[r],o);var A=u.children("td").eq(b.column).find(".prev_span").clone();if(u.attr("islastone")){A.append('<span class="'+h.N+" "+h.B+'"></span>')}else{A.append('<span class="'+h.N+" "+h.V+'"></span>')}}}var s=!x.attr("haschild");var z,w;if(!s){z=x.attr("islastone")?h.LS:h.S;z=h.AN+" "+z;w="icon_close"}else{z=h.N+" "+(x.attr("islastone")?h.LL:h.L);w="icon_leaf"}var p=x.children("td");var q;for(var v=0,y=p.length;v<y;v++){q=a(p[v]);q.html('<span class="tree_table_text">'+q.html()+"</span>")}q=p.eq(b.column);q.prepend('<span class="default_node '+w+'"></span>').prepend('<span arrow="true" class="'+z+'"></span>').prepend(A);return x}o.setEnable=function(p){b.enable=p};o.addChilds=function(s){var q=a(s);if(!q.length){return false}var p=function(A){var z=a("tr."+A,o);var x=z.length;if(x==0){return x}for(var w=0;w<z.length;w++){var y=z[w].id;x+=p(y)}return x};var v=function(z){if(!z.attr("id")){return}var A=z.attr("pid");if(!A){return false}var E=z.attr("previd")||A;if(E){var x=a("#"+E,o);if(x.length>0){if(z.attr("previd")&&a("tr."+E).length>0){var y=x.attr("depth");var F=x.nextUntil("tr[depth="+y+"]").last();if(F){F.after(a(z))}else{x.after(a(z))}}else{x.after(a(z))}var D=a("tr[pid="+A+"]",o);var B=D.index(z)+1;var C=D.length;if(B==1){D.filter("[isfirstone='true']").removeAttr("isfirstone").attr("previd",z.attr("id"));z.attr("isfirstone","true");if(C==1){z.attr("islastone","true")}}else{if(B>1){a(z).removeAttr("isfirstone");if(B==C){D.filter("[islastone='true']").removeAttr("islastone");z.attr("islastone","true")}else{z.removeAttr("islastone")}}}}else{x=q.filter("tr[id="+E+"]");if(x.length>0){v(x.eq(0));v(z)}}}else{if(z.attr("isfirstone")){var w=a("#"+A,o);w.after(a(z));var D=a("tr[pid="+A+"]",o);var C=D.length;if(C>1){D.filter("[isfirstone='true']").removeAttr("isfirstone").attr("previd",z.attr("id"));z.attr("isfirstone","true")}if(C==1){z.attr("islastone","true")}}else{}}};var u=function(A){if(!A.attr("id")){return}var y=A.attr("pid");if(!y){return false}var B=A.attr("previd")||y;var w=a("#"+B,o);if(w.length>0){var x=a("#"+y,o).find('[arrow="true"]');var z=x.attr("class");if(z==h.AN+" "+h.S||z==h.AN+" "+h.LS){x.attr("class",h.AN+" "+(z.indexOf(h.S)!=-1?h.O:h.LO));x.next().removeClass("icon_close").addClass("icon_open")}}};for(var r=0;r<q.length;r++){var t=q.eq(r);v(t)}f(q);for(var r=0;r<q.length;r++){var t=q.eq(r);u(t)}};var i=function(v){var p=v.attr("id");var q=v.children("td").eq(b.column);var w=q.find(".prev_span");if(w.length>0){w.remove();if(d[p]==-99999999){var z=a('<span class="prev_span"></span>')}else{if(!v.attr("isfirstone")){var s=n(a("#"+v.attr("previd"),o));var z=s.children("td").eq(b.column).find(".prev_span").clone()}else{var t=a("#"+d[p],o);var z=t.children("td").eq(b.column).find(".prev_span").clone();if(t.attr("islastone")){z.append('<span class="'+h.N+" "+h.B+'"></span>')}else{z.append('<span class="'+h.N+" "+h.V+'"></span>')}}}q.prepend(z);var r=!v.attr("haschild");var x,u;if(!r){x=v.attr("islastone")?h.LS:h.S;x=h.AN+" "+x}else{x=h.N+" "+(v.attr("islastone")?h.LL:h.L)}var y=v.find('[arrow="true"]');y.removeClass().addClass(x);return v}else{return n(v)}};o.deleteChilds=function(p){a.each(p,function(t,q){var u=a("#"+q,o);if(q=="Material_75583"){var A=1;A=A+1}var w=u.attr("pid")||-99999999;if(u.attr("islastone")=="true"){var r=a("#"+u.attr("previd"),o);if(r.length>0){r.attr("islastone","true");i(r)}}if(u.attr("isfirstone")=="true"){var s=a(a("tr[previd='"+q+"']",this._$table));if(s.length>0){s.attr("isfirstone",true)}}u.remove();var v;v=m[w].indexOf(""+q);m[w].splice(v,1);delete d[q];var z=a("#"+w,o);if(m[w].length==0){var y=a("#"+w,o).find('[arrow="true"]');var x=y.attr("class");if(x==h.AN+" "+h.O){y.attr("class",h.AN+" "+(x.indexOf(h.O)!=-1?h.S:h.LS));y.next().removeClass("icon_open").addClass("icon_close")}}})};o.expand=function(p){b.beforeExpand(o,p);g(p.attr("id"))};o.clearAll=function(){var p=0;a("tr[pid]",o).remove();m={},d={}};o.removeChildren=function(r){if(m[r]){var p=m[r].length;for(var q=0;q<p;q++){o.removeNode(m[r][q])}}};o.formatNode=n;o.removeNode=function(q,w){if(m[q]){for(var t=0;t<m[q].length;t++){o.removeNode(m[q][t])}delete m[q]}delete d[q];if(w){var v=a("#"+q,o);var u=v.index();var x=v.attr("isfirstone");var p=v.attr("islastone");if(x&&p){var y=v.attr("pid");var A=a("#"+y,o).find('[arrow="true"]');var z=A.attr("class");if(z==w.AN+" "+w.O){A.attr("class",w.AN+" "+(z.indexOf(w.O)!=-1?w.S:w.LS));A.next().removeClass("icon_open").addClass("icon_close")}}else{if(x){var s=a(a("tr[previd='"+q+"']",this._$table));if(s.length>0){s.attr("isfirstone",true)}}else{if(p){var r=a("#"+v.attr("previd"),o);if(r.length>0){r.attr("islastone","true");i(r)}}else{var C=v.attr("previd");var B=v.prev().attr("previd",C)}}}}a("#"+q,o).remove()};return o}})(jQuery);