(function(){var c,b,d,a;c=jQuery;b=(function(){function e(h,f,g){var i;this.row=h;this.tree=f;this.settings=g;this.id=this.row.attr(this.settings.nodeIdAttr);i=this.row.attr(this.settings.parentIdAttr);if(i!=null&&i!==""){this.parentId=i}this.treeCell=c(this.row.children(this.settings.columnElType)[this.settings.column]);this.expander=c(this.settings.expanderTemplate);this.indenter=c(this.settings.indenterTemplate);this.children=[];this.initialized=false;this.treeCell.prepend(this.indenter)}e.prototype.addChild=function(f){return this.children.push(f)};e.prototype.ancestors=function(){var f,g;g=this;f=[];while(g=g.parentNode()){f.push(g)}return f};e.prototype.collapse=function(){this._hideChildren();this.row.removeClass("expanded").addClass("collapsed");this.expander.attr("title",this.settings.stringExpand);if(this.initialized&&this.settings.onNodeCollapse!=null){this.settings.onNodeCollapse.apply(this)}return this};e.prototype.expand=function(){this.row.removeClass("collapsed").addClass("expanded");if(this.initialized&&this.settings.beforeExpand!=null){this.settings.beforeExpand(this.row)}this._showChildren();this.expander.attr("title",this.settings.stringCollapse);return this};e.prototype.expanded=function(){return this.row.hasClass("expanded")};e.prototype.hide=function(){this._hideChildren();this.row.hide();return this};e.prototype.isBranchNode=function(){if(this.children.length>0||this.row.data(this.settings.branchAttr)===true){return true}else{return false}};e.prototype.level=function(){return this.ancestors().length};e.prototype.parentNode=function(){if(this.parentId!=null){return this.tree[this.parentId]}else{return null}};e.prototype.removeChild=function(g){var f=c.inArray(g,this.children);return this.children.splice(f,1)};e.prototype.removeChildren=function(){this.children=[];return this.children};e.prototype.render=function(){var f=this.settings,g;if((f.expandable===true&&this.isBranchNode())||this.row.attr("haschild")=="true"){this.indenter.html(this.expander);g=f.clickableNodeNames===true?this.treeCell:this.expander}else{if(this.row.attr("haschild")!="true"){this.indenter.addClass("noChild")}}if(this.row.hasClass("root")){this.expand()}else{if(f.expandable===true&&f.initialState==="collapsed"){this.collapse()}}this.indenter[0].style.paddingLeft=""+(this.level()*f.indent)+"px";this.indenter[0].style.width=""+(this.level()*f.indent+40)+"px";return this};e.prototype.reveal=function(){if(this.parentId!=null){this.parentNode().reveal()}return this.expand()};e.prototype.setParent=function(f){if(this.parentId!=null){this.tree[this.parentId].removeChild(this)}this.parentId=f.id;this.row.attr(this.settings.parentIdAttr,f.id);return f.addChild(this)};e.prototype.show=function(){if(!this.initialized){this._initialize()}this.row.show();if(this.expanded()){this._showChildren()}return this};e.prototype.toggle=function(){if(this.expanded()){this.collapse()}else{this.expand()}return this};e.prototype._hideChildren=function(){var j,i,g,h,f;h=this.children;f=[];for(i=0,g=h.length;i<g;i++){j=h[i];f.push(j.hide())}return f};e.prototype._initialize=function(){this.render();if(this.settings.onNodeInitialized!=null){this.settings.onNodeInitialized.apply(this)}return this.initialized=true};e.prototype._showChildren=function(){var j,i,g,h,f;h=this.children;f=[];for(i=0,g=h.length;i<g;i++){j=h[i];f.push(j.show())}return f};return e})();d=(function(){function e(g,f){this.table=g;this.settings=f;this.tree={};this.nodes=[];this.roots=[]}e.prototype.collapseAll=function(){var h,j,g,i,f;i=this.nodes;f=[];for(j=0,g=i.length;j<g;j++){h=i[j];f.push(h.collapse())}return f};e.prototype.expandAll=function(){var h,j,g,i,f;i=this.nodes;f=[];for(j=0,g=i.length;j<g;j++){h=i[j];f.push(h.expand())}return f};e.prototype.loadRows=function(h){var g,j,f;if(h!=null){for(f=0;f<h.length;f++){j=c(h[f]);if(j.attr(this.settings.nodeIdAttr)!=null){g=new b(j,this.tree,this.settings);this.nodes.push(g);this.tree[g.id]=g;if(g.parentId!=null){this.tree[g.parentId].addChild(g)}else{this.roots.push(g)}}}}return this};e.prototype.move=function(g,f){if(g!==f&&f.id!==g.parentId&&c.inArray(g,f.ancestors())===-1){g.setParent(f);this._moveRows(g,f);if(g.parentNode().children.length===1){g.parentNode().render()}}return this};e.prototype.render=function(){var g,i,f,h;h=this.roots;for(i=0,f=h.length;i<f;i++){g=h[i];g.show()}return this};e.prototype._moveRows=function(i,f){var l,k,h,j,g;i.row.insertAfter(f.row);i.render();j=i.children;g=[];for(k=0,h=j.length;k<h;k++){l=j[k];g.push(this._moveRows(l,i))}return g};e.prototype.unloadBranch=function(h){var j,g,f;for(f=0;f<h.children.length;f++){j=h.children[f];this.unloadBranch(j);j.row.remove();delete this.tree[j.id];this.nodes.splice(c.inArray(j,this.nodes),1)}h.children=[];return this};return e})();a={init:function(e){var f;f=c.extend({branchAttr:"ttBranch",clickableNodeNames:false,column:0,columnElType:"td",expandable:false,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"id",parentIdAttr:"pid",stringExpand:"Expand",stringCollapse:"Collapse",strFolder:"folder",strFile:"file",onInitialized:null,onNodeCollapse:null,beforeExpand:null,onNodeInitialized:null,onSelect:c.noop},e);this.each(function(){var h,g;g=new d(this,f);g.loadRows(this.rows).render();h=c(this).addClass("treetable").addClass("tree_table").data("treetable",g);if(f.onInitialized!=null){f.onInitialized.apply(g)}h.delegate("tr","click",function(j){var i=c(j.target);if(i.hasClass("indenter")||i.parent().hasClass("indenter")){h.treetable("node",c(this).attr(f.nodeIdAttr)).toggle();return j.preventDefault()}if(h.attr("enable")=="false"){return}c("tr.selected",h).removeClass("selected");c(this).addClass("selected");var i=c(j.target);f.el.target=i;f.onSelect(f.el,c(this))});f.el=h;h.treeNode=g;h.renderAll=true;h.addChilds=a.addChilds;h.removeNode=a.removeNode;h.removeNodes=a.removeNodes;h.removeAll=a.removeAll;h.removeChildren=a.removeChildren;h.expand=a.expand;h.setEnable=a.setEnable});return f.el},setEnable:function(e){this.attr("enable",e)},addChilds:function(h){var s=c(h),r,j,p,e,o;var f=this;var q=this.treeNode;for(var g=0,n=s.length;g<n;g++){r=s.eq(g);j=r.attr("pid");p=r.attr("previd");o=c("#"+j,f);var l=q.tree[j];var m=l.expanded();if(!m){l.expand()}if(p){e=c("#"+p,f);var k=c("[pid="+p+"]",f).last();if(k.length>0){k.after(r)}else{e.after(r)}}else{o.after(r)}}c(this).each(function(){q.loadRows(s).render();f.tree=q.tree;f.data("treetable",q)})},removeChildren:function(k){var f=this.treeNode.tree;var j=f[k];var h=j.children;if(!h){return}for(var g=0,e=h.length;g<e;g++){this.removeChildren(h[g].id)}j.removeChildren();c("[pid="+j.id+"]",this).remove()},removeNodes:function(g){for(var f=0,e=g.length;f<e;f++){this.removeNode(g[f])}},removeAll:function(){var f=this.treeNode.roots;if(f){for(var g=0,e=f.length;g<e;g++){this.removeNode(f[g].id)}}},removeNode:function(e){var p=this.treeNode.tree;var f=p[e];if(!f){return}var o=f.settings.el;if(f.children.length>0){for(var g=0,k=f.children.length;g<k;g++){var l=f.children[g].id;f.children[g].row.remove();delete p[l]}}var j=p[f.parentId];if(j&&j.children.length>0){for(var g=0,k=j.children.length;g<k;g++){if(j.children[g].id==e){j.removeChild(j.children[g]);break}}}delete p[e];var h=c("#"+e,o);var n=h.attr("previd");var m=c("[previd='"+e+"']",o);if(m.length>0){if(n){m.attr("previd",n)}else{m.removeAttr("previd")}}c("#"+e,o).remove()},expand:function(g){var h=g.attr("id");var e=this.treeNode.tree;var f=e[h];f.expand()},destroy:function(){return this.each(function(){return c(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){this.data("treetable").collapseAll();return this},collapseNode:function(f){var e=this.data("treetable").tree[f];if(e){e.collapse()}else{throw new Error("Unknown node '"+f+"'")}return this},expandAll:function(){this.data("treetable").expandAll();return this},expandNode:function(f){var e=this.data("treetable").tree[f];if(e){e.expand()}else{throw new Error("Unknown node '"+f+"'")}return this},loadBranch:function(e,f){f=c(f);f.insertAfter(e.row);this.data("treetable").loadRows(f);return this},move:function(h,g){var e,f;f=this.data("treetable").tree[h];e=this.data("treetable").tree[g];this.data("treetable").move(f,e);return this},node:function(e){return this.data("treetable").tree[e]},reveal:function(f){var e=this.data("treetable").tree[f];if(e){e.reveal()}else{throw new Error("Unknown node '"+f+"'")}return this},unloadBranch:function(e){this.data("treetable").unloadBranch(e);return this}};c.fn.treetable=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments)}else{return c.error("Method "+e+" does not exist on jQuery.treetable")}}};this.TreeTable||(this.TreeTable={});this.TreeTable.Node=b;this.TreeTable.Tree=d}).call(this);